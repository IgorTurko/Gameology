"use strict";
/// <reference path="../typings/index.d.ts" />
var express = require("express");
var db_1 = require("../data-access/db");
var in_memory_authentication_token_storage_1 = require("../services/authentication/in-memory-authentication-token-storage");
var authentication_token_provider_1 = require("../services/authentication/authentication-token-provider");
var authentication_middleware_1 = require("../web/authentication-middleware");
var db = new db_1.default();
// const tokenStorage = new MongoAuthenticationTokenStorage(db);
var tokenStorage = new in_memory_authentication_token_storage_1.default();
var tokenProvider = new authentication_token_provider_1.default(tokenStorage);
var authenticationMiddleware = new authentication_middleware_1.default(tokenProvider);
var router = express.Router();
router.post("/login", function (req, res, next) {
    var info = req.body;
    if (info.login) {
        authenticationMiddleware.signIn(res, info.login);
        res.sendStatus(200)
            .end();
    }
    else {
        res.sendStatus(400)
            .end();
    }
});
router.use("*", function (res, req, next) { return authenticationMiddleware.run(res, req, next); });
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = router;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aGVudGljYXRpb24tcm91dGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zZXJ2ZXIvcm91dGVzL2F1dGhlbnRpY2F0aW9uLXJvdXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw4Q0FBOEM7QUFDOUMsSUFBWSxPQUFPLFdBQU0sU0FBUyxDQUFDLENBQUE7QUFFbkMsbUJBQWUsbUJBQW1CLENBQUMsQ0FBQTtBQUVuQyx1REFBK0MsbUVBQW1FLENBQUMsQ0FBQTtBQUNuSCw4Q0FBd0MsMERBQTBELENBQUMsQ0FBQTtBQUNuRywwQ0FBcUMsa0NBQWtDLENBQUMsQ0FBQTtBQUV4RSxJQUFNLEVBQUUsR0FBRyxJQUFJLFlBQUUsRUFBRSxDQUFDO0FBRXBCLGdFQUFnRTtBQUNoRSxJQUFNLFlBQVksR0FBRyxJQUFJLGdEQUFrQyxFQUFFLENBQUM7QUFDOUQsSUFBTSxhQUFhLEdBQUcsSUFBSSx1Q0FBMkIsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUNwRSxJQUFNLHdCQUF3QixHQUFHLElBQUksbUNBQXdCLENBQUMsYUFBYSxDQUFDLENBQUM7QUFFN0UsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBRWhDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJO0lBRWpDLElBQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDdEIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDYix3QkFBd0IsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqRCxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQzthQUNkLEdBQUcsRUFBRSxDQUFDO0lBQ2YsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ0osR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUM7YUFDZCxHQUFHLEVBQUUsQ0FBQztJQUNmLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLFVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLElBQUssT0FBQSx3QkFBd0IsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBNUMsQ0FBNEMsQ0FBQyxDQUFDO0FBRWxGO2tCQUFlLE1BQU0sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxyXG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XHJcblxyXG5pbXBvcnQgRGIgZnJvbSBcIi4uL2RhdGEtYWNjZXNzL2RiXCI7XHJcbmltcG9ydCBNb25nb0F1dGhlbnRpY2F0aW9uVG9rZW5TdG9yYWdlIGZyb20gXCIuLi9zZXJ2aWNlcy9hdXRoZW50aWNhdGlvbi9tb25nby1hdXRoZW50aWNhdGlvbi10b2tlbi1zdG9yYWdlXCI7XHJcbmltcG9ydCBJbk1lbW9yeUF1dGhlbnRpY2F0aW9uVG9rZW5TdG9yYWdlIGZyb20gXCIuLi9zZXJ2aWNlcy9hdXRoZW50aWNhdGlvbi9pbi1tZW1vcnktYXV0aGVudGljYXRpb24tdG9rZW4tc3RvcmFnZVwiO1xyXG5pbXBvcnQgQXV0aGVudGljYXRpb25Ub2tlblByb3ZpZGVyIGZyb20gXCIuLi9zZXJ2aWNlcy9hdXRoZW50aWNhdGlvbi9hdXRoZW50aWNhdGlvbi10b2tlbi1wcm92aWRlclwiO1xyXG5pbXBvcnQgQXV0aGVudGljYXRpb25NaWRkbGV3YXJlIGZyb20gXCIuLi93ZWIvYXV0aGVudGljYXRpb24tbWlkZGxld2FyZVwiO1xyXG5cclxuY29uc3QgZGIgPSBuZXcgRGIoKTtcclxuXHJcbi8vIGNvbnN0IHRva2VuU3RvcmFnZSA9IG5ldyBNb25nb0F1dGhlbnRpY2F0aW9uVG9rZW5TdG9yYWdlKGRiKTtcclxuY29uc3QgdG9rZW5TdG9yYWdlID0gbmV3IEluTWVtb3J5QXV0aGVudGljYXRpb25Ub2tlblN0b3JhZ2UoKTtcclxuY29uc3QgdG9rZW5Qcm92aWRlciA9IG5ldyBBdXRoZW50aWNhdGlvblRva2VuUHJvdmlkZXIodG9rZW5TdG9yYWdlKTtcclxuY29uc3QgYXV0aGVudGljYXRpb25NaWRkbGV3YXJlID0gbmV3IEF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZSh0b2tlblByb3ZpZGVyKTtcclxuXHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcblxyXG5yb3V0ZXIucG9zdChcIi9sb2dpblwiLCAocmVxLCByZXMsIG5leHQpID0+IHtcclxuXHJcbiAgICBjb25zdCBpbmZvID0gcmVxLmJvZHk7XHJcbiAgICBpZiAoaW5mby5sb2dpbikge1xyXG4gICAgICAgIGF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZS5zaWduSW4ocmVzLCBpbmZvLmxvZ2luKTtcclxuICAgICAgICByZXMuc2VuZFN0YXR1cygyMDApXHJcbiAgICAgICAgICAgIC5lbmQoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNDAwKVxyXG4gICAgICAgICAgICAuZW5kKCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxucm91dGVyLnVzZShcIipcIiwgKHJlcywgcmVxLCBuZXh0KSA9PiBhdXRoZW50aWNhdGlvbk1pZGRsZXdhcmUucnVuKHJlcywgcmVxLCBuZXh0KSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCByb3V0ZXI7Il19