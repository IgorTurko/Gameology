"use strict";
/// <reference path="../typings/index.d.ts" />
var express = require("express");
var db_1 = require("../data-access/db");
var mongo_authentication_token_storage_1 = require("../services/authentication/mongo-authentication-token-storage");
var authentication_token_provider_1 = require("../services/authentication/authentication-token-provider");
var authentication_middleware_1 = require("../web/authentication-middleware");
var db = new db_1.default();
var tokenStorage = new mongo_authentication_token_storage_1.default(db);
// const tokenStorage = new InMemoryAuthenticationTokenStorage();
var tokenProvider = new authentication_token_provider_1.default(tokenStorage);
var authenticationMiddleware = new authentication_middleware_1.default(tokenProvider);
var router = express.Router();
router.post("/login", function (req, res, next) {
    var info = req.body;
    if (info.login) {
        authenticationMiddleware.signIn(req, res, info.login)
            .then(function () {
            res.sendStatus(200)
                .end();
        });
    }
    else {
        res.sendStatus(400)
            .end();
    }
});
router.use("*", function (res, req, next) { return authenticationMiddleware.run(res, req, next); });
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = router;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aGVudGljYXRpb24tcm91dGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zZXJ2ZXIvcm91dGVzL2F1dGhlbnRpY2F0aW9uLXJvdXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQyw4Q0FBOEM7QUFDL0MsSUFBWSxPQUFPLFdBQU0sU0FBUyxDQUFDLENBQUE7QUFFbkMsbUJBQWUsbUJBQW1CLENBQUMsQ0FBQTtBQUNuQyxtREFBNEMsK0RBQStELENBQUMsQ0FBQTtBQUU1Ryw4Q0FBd0MsMERBQTBELENBQUMsQ0FBQTtBQUNuRywwQ0FBcUMsa0NBQWtDLENBQUMsQ0FBQTtBQUV4RSxJQUFNLEVBQUUsR0FBRyxJQUFJLFlBQUUsRUFBRSxDQUFDO0FBRXBCLElBQU0sWUFBWSxHQUFHLElBQUksNENBQStCLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDN0QsaUVBQWlFO0FBQ2pFLElBQU0sYUFBYSxHQUFHLElBQUksdUNBQTJCLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDcEUsSUFBTSx3QkFBd0IsR0FBRyxJQUFJLG1DQUF3QixDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBRTdFLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUVoQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFDcEIsVUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUk7SUFDWCxJQUFNLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO0lBRXRCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2Isd0JBQXdCLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQzthQUNoRCxJQUFJLENBQUM7WUFDRixHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQztpQkFDZCxHQUFHLEVBQUUsQ0FBQztRQUNmLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ0osR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUM7YUFDZCxHQUFHLEVBQUUsQ0FBQztJQUNmLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLFVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLElBQUssT0FBQSx3QkFBd0IsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBNUMsQ0FBNEMsQ0FBQyxDQUFDO0FBRWxGO2tCQUFlLE1BQU0sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIu+7vy8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxuaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuXG5pbXBvcnQgRGIgZnJvbSBcIi4uL2RhdGEtYWNjZXNzL2RiXCI7XG5pbXBvcnQgTW9uZ29BdXRoZW50aWNhdGlvblRva2VuU3RvcmFnZSBmcm9tIFwiLi4vc2VydmljZXMvYXV0aGVudGljYXRpb24vbW9uZ28tYXV0aGVudGljYXRpb24tdG9rZW4tc3RvcmFnZVwiO1xuaW1wb3J0IEluTWVtb3J5QXV0aGVudGljYXRpb25Ub2tlblN0b3JhZ2UgZnJvbSBcIi4uL3NlcnZpY2VzL2F1dGhlbnRpY2F0aW9uL2luLW1lbW9yeS1hdXRoZW50aWNhdGlvbi10b2tlbi1zdG9yYWdlXCI7XG5pbXBvcnQgQXV0aGVudGljYXRpb25Ub2tlblByb3ZpZGVyIGZyb20gXCIuLi9zZXJ2aWNlcy9hdXRoZW50aWNhdGlvbi9hdXRoZW50aWNhdGlvbi10b2tlbi1wcm92aWRlclwiO1xuaW1wb3J0IEF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZSBmcm9tIFwiLi4vd2ViL2F1dGhlbnRpY2F0aW9uLW1pZGRsZXdhcmVcIjtcblxuY29uc3QgZGIgPSBuZXcgRGIoKTtcblxuY29uc3QgdG9rZW5TdG9yYWdlID0gbmV3IE1vbmdvQXV0aGVudGljYXRpb25Ub2tlblN0b3JhZ2UoZGIpO1xuLy8gY29uc3QgdG9rZW5TdG9yYWdlID0gbmV3IEluTWVtb3J5QXV0aGVudGljYXRpb25Ub2tlblN0b3JhZ2UoKTtcbmNvbnN0IHRva2VuUHJvdmlkZXIgPSBuZXcgQXV0aGVudGljYXRpb25Ub2tlblByb3ZpZGVyKHRva2VuU3RvcmFnZSk7XG5jb25zdCBhdXRoZW50aWNhdGlvbk1pZGRsZXdhcmUgPSBuZXcgQXV0aGVudGljYXRpb25NaWRkbGV3YXJlKHRva2VuUHJvdmlkZXIpO1xuXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG5yb3V0ZXIucG9zdChcIi9sb2dpblwiLFxuKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgaW5mbyA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKGluZm8ubG9naW4pIHtcbiAgICAgICAgYXV0aGVudGljYXRpb25NaWRkbGV3YXJlLnNpZ25JbihyZXEsIHJlcywgaW5mby5sb2dpbilcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICByZXMuc2VuZFN0YXR1cygyMDApXG4gICAgICAgICAgICAgICAgICAgIC5lbmQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDQwMClcbiAgICAgICAgICAgIC5lbmQoKTtcbiAgICB9XG59KTtcblxucm91dGVyLnVzZShcIipcIiwgKHJlcywgcmVxLCBuZXh0KSA9PiBhdXRoZW50aWNhdGlvbk1pZGRsZXdhcmUucnVuKHJlcywgcmVxLCBuZXh0KSk7XG5cbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjsiXX0=