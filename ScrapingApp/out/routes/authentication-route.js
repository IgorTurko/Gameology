"use strict";
/// <reference path="../typings/index.d.ts" />
var express = require("express");
var db_1 = require("../data-access/db");
var in_memory_authentication_token_storage_1 = require("../services/authentication/in-memory-authentication-token-storage");
var authentication_token_provider_1 = require("../services/authentication/authentication-token-provider");
var authentication_middleware_1 = require("../web/authentication-middleware");
var db = new db_1.default();
// const tokenStorage = new MongoAuthenticationTokenStorage(db);
var tokenStorage = new in_memory_authentication_token_storage_1.default();
var tokenProvider = new authentication_token_provider_1.default(tokenStorage);
var authenticationMiddleware = new authentication_middleware_1.default(tokenProvider);
var router = express.Router();
router.post("/login", function (req, res, next) {
    var info = req.body;
    if (info.login) {
        authenticationMiddleware.signIn(res, info.login)
            .then(function () {
            res.sendStatus(200)
                .end();
        });
    }
    else {
        res.sendStatus(400)
            .end();
    }
});
router.use("*", function (res, req, next) { return authenticationMiddleware.run(res, req, next); });
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = router;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aGVudGljYXRpb24tcm91dGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zZXJ2ZXIvcm91dGVzL2F1dGhlbnRpY2F0aW9uLXJvdXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw4Q0FBOEM7QUFDOUMsSUFBWSxPQUFPLFdBQU0sU0FBUyxDQUFDLENBQUE7QUFFbkMsbUJBQWUsbUJBQW1CLENBQUMsQ0FBQTtBQUVuQyx1REFBK0MsbUVBQW1FLENBQUMsQ0FBQTtBQUNuSCw4Q0FBd0MsMERBQTBELENBQUMsQ0FBQTtBQUNuRywwQ0FBcUMsa0NBQWtDLENBQUMsQ0FBQTtBQUV4RSxJQUFNLEVBQUUsR0FBRyxJQUFJLFlBQUUsRUFBRSxDQUFDO0FBRXBCLGdFQUFnRTtBQUNoRSxJQUFNLFlBQVksR0FBRyxJQUFJLGdEQUFrQyxFQUFFLENBQUM7QUFDOUQsSUFBTSxhQUFhLEdBQUcsSUFBSSx1Q0FBMkIsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUNwRSxJQUFNLHdCQUF3QixHQUFHLElBQUksbUNBQXdCLENBQUMsYUFBYSxDQUFDLENBQUM7QUFFN0UsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBRWhDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUNwQixVQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSTtJQUVYLElBQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDdEIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDYix3QkFBd0IsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUM7YUFDM0MsSUFBSSxDQUFDO1lBQ0YsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUM7aUJBQ2QsR0FBRyxFQUFFLENBQUM7UUFDZixDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNKLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDO2FBQ2QsR0FBRyxFQUFFLENBQUM7SUFDZixDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxVQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxJQUFLLE9BQUEsd0JBQXdCLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQTVDLENBQTRDLENBQUMsQ0FBQztBQUVsRjtrQkFBZSxNQUFNLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xyXG5cclxuaW1wb3J0IERiIGZyb20gXCIuLi9kYXRhLWFjY2Vzcy9kYlwiO1xyXG5pbXBvcnQgTW9uZ29BdXRoZW50aWNhdGlvblRva2VuU3RvcmFnZSBmcm9tIFwiLi4vc2VydmljZXMvYXV0aGVudGljYXRpb24vbW9uZ28tYXV0aGVudGljYXRpb24tdG9rZW4tc3RvcmFnZVwiO1xyXG5pbXBvcnQgSW5NZW1vcnlBdXRoZW50aWNhdGlvblRva2VuU3RvcmFnZSBmcm9tIFwiLi4vc2VydmljZXMvYXV0aGVudGljYXRpb24vaW4tbWVtb3J5LWF1dGhlbnRpY2F0aW9uLXRva2VuLXN0b3JhZ2VcIjtcclxuaW1wb3J0IEF1dGhlbnRpY2F0aW9uVG9rZW5Qcm92aWRlciBmcm9tIFwiLi4vc2VydmljZXMvYXV0aGVudGljYXRpb24vYXV0aGVudGljYXRpb24tdG9rZW4tcHJvdmlkZXJcIjtcclxuaW1wb3J0IEF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZSBmcm9tIFwiLi4vd2ViL2F1dGhlbnRpY2F0aW9uLW1pZGRsZXdhcmVcIjtcclxuXHJcbmNvbnN0IGRiID0gbmV3IERiKCk7XHJcblxyXG4vLyBjb25zdCB0b2tlblN0b3JhZ2UgPSBuZXcgTW9uZ29BdXRoZW50aWNhdGlvblRva2VuU3RvcmFnZShkYik7XHJcbmNvbnN0IHRva2VuU3RvcmFnZSA9IG5ldyBJbk1lbW9yeUF1dGhlbnRpY2F0aW9uVG9rZW5TdG9yYWdlKCk7XHJcbmNvbnN0IHRva2VuUHJvdmlkZXIgPSBuZXcgQXV0aGVudGljYXRpb25Ub2tlblByb3ZpZGVyKHRva2VuU3RvcmFnZSk7XHJcbmNvbnN0IGF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZSA9IG5ldyBBdXRoZW50aWNhdGlvbk1pZGRsZXdhcmUodG9rZW5Qcm92aWRlcik7XHJcblxyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5cclxucm91dGVyLnBvc3QoXCIvbG9naW5cIixcclxuKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcblxyXG4gICAgY29uc3QgaW5mbyA9IHJlcS5ib2R5O1xyXG4gICAgaWYgKGluZm8ubG9naW4pIHtcclxuICAgICAgICBhdXRoZW50aWNhdGlvbk1pZGRsZXdhcmUuc2lnbkluKHJlcywgaW5mby5sb2dpbilcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmRTdGF0dXMoMjAwKVxyXG4gICAgICAgICAgICAgICAgICAgIC5lbmQoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDQwMClcclxuICAgICAgICAgICAgLmVuZCgpO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbnJvdXRlci51c2UoXCIqXCIsIChyZXMsIHJlcSwgbmV4dCkgPT4gYXV0aGVudGljYXRpb25NaWRkbGV3YXJlLnJ1bihyZXMsIHJlcSwgbmV4dCkpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcm91dGVyOyJdfQ==