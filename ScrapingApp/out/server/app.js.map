{"version":3,"sources":["webpack:///webpack/bootstrap 47bb8843970626da1d71","webpack:///./server/extensions.ts","webpack:///./server/app.ts","webpack:///./server/web-server.ts","webpack:///external \"http\"","webpack:///external \"express\"","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///./server/web/routes/authentication-route.ts","webpack:///./server/data-access/db.ts","webpack:///external \"mongodb\"","webpack:///./server/config.ts","webpack:///external \"fs\"","webpack:///./server/services/authentication/mongo-authentication-token-storage.ts","webpack:///./server/services/authentication/authentication-token-provider.ts","webpack:///external \"node-uuid\"","webpack:///external \"moment\"","webpack:///./server/services/users/mongo-user-account-storage.ts","webpack:///./server/services/users/user-account-service.ts","webpack:///./server/web/authentication-middleware.ts","webpack:///./server/web/routes/product-route.ts","webpack:///./server/services/products/mongo-product-storage.ts","webpack:///./server/services/products/product-service.ts","webpack:///./server/services/event-bus.ts","webpack:///external \"events\"","webpack:///./server/services/products/product-validator.ts","webpack:///external \"pojo-fluent-validator\"","webpack:///./server/services/utils.ts","webpack:///./server/web/routes/web-shop-route.ts","webpack:///./server/services/web-shop/mongo-web-shop-storage.ts","webpack:///./server/services/web-shop/web-shop-service.ts","webpack:///./server/services/web-shop/web-shop-validator.ts","webpack:///./server/scrape-server.ts","webpack:///./server/services/scraping/scrape-service.ts","webpack:///./server/scrapers/jsdom-scraper.ts","webpack:///external \"jsdom\"","webpack:///external \"debug\"","webpack:///./server/scrapers/value-parser.ts","webpack:///external \"path\"","webpack:///./server/services/scraping/scrape-queue-service.ts","webpack:///external \"async\"","webpack:///./server/services/scraping/scrape-scheduler-service.ts","webpack:///external \"node-schedule\"","webpack:///./server/socket-server.ts","webpack:///external \"socket.io\""],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;ACtCA;AACA;AACA;AACA,yDAAwD,YAAY,EAAE;AACtE;AACA;AACA;AACA;AACA;AACA,UAAS,IAAI;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAuB,iBAAiB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAuB,iBAAiB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC;AACrC,8BAA6B,0BAA0B,EAAE,EAAE;AAC3D;;;;;;;ACrDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;;;;;;AC5BA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAA+B,+BAA+B,EAAE;AAChE,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,EAAC;AACD,4CAA2C,qDAAqD,EAAE;AAClG,+CAA8C,cAAc;AAC5D;;;;;;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC,kCAAkC,EAAE;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AC9CA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA,+CAA8C,cAAc;AAC5D;;;;;;;ACNA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC,qBAAoB,6BAA6B,GAAG,SAAS;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS,EAAE,EAAE;AACb;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT;AACA,UAAS,EAAE,EAAE;AACb,gCAA+B,2BAA2B,EAAE;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,qBAAqB,6BAA6B,EAAE,EAAE;AACtF;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,mCAAmC,EAAE;AAChF,gDAA+C,oBAAoB,EAAE;AACrE;AACA;AACA,cAAa;AACb,wCAAuC,oBAAoB,EAAE;AAC7D,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AC5CA;;;;;;ACAA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,gBAAgB,qBAAqB,GAAG,SAAS,EAAE,EAAE;AACrF,iCAAgC,mBAAmB,EAAE;AACrD,iCAAgC,iBAAiB,EAAE;AACnD;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAwD;AACxD;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,iCAAgC,uCAAuC,EAAE;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC,0BAA0B,EAAE;AAC9D,gCAA+B,yCAAyC,EAAE;AAC1E,EAAC;AACD;AACA,sCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA,4BAA2B,kCAAkC,EAAE;AAC/D,gCAA+B,iCAAiC,EAAE;AAClE,EAAC;AACD;AACA;AACA,oCAAmC,2BAA2B,EAAE;AAChE,gCAA+B,iCAAiC,EAAE;AAClE,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;ACrEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,iBAAiB,GAAG,SAAS,EAAE,EAAE;AACjE,iCAAgC,oBAAoB,EAAE;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,gBAAgB,SAAS,GAAG,SAAS,EAAE,EAAE;AACzE,iCAAgC,mBAAmB,EAAE;AACrD,iCAAgC,iBAAiB,EAAE;AACnD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,gBAAgB,eAAe,GAAG,SAAS,EAAE,EAAE;AAC/E,iCAAgC,mBAAmB,EAAE;AACrD,iCAAgC,iBAAiB,EAAE;AACnD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,UAAS,EAAE,EAAE;AACb,gCAA+B,gBAAgB,EAAE;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,+BAA8B;AAC9B;AACA;AACA;AACA,cAAa;AACb;AACA,cAAa;AACb;AACA,UAAS;AACT,gCAA+B,UAAU,WAAW,EAAE,EAAE;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,qBAAqB,gBAAgB,EAAE,EAAE;AACzE,iCAAgC,aAAa,EAAE;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT,2BAA0B;AAC1B;AACA;AACA;AACA,UAAS;AACT;AACA,UAAS,EAAE,QAAQ,EAAE;AACrB,iCAAgC,6BAA6B,EAAE;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS,IAAI;AACb;AACA;AACA,iCAAgC,qBAAqB,gBAAgB,GAAG,gBAAgB,EAAE,EAAE;AAC5F;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,oCAAmC,wDAAwD,EAAE;AAC7F;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA,sBAAqB;AACrB;AACA,oDAAmD,sCAAsC,EAAE;AAC3F;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,oCAAmC,sCAAsC,EAAE;AAC3E,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;ACnHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;;;;;;;ACpBA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+DAA8D,yCAAyC;AACvG;AACA,4BAA2B,4CAA4C;AACvE,qCAAoC,wBAAwB,EAAE,GAAG,yCAAyC;AAC1G,uHAAsH,gFAAgF,EAAE,GAAG,4DAA4D;AACvQ,0CAAyC,iCAAiC,EAAE;AAC5E,0CAAyC;AACzC,yCAAwC,qBAAqB,EAAE;AAC/D,yCAAwC,qCAAqC,EAAE;AAC/E,6BAA4B,EAAE,GAAG,+DAA+D;AAChG,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,yBAAwB,gFAAgF;AACxG,qCAAoC,4BAA4B,EAAE,GAAG,8EAA8E;AACnJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;;;;;;;ACxCA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA,qBAAoB,uBAAuB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;;;;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C;AAC5C;AACA;AACA;AACA;AACA,UAAS,EAAE,EAAE;AACb;AACA,MAAK;AACL,gCAA+B,sCAAsC,EAAE;AACvE,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,iBAAiB,GAAG,SAAS,EAAE,EAAE;AACjE,iCAAgC,oBAAoB,EAAE;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,gBAAgB,SAAS,GAAG,SAAS,EAAE,EAAE;AACzE,iCAAgC,0BAA0B,EAAE;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT;AACA;AACA;AACA,UAAS,EAAE,EAAE;AACb,gCAA+B,gBAAgB,EAAE;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT;AACA,UAAS,EAAE,EAAE;AACb,gCAA+B,gBAAgB,EAAE;AACjD;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC;AACtC;AACA,gCAA+B,8BAA8B,EAAE,EAAE,EAAE;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAA+B,8BAA8B,EAAE;AAC/D;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAAqE,gCAAgC;AACrG,+BAA8B,oDAAoD;AAClF,yCAAwC,4BAA4B,EAAE,GAAG,2DAA2D;AACpI,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;;;;;;;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,mCAAmC,aAAa,EAAE,EAAE,EAAE;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,iCAAgC,+BAA+B,oBAAoB,EAAE,gBAAgB,wBAAwB,EAAE,EAAE,EAAE;AACnI;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,wCAAuC;AACvC,6CAA4C,UAAU,qDAAqD,EAAE,EAAE,EAAE,EAAE;AACnH;AACA;AACA;AACA;AACA;AACA,6CAA4C;AAC5C;AACA,gCAA+B,sBAAsB,EAAE,EAAE,EAAE,kBAAkB;AAC7E;AACA,gCAA+B,2BAA2B,EAAE,EAAE,EAAE;AAChE;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC;AACzC;AACA;AACA;AACA,0DAAyD;AACzD;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0EAAyE,qCAAqC;AAC9G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AChIA;;;;;;ACAA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AC5BA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA,cAAa;AACb;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;ACpEA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC;AAClC;AACA;AACA;AACA;AACA,gDAA+C,kCAAkC,EAAE;AACnF,cAAa;AACb,UAAS,EAAE,EAAE;AACb;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;;;;;;;AClCA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB;AACA,kBAAiB;AACjB;AACA,UAAS;AACT,MAAK;AACL;AACA,+CAA8C,cAAc;AAC5D;;;;;;;AC3BA","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 47bb8843970626da1d71\n **/","/// <reference path=\"typings/index.d.ts\" />\r\nif (!Array.prototype.toHash) {\r\n    Array.prototype.toHash = function toHash(keySelector, valueSelector) {\r\n        valueSelector = valueSelector || (function (e) { return (e); });\r\n        return this.reduce(function (hash, elem) {\r\n            var key = keySelector(elem);\r\n            var value = valueSelector(elem);\r\n            hash[key] = value;\r\n            return hash;\r\n        }, {});\r\n    };\r\n}\r\nif (!Array.prototype.min) {\r\n    Array.prototype.min = function min(selector) {\r\n        var self = this;\r\n        if (!self.length) {\r\n            return null;\r\n        }\r\n        var minElement = self[0];\r\n        var minValue = selector(minElement);\r\n        for (var i = 1; i < self.length; i++) {\r\n            var element = self[i];\r\n            var value = selector(element);\r\n            if (value < minValue) {\r\n                minValue = value;\r\n                minElement = element;\r\n            }\r\n        }\r\n        return minElement;\r\n    };\r\n}\r\nif (!Array.prototype.max) {\r\n    Array.prototype.max = function min(selector) {\r\n        var self = this;\r\n        if (!self.length) {\r\n            return null;\r\n        }\r\n        var maxElement = self[0];\r\n        var maxValue = selector(maxElement);\r\n        for (var i = 1; i < self.length; i++) {\r\n            var element = self[i];\r\n            var value = selector(element);\r\n            if (value > maxValue) {\r\n                maxValue = value;\r\n                maxElement = element;\r\n            }\r\n        }\r\n        return maxElement;\r\n    };\r\n}\r\nif (!Object.entries) {\r\n    Object.entries = function (obj) { return Object.keys(obj)\r\n        .map(function (key) { return ([key, obj[key]]); }); };\r\n}\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/extensions.ts\n ** module id = 1\n ** module chunks = 0\n **/","/// <reference path=\"./typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar webServer = require(\"./web-server\");\r\nvar scrapeServer = require(\"./scrape-server\");\r\nvar socket_server_1 = require(\"./socket-server\");\r\nscrapeServer.run();\r\nvar httpServer = webServer.run();\r\nsocket_server_1.default(httpServer, scrapeServer.productService);\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/app.ts\n ** module id = 2\n ** module chunks = 0\n **/","/// <reference path=\"./typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar http = require(\"http\");\r\nvar express = require(\"express\");\r\nvar bodyparser = require(\"body-parser\");\r\nvar cookieparser = require(\"cookie-parser\");\r\nvar authentication_route_1 = require(\"./web/routes/authentication-route\");\r\nvar product_route_1 = require(\"./web/routes/product-route\");\r\nvar web_shop_route_1 = require(\"./web/routes/web-shop-route\");\r\nvar app = express();\r\napp.use(cookieparser());\r\napp.use(\"/api\", bodyparser.json());\r\napp.use(\"/api\", authentication_route_1.default);\r\napp.use(\"/api/products\", product_route_1.default);\r\napp.use(\"/api/shops\", web_shop_route_1.default);\r\napp.use(\"/\", express.static(\"./out/client\"));\r\napp.use(\"/\", function (req, res) {\r\n    res.sendfile(\"./out/client\" + '/index.html');\r\n});\r\nvar port = process.env.OPENSHIFT_NODEJS_PORT || 8081;\r\nvar ipAddress = process.env.OPENSHIFT_NODEJS_IP || '127.0.0.1';\r\nfunction run() {\r\n    var server = http.createServer(app);\r\n    server.listen(port, ipAddress, function () {\r\n        console.info(\"Web server started at \" + ipAddress + \":\" + port + \"/\");\r\n    });\r\n    return server;\r\n}\r\nexports.run = run;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web-server.ts\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"http\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"http\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"body-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"body-parser\"\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = require(\"cookie-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"cookie-parser\"\n ** module id = 7\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"../../typings/index.d.ts\" />\r\nvar express = require(\"express\");\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar mongo_authentication_token_storage_1 = require(\"../../services/authentication/mongo-authentication-token-storage\");\r\nvar authentication_token_provider_1 = require(\"../../services/authentication/authentication-token-provider\");\r\nvar mongo_user_account_storage_1 = require(\"../../services/users/mongo-user-account-storage\");\r\nvar user_account_service_1 = require(\"../../services/users/user-account-service\");\r\nvar authentication_middleware_1 = require(\"../../web/authentication-middleware\");\r\nvar db = new db_1.default();\r\nvar tokenStorage = new mongo_authentication_token_storage_1.default(db);\r\nvar tokenProvider = new authentication_token_provider_1.default(tokenStorage);\r\nvar authenticationMiddleware = new authentication_middleware_1.default(tokenProvider);\r\nvar userAccountService = new user_account_service_1.default(new mongo_user_account_storage_1.default(db));\r\nvar router = express.Router();\r\nrouter.post(\"/login\", function (req, res) {\r\n    var info = req.body;\r\n    userAccountService.validateCredentials(info.login, info.password)\r\n        .then(function () {\r\n        var result = {\r\n            ok: true,\r\n            error: \"\"\r\n        };\r\n        authenticationMiddleware.signIn(req, res, info.login)\r\n            .then(function () { return res.json(result).end(); });\r\n    })\r\n        .catch(function (error) {\r\n        var result = {\r\n            ok: false,\r\n            error: error\r\n        };\r\n        res.json(result).end();\r\n    });\r\n});\r\nrouter.use(\"*\", function (res, req, next) { return authenticationMiddleware.run(res, req, next); });\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = router;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web/routes/authentication-route.ts\n ** module id = 8\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"../typings/index.d.ts\" />\r\nvar mongo = require(\"mongodb\");\r\nvar config_1 = require(\"../config\");\r\nvar connectionString = config_1.default.mongoUrl;\r\nvar db = new Promise(function (resolve, reject) {\r\n    if (process.env.OPENSHIFT_MONGODB_DB_PASSWORD) {\r\n        connectionString = process.env.OPENSHIFT_MONGODB_DB_USERNAME + \":\" +\r\n            process.env.OPENSHIFT_MONGODB_DB_PASSWORD + \"@\" +\r\n            process.env.OPENSHIFT_MONGODB_DB_HOST + ':' +\r\n            process.env.OPENSHIFT_MONGODB_DB_PORT + '/' +\r\n            process.env.OPENSHIFT_APP_NAME;\r\n    }\r\n    mongo.MongoClient.connect('mongodb://' + connectionString, function (err, db) {\r\n        if (err) {\r\n            reject(err);\r\n        }\r\n        else {\r\n            console.info(\"Connected to Mongo server at \" + connectionString);\r\n            resolve(db);\r\n        }\r\n    });\r\n});\r\nvar Database = (function () {\r\n    function Database() {\r\n    }\r\n    Database.prototype.collection = function (collection) {\r\n        if (!collection)\r\n            throw new Error(\"collection is undefined\");\r\n        if (!Database.Collections[collection])\r\n            throw new Error(\"Collection \" + collection + \" is unknown\");\r\n        return this.connect()\r\n            .then(function (db) { return db.collection(collection); });\r\n    };\r\n    Database.prototype.connect = function () {\r\n        return db;\r\n    };\r\n    Database.Collections = {\r\n        sessions: \"sessions\",\r\n        webshops: \"webshops\",\r\n        products: \"products\",\r\n        users: \"users\"\r\n    };\r\n    return Database;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = Database;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/data-access/db.ts\n ** module id = 9\n ** module chunks = 0\n **/","module.exports = require(\"mongodb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongodb\"\n ** module id = 10\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"typings/index.d.ts\"/>\r\nvar fs = require(\"fs\");\r\nvar configContent = fs.readFileSync(\"./config.json\", \"utf8\");\r\nvar configuration = JSON.parse(configContent);\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = configuration;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/config.ts\n ** module id = 11\n ** module chunks = 0\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 12\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar MongoAuthenticationTokenStorage = (function () {\r\n    function MongoAuthenticationTokenStorage(db) {\r\n        this.db = db;\r\n        if (!db)\r\n            throw new Error(\"db is undefined\");\r\n    }\r\n    MongoAuthenticationTokenStorage.prototype.find = function (authenticationToken) {\r\n        if (!authenticationToken)\r\n            throw new Error(\"authenticationToken is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.sessions)\r\n            .then(function (c) { return new Promise(function (resolve, reject) {\r\n            c.find({ token: authenticationToken }, { _id: 0 })\r\n                .limit(1)\r\n                .next(function (err, doc) {\r\n                if (err)\r\n                    reject(err);\r\n                else\r\n                    resolve(doc);\r\n            });\r\n        }); });\r\n    };\r\n    MongoAuthenticationTokenStorage.prototype.save = function (authenticationInfo) {\r\n        if (!authenticationInfo)\r\n            throw new Error(\"authenticationInfo is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.sessions)\r\n            .then(function (c) { return c.updateOne({\r\n            token: authenticationInfo.token\r\n        }, authenticationInfo, {\r\n            upsert: true\r\n        }); })\r\n            .then(function () { return authenticationInfo; });\r\n    };\r\n    MongoAuthenticationTokenStorage.prototype.remove = function (authenticationToken) {\r\n        if (!authenticationToken)\r\n            throw new Error(\"authenticationToken is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.sessions)\r\n            .then(function (c) { return c.deleteOne({ token: authenticationToken }); });\r\n    };\r\n    return MongoAuthenticationTokenStorage;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = MongoAuthenticationTokenStorage;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/authentication/mongo-authentication-token-storage.ts\n ** module id = 13\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"../../typings/index.d.ts\" />\r\nvar uuid = require(\"node-uuid\");\r\nvar moment = require(\"moment\");\r\nvar AuthenticationTokenProvider = (function () {\r\n    function AuthenticationTokenProvider(storage) {\r\n        this.storage = storage;\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n    AuthenticationTokenProvider.prototype.validate = function (authenticationToken) {\r\n        var _this = this;\r\n        if (!authenticationToken)\r\n            return Promise.reject(null);\r\n        return new Promise(function (resolve, reject) {\r\n            _this.storage\r\n                .find(authenticationToken)\r\n                .then(function (info) {\r\n                var now = moment.utc().toDate();\r\n                if (info.expiresAt < now)\r\n                    _this.storage\r\n                        .remove(authenticationToken)\r\n                        .then(function () { return reject(\"Token is expired\"); })\r\n                        .catch(function (err) { return reject(err); });\r\n                else\r\n                    resolve(info);\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n    };\r\n    AuthenticationTokenProvider.prototype.generate = function (userId) {\r\n        if (!userId)\r\n            throw new Error(\"userId is undefined\");\r\n        var info = {\r\n            userId: userId,\r\n            token: uuid.v1(),\r\n            expiresAt: moment.utc().add(moment.duration(5, \"day\")).toDate()\r\n        };\r\n        return this.storage\r\n            .save(info);\r\n    };\r\n    return AuthenticationTokenProvider;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = AuthenticationTokenProvider;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/authentication/authentication-token-provider.ts\n ** module id = 14\n ** module chunks = 0\n **/","module.exports = require(\"node-uuid\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-uuid\"\n ** module id = 15\n ** module chunks = 0\n **/","module.exports = require(\"moment\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"moment\"\n ** module id = 16\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar MongoUserAccountStorage = (function () {\r\n    function MongoUserAccountStorage(db) {\r\n        this.db = db;\r\n        if (!db)\r\n            throw new Error(\"db is undefined\");\r\n    }\r\n    MongoUserAccountStorage.prototype.findByUserName = function (userName) {\r\n        if (!userName)\r\n            throw new Error(\"userName is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.users)\r\n            .then(function (c) { return c.find({ userName: userName }, { _id: 0 }); })\r\n            .then(function (r) { return r.limit(1); })\r\n            .then(function (c) { return c.next(); });\r\n    };\r\n    return MongoUserAccountStorage;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = MongoUserAccountStorage;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/users/mongo-user-account-storage.ts\n ** module id = 17\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar UserAccountService = (function () {\r\n    function UserAccountService(userAccountStorage) {\r\n        this.userAccountStorage = userAccountStorage;\r\n        if (!userAccountStorage)\r\n            throw new Error(\"userAccountStorage is undefined\");\r\n    }\r\n    UserAccountService.prototype.validateCredentials = function (userName, password) {\r\n        var _this = this;\r\n        if (!userName || !password)\r\n            return Promise.reject(\"Login and password required.\");\r\n        return new Promise(function (resolve, reject) {\r\n            _this.userAccountStorage\r\n                .findByUserName(userName)\r\n                .then(function (user) {\r\n                if (user != null && user.isActive && user.password === password)\r\n                    resolve(true);\r\n                else\r\n                    reject(\"User credentials is not valid.\");\r\n            });\r\n        });\r\n    };\r\n    return UserAccountService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = UserAccountService;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/users/user-account-service.ts\n ** module id = 18\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar AuthenticationMiddleware = (function () {\r\n    function AuthenticationMiddleware(authenticationTokenProvider) {\r\n        this.authenticationTokenProvider = authenticationTokenProvider;\r\n        if (!authenticationTokenProvider)\r\n            throw new Error(\"authenticationTokenProvider is undefined\");\r\n    }\r\n    /**\r\n     * Request handler which checks authentication and setups the request.user.\r\n     * If request is not authenticated the 401 Not authorized status will be returned to the client.\r\n     */\r\n    AuthenticationMiddleware.prototype.run = function (request, response, next) {\r\n        var authenticationToken = (request.cookies || {})[AuthenticationMiddleware.authenticationCookieName];\r\n        this.authenticationTokenProvider\r\n            .validate(authenticationToken)\r\n            .then(function (user) {\r\n            request.user = user;\r\n            next();\r\n        })\r\n            .catch(function () { return response.sendStatus(401).end(); });\r\n    };\r\n    /**\r\n     * Adds authentication cookie to response.\r\n     */\r\n    AuthenticationMiddleware.prototype.signIn = function (request, response, userId) {\r\n        if (!response)\r\n            throw new Error(\"response is undefined\");\r\n        if (!userId)\r\n            throw new Error(\"userId is undefined\");\r\n        return this.authenticationTokenProvider\r\n            .generate(userId)\r\n            .then(function (info) {\r\n            response.cookie(AuthenticationMiddleware.authenticationCookieName, info.token, {\r\n                httpOnly: true,\r\n                expires: info.expiresAt\r\n            });\r\n        });\r\n    };\r\n    AuthenticationMiddleware.authenticationCookieName = \"auth\";\r\n    return AuthenticationMiddleware;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = AuthenticationMiddleware;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web/authentication-middleware.ts\n ** module id = 19\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar express = require(\"express\");\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar mongo_product_storage_1 = require(\"../../services/products/mongo-product-storage\");\r\nvar product_service_1 = require(\"../../services/products/product-service\");\r\nvar db = new db_1.default();\r\nvar productService = new product_service_1.default(new mongo_product_storage_1.default(db));\r\nvar router = express.Router();\r\nrouter.get(\"/:id\", function (req, res) {\r\n    var productId = (req.params || {})[\"id\"];\r\n    if (!productId) {\r\n        res.send(404, \"Not found\")\r\n            .end();\r\n        return;\r\n    }\r\n    productService.one(productId)\r\n        .then(function (product) { return res.json(product); })\r\n        .catch(function (err) { return res.send(404, \"Not found\").end(); });\r\n});\r\nrouter.delete(\"/:id\", function (req, res) {\r\n    var productId = (req.params || {})[\"id\"];\r\n    if (!productId) {\r\n        res.send(404, \"Not found\").end();\r\n        return;\r\n    }\r\n    productService.delete(productId)\r\n        .then(function () { return res.json(200, \"OK\").end(); })\r\n        .catch(function (err) { return res.send(500, err).end(); });\r\n});\r\nrouter.get(\"/\", function (req, res) {\r\n    productService.all()\r\n        .then(function (products) { return res.json(products); })\r\n        .catch(function (err) { return res.send(500, err).end(); });\r\n});\r\nrouter.post(\"/price\", function (request, response) {\r\n    var productId = request.body.productId;\r\n    var shopId = request.body.shopId;\r\n    var price = request.body.price;\r\n    productService.savePrice(productId, shopId, price)\r\n        .then(function (result) {\r\n        response.json(result).end();\r\n    })\r\n        .catch(function (err) {\r\n        response.json({\r\n            ok: false,\r\n            errors: err\r\n        }).end();\r\n    });\r\n});\r\nrouter.post(\"/\", function (request, response) {\r\n    var product = request.body;\r\n    productService.save(product)\r\n        .then(function (product) {\r\n        var responseData = {\r\n            ok: true,\r\n            entity: product\r\n        };\r\n        response.json(responseData).end();\r\n    })\r\n        .catch(function (err) {\r\n        var responseData = {\r\n            ok: false,\r\n            errors: err\r\n        };\r\n        response.json(responseData).end();\r\n    });\r\n});\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = router;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web/routes/product-route.ts\n ** module id = 20\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar MongoProductStorage = (function () {\r\n    function MongoProductStorage(db) {\r\n        this.db = db;\r\n        if (!db)\r\n            throw new Error(\"db is missing\");\r\n    }\r\n    MongoProductStorage.prototype.all = function () {\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.find({}, { _id: 0 }); })\r\n            .then(function (c) { return c.toArray(); });\r\n    };\r\n    MongoProductStorage.prototype.one = function (id) {\r\n        if (!id)\r\n            throw new Error(\"id is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.find({ id: id }, { _id: 0 }); })\r\n            .then(function (c) { return c.limit(1); })\r\n            .then(function (c) { return c.next(); });\r\n    };\r\n    MongoProductStorage.prototype.findByTitle = function (title) {\r\n        if (!title)\r\n            return Promise.reject(\"Title is empty\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.find({ title: title }, { _id: 0 }); })\r\n            .then(function (c) { return c.limit(1); })\r\n            .then(function (c) { return c.next(); });\r\n    };\r\n    MongoProductStorage.prototype.save = function (product) {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.updateOne({\r\n            id: product.id\r\n        }, {\r\n            $set: {\r\n                id: product.id,\r\n                title: product.title,\r\n                scrapingUrls: product.scrapingUrls\r\n            }\r\n        }, {\r\n            upsert: true\r\n        }); })\r\n            .then(function () { return product; });\r\n    };\r\n    MongoProductStorage.prototype.savePrice = function (productId, shopId, price) {\r\n        if (!productId)\r\n            throw new Error(\"product id is undefined\");\r\n        if (!productId)\r\n            throw new Error(\"product id is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) {\r\n            c.update({\r\n                id: productId\r\n            }, {\r\n                $set: (_a = {},\r\n                    _a[\"values.\" + shopId + \".manualPrice\"] = price,\r\n                    _a\r\n                )\r\n            }, {\r\n                upsert: true\r\n            });\r\n            var _a;\r\n        })\r\n            .then(function () { return ({ ok: true }); });\r\n    };\r\n    MongoProductStorage.prototype.delete = function (productId) {\r\n        if (!productId)\r\n            throw new Error(\"Product ID is not defined.\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.deleteOne({ id: productId }); })\r\n            .then(function (c) { return true; });\r\n    };\r\n    MongoProductStorage.prototype.setScrapingData = function (productId, webShopId, values) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        if (!webShopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        if (!values)\r\n            throw new Error(\"values is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.updateOne({\r\n            id: productId\r\n        }, {\r\n            $set: (_a = {},\r\n                _a[\"values.\" + webShopId] = values,\r\n                _a\r\n            )\r\n        }, {\r\n            upsert: true\r\n        }); var _a; })\r\n            .then(function (r) { return _this.one(productId); });\r\n    };\r\n    MongoProductStorage.prototype.discardScrapingData = function (productId, shops) {\r\n        if (!shops || !shops.length) {\r\n            return;\r\n        }\r\n        var unset = shops.reduce(function (val, shopId) {\r\n            val[(\"log.\" + shopId)] = \"\";\r\n            val[(\"values.\" + shopId)] = \"\";\r\n            return val;\r\n        }, {});\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.updateOne({ id: productId }, { $unset: unset }); });\r\n    };\r\n    return MongoProductStorage;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = MongoProductStorage;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/products/mongo-product-storage.ts\n ** module id = 21\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar uuid = require(\"node-uuid\");\r\nvar event_bus_1 = require(\"../event-bus\");\r\nvar product_validator_1 = require(\"./product-validator\");\r\nvar ProductService = (function () {\r\n    function ProductService(storage) {\r\n        this.storage = storage;\r\n        this.validator = new product_validator_1.ProductValidator();\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n    ProductService.prototype.all = function () {\r\n        return this.storage.all();\r\n    };\r\n    ProductService.prototype.save = function (product) {\r\n        var _this = this;\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n        if (!product.id)\r\n            product.id = uuid.v1();\r\n        return this.validator\r\n            .validate(product)\r\n            .then(function (product) {\r\n            return _this.storage\r\n                .findByTitle(product.title)\r\n                .then(function (found) {\r\n                if (found && found.id !== product.id) {\r\n                    throw {\r\n                        \"title\": [\"Product with such title already exists\"]\r\n                    };\r\n                }\r\n            })\r\n                .then(function () { return _this.writeProductAndDiscardScrapeData(product); })\r\n                .then(function (product) {\r\n                event_bus_1.eventBus.emit(event_bus_1.EventNames.ProductUpdated, product.id);\r\n                return product;\r\n            });\r\n        });\r\n    };\r\n    ProductService.prototype.savePrice = function (productId, shopId, price) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"product id is undefined\");\r\n        if (!shopId)\r\n            throw new Error(\"shop id is undefined\");\r\n        var priceValidator = new product_validator_1.PriceValidator();\r\n        return priceValidator\r\n            .validate(price)\r\n            .then(function (r) {\r\n            return _this.storage.savePrice(productId, shopId, r);\r\n        });\r\n    };\r\n    ProductService.prototype.one = function (productId) {\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return this.storage.one(productId);\r\n    };\r\n    ProductService.prototype.findByTitle = function (title) {\r\n        return this.storage.findByTitle(title);\r\n    };\r\n    ProductService.prototype.updateScrapedData = function (productId, webshopId, data) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        if (!webshopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        if (!data)\r\n            throw new Error(\"data is undefined\");\r\n        return this.one(productId)\r\n            .then(function (product) {\r\n            return _this.storage.setScrapingData(product.id, webshopId, data);\r\n        });\r\n    };\r\n    ProductService.prototype.delete = function (productId) {\r\n        if (!productId)\r\n            throw new Error(\"Product ID is not defined.\");\r\n        return this.storage.delete(productId);\r\n    };\r\n    /**\r\n     * Writes validated product to storage and removes values and logs for changed URL.\r\n     */\r\n    ProductService.prototype.writeProductAndDiscardScrapeData = function (product) {\r\n        var _this = this;\r\n        return this.one(product.id)\r\n            .then(function (origin) {\r\n            return _this.storage\r\n                .save(product)\r\n                .then(function () {\r\n                if (origin) {\r\n                    var shops = Object.entries(product.scrapingUrls)\r\n                        .filter(function (_a) {\r\n                        var shop = _a[0], url = _a[1];\r\n                        var originUrl = origin.scrapingUrls[shop];\r\n                        return url !== originUrl;\r\n                    })\r\n                        .map(function (_a) {\r\n                        var shop = _a[0], url = _a[1];\r\n                        return shop;\r\n                    });\r\n                    var removedShops = Object.keys(origin.scrapingUrls)\r\n                        .filter(function (shopId) { return !product.scrapingUrls[shopId]; });\r\n                    shops.push.apply(shops, removedShops);\r\n                    return _this.storage.discardScrapingData(product.id, shops);\r\n                }\r\n                else {\r\n                    return Promise.resolve();\r\n                }\r\n            })\r\n                .then(function () { return _this.storage.one(product.id); });\r\n        });\r\n    };\r\n    return ProductService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ProductService;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/products/product-service.ts\n ** module id = 22\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar events_1 = require(\"events\");\r\nvar EventNames = (function () {\r\n    function EventNames() {\r\n    }\r\n    /**\r\n     * Published when product inserted or updated.\r\n     * Params is product id: string.\r\n     */\r\n    EventNames.ProductUpdated = \"product-updated\";\r\n    /**\r\n     * Published when product data is scraped.\r\n     * Param is product id: string.\r\n     */\r\n    EventNames.ProductScraped = \"product-scraped\";\r\n    return EventNames;\r\n}());\r\nexports.EventNames = EventNames;\r\nvar eventBus = new events_1.EventEmitter();\r\nexports.eventBus = eventBus;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/event-bus.ts\n ** module id = 23\n ** module chunks = 0\n **/","module.exports = require(\"events\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"events\"\n ** module id = 24\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar pojo_fluent_validator_1 = require(\"pojo-fluent-validator\");\r\nvar utils_1 = require(\"../utils\");\r\nvar ProductValidator = (function () {\r\n    function ProductValidator() {\r\n        this.validator = pojo_fluent_validator_1.rules.obj({\r\n            id: pojo_fluent_validator_1.rules.str().notEmpty({ errorMessage: \"Product ID is required\" }),\r\n            title: pojo_fluent_validator_1.rules.str()\r\n                .notEmpty({ errorMessage: \"Product title is required\" })\r\n                .must(function (t) { return t.length < 1024; }, { errorMessage: \"Product title too long\" }),\r\n            scrapingUrls: pojo_fluent_validator_1.rules.hash(pojo_fluent_validator_1.rules.str().must(function (url) { return !url || (url.indexOf(\"http://\") === 0 || url.indexOf(\"https://\") === 0); }, { errorMessage: \"URL must starts from http:// or https:// \" }))\r\n                .filter(function (k, v) { return v && v.trim().length > 0; })\r\n                .before(function (urls) { return Object.keys(urls)\r\n                .map(function (shopId) { return urls[shopId]; })\r\n                .filter(function (url) { return url && url.trim().length > 0; })\r\n                .length > 0; }, { errorMessage: \"At least one scraping URL must be specified.\" })\r\n        });\r\n    }\r\n    ProductValidator.prototype.validate = function (product) {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n        return utils_1.validate(product, this.validator);\r\n    };\r\n    return ProductValidator;\r\n}());\r\nexports.ProductValidator = ProductValidator;\r\nvar PriceValidator = (function () {\r\n    function PriceValidator() {\r\n        this.validator = pojo_fluent_validator_1.rules\r\n            .num(true, { stopOnFailure: true, errorMessage: \"Manual price is not recognized as number\" })\r\n            .must(function (price) { return !price || price > 0; }, { stopOnFailure: true, errorMessage: \"Manual price must be greater than zero\" });\r\n    }\r\n    PriceValidator.prototype.validate = function (price) {\r\n        if (!price)\r\n            throw new Error(\"Price is undefined\");\r\n        return utils_1.validate(price, this.validator);\r\n    };\r\n    return PriceValidator;\r\n}());\r\nexports.PriceValidator = PriceValidator;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/products/product-validator.ts\n ** module id = 25\n ** module chunks = 0\n **/","module.exports = require(\"pojo-fluent-validator\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"pojo-fluent-validator\"\n ** module id = 26\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar pojo_fluent_validator_1 = require(\"pojo-fluent-validator\");\r\nfunction validate(value) {\r\n    var validators = [];\r\n    for (var _i = 1; _i < arguments.length; _i++) {\r\n        validators[_i - 1] = arguments[_i];\r\n    }\r\n    if (!validators || !validators.length) {\r\n        throw new Error(\"At least one validator is required\");\r\n    }\r\n    return new Promise(function (resolve, reject) {\r\n        pojo_fluent_validator_1.validate.apply(void 0, [value, function (errors, result) {\r\n            if (errors) {\r\n                reject(errors);\r\n            }\r\n            else {\r\n                resolve(result);\r\n            }\r\n            ;\r\n        }].concat(validators));\r\n    });\r\n}\r\nexports.validate = validate;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/utils.ts\n ** module id = 27\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar express = require(\"express\");\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar mongo_web_shop_storage_1 = require(\"../../services/web-shop/mongo-web-shop-storage\");\r\nvar web_shop_service_1 = require(\"../../services/web-shop/web-shop-service\");\r\nvar db = new db_1.default();\r\nvar webShopService = new web_shop_service_1.default(new mongo_web_shop_storage_1.default(db));\r\nvar router = express.Router();\r\nrouter.get(\"/\", function (request, response) {\r\n    webShopService.all()\r\n        .then(function (shops) {\r\n        var model = shops.map(function (s) { return ({\r\n            id: s.id,\r\n            isBase: s.isBase,\r\n            title: s.title,\r\n            deliveryPrice: s.deliveryPrice\r\n        }); });\r\n        response.json(model).end();\r\n    })\r\n        .catch(function (err) { return response.send(500, err).end(); });\r\n});\r\nrouter.post(\"/\", function (request, response) {\r\n    var webShop = request.body;\r\n    if (!webShop.id) {\r\n        response.send(400, \"Bad request. Web shop identifier is missing\").end();\r\n    }\r\n    else {\r\n        webShopService.save(webShop)\r\n            .then(function (webShop) {\r\n            var responseData = {\r\n                ok: true,\r\n                entity: webShop\r\n            };\r\n            response.json(responseData).end();\r\n        })\r\n            .catch(function (err) {\r\n            var responseData = {\r\n                ok: false,\r\n                errors: err\r\n            };\r\n            response.json(responseData).end();\r\n        });\r\n    }\r\n});\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = router;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web/routes/web-shop-route.ts\n ** module id = 28\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar MongoWebShopStorage = (function () {\r\n    function MongoWebShopStorage(db) {\r\n        this.db = db;\r\n        if (!db)\r\n            throw new Error(\"db is undefined\");\r\n    }\r\n    MongoWebShopStorage.prototype.all = function () {\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.find({}, { _id: 0 }); })\r\n            .then(function (c) { return c.toArray(); });\r\n    };\r\n    MongoWebShopStorage.prototype.one = function (id) {\r\n        if (!id)\r\n            throw new Error(\"id is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.find({ id: id }, { _id: 0 }); })\r\n            .then(function (c) { return c.limit(1).next(); });\r\n    };\r\n    MongoWebShopStorage.prototype.save = function (webShop) {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.updateOne({\r\n            id: webShop.id\r\n        }, {\r\n            $set: {\r\n                deliveryPrice: webShop.deliveryPrice\r\n            }\r\n        }); })\r\n            .then(function () { return webShop; });\r\n    };\r\n    MongoWebShopStorage.prototype.put = function (webShop) {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.updateOne({\r\n            id: webShop.id\r\n        }, webShop, {\r\n            upsert: true\r\n        }); })\r\n            .then(function () { return webShop; });\r\n    };\r\n    return MongoWebShopStorage;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = MongoWebShopStorage;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/web-shop/mongo-web-shop-storage.ts\n ** module id = 29\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar web_shop_validator_1 = require(\"./web-shop-validator\");\r\nvar WebShopService = (function () {\r\n    function WebShopService(storage) {\r\n        this.storage = storage;\r\n        this.validator = new web_shop_validator_1.default();\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n    WebShopService.prototype.all = function () {\r\n        return this.storage.all();\r\n    };\r\n    WebShopService.prototype.one = function (webShopId) {\r\n        if (!webShopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        return this.storage.one(webShopId);\r\n    };\r\n    WebShopService.prototype.save = function (webShop) {\r\n        var _this = this;\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return this.validator\r\n            .validate(webShop)\r\n            .then(function (webShop) { return _this.storage\r\n            .save(webShop)\r\n            .then(function () { return _this.one(webShop.id); }); });\r\n    };\r\n    WebShopService.prototype.put = function (webShop) {\r\n        var _this = this;\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return this.storage\r\n            .put(webShop)\r\n            .then(function () { return _this.one(webShop.id); })\r\n            .catch(function (err) {\r\n            throw {\r\n                \"\": \"\" + err\r\n            };\r\n        });\r\n    };\r\n    return WebShopService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = WebShopService;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/web-shop/web-shop-service.ts\n ** module id = 30\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar pojo_fluent_validator_1 = require(\"pojo-fluent-validator\");\r\nvar utils_1 = require(\"../utils\");\r\nvar WebShopValidator = (function () {\r\n    function WebShopValidator() {\r\n        /** Only updateable fields is validated */\r\n        this.validator = pojo_fluent_validator_1.rules.obj({\r\n            deliveryPrice: pojo_fluent_validator_1.rules.num(false, { errorMessage: \"Invalid price\" })\r\n                .parseNumber({ errorMessage: \"Price is not recognized as number\" })\r\n                .must(function (price) { return !price || price > 0; }, { errorMessage: \"Delivery price must be greater than zero\" })\r\n        }).expandable();\r\n    }\r\n    WebShopValidator.prototype.validate = function (webShop) {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return utils_1.validate(webShop, this.validator);\r\n    };\r\n    return WebShopValidator;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = WebShopValidator;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/web-shop/web-shop-validator.ts\n ** module id = 31\n ** module chunks = 0\n **/","/// <reference path=\"typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar config_1 = require(\"./config\");\r\nvar db_1 = require(\"./data-access/db\");\r\nvar mongo_web_shop_storage_1 = require(\"./services/web-shop/mongo-web-shop-storage\");\r\nvar web_shop_service_1 = require(\"./services/web-shop/web-shop-service\");\r\nvar mongo_product_storage_1 = require(\"./services/products/mongo-product-storage\");\r\nvar product_service_1 = require(\"./services/products/product-service\");\r\nvar scrape_service_1 = require(\"./services/scraping/scrape-service\");\r\nvar scrape_queue_service_1 = require(\"./services/scraping/scrape-queue-service\");\r\nvar scrape_scheduler_service_1 = require(\"./services/scraping/scrape-scheduler-service\");\r\nvar event_bus_1 = require(\"./services/event-bus\");\r\nvar db = new db_1.default();\r\nexports.productService = new product_service_1.default(new mongo_product_storage_1.default(db));\r\nvar webShopService = new web_shop_service_1.default(new mongo_web_shop_storage_1.default(db));\r\nvar scrapeService = new scrape_service_1.default(exports.productService, webShopService);\r\nvar queue = new scrape_queue_service_1.default(scrapeService, config_1.default.scrapingThreads, config_1.default.delayBetweenShopScrapingMs);\r\nvar scheduler = new scrape_scheduler_service_1.default(queue, exports.productService, config_1.default.schedules);\r\nfunction run() {\r\n    // Re-run scraping when product data is changed.\r\n    event_bus_1.eventBus.on(event_bus_1.EventNames.ProductUpdated, function (productId) {\r\n        queue.enqueuePriore(productId);\r\n    });\r\n    if (scheduler.run())\r\n        console.info(\"Scrape server running\");\r\n    else\r\n        console.error(\"Error running scrape server\");\r\n}\r\nexports.run = run;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/scrape-server.ts\n ** module id = 32\n ** module chunks = 0\n **/","\"use strict\";\r\nvar jsdom_scraper_1 = require(\"../../scrapers/jsdom-scraper\");\r\nvar event_bus_1 = require(\"../event-bus\");\r\nvar emptyScrapedValues = {\r\n    title: null,\r\n    price: null,\r\n    image: null\r\n};\r\nvar ScrapeService = (function () {\r\n    function ScrapeService(productService, webShopService) {\r\n        this.productService = productService;\r\n        this.webShopService = webShopService;\r\n        this.scraper = new jsdom_scraper_1.default();\r\n        if (!productService)\r\n            throw new Error(\"productService is undefined\");\r\n        if (!webShopService)\r\n            throw new Error(\"webShopService is undefined\");\r\n        this.webShops = this.webShopService\r\n            .all()\r\n            .then(function (shops) { return shops.toHash(function (s) { return s.id; }); });\r\n    }\r\n    ScrapeService.prototype.scrapeProductData = function (productId) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return Promise.all([\r\n            this.webShops,\r\n            this.productService.one(productId)\r\n        ])\r\n            .then(function (_a) {\r\n            var shops = _a[0], product = _a[1];\r\n            return Promise.all(_this.scrapeProduct(product, shops));\r\n        })\r\n            .then(function (r) { return r.toHash(function (e) { return e.webShopId; }, function (e) { return e.scrapedValues; }); })\r\n            .then(function (hash) {\r\n            event_bus_1.eventBus.emit(event_bus_1.EventNames.ProductScraped, productId);\r\n            return hash;\r\n        });\r\n    };\r\n    ScrapeService.prototype.scrapeProduct = function (product, shops) {\r\n        var _this = this;\r\n        return Object.keys(product.scrapingUrls)\r\n            .map(function (webShopId) { return _this.scrapeProductFromShopAndSave(product, webShopId, shops)\r\n            .then(function (scrapedValues) { return ({ webShopId: webShopId, scrapedValues: scrapedValues }); }); });\r\n    };\r\n    ScrapeService.prototype.scrapeProductFromShopAndSave = function (product, webShopId, shops) {\r\n        var _this = this;\r\n        return this.scraper\r\n            .scrape(product.scrapingUrls[webShopId], shops[webShopId].scrapingSettings, webShopId)\r\n            .then(function (scrapedValues) { return _this.productService\r\n            .updateScrapedData(product.id, webShopId, scrapedValues)\r\n            .then(function () { return scrapedValues; }); }, function (err) { return _this.productService\r\n            .updateScrapedData(product.id, webShopId, emptyScrapedValues)\r\n            .then(function () { return emptyScrapedValues; }); });\r\n    };\r\n    return ScrapeService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ScrapeService;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/scraping/scrape-service.ts\n ** module id = 33\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar jsdom = require(\"jsdom\");\r\nvar createDebugger = require(\"debug\");\r\nvar value_parser_1 = require(\"./value-parser\");\r\nvar JsdomScraper = (function () {\r\n    function JsdomScraper() {\r\n        this.valueParser = new value_parser_1.default();\r\n    }\r\n    JsdomScraper.prototype.scrape = function (url, values, webShopId) {\r\n        var _this = this;\r\n        if (!url)\r\n            throw new Error(\"url is undefined\");\r\n        if (!values)\r\n            throw new Error(\"values is undefined.\");\r\n        if (!Object.keys(values).length)\r\n            throw new Error(\"No values to extract\");\r\n        webShopId = webShopId || \"unknown-web-shop\";\r\n        var log = {\r\n            error: createDebugger(\"gameology:error:jsdom:\" + webShopId),\r\n            debug: createDebugger(\"gameology:debug:jsdom:\" + webShopId),\r\n            dump: createDebugger(\"gameology:dump:jsdom:\" + webShopId)\r\n        };\r\n        var result = {\r\n            title: null,\r\n            price: null,\r\n            image: null\r\n        };\r\n        // \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\"\r\n        return new Promise(function (resolve, reject) {\r\n            jsdom.env({\r\n                url: url,\r\n                userAgent: \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\",\r\n                features: {\r\n                    FetchExternalResources: false,\r\n                    ProcessExternalResources: false\r\n                },\r\n                done: function (err, window) {\r\n                    if (err) {\r\n                        log.error(\"Error occured on scraping URL \" + url + \".\\r\\n\" + JSON.stringify(err));\r\n                        reject(err);\r\n                        return;\r\n                    }\r\n                    if (!window || !window.document) {\r\n                        log.error(\"Error occured on scraping URL \" + url + \". HTML data are not received.\");\r\n                        reject(new Error(\"HTML is not received.\"));\r\n                        return;\r\n                    }\r\n                    var tags = window.document.getElementsByTagName(\"html\");\r\n                    if (!tags || !tags.length) {\r\n                        log.dump(\"HTML element is missing in document.\");\r\n                    }\r\n                    else {\r\n                        log.dump(tags[0].innerHTML);\r\n                    }\r\n                    Object.keys(values)\r\n                        .forEach(function (valueName) {\r\n                        var settings = values[valueName];\r\n                        result[valueName] = _this.scrapeValue(window.document, settings, log);\r\n                    });\r\n                    log.debug(\"Scraping data from \" + url + \" completed with values \" + JSON.stringify(result));\r\n                    resolve(result);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    JsdomScraper.prototype.scrapeValue = function (document, valueScrapingSettings, log) {\r\n        if (!document)\r\n            throw new Error(\"document is undefined\");\r\n        if (!valueScrapingSettings)\r\n            throw new Error(\"valueScrapingSettings is undefined\");\r\n        var parsingContext = {\r\n            location: document.location\r\n        };\r\n        for (var _i = 0, valueScrapingSettings_1 = valueScrapingSettings; _i < valueScrapingSettings_1.length; _i++) {\r\n            var scrapingSetting = valueScrapingSettings_1[_i];\r\n            try {\r\n                var rawValue = this.extractRawValueFromDocument(document, scrapingSetting);\r\n                var parsedValue = this.valueParser[scrapingSetting.type](rawValue, parsingContext);\r\n                return parsedValue;\r\n            }\r\n            catch (error) {\r\n                log.error(\"The error occured due parsing value. \" + error);\r\n                if (scrapingSetting.failOnError)\r\n                    return null;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    JsdomScraper.prototype.extractRawValueFromDocument = function (document, valueScrapingSetting) {\r\n        var extractMethod = valueScrapingSetting.extract || \"queryselector\";\r\n        switch (extractMethod) {\r\n            case \"queryselector\":\r\n                {\r\n                    var querySelectorSettings = valueScrapingSetting;\r\n                    if (!querySelectorSettings.elementSelector)\r\n                        throw new Error(\"elementSelector is missing\");\r\n                    var elements = document.querySelectorAll(querySelectorSettings.elementSelector);\r\n                    if (elements.length === 0)\r\n                        throw new Error(\"Element with selector \" + querySelectorSettings.elementSelector + \" is missing\");\r\n                    if (elements.length > 1)\r\n                        throw new Error(\"There are more than one element with selector \" + querySelectorSettings.elementSelector);\r\n                    if (querySelectorSettings.attribute)\r\n                        return elements[0].getAttribute(querySelectorSettings.attribute);\r\n                    else\r\n                        return elements[0].textContent;\r\n                }\r\n                ;\r\n            case \"regex\":\r\n                {\r\n                    var regexSettings = valueScrapingSetting;\r\n                    if (!regexSettings.regex)\r\n                        throw new Error(\"regex missing\");\r\n                    var text = document.querySelector(\"html\").innerHTML;\r\n                    var regex = new RegExp(regexSettings.regex, \"gmi\");\r\n                    var matches = regex.exec(text);\r\n                    if (!matches.length)\r\n                        throw new Error(\"No value matches\");\r\n                    return matches[1];\r\n                }\r\n                ;\r\n            default:\r\n                throw new Error(\"Unknown extract method\");\r\n        }\r\n    };\r\n    return JsdomScraper;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = JsdomScraper;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/scrapers/jsdom-scraper.ts\n ** module id = 34\n ** module chunks = 0\n **/","module.exports = require(\"jsdom\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"jsdom\"\n ** module id = 35\n ** module chunks = 0\n **/","module.exports = require(\"debug\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"debug\"\n ** module id = 36\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"../typings/index.d.ts\"/>\r\nvar path = require(\"path\");\r\nvar ValueParserHash = (function () {\r\n    function ValueParserHash() {\r\n        this.parsers = {};\r\n        this.parsers[\"string\"] = this.string;\r\n        this.parsers[\"number\"] = this.number;\r\n    }\r\n    ValueParserHash.prototype.string = function (input) {\r\n        return (input || \"\").trim();\r\n    };\r\n    ValueParserHash.prototype.number = function (input) {\r\n        if (!input)\r\n            throw new Error(\"Number is missing.\");\r\n        var src = input.replace(/[^0-9\\.]/g, \"\");\r\n        var number = parseFloat(src);\r\n        if (number && !isNaN(number))\r\n            return number;\r\n        throw new Error(\"Number format is not valid.\");\r\n    };\r\n    ValueParserHash.prototype.relativeUrl = function (input, context) {\r\n        var baseLocation = input[0] === \"/\" ? context.location.origin : context.location.href;\r\n        return path.posix.join(baseLocation, input).replace(\":/\", \"://\");\r\n    };\r\n    return ValueParserHash;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ValueParserHash;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/scrapers/value-parser.ts\n ** module id = 37\n ** module chunks = 0\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 38\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar async = require(\"async\");\r\nvar createDebugger = require(\"debug\");\r\nvar log = {\r\n    debug: createDebugger(\"gameology:scrape-queue:debug\"),\r\n    error: createDebugger(\"gameology:scrape-queue:error\")\r\n};\r\nvar ScrapeQueueService = (function () {\r\n    function ScrapeQueueService(scrapeService, scrapingThreads, delayBetweenProductScraping) {\r\n        var _this = this;\r\n        this.scrapeService = scrapeService;\r\n        if (!scrapeService)\r\n            throw new Error(\"scrapeService is missing\");\r\n        this.queue = async.queue(function (productId, callback) {\r\n            log.debug(\"Scraping data for product \" + productId);\r\n            _this.scrapeService.scrapeProductData(productId)\r\n                .then(function (res) {\r\n                Object.keys(res)\r\n                    .forEach(function (webShop) {\r\n                    var result = res[webShop];\r\n                    log.debug(\"Scraping product \" + productId + \" from shop \" + webShop + \" completed successfuly\");\r\n                });\r\n                setTimeout(callback, delayBetweenProductScraping);\r\n            })\r\n                .catch(function (err) {\r\n                log.error(\"Error occured due scraping, \" + err);\r\n                callback(err);\r\n            });\r\n        }, scrapingThreads);\r\n    }\r\n    /**\r\n     * Enqueues scraping data and saving results for a product.\r\n     * Method returns a promise which will be resolved when processing finishes.\r\n     */\r\n    ScrapeQueueService.prototype.enqueue = function (productId) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return new Promise(function (resolve, reject) {\r\n            _this.queue.push(productId, function (err) {\r\n                if (err)\r\n                    reject(err);\r\n                else\r\n                    resolve(productId);\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Enqueues scraping data and saving results for a product before other enqueued products.\r\n     * Method returns a promise which will be resolved when processing finishes.\r\n     */\r\n    ScrapeQueueService.prototype.enqueuePriore = function (productId) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return new Promise(function (resolve, reject) {\r\n            _this.queue.unshift(productId, function (err) {\r\n                if (err)\r\n                    reject(err);\r\n                else\r\n                    resolve(productId);\r\n            });\r\n        });\r\n    };\r\n    return ScrapeQueueService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ScrapeQueueService;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/scraping/scrape-queue-service.ts\n ** module id = 39\n ** module chunks = 0\n **/","module.exports = require(\"async\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"async\"\n ** module id = 40\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar schedule = require(\"node-schedule\");\r\nvar uuid = require(\"node-uuid\");\r\nvar ScrapeSchedulerService = (function () {\r\n    function ScrapeSchedulerService(queue, productService, schedules) {\r\n        this.queue = queue;\r\n        this.productService = productService;\r\n        this.schedules = schedules;\r\n        if (!queue)\r\n            throw new Error(\"queue is undefined\");\r\n        if (!productService)\r\n            throw new Error(\"productService is undefined\");\r\n        if (!schedules && !schedules.length)\r\n            throw new Error(\"schedules is undefined or empty\");\r\n    }\r\n    ScrapeSchedulerService.prototype.run = function () {\r\n        var _this = this;\r\n        if (schedule.scheduledJobs && Object.keys(schedule.scheduledJobs).length)\r\n            return false;\r\n        this.schedules\r\n            .map(function (rule) { return schedule.scheduleJob(uuid.v1(), rule, function () {\r\n            console.log(new Date() + \" Running product scraping for scheduler rule \" + rule);\r\n            _this.productService\r\n                .all()\r\n                .then(function (products) {\r\n                products.forEach(function (p) { return _this.queue.enqueue(p.id); });\r\n            });\r\n        }); });\r\n        return true;\r\n    };\r\n    return ScrapeSchedulerService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ScrapeSchedulerService;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/scraping/scrape-scheduler-service.ts\n ** module id = 41\n ** module chunks = 0\n **/","module.exports = require(\"node-schedule\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-schedule\"\n ** module id = 42\n ** module chunks = 0\n **/","/// <reference path=\"./typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar io = require(\"socket.io\");\r\nvar event_bus_1 = require(\"./services/event-bus\");\r\nvar PRODUCT_DATA_RECEIVED_FROM_SERVER = \"product-data-received-from-server\";\r\nfunction run(server, productService) {\r\n    var ioServer = io(server);\r\n    event_bus_1.eventBus.on(event_bus_1.EventNames.ProductScraped, function (productId) {\r\n        productService.one(productId)\r\n            .then(function (product) {\r\n            var connectedClients = ioServer.clients().connected;\r\n            if (connectedClients) {\r\n                Object.keys(connectedClients)\r\n                    .forEach(function (k) {\r\n                    var socket = connectedClients[k];\r\n                    if (socket && socket.connected) {\r\n                        socket.emit(PRODUCT_DATA_RECEIVED_FROM_SERVER, {\r\n                            type: PRODUCT_DATA_RECEIVED_FROM_SERVER,\r\n                            product: product\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    });\r\n}\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = run;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/socket-server.ts\n ** module id = 43\n ** module chunks = 0\n **/","module.exports = require(\"socket.io\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"socket.io\"\n ** module id = 44\n ** module chunks = 0\n **/"],"sourceRoot":""}