{"version":3,"sources":["webpack:///webpack/bootstrap 31f0a6563fc56f5bceea","webpack:///./server/app.ts","webpack:///./server/web-server.ts","webpack:///external \"express\"","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///./server/config.ts","webpack:///external \"fs\"","webpack:///./server/web/routes/product-route.ts","webpack:///./server/data-access/db.ts","webpack:///external \"mongodb\"","webpack:///./server/services/products/mongo-product-storage.ts","webpack:///./server/services/products/product-service.ts","webpack:///./server/services/products/product-validator.ts","webpack:///external \"node-validator\"","webpack:///external \"moment\"","webpack:///external \"node-uuid\"","webpack:///./server/web/routes/web-shop-route.ts","webpack:///./server/services/web-shop/mongo-web-shop-storage.ts","webpack:///./server/services/web-shop/web-shop-service.ts","webpack:///./server/services/web-shop/web-shop-validator.ts","webpack:///./server/scrape-server.ts","webpack:///./server/services/scrape-service.ts","webpack:///./server/scrapers/jsdom-scraper.ts","webpack:///./server/extensions.ts","webpack:///external \"jsdom\"","webpack:///./server/scrapers/value-parser.ts","webpack:///./server/services/scrape-queue-service.ts","webpack:///external \"async\"","webpack:///./server/services/scrape-scheduler-service.ts","webpack:///external \"node-schedule\""],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,+mB;;;;;;ACN3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,4CAA2C,2lF;;;;;;ACxB3C,qC;;;;;;ACAA,yC;;;;;;ACAA,2C;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,2vB;;;;;;ACP3C,gC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC,0BAA0B,EAAE;AAC9D,gCAA+B,yCAAyC,EAAE;AAC1E,EAAC;AACD;AACA;AACA,oCAAmC,2BAA2B,EAAE;AAChE,gCAA+B,iCAAiC,EAAE;AAClE,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,2+J;;;;;;ACjD3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC,kCAAkC,EAAE;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,u8F;;;;;;ACtC3C,qC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,iBAAiB,GAAG,SAAS,EAAE,EAAE;AACjE,iCAAgC,oBAAoB,EAAE;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,gBAAgB,SAAS,GAAG,SAAS,EAAE,EAAE;AACzE,iCAAgC,mBAAmB,EAAE;AACrD,iCAAgC,iBAAiB,EAAE;AACnD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,UAAS,EAAE,EAAE;AACb,gCAA+B,gBAAgB,EAAE;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT,2BAA0B;AAC1B;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,UAAS,EAAE,QAAQ,EAAE;AACrB,iCAAgC,6BAA6B,EAAE;AAC/D;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,+zM;;;;;;ACrE3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,8BAA8B,EAAE;AAC3E,kDAAiD,wBAAwB,EAAE;AAC3E;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,mkR;;;;;;ACzF3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB,cAAa;AACb,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,+4E;;;;;;AC3B3C,4C;;;;;;ACAA,oC;;;;;;ACAA,uC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C;AAC5C;AACA;AACA;AACA;AACA,UAAS,EAAE,EAAE;AACb;AACA,MAAK;AACL,gCAA+B,sCAAsC,EAAE;AACvE,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,+/J;;;;;;ACnD3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,iBAAiB,GAAG,SAAS,EAAE,EAAE;AACjE,iCAAgC,oBAAoB,EAAE;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,gBAAgB,SAAS,GAAG,SAAS,EAAE,EAAE;AACzE,iCAAgC,mBAAmB,EAAE;AACrD,iCAAgC,iBAAiB,EAAE;AACnD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,qBAAqB,iBAAiB;AACtE;AACA;AACA;AACA;AACA,UAAS,EAAE,EAAE;AACb,gCAA+B,gBAAgB,EAAE;AACjD;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,26H;;;;;;ACzC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,8BAA8B,EAAE;AAC3E,kDAAiD,wBAAwB,EAAE;AAC3E,cAAa;AACb,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,29G;;;;;;ACxC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAuD,SAAS;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB,cAAa;AACb,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,u3F;;;;;;AC7B3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,mnG;;;;;;ACxB3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,mCAAmC,aAAa,EAAE,EAAE,EAAE;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C;AAC1C,2CAA0C,qCAAqC,oBAAoB,EAAE,gBAAgB,yBAAyB,EAAE,EAAE,EAAE,EAAE,EAAE;AACxJ,UAAS;AACT;AACA;AACA;AACA;AACA,wCAAuC;AACvC,mDAAkD;AAClD;AACA;AACA,UAAS,EAAE,EAAE,EAAE,EAAE;AACjB;AACA;AACA;AACA;AACA;AACA,sCAAqC;AACrC;AACA,gCAA+B,eAAe,EAAE,EAAE,EAAE;AACpD;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,msL;;;;;;AC/C3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC;AACzC;AACA;AACA;AACA,0DAAyD;AACzD;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB;AACA,wDAAuD,iCAAiC,EAAE;AAC1F,kDAAiD,uBAAuB,EAAE;AAC1E;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0EAAyE,qCAAqC;AAC9G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,+ka;;;;;;AChI3C;AACA;AACA;AACA,yDAAwD,YAAY,EAAE;AACtE;AACA;AACA;AACA;AACA;AACA,UAAS,IAAI;AACb;AACA;AACA;AACA,sCAAqC;AACrC,8BAA6B,0BAA0B,EAAE,EAAE;AAC3D;AACA,4CAA2C,2mE;;;;;;AChB3C,mC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,+gE;;;;;;ACxB3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA,cAAa;AACb,wCAAuC,sBAAsB,EAAE;AAC/D,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,+mM;;;;;;AClE3C,mC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC;AAClC;AACA;AACA;AACA;AACA,gDAA+C,kCAAkC,EAAE;AACnF,cAAa;AACb,UAAS,EAAE,EAAE;AACb;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,mnH;;;;;;ACnC3C,2C","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 31f0a6563fc56f5bceea\n **/","/// <reference path=\"./typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar webServer = require(\"./web-server\");\r\nvar scrapeServer = require(\"./scrape-server\");\r\nscrapeServer.run();\r\nwebServer.run();\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDRDQUE0Qzs7QUFFNUMsSUFBWSxTQUFTLFdBQU0sY0FBYyxDQUFDLENBQUE7QUFDMUMsSUFBWSxZQUFZLFdBQU0saUJBQWlCLENBQUMsQ0FBQTtBQUVoRCxZQUFZLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDbkIsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vdHlwaW5ncy9pbmRleC5kLnRzXCIvPlxyXG5cclxuaW1wb3J0ICogYXMgd2ViU2VydmVyIGZyb20gXCIuL3dlYi1zZXJ2ZXJcIjtcclxuaW1wb3J0ICogYXMgc2NyYXBlU2VydmVyIGZyb20gXCIuL3NjcmFwZS1zZXJ2ZXJcIjtcclxuXHJcbnNjcmFwZVNlcnZlci5ydW4oKTtcclxud2ViU2VydmVyLnJ1bigpOyJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/app.ts\n ** module id = 0\n ** module chunks = 0\n **/","/// <reference path=\"./typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar express = require(\"express\");\r\nvar bodyparser = require(\"body-parser\");\r\nvar cookieparser = require(\"cookie-parser\");\r\nvar config_1 = require(\"./config\");\r\nvar product_route_1 = require(\"./web/routes/product-route\");\r\nvar web_shop_route_1 = require(\"./web/routes/web-shop-route\");\r\nvar server = express();\r\nserver.use(cookieparser());\r\nserver.use(\"/api\", bodyparser.json());\r\n// server.use(\"/api\", authenticationRouter);\r\nserver.use(\"/api/products\", product_route_1.default);\r\nserver.use(\"/api/shops\", web_shop_route_1.default);\r\nserver.use(\"/\", express.static(\"./out/client\", {\r\n    index: \"index.html\"\r\n}));\r\nvar port = process.env.PORT || config_1.default.fallbackPort;\r\nfunction run() {\r\n    server.listen(port, function () {\r\n        console.info(\"Web server started at http://localhost:\" + port + \"/\");\r\n    });\r\n}\r\nexports.run = run;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLXNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIndlYi1zZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsNENBQTRDOztBQUc1QyxJQUFZLE9BQU8sV0FBTyxTQUFTLENBQUMsQ0FBQTtBQUVwQyxJQUFZLFVBQVUsV0FBTSxhQUFhLENBQUMsQ0FBQTtBQUMxQyxJQUFZLFlBQVksV0FBTSxlQUFlLENBQUMsQ0FBQTtBQUU5Qyx1QkFBbUIsVUFBVSxDQUFDLENBQUE7QUFHOUIsOEJBQXlCLDRCQUE0QixDQUFDLENBQUE7QUFDdEQsK0JBQXlCLDZCQUE2QixDQUFDLENBQUE7QUFFdkQsSUFBSSxNQUFNLEdBQUcsT0FBTyxFQUFFLENBQUM7QUFFdkIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDO0FBQzNCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBRXRDLDRDQUE0QztBQUM1QyxNQUFNLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSx1QkFBWSxDQUFDLENBQUM7QUFDMUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsd0JBQVksQ0FBQyxDQUFDO0FBSXZDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFO0lBQzNDLEtBQUssRUFBRSxZQUFZO0NBQ3RCLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksZ0JBQU0sQ0FBQyxZQUFZLENBQUM7QUFFckQ7SUFFSSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRTtRQUNoQixPQUFPLENBQUMsSUFBSSxDQUFDLDRDQUEwQyxJQUFJLE1BQUcsQ0FBQyxDQUFDO0lBQ3BFLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUxlLFdBQUcsTUFLbEIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cclxuXHJcbmltcG9ydCAqIGFzIGh0dHAgIGZyb20gXCJodHRwXCI7XHJcbmltcG9ydCAqIGFzIGV4cHJlc3MgIGZyb20gXCJleHByZXNzXCI7XHJcblxyXG5pbXBvcnQgKiBhcyBib2R5cGFyc2VyIGZyb20gXCJib2R5LXBhcnNlclwiO1xyXG5pbXBvcnQgKiBhcyBjb29raWVwYXJzZXIgZnJvbSBcImNvb2tpZS1wYXJzZXJcIjtcclxuXHJcbmltcG9ydCBjb25maWcgZnJvbSBcIi4vY29uZmlnXCI7XHJcblxyXG5pbXBvcnQgYXV0aGVudGljYXRpb25Sb3V0ZXIgZnJvbSBcIi4vd2ViL3JvdXRlcy9hdXRoZW50aWNhdGlvbi1yb3V0ZVwiO1xyXG5pbXBvcnQgcHJvZHVjdFJvdXRlIGZyb20gXCIuL3dlYi9yb3V0ZXMvcHJvZHVjdC1yb3V0ZVwiO1xyXG5pbXBvcnQgd2ViU2hvcFJvdXRlIGZyb20gXCIuL3dlYi9yb3V0ZXMvd2ViLXNob3Atcm91dGVcIjtcclxuXHJcbmxldCBzZXJ2ZXIgPSBleHByZXNzKCk7XHJcblxyXG5zZXJ2ZXIudXNlKGNvb2tpZXBhcnNlcigpKTtcclxuc2VydmVyLnVzZShcIi9hcGlcIiwgYm9keXBhcnNlci5qc29uKCkpO1xyXG5cclxuLy8gc2VydmVyLnVzZShcIi9hcGlcIiwgYXV0aGVudGljYXRpb25Sb3V0ZXIpO1xyXG5zZXJ2ZXIudXNlKFwiL2FwaS9wcm9kdWN0c1wiLCBwcm9kdWN0Um91dGUpO1xyXG5zZXJ2ZXIudXNlKFwiL2FwaS9zaG9wc1wiLCB3ZWJTaG9wUm91dGUpO1xyXG5cclxuXHJcblxyXG5zZXJ2ZXIudXNlKFwiL1wiLCBleHByZXNzLnN0YXRpYyhcIi4vb3V0L2NsaWVudFwiLCB7XHJcbiAgICBpbmRleDogXCJpbmRleC5odG1sXCJcclxufSkpO1xyXG5cclxuY29uc3QgcG9ydCA9IHByb2Nlc3MuZW52LlBPUlQgfHwgY29uZmlnLmZhbGxiYWNrUG9ydDtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBydW4oKSB7XHJcblxyXG4gICAgc2VydmVyLmxpc3Rlbihwb3J0LCAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5pbmZvKGBXZWIgc2VydmVyIHN0YXJ0ZWQgYXQgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L2ApO1xyXG4gICAgfSk7XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web-server.ts\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = require(\"body-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"body-parser\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"cookie-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"cookie-parser\"\n ** module id = 4\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"typings/index.d.ts\"/>\r\nvar fs = require(\"fs\");\r\nvar configContent = fs.readFileSync(\"./config.json\", \"utf8\");\r\nvar configuration = JSON.parse(configContent);\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = configuration;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29uZmlnLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwwQ0FBMEM7QUFDMUMsSUFBWSxFQUFFLFdBQU0sSUFBSSxDQUFDLENBQUE7QUFHekIsSUFBSSxhQUFhLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxlQUFlLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDN0QsSUFBSSxhQUFhLEdBQWtCLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7QUFFN0Q7a0JBQWUsYUFBYSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cInR5cGluZ3MvaW5kZXguZC50c1wiLz5cclxuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XHJcblxyXG5cclxubGV0IGNvbmZpZ0NvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoXCIuL2NvbmZpZy5qc29uXCIsIFwidXRmOFwiKTtcclxubGV0IGNvbmZpZ3VyYXRpb24gPSA8Q29uZmlndXJhdGlvbj5KU09OLnBhcnNlKGNvbmZpZ0NvbnRlbnQpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY29uZmlndXJhdGlvbjsiXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/config.ts\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 6\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar express = require(\"express\");\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar mongo_product_storage_1 = require(\"../../services/products/mongo-product-storage\");\r\nvar product_service_1 = require(\"../../services/products/product-service\");\r\nvar db = new db_1.default();\r\nvar productService = new product_service_1.default(new mongo_product_storage_1.default(db));\r\nvar router = express.Router();\r\nrouter.get(\"/:id\", function (req, res) {\r\n    var productId = req.param(\"id\");\r\n    if (!productId) {\r\n        res.send(404, \"Not found\")\r\n            .end();\r\n        return;\r\n    }\r\n    productService.one(productId)\r\n        .then(function (product) { return res.json(product); })\r\n        .catch(function (err) { return res.send(404, \"Not found\").end(); });\r\n});\r\nrouter.get(\"/\", function (req, res) {\r\n    productService.all()\r\n        .then(function (products) { return res.json(products); })\r\n        .catch(function (err) { return res.send(500, err).end(); });\r\n});\r\nrouter.post(\"/\", function (request, response) {\r\n    var product = request.body;\r\n    productService.save(product)\r\n        .then(function (result) {\r\n        if (result[\"isValid\"] === false) {\r\n            var validationResult = result;\r\n            var failResponse = {\r\n                ok: false,\r\n                errors: validationResult.errors\r\n            };\r\n            response.json(failResponse).end();\r\n        }\r\n        else {\r\n            var updatedProduct = result;\r\n            var okResponse = {\r\n                ok: true,\r\n                entity: updatedProduct\r\n            };\r\n            response.json(okResponse).end();\r\n        }\r\n    });\r\n});\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = router;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1yb3V0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInByb2R1Y3Qtcm91dGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsZ0RBQWdEOztBQUVoRCxJQUFZLE9BQU8sV0FBTSxTQUFTLENBQUMsQ0FBQTtBQUVuQyxtQkFBZSxzQkFBc0IsQ0FBQyxDQUFBO0FBQ3RDLHNDQUFnQywrQ0FBK0MsQ0FBQyxDQUFBO0FBQ2hGLGdDQUEyQix5Q0FBeUMsQ0FBQyxDQUFBO0FBRXJFLElBQU0sRUFBRSxHQUFHLElBQUksWUFBRSxFQUFFLENBQUM7QUFFcEIsSUFBTSxjQUFjLEdBQUcsSUFBSSx5QkFBYyxDQUFDLElBQUksK0JBQW1CLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUV2RSxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7QUFFaEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsVUFBQyxHQUFHLEVBQUUsR0FBRztJQUN4QixJQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWxDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUNiLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFdBQVcsQ0FBQzthQUNyQixHQUFHLEVBQUUsQ0FBQztRQUNYLE1BQU0sQ0FBQztJQUNYLENBQUM7SUFHRCxjQUFjLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQztTQUN4QixJQUFJLENBQUMsVUFBQSxPQUFPLElBQUksT0FBQSxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFqQixDQUFpQixDQUFDO1NBQ2xDLEtBQUssQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFoQyxDQUFnQyxDQUFDLENBQUM7QUFDeEQsQ0FBQyxDQUFDLENBQUM7QUFFSCxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxVQUFDLEdBQUcsRUFBRSxHQUFHO0lBQ3JCLGNBQWMsQ0FBQyxHQUFHLEVBQUU7U0FDZixJQUFJLENBQUMsVUFBQSxRQUFRLElBQUksT0FBQSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFsQixDQUFrQixDQUFDO1NBQ3BDLEtBQUssQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUF4QixDQUF3QixDQUFDLENBQUM7QUFDaEQsQ0FBQyxDQUFDLENBQUM7QUFFSCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxVQUFDLE9BQU8sRUFBRSxRQUFRO0lBQy9CLElBQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7SUFFN0IsY0FBYyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7U0FDdkIsSUFBSSxDQUFDLFVBQUEsTUFBTTtRQUNSLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQzlCLElBQU0sZ0JBQWdCLEdBQXlCLE1BQU0sQ0FBQztZQUV0RCxJQUFNLFlBQVksR0FBc0I7Z0JBQ3BDLEVBQUUsRUFBRSxLQUFLO2dCQUNULE1BQU0sRUFBRSxnQkFBZ0IsQ0FBQyxNQUFNO2FBQ2xDLENBQUM7WUFFRixRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3RDLENBQUM7UUFDRCxJQUFJLENBQUMsQ0FBQztZQUNGLElBQU0sY0FBYyxHQUFnQixNQUFNLENBQUM7WUFDM0MsSUFBTSxVQUFVLEdBQXNDO2dCQUNsRCxFQUFFLEVBQUUsSUFBSTtnQkFDUixNQUFNLEVBQUUsY0FBYzthQUN6QixDQUFDO1lBRUYsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNwQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFWCxDQUFDLENBQUMsQ0FBQztBQUVIO2tCQUFlLE1BQU0sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcblxyXG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XHJcblxyXG5pbXBvcnQgRGIgZnJvbSBcIi4uLy4uL2RhdGEtYWNjZXNzL2RiXCI7XHJcbmltcG9ydCBNb25nb1Byb2R1Y3RTdG9yYWdlIGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9wcm9kdWN0cy9tb25nby1wcm9kdWN0LXN0b3JhZ2VcIjtcclxuaW1wb3J0IFByb2R1Y3RTZXJ2aWNlIGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9wcm9kdWN0cy9wcm9kdWN0LXNlcnZpY2VcIjtcclxuXHJcbmNvbnN0IGRiID0gbmV3IERiKCk7XHJcblxyXG5jb25zdCBwcm9kdWN0U2VydmljZSA9IG5ldyBQcm9kdWN0U2VydmljZShuZXcgTW9uZ29Qcm9kdWN0U3RvcmFnZShkYikpOyBcclxuXHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcblxyXG5yb3V0ZXIuZ2V0KFwiLzppZFwiLCAocmVxLCByZXMpID0+IHtcclxuICAgIGNvbnN0IHByb2R1Y3RJZCA9IHJlcS5wYXJhbShcImlkXCIpO1xyXG5cclxuICAgIGlmICghcHJvZHVjdElkKSB7XHJcbiAgICAgICAgcmVzLnNlbmQoNDA0LCBcIk5vdCBmb3VuZFwiKVxyXG4gICAgICAgICAgICAuZW5kKCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcm9kdWN0U2VydmljZS5vbmUocHJvZHVjdElkKVxyXG4gICAgICAgIC50aGVuKHByb2R1Y3QgPT4gcmVzLmpzb24ocHJvZHVjdCkpXHJcbiAgICAgICAgLmNhdGNoKGVyciA9PiByZXMuc2VuZCg0MDQsIFwiTm90IGZvdW5kXCIpLmVuZCgpKTtcclxufSk7XHJcblxyXG5yb3V0ZXIuZ2V0KFwiL1wiLCAocmVxLCByZXMpID0+IHtcclxuICAgIHByb2R1Y3RTZXJ2aWNlLmFsbCgpXHJcbiAgICAgICAgLnRoZW4ocHJvZHVjdHMgPT4gcmVzLmpzb24ocHJvZHVjdHMpKVxyXG4gICAgICAgIC5jYXRjaChlcnIgPT4gcmVzLnNlbmQoNTAwLCBlcnIpLmVuZCgpKTsgXHJcbn0pO1xyXG5cclxucm91dGVyLnBvc3QoXCIvXCIsIChyZXF1ZXN0LCByZXNwb25zZSkgPT4ge1xyXG4gICAgY29uc3QgcHJvZHVjdCA9IHJlcXVlc3QuYm9keTtcclxuXHJcbiAgICBwcm9kdWN0U2VydmljZS5zYXZlKHByb2R1Y3QpXHJcbiAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdFtcImlzVmFsaWRcIl0gPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gPEFwaS5WYWxpZGF0aW9uUmVzdWx0PnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBmYWlsUmVzcG9uc2U6IEFwaS5JRmFpbFJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIG9rOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oZmFpbFJlc3BvbnNlKS5lbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRQcm9kdWN0ID0gPEFwaS5Qcm9kdWN0PnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9rUmVzcG9uc2U6IEFwaS5JU3VjY2Vzc1Jlc3BvbnNlPEFwaS5Qcm9kdWN0PiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBvazogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBlbnRpdHk6IHVwZGF0ZWRQcm9kdWN0XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmpzb24ob2tSZXNwb25zZSkuZW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcm91dGVyOyJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web/routes/product-route.ts\n ** module id = 7\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"../typings/index.d.ts\" />\r\nvar mongo = require(\"mongodb\");\r\nvar config_1 = require(\"../config\");\r\nvar db = new Promise(function (resolve, reject) {\r\n    mongo.MongoClient.connect(config_1.default.mongoUrl, function (err, db) {\r\n        if (err) {\r\n            reject(err);\r\n        }\r\n        else {\r\n            console.info(\"Connected to Mongo server at \" + config_1.default.mongoUrl);\r\n            resolve(db);\r\n        }\r\n    });\r\n});\r\nvar Database = (function () {\r\n    function Database() {\r\n    }\r\n    Database.prototype.collection = function (collection) {\r\n        if (!collection)\r\n            throw new Error(\"collection is undefined\");\r\n        if (!Database.Collections[collection])\r\n            throw new Error(\"Collection \" + collection + \" is unknown\");\r\n        return this.connect()\r\n            .then(function (db) { return db.collection(collection); });\r\n    };\r\n    Database.prototype.connect = function () {\r\n        return db;\r\n    };\r\n    Database.Collections = {\r\n        sessions: \"sessions\",\r\n        webshops: \"webshops\",\r\n        products: \"products\"\r\n    };\r\n    return Database;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = Database;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsOENBQThDO0FBQzlDLElBQVksS0FBSyxXQUFNLFNBQVMsQ0FBQyxDQUFBO0FBQ2pDLHVCQUFtQixXQUFXLENBQUMsQ0FBQTtBQUUvQixJQUFJLEVBQUUsR0FBc0IsSUFBSSxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsTUFBTTtJQUNwRCxLQUFLLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxnQkFBTSxDQUFDLFFBQVEsRUFDekMsVUFBQyxHQUFHLEVBQUUsRUFBRTtRQUNKLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDTixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ0osT0FBTyxDQUFDLElBQUksQ0FBQyxrQ0FBZ0MsZ0JBQU0sQ0FBQyxRQUFVLENBQUMsQ0FBQztZQUNoRSxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDaEIsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUM7QUFFSDtJQUFBO0lBb0JBLENBQUM7SUFiRyw2QkFBVSxHQUFWLFVBQVcsVUFBa0I7UUFDekIsRUFBRSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUM7WUFDWixNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFDL0MsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0JBQWMsVUFBVSxnQkFBYSxDQUFDLENBQUM7UUFFM0QsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7YUFDaEIsSUFBSSxDQUFDLFVBQUEsRUFBRSxJQUFJLE9BQUEsRUFBRSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFBekIsQ0FBeUIsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFTywwQkFBTyxHQUFmO1FBQ0ksTUFBTSxDQUFDLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFsQk0sb0JBQVcsR0FBRztRQUNqQixRQUFRLEVBQUUsVUFBVTtRQUNwQixRQUFRLEVBQUUsVUFBVTtRQUNwQixRQUFRLEVBQUUsVUFBVTtLQUN2QixDQUFDO0lBZU4sZUFBQztBQUFELENBQUMsQUFwQkQsSUFvQkM7QUFwQkQ7MEJBb0JDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuaW1wb3J0ICogYXMgbW9uZ28gZnJvbSBcIm1vbmdvZGJcIjtcclxuaW1wb3J0IGNvbmZpZyBmcm9tIFwiLi4vY29uZmlnXCI7XHJcblxyXG5sZXQgZGI6IFByb21pc2U8bW9uZ28uRGI+ID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgbW9uZ28uTW9uZ29DbGllbnQuY29ubmVjdChjb25maWcubW9uZ29VcmwsXHJcbiAgICAoZXJyLCBkYikgPT4ge1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5pbmZvKGBDb25uZWN0ZWQgdG8gTW9uZ28gc2VydmVyIGF0ICR7Y29uZmlnLm1vbmdvVXJsfWApO1xyXG4gICAgICAgICAgICByZXNvbHZlKGRiKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEYXRhYmFzZSB7XHJcbiAgICBzdGF0aWMgQ29sbGVjdGlvbnMgPSB7XHJcbiAgICAgICAgc2Vzc2lvbnM6IFwic2Vzc2lvbnNcIixcclxuICAgICAgICB3ZWJzaG9wczogXCJ3ZWJzaG9wc1wiLFxyXG4gICAgICAgIHByb2R1Y3RzOiBcInByb2R1Y3RzXCJcclxuICAgIH07XHJcblxyXG4gICAgY29sbGVjdGlvbihjb2xsZWN0aW9uOiBzdHJpbmcpOiBQcm9taXNlPG1vbmdvLkNvbGxlY3Rpb24+IHtcclxuICAgICAgICBpZiAoIWNvbGxlY3Rpb24pXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvbGxlY3Rpb24gaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgICAgIGlmICghRGF0YWJhc2UuQ29sbGVjdGlvbnNbY29sbGVjdGlvbl0pXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29sbGVjdGlvbiAke2NvbGxlY3Rpb259IGlzIHVua25vd25gKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdCgpXHJcbiAgICAgICAgICAgIC50aGVuKGRiID0+IGRiLmNvbGxlY3Rpb24oY29sbGVjdGlvbikpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29ubmVjdCgpOiBQcm9taXNlPG1vbmdvLkRiPiB7XHJcbiAgICAgICAgcmV0dXJuIGRiO1xyXG4gICAgfVxyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/data-access/db.ts\n ** module id = 8\n ** module chunks = 0\n **/","module.exports = require(\"mongodb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongodb\"\n ** module id = 9\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar MongoProductStorage = (function () {\r\n    function MongoProductStorage(db) {\r\n        this.db = db;\r\n        if (!db)\r\n            throw new Error(\"db is missing\");\r\n    }\r\n    MongoProductStorage.prototype.all = function () {\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.find({}, { _id: 0 }); })\r\n            .then(function (c) { return c.toArray(); });\r\n    };\r\n    MongoProductStorage.prototype.one = function (id) {\r\n        if (!id)\r\n            throw new Error(\"id is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.find({ id: id }, { _id: 0 }); })\r\n            .then(function (c) { return c.limit(1); })\r\n            .then(function (c) { return c.next(); });\r\n    };\r\n    MongoProductStorage.prototype.save = function (product) {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.updateOne({\r\n            id: product.id\r\n        }, {\r\n            $set: {\r\n                id: product.id,\r\n                title: product.title,\r\n                scrapingUrls: product.scrapingUrls\r\n            }\r\n        }, {\r\n            upsert: true\r\n        }); })\r\n            .then(function () { return product; });\r\n    };\r\n    MongoProductStorage.prototype.setScrapingData = function (productId, webShopId, values, log) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        if (!webShopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        if (!values)\r\n            throw new Error(\"values is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.updateOne({\r\n            id: productId\r\n        }, {\r\n            $set: (_a = {},\r\n                _a[\"values.\" + webShopId] = values,\r\n                _a[\"log.\" + webShopId] = log,\r\n                _a\r\n            )\r\n        }, {\r\n            upsert: true\r\n        }); var _a; })\r\n            .then(function (r) { return _this.one(productId); });\r\n    };\r\n    return MongoProductStorage;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = MongoProductStorage;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uZ28tcHJvZHVjdC1zdG9yYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibW9uZ28tcHJvZHVjdC1zdG9yYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDs7QUFFakQsbUJBQXFCLHNCQUFzQixDQUFDLENBQUE7QUFFNUM7SUFDSSw2QkFBb0IsRUFBWTtRQUFaLE9BQUUsR0FBRixFQUFFLENBQVU7UUFDNUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDSixNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRCxpQ0FBRyxHQUFIO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO2FBQ1QsVUFBVSxDQUFDLFlBQVEsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDO2FBQ3pDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQXRCLENBQXNCLENBQUM7YUFDakMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFYLENBQVcsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRCxpQ0FBRyxHQUFILFVBQUksRUFBVTtRQUNWLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ0osTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRXZDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTthQUNULFVBQVUsQ0FBQyxZQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQzthQUN6QyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQTlCLENBQThCLENBQUM7YUFDekMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBVixDQUFVLENBQUM7YUFDckIsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFSLENBQVEsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCxrQ0FBSSxHQUFKLFVBQUssT0FBb0I7UUFDckIsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDVCxNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFFNUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO2FBQ1QsVUFBVSxDQUFDLFlBQVEsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDO2FBQ3pDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDbkIsRUFBRSxFQUFFLE9BQU8sQ0FBQyxFQUFFO1NBQ2pCLEVBQ0Q7WUFDSSxJQUFJLEVBQUU7Z0JBQ0YsRUFBRSxFQUFFLE9BQU8sQ0FBQyxFQUFFO2dCQUNkLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSztnQkFDcEIsWUFBWSxFQUFFLE9BQU8sQ0FBQyxZQUFZO2FBQ3JDO1NBQ0osRUFDRDtZQUNJLE1BQU0sRUFBRSxJQUFJO1NBQ2YsQ0FBQyxFQVpTLENBWVQsQ0FBQzthQUNGLElBQUksQ0FBQyxjQUFNLE9BQUEsT0FBTyxFQUFQLENBQU8sQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCw2Q0FBZSxHQUFmLFVBQWdCLFNBQWlCLEVBQUUsU0FBaUIsRUFBRSxNQUF5QixFQUFFLEdBQWtCO1FBQW5HLGlCQXdCQztRQXZCRyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUM5QyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUM5QyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUNSLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUUzQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7YUFDVCxVQUFVLENBQUMsWUFBUSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUM7YUFDekMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLFNBQVMsQ0FDdEI7WUFDSSxFQUFFLEVBQUUsU0FBUztTQUNoQixFQUNEO1lBQ0ksSUFBSSxFQUFFO2dCQUNGLEdBQUMsWUFBVSxTQUFXLENBQUMsR0FBRSxNQUFNO2dCQUMvQixHQUFDLFNBQU8sU0FBVyxDQUFDLEdBQUUsR0FBRzs7YUFDNUI7U0FDSixFQUNEO1lBQ0ksTUFBTSxFQUFFLElBQUk7U0FDZixDQUFDLFVBWlMsQ0FZVCxDQUFDO2FBQ0YsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsS0FBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBbkIsQ0FBbUIsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFDTCwwQkFBQztBQUFELENBQUMsQUF2RUQsSUF1RUM7QUF2RUQ7cUNBdUVDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCBEYXRhYmFzZSBmcm9tIFwiLi4vLi4vZGF0YS1hY2Nlc3MvZGJcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vbmdvUHJvZHVjdFN0b3JhZ2UgaW1wbGVtZW50cyBQcm9kdWN0cy5JUHJvZHVjdFN0b3JhZ2Uge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBkYjogRGF0YWJhc2UpIHtcclxuICAgICAgICBpZiAoIWRiKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJkYiBpcyBtaXNzaW5nXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGFsbCgpOiBQcm9taXNlPEFwaS5Qcm9kdWN0W10+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kYlxyXG4gICAgICAgICAgICAuY29sbGVjdGlvbihEYXRhYmFzZS5Db2xsZWN0aW9ucy5wcm9kdWN0cylcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLmZpbmQoe30sIHsgX2lkOiAwIH0pKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMudG9BcnJheSgpKTtcclxuICAgIH1cclxuXHJcbiAgICBvbmUoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBpLlByb2R1Y3Q+IHtcclxuICAgICAgICBpZiAoIWlkKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpZCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmRiXHJcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKERhdGFiYXNlLkNvbGxlY3Rpb25zLnByb2R1Y3RzKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMuZmluZCh7IGlkOiBpZCB9LCB7IF9pZDogMCB9KSlcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLmxpbWl0KDEpKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMubmV4dCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlKHByb2R1Y3Q6IEFwaS5Qcm9kdWN0KTogUHJvbWlzZTxBcGkuUHJvZHVjdD4ge1xyXG4gICAgICAgIGlmICghcHJvZHVjdClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHJvZHVjdCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmRiXHJcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKERhdGFiYXNlLkNvbGxlY3Rpb25zLnByb2R1Y3RzKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMudXBkYXRlT25lKHtcclxuICAgICAgICAgICAgICAgIGlkOiBwcm9kdWN0LmlkXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICRzZXQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogcHJvZHVjdC5pZCxcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogcHJvZHVjdC50aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICBzY3JhcGluZ1VybHM6IHByb2R1Y3Quc2NyYXBpbmdVcmxzXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHVwc2VydDogdHJ1ZVxyXG4gICAgICAgICAgICB9KSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gcHJvZHVjdCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U2NyYXBpbmdEYXRhKHByb2R1Y3RJZDogc3RyaW5nLCB3ZWJTaG9wSWQ6IHN0cmluZywgdmFsdWVzOiBBcGkuU2NyYXBlZFZhbHVlcywgbG9nOiBBcGkuU2NyYXBlTG9nKTogUHJvbWlzZTxBcGkuUHJvZHVjdD4ge1xyXG4gICAgICAgIGlmICghcHJvZHVjdElkKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJwcm9kdWN0SWQgaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgICAgIGlmICghd2ViU2hvcElkKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ3ZWJTaG9wSWQgaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgICAgIGlmICghdmFsdWVzKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ2YWx1ZXMgaXMgdW5kZWZpbmVkXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5kYlxyXG4gICAgICAgICAgICAuY29sbGVjdGlvbihEYXRhYmFzZS5Db2xsZWN0aW9ucy5wcm9kdWN0cylcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLnVwZGF0ZU9uZShcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6IHByb2R1Y3RJZFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAkc2V0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgW2B2YWx1ZXMuJHt3ZWJTaG9wSWR9YF06IHZhbHVlcyxcclxuICAgICAgICAgICAgICAgICAgICBbYGxvZy4ke3dlYlNob3BJZH1gXTogbG9nXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHVwc2VydDogdHJ1ZVxyXG4gICAgICAgICAgICB9KSlcclxuICAgICAgICAgICAgLnRoZW4ociA9PiB0aGlzLm9uZShwcm9kdWN0SWQpKTtcclxuICAgIH1cclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/products/mongo-product-storage.ts\n ** module id = 10\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar product_validator_1 = require(\"./product-validator\");\r\nvar moment = require(\"moment\");\r\nvar uuid = require(\"node-uuid\");\r\nvar ProductService = (function () {\r\n    function ProductService(storage) {\r\n        this.storage = storage;\r\n        this.validator = new product_validator_1.default();\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n    ProductService.prototype.all = function () {\r\n        return this.storage.all();\r\n    };\r\n    ProductService.prototype.save = function (product) {\r\n        var _this = this;\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n        if (!product.id)\r\n            product.id = uuid.v1();\r\n        return new Promise(function (resolve) {\r\n            _this.validator\r\n                .validate(product)\r\n                .then(function (validationResult) {\r\n                if (!validationResult.isValid)\r\n                    resolve(validationResult);\r\n                else {\r\n                    _this.storage\r\n                        .save(product)\r\n                        .then(function () { return _this.one(product.id); })\r\n                        .then(function (entity) { return resolve(entity); });\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ProductService.prototype.one = function (productId) {\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return this.storage.one(productId);\r\n    };\r\n    ProductService.prototype.updateScrapedData = function (productId, webshopId, data) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        if (!webshopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        if (!data)\r\n            throw new Error(\"data is undefined\");\r\n        var now = moment.utc().toDate();\r\n        return this.one(productId)\r\n            .then(function (product) {\r\n            if (!product.values)\r\n                product.values = {};\r\n            var values = product.values[webshopId] || {\r\n                title: null,\r\n                price: null,\r\n                image: null\r\n            };\r\n            product.values[webshopId] = values;\r\n            if (!product.log)\r\n                product.log = {};\r\n            var log = product.log[webshopId] || {\r\n                url: null,\r\n                scrapedAt: null,\r\n                error: data.error,\r\n                values: {}\r\n            };\r\n            product.log[webshopId] = log;\r\n            log.url = product.scrapingUrls[webshopId];\r\n            log.scrapedAt = now;\r\n            log.error = data.error;\r\n            Object.keys(data.values)\r\n                .forEach(function (name) {\r\n                var value = data.values[name];\r\n                if (value.isSuccessful)\r\n                    values[name] = value.value;\r\n                log.values[name] = {\r\n                    scrapedAt: now,\r\n                    error: value.error\r\n                };\r\n            });\r\n            return _this.storage.setScrapingData(product.id, webshopId, values, log);\r\n        });\r\n    };\r\n    return ProductService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ProductService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicHJvZHVjdC1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDs7QUFFakQsa0NBQTZCLHFCQUFxQixDQUFDLENBQUE7QUFDbkQsSUFBWSxNQUFNLFdBQU0sUUFBUSxDQUFDLENBQUE7QUFDakMsSUFBWSxJQUFJLFdBQU0sV0FBVyxDQUFDLENBQUE7QUFFbEM7SUFHSSx3QkFBb0IsT0FBaUM7UUFBakMsWUFBTyxHQUFQLE9BQU8sQ0FBMEI7UUFGN0MsY0FBUyxHQUFHLElBQUksMkJBQWdCLEVBQUUsQ0FBQztRQUd2QyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUNULE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQsNEJBQUcsR0FBSDtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFRCw2QkFBSSxHQUFKLFVBQUssT0FBb0I7UUFBekIsaUJBcUJDO1FBcEJHLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBRTVDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUNaLE9BQU8sQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBRTNCLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxVQUFBLE9BQU87WUFDdEIsS0FBSSxDQUFDLFNBQVM7aUJBQ1QsUUFBUSxDQUFDLE9BQU8sQ0FBQztpQkFDakIsSUFBSSxDQUFDLFVBQUEsZ0JBQWdCO2dCQUNsQixFQUFFLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQztvQkFDMUIsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7Z0JB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QUFLLENBQUMsS0FBSyxDQUFDO2dCQUUvQixHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHO29CQUNmLFNBQVMsRUFBRSxHQUFHO29CQUNkLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztpQkFDckIsQ0FBQztZQUNOLENBQUMsQ0FBQyxDQUFDO1lBRVAsTUFBTSxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM1RSxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFDTCxxQkFBQztBQUFELENBQUMsQUEvRkQsSUErRkM7QUEvRkQ7Z0NBK0ZDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCBQcm9kdWN0VmFsaWRhdG9yIGZyb20gXCIuL3Byb2R1Y3QtdmFsaWRhdG9yXCI7XHJcbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tIFwibW9tZW50XCI7XHJcbmltcG9ydCAqIGFzIHV1aWQgZnJvbSBcIm5vZGUtdXVpZFwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvZHVjdFNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSB2YWxpZGF0b3IgPSBuZXcgUHJvZHVjdFZhbGlkYXRvcigpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc3RvcmFnZTogUHJvZHVjdHMuSVByb2R1Y3RTdG9yYWdlKSB7XHJcbiAgICAgICAgaWYgKCFzdG9yYWdlKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzdG9yYWdlIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBhbGwoKTogUHJvbWlzZTxBcGkuUHJvZHVjdFtdPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5hbGwoKTtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlKHByb2R1Y3Q6IEFwaS5Qcm9kdWN0KTogUHJvbWlzZTxBcGkuVmFsaWRhdGlvblJlc3VsdCB8IEFwaS5Qcm9kdWN0PiB7XHJcbiAgICAgICAgaWYgKCFwcm9kdWN0KVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJwcm9kdWN0IGlzIHVuZGVmaW5lZFwiKTtcclxuXHJcbiAgICAgICAgaWYgKCFwcm9kdWN0LmlkKVxyXG4gICAgICAgICAgICBwcm9kdWN0LmlkID0gdXVpZC52MSgpO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdG9yXHJcbiAgICAgICAgICAgICAgICAudmFsaWRhdGUocHJvZHVjdClcclxuICAgICAgICAgICAgICAgIC50aGVuKHZhbGlkYXRpb25SZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdmFsaWRhdGlvblJlc3VsdC5pc1ZhbGlkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHZhbGlkYXRpb25SZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3JhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zYXZlKHByb2R1Y3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLm9uZShwcm9kdWN0LmlkKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGVudGl0eSA9PiByZXNvbHZlKGVudGl0eSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uZShwcm9kdWN0SWQ6IHN0cmluZyk6IFByb21pc2U8QXBpLlByb2R1Y3Q+IHtcclxuICAgICAgICBpZiAoIXByb2R1Y3RJZClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHJvZHVjdElkIGlzIHVuZGVmaW5lZFwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5vbmUocHJvZHVjdElkKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVTY3JhcGVkRGF0YShwcm9kdWN0SWQ6IHN0cmluZywgd2Vic2hvcElkOiBzdHJpbmcsIGRhdGE6IFNjcmFwaW5nLldlYlNob3BTY3JhcGluZ1Jlc3VsdCk6IFByb21pc2U8QXBpLlByb2R1Y3Q+IHtcclxuICAgICAgICBpZiAoIXByb2R1Y3RJZClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHJvZHVjdElkIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoIXdlYnNob3BJZClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwid2ViU2hvcElkIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoIWRhdGEpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImRhdGEgaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgICAgIGNvbnN0IG5vdyA9IG1vbWVudC51dGMoKS50b0RhdGUoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMub25lKHByb2R1Y3RJZClcclxuICAgICAgICAgICAgLnRoZW4ocHJvZHVjdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXByb2R1Y3QudmFsdWVzKVxyXG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3QudmFsdWVzID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlcyA9IHByb2R1Y3QudmFsdWVzW3dlYnNob3BJZF0gfHwge1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHByaWNlOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcHJvZHVjdC52YWx1ZXNbd2Vic2hvcElkXSA9IHZhbHVlcztcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFwcm9kdWN0LmxvZylcclxuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LmxvZyA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBsb2cgPSBwcm9kdWN0LmxvZ1t3ZWJzaG9wSWRdIHx8IHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgc2NyYXBlZEF0OiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBkYXRhLmVycm9yLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlczoge31cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBwcm9kdWN0LmxvZ1t3ZWJzaG9wSWRdID0gbG9nO1xyXG5cclxuICAgICAgICAgICAgICAgIGxvZy51cmwgPSBwcm9kdWN0LnNjcmFwaW5nVXJsc1t3ZWJzaG9wSWRdO1xyXG4gICAgICAgICAgICAgICAgbG9nLnNjcmFwZWRBdCA9IG5vdztcclxuICAgICAgICAgICAgICAgIGxvZy5lcnJvciA9IGRhdGEuZXJyb3I7XHJcblxyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZGF0YS52YWx1ZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgLmZvckVhY2gobmFtZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZGF0YS52YWx1ZXNbbmFtZV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuaXNTdWNjZXNzZnVsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW25hbWVdID0gdmFsdWUudmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cudmFsdWVzW25hbWVdID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyYXBlZEF0OiBub3csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogdmFsdWUuZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdG9yYWdlLnNldFNjcmFwaW5nRGF0YShwcm9kdWN0LmlkLCB3ZWJzaG9wSWQsIHZhbHVlcywgbG9nKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/products/product-service.ts\n ** module id = 11\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar validator = require(\"node-validator\");\r\nvar ProductValidator = (function () {\r\n    function ProductValidator() {\r\n        this.productValidator = validator.isAnyObject()\r\n            .withRequired(\"id\", validator.isString())\r\n            .withRequired(\"title\", validator.isString());\r\n    }\r\n    ProductValidator.prototype.validate = function (product) {\r\n        var _this = this;\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n        return new Promise(function (resolve) {\r\n            validator.run(_this.productValidator, product, function (errorCount, errors) {\r\n                resolve({\r\n                    isValid: errorCount === 0,\r\n                    errorCount: errorCount,\r\n                    errors: errors\r\n                });\r\n            });\r\n        });\r\n    };\r\n    return ProductValidator;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ProductValidator;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC12YWxpZGF0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwcm9kdWN0LXZhbGlkYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpREFBaUQ7O0FBRWpELElBQVksU0FBUyxXQUFNLGdCQUFnQixDQUFDLENBQUE7QUFFNUM7SUFHSTtRQUNJLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxTQUFTLENBQUMsV0FBVyxFQUFFO2FBQzFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDO2FBQ3hDLFlBQVksQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFFckQsQ0FBQztJQUVELG1DQUFRLEdBQVIsVUFBUyxPQUFvQjtRQUE3QixpQkFlQztRQWRHLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBRTVDLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxVQUFBLE9BQU87WUFDdEIsU0FBUyxDQUFDLEdBQUcsQ0FBQyxLQUFJLENBQUMsZ0JBQWdCLEVBQy9CLE9BQU8sRUFDUCxVQUFDLFVBQVUsRUFBRSxNQUFNO2dCQUNmLE9BQU8sQ0FBQztvQkFDSixPQUFPLEVBQUUsVUFBVSxLQUFLLENBQUM7b0JBQ3pCLFVBQVUsRUFBRSxVQUFVO29CQUN0QixNQUFNLEVBQUUsTUFBTTtpQkFDakIsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDTCx1QkFBQztBQUFELENBQUMsQUExQkQsSUEwQkM7QUExQkQ7a0NBMEJDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCAqIGFzIHZhbGlkYXRvciBmcm9tIFwibm9kZS12YWxpZGF0b3JcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2R1Y3RWYWxpZGF0b3Ige1xyXG4gICAgcHJpdmF0ZSBwcm9kdWN0VmFsaWRhdG9yOiB2YWxpZGF0b3IuVmFsaWRhdGFibGU7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5wcm9kdWN0VmFsaWRhdG9yID0gdmFsaWRhdG9yLmlzQW55T2JqZWN0KClcclxuICAgICAgICAgICAgLndpdGhSZXF1aXJlZChcImlkXCIsIHZhbGlkYXRvci5pc1N0cmluZygpKVxyXG4gICAgICAgICAgICAud2l0aFJlcXVpcmVkKFwidGl0bGVcIiwgdmFsaWRhdG9yLmlzU3RyaW5nKCkpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB2YWxpZGF0ZShwcm9kdWN0OiBBcGkuUHJvZHVjdCk6IFByb21pc2U8QXBpLlZhbGlkYXRpb25SZXN1bHQ+IHtcclxuICAgICAgICBpZiAoIXByb2R1Y3QpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInByb2R1Y3QgaXMgdW5kZWZpbmVkXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgIHZhbGlkYXRvci5ydW4odGhpcy5wcm9kdWN0VmFsaWRhdG9yLFxyXG4gICAgICAgICAgICAgICAgcHJvZHVjdCxcclxuICAgICAgICAgICAgICAgIChlcnJvckNvdW50LCBlcnJvcnMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXNWYWxpZDogZXJyb3JDb3VudCA9PT0gMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JDb3VudDogZXJyb3JDb3VudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBlcnJvcnNcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/products/product-validator.ts\n ** module id = 12\n ** module chunks = 0\n **/","module.exports = require(\"node-validator\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-validator\"\n ** module id = 13\n ** module chunks = 0\n **/","module.exports = require(\"moment\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"moment\"\n ** module id = 14\n ** module chunks = 0\n **/","module.exports = require(\"node-uuid\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-uuid\"\n ** module id = 15\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar express = require(\"express\");\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar mongo_web_shop_storage_1 = require(\"../../services/web-shop/mongo-web-shop-storage\");\r\nvar web_shop_service_1 = require(\"../../services/web-shop/web-shop-service\");\r\nvar db = new db_1.default();\r\nvar webShopService = new web_shop_service_1.default(new mongo_web_shop_storage_1.default(db));\r\nvar router = express.Router();\r\nrouter.get(\"/\", function (request, response) {\r\n    webShopService.all()\r\n        .then(function (shops) {\r\n        var model = shops.map(function (s) { return ({\r\n            id: s.id,\r\n            isBase: s.isBase,\r\n            title: s.title,\r\n            delivery: s.delivery\r\n        }); });\r\n        response.json(model).end();\r\n    })\r\n        .catch(function (err) { return response.send(500, err).end(); });\r\n});\r\nrouter.post(\"/\", function (request, response) {\r\n    var webShop = request.body;\r\n    if (!webShop.id) {\r\n        response.send(400, \"Bad request. Web shop identifier is missing\").end();\r\n    }\r\n    else {\r\n        webShopService.save(webShop)\r\n            .then(function (result) {\r\n            if (result[\"isValid\"] === false) {\r\n                var validationResult = result;\r\n                var failResponse = {\r\n                    ok: false,\r\n                    errors: validationResult.errors\r\n                };\r\n                response.json(failResponse).end();\r\n            }\r\n            else {\r\n                var updatedWebShop = result;\r\n                var okResponse = {\r\n                    ok: true,\r\n                    entity: updatedWebShop\r\n                };\r\n                response.json(okResponse).end();\r\n            }\r\n        });\r\n    }\r\n});\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = router;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLXNob3Atcm91dGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3ZWItc2hvcC1yb3V0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpREFBaUQ7O0FBRWpELElBQVksT0FBTyxXQUFNLFNBQVMsQ0FBQyxDQUFBO0FBRW5DLG1CQUFlLHNCQUFzQixDQUFDLENBQUE7QUFFdEMsdUNBQWdDLGdEQUFnRCxDQUFDLENBQUE7QUFDakYsaUNBQTJCLDBDQUEwQyxDQUFDLENBQUE7QUFFdEUsSUFBTSxFQUFFLEdBQUcsSUFBSSxZQUFFLEVBQUUsQ0FBQztBQUVwQixJQUFNLGNBQWMsR0FBRyxJQUFJLDBCQUFjLENBQUMsSUFBSSxnQ0FBbUIsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBRXZFLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUVoQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxVQUFDLE9BQU8sRUFBRSxRQUFRO0lBQzlCLGNBQWMsQ0FBQyxHQUFHLEVBQUU7U0FDZixJQUFJLENBQUMsVUFBQSxLQUFLO1FBQ1AsSUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUM7WUFDMUIsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFO1lBQ1IsTUFBTSxFQUFFLENBQUMsQ0FBQyxNQUFNO1lBQ2hCLEtBQUssRUFBRSxDQUFDLENBQUMsS0FBSztZQUNkLFFBQVEsRUFBRSxDQUFDLENBQUMsUUFBUTtTQUN2QixDQUFDLEVBTDJCLENBSzNCLENBQUMsQ0FBQztRQUNKLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDL0IsQ0FBQyxDQUFDO1NBQ0QsS0FBSyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQTdCLENBQTZCLENBQUMsQ0FBQztBQUNyRCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFVBQUMsT0FBTyxFQUFFLFFBQVE7SUFDL0IsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztJQUU3QixFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2QsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsNkNBQTZDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUM1RSxDQUFDO0lBQ0QsSUFBSSxDQUFDLENBQUM7UUFDRixjQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUN2QixJQUFJLENBQUMsVUFBQSxNQUFNO1lBQ1IsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLElBQU0sZ0JBQWdCLEdBQXlCLE1BQU0sQ0FBQztnQkFFdEQsSUFBTSxZQUFZLEdBQXNCO29CQUNwQyxFQUFFLEVBQUUsS0FBSztvQkFDVCxNQUFNLEVBQUUsZ0JBQWdCLENBQUMsTUFBTTtpQkFDbEMsQ0FBQztnQkFFRixRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ3RDLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDRixJQUFNLGNBQWMsR0FBZ0IsTUFBTSxDQUFDO2dCQUMzQyxJQUFNLFVBQVUsR0FBc0M7b0JBQ2xELEVBQUUsRUFBRSxJQUFJO29CQUNSLE1BQU0sRUFBRSxjQUFjO2lCQUN6QixDQUFDO2dCQUVGLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDcEMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUg7a0JBQWUsTUFBTSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XHJcblxyXG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XHJcblxyXG5pbXBvcnQgRGIgZnJvbSBcIi4uLy4uL2RhdGEtYWNjZXNzL2RiXCI7XHJcblxyXG5pbXBvcnQgTW9uZ29XZWJTaG9wU3RvcmFnZSBmcm9tIFwiLi4vLi4vc2VydmljZXMvd2ViLXNob3AvbW9uZ28td2ViLXNob3Atc3RvcmFnZVwiO1xyXG5pbXBvcnQgV2ViU2hvcFNlcnZpY2UgZnJvbSBcIi4uLy4uL3NlcnZpY2VzL3dlYi1zaG9wL3dlYi1zaG9wLXNlcnZpY2VcIjtcclxuXHJcbmNvbnN0IGRiID0gbmV3IERiKCk7XHJcblxyXG5jb25zdCB3ZWJTaG9wU2VydmljZSA9IG5ldyBXZWJTaG9wU2VydmljZShuZXcgTW9uZ29XZWJTaG9wU3RvcmFnZShkYikpO1xyXG5cclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuXHJcbnJvdXRlci5nZXQoXCIvXCIsIChyZXF1ZXN0LCByZXNwb25zZSkgPT4ge1xyXG4gICAgd2ViU2hvcFNlcnZpY2UuYWxsKClcclxuICAgICAgICAudGhlbihzaG9wcyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vZGVsID0gc2hvcHMubWFwKHMgPT4gKHtcclxuICAgICAgICAgICAgICAgIGlkOiBzLmlkLFxyXG4gICAgICAgICAgICAgICAgaXNCYXNlOiBzLmlzQmFzZSxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiBzLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgZGVsaXZlcnk6IHMuZGVsaXZlcnlcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICByZXNwb25zZS5qc29uKG1vZGVsKS5lbmQoKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChlcnIgPT4gcmVzcG9uc2Uuc2VuZCg1MDAsIGVycikuZW5kKCkpO1xyXG59KTtcclxuXHJcbnJvdXRlci5wb3N0KFwiL1wiLCAocmVxdWVzdCwgcmVzcG9uc2UpID0+IHtcclxuICAgIGNvbnN0IHdlYlNob3AgPSByZXF1ZXN0LmJvZHk7XHJcblxyXG4gICAgaWYgKCF3ZWJTaG9wLmlkKSB7XHJcbiAgICAgICAgcmVzcG9uc2Uuc2VuZCg0MDAsIFwiQmFkIHJlcXVlc3QuIFdlYiBzaG9wIGlkZW50aWZpZXIgaXMgbWlzc2luZ1wiKS5lbmQoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHdlYlNob3BTZXJ2aWNlLnNhdmUod2ViU2hvcClcclxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHRbXCJpc1ZhbGlkXCJdID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSA8QXBpLlZhbGlkYXRpb25SZXN1bHQ+cmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmYWlsUmVzcG9uc2U6IEFwaS5JRmFpbFJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvazogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogdmFsaWRhdGlvblJlc3VsdC5lcnJvcnNcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5qc29uKGZhaWxSZXNwb25zZSkuZW5kKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkV2ViU2hvcCA9IDxBcGkuV2ViU2hvcD5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2tSZXNwb25zZTogQXBpLklTdWNjZXNzUmVzcG9uc2U8QXBpLldlYlNob3A+ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvazogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5OiB1cGRhdGVkV2ViU2hvcFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmpzb24ob2tSZXNwb25zZSkuZW5kKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjsiXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web/routes/web-shop-route.ts\n ** module id = 16\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar MongoWebShopStorage = (function () {\r\n    function MongoWebShopStorage(db) {\r\n        this.db = db;\r\n        if (!db)\r\n            throw new Error(\"db is undefined\");\r\n    }\r\n    MongoWebShopStorage.prototype.all = function () {\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.find({}, { _id: 0 }); })\r\n            .then(function (c) { return c.toArray(); });\r\n    };\r\n    MongoWebShopStorage.prototype.one = function (id) {\r\n        if (!id)\r\n            throw new Error(\"id is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.find({ id: id }, { _id: 0 }); })\r\n            .then(function (r) { return r.limit(1); })\r\n            .then(function (c) { return c.next(); });\r\n    };\r\n    MongoWebShopStorage.prototype.save = function (webShop) {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.updateOne({ id: webShop.id }, {\r\n            $set: {\r\n                title: webShop.title,\r\n                delivery: webShop.delivery\r\n            }\r\n        }); })\r\n            .then(function () { return webShop; });\r\n    };\r\n    return MongoWebShopStorage;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = MongoWebShopStorage;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uZ28td2ViLXNob3Atc3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1vbmdvLXdlYi1zaG9wLXN0b3JhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsaURBQWlEOztBQUVqRCxtQkFBcUIsc0JBQXNCLENBQUMsQ0FBQTtBQUU1QztJQUNJLDZCQUFvQixFQUFZO1FBQVosT0FBRSxHQUFGLEVBQUUsQ0FBVTtRQUM1QixFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNKLE1BQU0sSUFBSSxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQsaUNBQUcsR0FBSDtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTthQUNULFVBQVUsQ0FBQyxZQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQzthQUN6QyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUF0QixDQUFzQixDQUFDO2FBQ2pDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBWCxDQUFXLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQsaUNBQUcsR0FBSCxVQUFJLEVBQVU7UUFDVixFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNKLE1BQU0sSUFBSSxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUV2QyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7YUFDVCxVQUFVLENBQUMsWUFBUSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUM7YUFDekMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUE5QixDQUE4QixDQUFDO2FBQ3pDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQVYsQ0FBVSxDQUFDO2FBQ3JCLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBUixDQUFRLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRUQsa0NBQUksR0FBSixVQUFLLE9BQW9CO1FBQ3JCLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBRTVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTthQUNULFVBQVUsQ0FBQyxZQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQzthQUN6QyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFLE9BQU8sQ0FBQyxFQUFFLEVBQUUsRUFBRTtZQUN2QyxJQUFJLEVBQUU7Z0JBQ0YsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLO2dCQUNwQixRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVE7YUFDN0I7U0FDSixDQUFDLEVBTFMsQ0FLVCxDQUFDO2FBQ0YsSUFBSSxDQUFDLGNBQU0sT0FBQSxPQUFPLEVBQVAsQ0FBTyxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNMLDBCQUFDO0FBQUQsQ0FBQyxBQXRDRCxJQXNDQztBQXRDRDtxQ0FzQ0MsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxyXG5cclxuaW1wb3J0IERhdGFiYXNlIGZyb20gXCIuLi8uLi9kYXRhLWFjY2Vzcy9kYlwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9uZ29XZWJTaG9wU3RvcmFnZSBpbXBsZW1lbnRzIFdlYlNob3BzLklXZWJTaG9wU3RvcmFnZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRiOiBEYXRhYmFzZSkge1xyXG4gICAgICAgIGlmICghZGIpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImRiIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBhbGwoKTogUHJvbWlzZTxBcGkuV2ViU2hvcFtdPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGJcclxuICAgICAgICAgICAgLmNvbGxlY3Rpb24oRGF0YWJhc2UuQ29sbGVjdGlvbnMud2Vic2hvcHMpXHJcbiAgICAgICAgICAgIC50aGVuKGMgPT4gYy5maW5kKHt9LCB7IF9pZDogMCB9KSlcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLnRvQXJyYXkoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25lKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFwaS5XZWJTaG9wPiB7XHJcbiAgICAgICAgaWYgKCFpZClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaWQgaXMgdW5kZWZpbmVkXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5kYlxyXG4gICAgICAgICAgICAuY29sbGVjdGlvbihEYXRhYmFzZS5Db2xsZWN0aW9ucy53ZWJzaG9wcylcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLmZpbmQoeyBpZDogaWQgfSwgeyBfaWQ6IDAgfSkpXHJcbiAgICAgICAgICAgIC50aGVuKHIgPT4gci5saW1pdCgxKSlcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLm5leHQoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZSh3ZWJTaG9wOiBBcGkuV2ViU2hvcCk6IFByb21pc2U8QXBpLldlYlNob3A+IHtcclxuICAgICAgICBpZiAoIXdlYlNob3ApXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIndlYlNob3AgaXMgdW5kZWZpbmVkXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5kYlxyXG4gICAgICAgICAgICAuY29sbGVjdGlvbihEYXRhYmFzZS5Db2xsZWN0aW9ucy53ZWJzaG9wcylcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLnVwZGF0ZU9uZSh7IGlkOiB3ZWJTaG9wLmlkIH0sIHtcclxuICAgICAgICAgICAgICAgICRzZXQ6IHtcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogd2ViU2hvcC50aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeTogd2ViU2hvcC5kZWxpdmVyeVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gd2ViU2hvcCk7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/web-shop/mongo-web-shop-storage.ts\n ** module id = 17\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar web_shop_validator_1 = require(\"./web-shop-validator\");\r\nvar WebShopService = (function () {\r\n    function WebShopService(storage) {\r\n        this.storage = storage;\r\n        this.validator = new web_shop_validator_1.default();\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n    WebShopService.prototype.all = function () {\r\n        return this.storage.all();\r\n    };\r\n    WebShopService.prototype.one = function (webShopId) {\r\n        if (!webShopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        return this.storage.one(webShopId);\r\n    };\r\n    WebShopService.prototype.save = function (webShop) {\r\n        var _this = this;\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return new Promise(function (resolve) {\r\n            _this.validator\r\n                .validate(webShop)\r\n                .then(function (validationResult) {\r\n                if (!validationResult.isValid)\r\n                    resolve(validationResult);\r\n                else\r\n                    _this.storage\r\n                        .save(webShop)\r\n                        .then(function () { return _this.one(webShop.id); })\r\n                        .then(function (entity) { return resolve(entity); });\r\n            });\r\n        });\r\n    };\r\n    return WebShopService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = WebShopService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLXNob3Atc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIndlYi1zaG9wLXNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsaURBQWlEOztBQUVqRCxtQ0FBNkIsc0JBQXNCLENBQUMsQ0FBQTtBQUVwRDtJQUlJLHdCQUFvQixPQUFpQztRQUFqQyxZQUFPLEdBQVAsT0FBTyxDQUEwQjtRQUY3QyxjQUFTLEdBQUcsSUFBSSw0QkFBZ0IsRUFBRSxDQUFDO1FBR3ZDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCw0QkFBRyxHQUFIO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDOUIsQ0FBQztJQUVELDRCQUFHLEdBQUgsVUFBSSxTQUFpQjtRQUNqQixFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUU5QyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVELDZCQUFJLEdBQUosVUFBSyxPQUFvQjtRQUF6QixpQkFpQkM7UUFoQkcsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDVCxNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFFNUMsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFDLFVBQUEsT0FBTztZQUN0QixLQUFJLENBQUMsU0FBUztpQkFDVCxRQUFRLENBQUMsT0FBTyxDQUFDO2lCQUNqQixJQUFJLENBQUMsVUFBQSxnQkFBZ0I7Z0JBQ2xCLEVBQUUsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDO29CQUMxQixPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFDOUIsSUFBSTtvQkFDQSxLQUFJLENBQUMsT0FBTzt5QkFDUCxJQUFJLENBQUMsT0FBTyxDQUFDO3lCQUNiLElBQUksQ0FBQyxjQUFNLE9BQUEsS0FBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQXBCLENBQW9CLENBQUM7eUJBQ2hDLElBQUksQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBZixDQUFlLENBQUMsQ0FBQztZQUM3QyxDQUFDLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNMLHFCQUFDO0FBQUQsQ0FBQyxBQXRDRCxJQXNDQztBQXRDRDtnQ0FzQ0MsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxyXG5cclxuaW1wb3J0IFdlYlNob3BWYWxpZGF0b3IgZnJvbSBcIi4vd2ViLXNob3AtdmFsaWRhdG9yXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXZWJTaG9wU2VydmljZSB7XHJcblxyXG4gICAgcHJpdmF0ZSB2YWxpZGF0b3IgPSBuZXcgV2ViU2hvcFZhbGlkYXRvcigpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc3RvcmFnZTogV2ViU2hvcHMuSVdlYlNob3BTdG9yYWdlKSB7XHJcbiAgICAgICAgaWYgKCFzdG9yYWdlKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzdG9yYWdlIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBhbGwoKTogUHJvbWlzZTxBcGkuV2ViU2hvcFtdPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5hbGwoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbmUod2ViU2hvcElkOiBzdHJpbmcpOiBQcm9taXNlPEFwaS5XZWJTaG9wPiB7XHJcbiAgICAgICAgaWYgKCF3ZWJTaG9wSWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIndlYlNob3BJZCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2Uub25lKHdlYlNob3BJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZSh3ZWJTaG9wOiBBcGkuV2ViU2hvcCk6IFByb21pc2U8QXBpLldlYlNob3AgfCBBcGkuVmFsaWRhdGlvblJlc3VsdD4ge1xyXG4gICAgICAgIGlmICghd2ViU2hvcClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwid2ViU2hvcCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgdGhpcy52YWxpZGF0b3JcclxuICAgICAgICAgICAgICAgIC52YWxpZGF0ZSh3ZWJTaG9wKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4odmFsaWRhdGlvblJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodmFsaWRhdGlvblJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3JhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zYXZlKHdlYlNob3ApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLm9uZSh3ZWJTaG9wLmlkKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGVudGl0eSA9PiByZXNvbHZlKGVudGl0eSkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/web-shop/web-shop-service.ts\n ** module id = 18\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar validator = require(\"node-validator\");\r\nvar WebShopValidator = (function () {\r\n    function WebShopValidator() {\r\n        this.deliveryMethodValidator = validator.isAnyObject()\r\n            .withRequired(\"deliveryMethod\", validator.isString())\r\n            .withRequired(\"price\", validator.isNumber({ min: 0 }));\r\n        this.webShopValidator = validator.isAnyObject()\r\n            .withRequired(\"title\", validator.isString());\r\n    }\r\n    WebShopValidator.prototype.validate = function (webShop) {\r\n        var _this = this;\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return new Promise(function (resolve) {\r\n            validator.run(_this.webShopValidator, webShop, function (errorCount, errors) {\r\n                resolve({\r\n                    isValid: errorCount === 0,\r\n                    errorCount: errorCount,\r\n                    errors: errors\r\n                });\r\n            });\r\n        });\r\n    };\r\n    return WebShopValidator;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = WebShopValidator;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLXNob3AtdmFsaWRhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsid2ViLXNob3AtdmFsaWRhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDs7QUFFakQsSUFBWSxTQUFTLFdBQU0sZ0JBQWdCLENBQUMsQ0FBQTtBQUU1QztJQUlJO1FBQ0ksSUFBSSxDQUFDLHVCQUF1QixHQUFHLFNBQVMsQ0FBQyxXQUFXLEVBQUU7YUFDakQsWUFBWSxDQUFDLGdCQUFnQixFQUFFLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQzthQUNwRCxZQUFZLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRzNELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxTQUFTLENBQUMsV0FBVyxFQUFFO2FBQzFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVELG1DQUFRLEdBQVIsVUFBUyxPQUFvQjtRQUE3QixpQkFlQztRQWRHLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBRTVDLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxVQUFBLE9BQU87WUFDdEIsU0FBUyxDQUFDLEdBQUcsQ0FBQyxLQUFJLENBQUMsZ0JBQWdCLEVBQy9CLE9BQU8sRUFDUCxVQUFDLFVBQVUsRUFBRSxNQUFNO2dCQUNmLE9BQU8sQ0FBQztvQkFDSixPQUFPLEVBQUUsVUFBVSxLQUFLLENBQUM7b0JBQ3pCLFVBQVUsRUFBRSxVQUFVO29CQUN0QixNQUFNLEVBQUUsTUFBTTtpQkFDakIsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDTCx1QkFBQztBQUFELENBQUMsQUE5QkQsSUE4QkM7QUE5QkQ7a0NBOEJDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCAqIGFzIHZhbGlkYXRvciBmcm9tIFwibm9kZS12YWxpZGF0b3JcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdlYlNob3BWYWxpZGF0b3Ige1xyXG4gICAgcHJpdmF0ZSB3ZWJTaG9wVmFsaWRhdG9yOiB2YWxpZGF0b3IuVmFsaWRhdGFibGU7XHJcbiAgICBwcml2YXRlIGRlbGl2ZXJ5TWV0aG9kVmFsaWRhdG9yOiB2YWxpZGF0b3IuVmFsaWRhdGFibGU7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5kZWxpdmVyeU1ldGhvZFZhbGlkYXRvciA9IHZhbGlkYXRvci5pc0FueU9iamVjdCgpXHJcbiAgICAgICAgICAgIC53aXRoUmVxdWlyZWQoXCJkZWxpdmVyeU1ldGhvZFwiLCB2YWxpZGF0b3IuaXNTdHJpbmcoKSlcclxuICAgICAgICAgICAgLndpdGhSZXF1aXJlZChcInByaWNlXCIsIHZhbGlkYXRvci5pc051bWJlcih7IG1pbjogMCB9KSk7XHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMud2ViU2hvcFZhbGlkYXRvciA9IHZhbGlkYXRvci5pc0FueU9iamVjdCgpXHJcbiAgICAgICAgICAgIC53aXRoUmVxdWlyZWQoXCJ0aXRsZVwiLCB2YWxpZGF0b3IuaXNTdHJpbmcoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGUod2ViU2hvcDogQXBpLldlYlNob3ApOiBQcm9taXNlPEFwaS5WYWxpZGF0aW9uUmVzdWx0PiB7XHJcbiAgICAgICAgaWYgKCF3ZWJTaG9wKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ3ZWJTaG9wIGlzIHVuZGVmaW5lZFwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICAgICAgICB2YWxpZGF0b3IucnVuKHRoaXMud2ViU2hvcFZhbGlkYXRvcixcclxuICAgICAgICAgICAgICAgIHdlYlNob3AsXHJcbiAgICAgICAgICAgICAgICAoZXJyb3JDb3VudCwgZXJyb3JzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzVmFsaWQ6IGVycm9yQ291bnQgPT09IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yQ291bnQ6IGVycm9yQ291bnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogZXJyb3JzXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/web-shop/web-shop-validator.ts\n ** module id = 19\n ** module chunks = 0\n **/","/// <reference path=\"typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar config_1 = require(\"./config\");\r\nvar db_1 = require(\"./data-access/db\");\r\nvar mongo_web_shop_storage_1 = require(\"./services/web-shop/mongo-web-shop-storage\");\r\nvar web_shop_service_1 = require(\"./services/web-shop/web-shop-service\");\r\nvar mongo_product_storage_1 = require(\"./services/products/mongo-product-storage\");\r\nvar product_service_1 = require(\"./services/products/product-service\");\r\nvar scrape_service_1 = require(\"./services/scrape-service\");\r\nvar scrape_queue_service_1 = require(\"./services/scrape-queue-service\");\r\nvar scrape_scheduler_service_1 = require(\"./services/scrape-scheduler-service\");\r\nvar db = new db_1.default();\r\nvar productService = new product_service_1.default(new mongo_product_storage_1.default(db));\r\nvar webShopService = new web_shop_service_1.default(new mongo_web_shop_storage_1.default(db));\r\nvar scrapeService = new scrape_service_1.default(productService, webShopService);\r\nvar queue = new scrape_queue_service_1.default(scrapeService, config_1.default.scrapingThreads, config_1.default.delayBetweenShopScrapingMs);\r\nvar scheduler = new scrape_scheduler_service_1.default(queue, productService, config_1.default.schedules);\r\nfunction run() {\r\n    if (scheduler.run())\r\n        console.info(\"Scrape server running\");\r\n    else\r\n        console.error(\"Error running scrape server\");\r\n}\r\nexports.run = run;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyYXBlLXNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNjcmFwZS1zZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMENBQTBDOztBQUUxQyx1QkFBMEIsVUFBVSxDQUFDLENBQUE7QUFFckMsbUJBQXFCLGtCQUFrQixDQUFDLENBQUE7QUFFeEMsdUNBQWdDLDRDQUE0QyxDQUFDLENBQUE7QUFDN0UsaUNBQTJCLHNDQUFzQyxDQUFDLENBQUE7QUFFbEUsc0NBQWdDLDJDQUEyQyxDQUFDLENBQUE7QUFDNUUsZ0NBQTJCLHFDQUFxQyxDQUFDLENBQUE7QUFFakUsK0JBQTBCLDJCQUEyQixDQUFDLENBQUE7QUFDdEQscUNBQStCLGlDQUFpQyxDQUFDLENBQUE7QUFDakUseUNBQW1DLHFDQUFxQyxDQUFDLENBQUE7QUFFekUsSUFBTSxFQUFFLEdBQUcsSUFBSSxZQUFRLEVBQUUsQ0FBQztBQUcxQixJQUFNLGNBQWMsR0FBRyxJQUFJLHlCQUFjLENBQUMsSUFBSSwrQkFBbUIsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ3ZFLElBQU0sY0FBYyxHQUFHLElBQUksMEJBQWMsQ0FBQyxJQUFJLGdDQUFtQixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFFdkUsSUFBTSxhQUFhLEdBQUcsSUFBSSx3QkFBYSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsQ0FBQztBQUV4RSxJQUFNLEtBQUssR0FBRyxJQUFJLDhCQUFrQixDQUFDLGFBQWEsRUFBRSxnQkFBYSxDQUFDLGVBQWUsRUFBRSxnQkFBYSxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFDN0gsSUFBTSxTQUFTLEdBQUcsSUFBSSxrQ0FBc0IsQ0FBQyxLQUFLLEVBQUUsY0FBYyxFQUFFLGdCQUFhLENBQUMsU0FBUyxDQUFDLENBQUM7QUFFN0Y7SUFDSSxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDaEIsT0FBTyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0lBQzFDLElBQUk7UUFDQSxPQUFPLENBQUMsS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7QUFDckQsQ0FBQztBQUxlLFdBQUcsTUFLbEIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJ0eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcblxyXG5pbXBvcnQgY29uZmlndXJhdGlvbiBmcm9tIFwiLi9jb25maWdcIjtcclxuXHJcbmltcG9ydCBEYXRhYmFzZSBmcm9tIFwiLi9kYXRhLWFjY2Vzcy9kYlwiO1xyXG5cclxuaW1wb3J0IE1vbmdvV2ViU2hvcFNlcnZpY2UgZnJvbSBcIi4vc2VydmljZXMvd2ViLXNob3AvbW9uZ28td2ViLXNob3Atc3RvcmFnZVwiO1xyXG5pbXBvcnQgV2ViU2hvcFNlcnZpY2UgZnJvbSBcIi4vc2VydmljZXMvd2ViLXNob3Avd2ViLXNob3Atc2VydmljZVwiO1xyXG5cclxuaW1wb3J0IE1vbmdvUHJvZHVjdFN0b3JhZ2UgZnJvbSBcIi4vc2VydmljZXMvcHJvZHVjdHMvbW9uZ28tcHJvZHVjdC1zdG9yYWdlXCI7XHJcbmltcG9ydCBQcm9kdWN0U2VydmljZSBmcm9tIFwiLi9zZXJ2aWNlcy9wcm9kdWN0cy9wcm9kdWN0LXNlcnZpY2VcIjtcclxuXHJcbmltcG9ydCBTY3JhcGVTZXJ2aWNlIGZyb20gXCIuL3NlcnZpY2VzL3NjcmFwZS1zZXJ2aWNlXCI7XHJcbmltcG9ydCBTY3JhcGVRdWV1ZVNlcnZpY2UgZnJvbSBcIi4vc2VydmljZXMvc2NyYXBlLXF1ZXVlLXNlcnZpY2VcIjtcclxuaW1wb3J0IFNjcmFwZVNjaGVkdWxlclNlcnZpY2UgZnJvbSBcIi4vc2VydmljZXMvc2NyYXBlLXNjaGVkdWxlci1zZXJ2aWNlXCI7XHJcblxyXG5jb25zdCBkYiA9IG5ldyBEYXRhYmFzZSgpO1xyXG5cclxuXHJcbmNvbnN0IHByb2R1Y3RTZXJ2aWNlID0gbmV3IFByb2R1Y3RTZXJ2aWNlKG5ldyBNb25nb1Byb2R1Y3RTdG9yYWdlKGRiKSk7XHJcbmNvbnN0IHdlYlNob3BTZXJ2aWNlID0gbmV3IFdlYlNob3BTZXJ2aWNlKG5ldyBNb25nb1dlYlNob3BTZXJ2aWNlKGRiKSk7XHJcblxyXG5jb25zdCBzY3JhcGVTZXJ2aWNlID0gbmV3IFNjcmFwZVNlcnZpY2UocHJvZHVjdFNlcnZpY2UsIHdlYlNob3BTZXJ2aWNlKTtcclxuXHJcbmNvbnN0IHF1ZXVlID0gbmV3IFNjcmFwZVF1ZXVlU2VydmljZShzY3JhcGVTZXJ2aWNlLCBjb25maWd1cmF0aW9uLnNjcmFwaW5nVGhyZWFkcywgY29uZmlndXJhdGlvbi5kZWxheUJldHdlZW5TaG9wU2NyYXBpbmdNcyk7XHJcbmNvbnN0IHNjaGVkdWxlciA9IG5ldyBTY3JhcGVTY2hlZHVsZXJTZXJ2aWNlKHF1ZXVlLCBwcm9kdWN0U2VydmljZSwgY29uZmlndXJhdGlvbi5zY2hlZHVsZXMpO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJ1bigpIHtcclxuICAgIGlmIChzY2hlZHVsZXIucnVuKCkpXHJcbiAgICAgICAgY29uc29sZS5pbmZvKFwiU2NyYXBlIHNlcnZlciBydW5uaW5nXCIpO1xyXG4gICAgZWxzZVxyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBydW5uaW5nIHNjcmFwZSBzZXJ2ZXJcIik7XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/scrape-server.ts\n ** module id = 20\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar jsdom_scraper_1 = require(\"../scrapers/jsdom-scraper\");\r\nvar ScrapeService = (function () {\r\n    function ScrapeService(productService, webShopService) {\r\n        this.productService = productService;\r\n        this.webShopService = webShopService;\r\n        this.scraper = new jsdom_scraper_1.default();\r\n        if (!productService)\r\n            throw new Error(\"productService is undefined\");\r\n        if (!webShopService)\r\n            throw new Error(\"webShopService is undefined\");\r\n        this.webShops = this.webShopService\r\n            .all()\r\n            .then(function (shops) { return shops.toHash(function (s) { return s.id; }); });\r\n    }\r\n    ScrapeService.prototype.scrapeProductData = function (productId) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return this.webShops.then(function (shops) {\r\n            return _this.productService.one(productId)\r\n                .then(function (product) { return Promise.all(_this.scrapeProduct(product, shops))\r\n                .then(function (results) { return results.toHash(function (e) { return e.webShopId; }, function (e) { return e.scrapingResult; }); }); });\r\n        });\r\n    };\r\n    ScrapeService.prototype.scrapeProduct = function (product, shops) {\r\n        var _this = this;\r\n        return Object.keys(product.scrapingUrls)\r\n            .map(function (webShopId) { return _this.scrapeProductFromShopAndSave(product, webShopId, shops)\r\n            .then(function (productScrapeResult) { return ({\r\n            webShopId: webShopId,\r\n            scrapingResult: productScrapeResult\r\n        }); }); });\r\n    };\r\n    ScrapeService.prototype.scrapeProductFromShopAndSave = function (product, webShopId, shops) {\r\n        var _this = this;\r\n        return this.scraper\r\n            .scrape(product.scrapingUrls[webShopId], shops[webShopId].scrapingSettings)\r\n            .then(function (result) { return _this.productService\r\n            .updateScrapedData(product.id, webShopId, result)\r\n            .then(function () { return result; }); });\r\n    };\r\n    return ScrapeService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ScrapeService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyYXBlLXNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzY3JhcGUtc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSw4Q0FBOEM7O0FBSzlDLDhCQUF5QiwyQkFBMkIsQ0FBQyxDQUFBO0FBTXJEO0lBSUksdUJBQW9CLGNBQThCLEVBQzlCLGNBQThCO1FBRDlCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFKMUMsWUFBTyxHQUFHLElBQUksdUJBQVksRUFBRSxDQUFDO1FBS2pDLEVBQUUsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDO1lBQ2hCLE1BQU0sSUFBSSxLQUFLLENBQUMsNkJBQTZCLENBQUMsQ0FBQztRQUNuRCxFQUFFLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQztZQUNoQixNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7UUFFbkQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsY0FBYzthQUM5QixHQUFHLEVBQUU7YUFDTCxJQUFJLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEVBQUUsRUFBSixDQUFJLENBQUMsRUFBdkIsQ0FBdUIsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCx5Q0FBaUIsR0FBakIsVUFBa0IsU0FBaUI7UUFBbkMsaUJBU0M7UUFSRyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUU5QyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBQSxLQUFLO1lBQzNCLE1BQU0sQ0FBQyxLQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUM7aUJBQ3BDLElBQUksQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7aUJBQzNELElBQUksQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLE9BQU8sQ0FBQyxNQUFNLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsU0FBUyxFQUFYLENBQVcsRUFBRSxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxjQUFjLEVBQWhCLENBQWdCLENBQUMsRUFBdkQsQ0FBdUQsQ0FBQyxFQUQ1RCxDQUM0RCxDQUFDLENBQUM7UUFDdkYsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRU8scUNBQWEsR0FBckIsVUFBc0IsT0FBb0IsRUFBRSxLQUFrQjtRQUE5RCxpQkFRQztRQU5HLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUM7YUFDbkMsR0FBRyxDQUFDLFVBQUEsU0FBUyxJQUFJLE9BQUEsS0FBSSxDQUFDLDRCQUE0QixDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxDQUFDO2FBQ3pFLElBQUksQ0FBQyxVQUFBLG1CQUFtQixJQUFJLE9BQUEsQ0FBQztZQUMxQixTQUFTLEVBQUUsU0FBUztZQUNwQixjQUFjLEVBQUUsbUJBQW1CO1NBQ3RDLENBQUMsRUFIMkIsQ0FHM0IsQ0FBQyxFQUpXLENBSVgsQ0FBQyxDQUFDO0lBQ2pCLENBQUM7SUFFTyxvREFBNEIsR0FBcEMsVUFBcUMsT0FBb0IsRUFBRSxTQUFpQixFQUFFLEtBQWtCO1FBQWhHLGlCQU1DO1FBTEcsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPO2FBQ2QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDO2FBQzFFLElBQUksQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLEtBQUksQ0FBQyxjQUFjO2FBQzlCLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQzthQUNoRCxJQUFJLENBQUMsY0FBTSxPQUFBLE1BQU0sRUFBTixDQUFNLENBQUMsRUFGUCxDQUVPLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBQ0wsb0JBQUM7QUFBRCxDQUFDLEFBNUNELElBNENDO0FBNUNEOytCQTRDQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XHJcblxyXG5pbXBvcnQgUHJvZHVjdFNlcnZpY2UgZnJvbSBcIi4vcHJvZHVjdHMvcHJvZHVjdC1zZXJ2aWNlXCI7XHJcbmltcG9ydCBXZWJTaG9wU2VydmljZSBmcm9tIFwiLi93ZWItc2hvcC93ZWItc2hvcC1zZXJ2aWNlXCI7XHJcblxyXG5pbXBvcnQgSnNkb21TY3JhcGVyIGZyb20gXCIuLi9zY3JhcGVycy9qc2RvbS1zY3JhcGVyXCI7XHJcblxyXG5pbnRlcmZhY2UgV2ViU2hvcEhhc2gge1xyXG4gICAgW3dlYlNob3BJZDogc3RyaW5nXTogQXBpLldlYlNob3A7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNjcmFwZVNlcnZpY2UgaW1wbGVtZW50cyBTY3JhcGluZy5JU2NyYXBlU2VydmljZSB7XHJcbiAgICBwcml2YXRlIHNjcmFwZXIgPSBuZXcgSnNkb21TY3JhcGVyKCk7XHJcbiAgICBwcml2YXRlIHdlYlNob3BzOiBQcm9taXNlPFdlYlNob3BIYXNoPjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHByb2R1Y3RTZXJ2aWNlOiBQcm9kdWN0U2VydmljZSxcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgd2ViU2hvcFNlcnZpY2U6IFdlYlNob3BTZXJ2aWNlKSB7XHJcbiAgICAgICAgaWYgKCFwcm9kdWN0U2VydmljZSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHJvZHVjdFNlcnZpY2UgaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgICAgIGlmICghd2ViU2hvcFNlcnZpY2UpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIndlYlNob3BTZXJ2aWNlIGlzIHVuZGVmaW5lZFwiKTtcclxuXHJcbiAgICAgICAgdGhpcy53ZWJTaG9wcyA9IHRoaXMud2ViU2hvcFNlcnZpY2VcclxuICAgICAgICAgICAgLmFsbCgpXHJcbiAgICAgICAgICAgIC50aGVuKHNob3BzID0+IHNob3BzLnRvSGFzaChzID0+IHMuaWQpKTtcclxuICAgIH1cclxuXHJcbiAgICBzY3JhcGVQcm9kdWN0RGF0YShwcm9kdWN0SWQ6IHN0cmluZyk6IFByb21pc2U8U2NyYXBpbmcuUHJvZHVjdFNjcmFwZVJlc3VsdD4ge1xyXG4gICAgICAgIGlmICghcHJvZHVjdElkKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJwcm9kdWN0SWQgaXMgdW5kZWZpbmVkXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy53ZWJTaG9wcy50aGVuKHNob3BzID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvZHVjdFNlcnZpY2Uub25lKHByb2R1Y3RJZClcclxuICAgICAgICAgICAgICAgIC50aGVuKHByb2R1Y3QgPT4gUHJvbWlzZS5hbGwodGhpcy5zY3JhcGVQcm9kdWN0KHByb2R1Y3QsIHNob3BzKSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihyZXN1bHRzID0+IHJlc3VsdHMudG9IYXNoKGUgPT4gZS53ZWJTaG9wSWQsIGUgPT4gZS5zY3JhcGluZ1Jlc3VsdCkpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNjcmFwZVByb2R1Y3QocHJvZHVjdDogQXBpLlByb2R1Y3QsIHNob3BzOiBXZWJTaG9wSGFzaCk6IFByb21pc2U8eyB3ZWJTaG9wSWQ6IHN0cmluZzsgc2NyYXBpbmdSZXN1bHQ6IFNjcmFwaW5nLldlYlNob3BTY3JhcGluZ1Jlc3VsdDsgfT5bXSB7XHJcblxyXG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhwcm9kdWN0LnNjcmFwaW5nVXJscylcclxuICAgICAgICAgICAgLm1hcCh3ZWJTaG9wSWQgPT4gdGhpcy5zY3JhcGVQcm9kdWN0RnJvbVNob3BBbmRTYXZlKHByb2R1Y3QsIHdlYlNob3BJZCwgc2hvcHMpXHJcbiAgICAgICAgICAgICAgICAudGhlbihwcm9kdWN0U2NyYXBlUmVzdWx0ID0+ICh7XHJcbiAgICAgICAgICAgICAgICAgICAgd2ViU2hvcElkOiB3ZWJTaG9wSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgc2NyYXBpbmdSZXN1bHQ6IHByb2R1Y3RTY3JhcGVSZXN1bHRcclxuICAgICAgICAgICAgICAgIH0pKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzY3JhcGVQcm9kdWN0RnJvbVNob3BBbmRTYXZlKHByb2R1Y3Q6IEFwaS5Qcm9kdWN0LCB3ZWJTaG9wSWQ6IHN0cmluZywgc2hvcHM6IFdlYlNob3BIYXNoKTogUHJvbWlzZTxTY3JhcGluZy5XZWJTaG9wU2NyYXBpbmdSZXN1bHQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zY3JhcGVyXHJcbiAgICAgICAgICAgIC5zY3JhcGUocHJvZHVjdC5zY3JhcGluZ1VybHNbd2ViU2hvcElkXSwgc2hvcHNbd2ViU2hvcElkXS5zY3JhcGluZ1NldHRpbmdzKVxyXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4gdGhpcy5wcm9kdWN0U2VydmljZVxyXG4gICAgICAgICAgICAgICAgLnVwZGF0ZVNjcmFwZWREYXRhKHByb2R1Y3QuaWQsIHdlYlNob3BJZCwgcmVzdWx0KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gcmVzdWx0KSk7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/scrape-service.ts\n ** module id = 21\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"../typings/index.d.ts\" />\r\nrequire(\"../extensions\");\r\nvar jsdom = require(\"jsdom\");\r\nvar value_parser_1 = require(\"./value-parser\");\r\nvar JsdomScraper = (function () {\r\n    function JsdomScraper() {\r\n        this.valueParser = new value_parser_1.default();\r\n    }\r\n    JsdomScraper.prototype.scrape = function (url, values) {\r\n        var _this = this;\r\n        if (!url)\r\n            throw new Error(\"url is undefined\");\r\n        if (!values)\r\n            throw new Error(\"values is undefined.\");\r\n        if (!Object.keys(values).length)\r\n            throw new Error(\"No values to extract\");\r\n        var result = {\r\n            isSuccessful: false,\r\n            error: null,\r\n            values: {}\r\n        };\r\n        // \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\"\r\n        return new Promise(function (resolve) {\r\n            jsdom.env({\r\n                url: url,\r\n                userAgent: \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\",\r\n                features: {\r\n                    FetchExternalResources: false,\r\n                    ProcessExternalResources: false\r\n                },\r\n                done: function (err, window) {\r\n                    if (err && err.length) {\r\n                        result.isSuccessful = false;\r\n                        result.error = err;\r\n                        resolve(result);\r\n                        return;\r\n                    }\r\n                    else {\r\n                        Object.keys(values)\r\n                            .forEach(function (valueName) {\r\n                            var settings = values[valueName];\r\n                            result.values[valueName] = _this.scrapeValue(window.document, settings);\r\n                        });\r\n                        result.isSuccessful = Object.keys(result.values)\r\n                            .map(function (valueName) { return result.values[valueName]; })\r\n                            .every(function (v) { return v.isSuccessful; });\r\n                        resolve(result);\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    };\r\n    JsdomScraper.prototype.scrapeValue = function (document, valueScrapingSettings) {\r\n        if (!document)\r\n            throw new Error(\"document is undefined\");\r\n        if (!valueScrapingSettings)\r\n            throw new Error(\"valueScrapingSettings is undefined\");\r\n        var result = this.emptyValueScrapingResult();\r\n        for (var _i = 0, valueScrapingSettings_1 = valueScrapingSettings; _i < valueScrapingSettings_1.length; _i++) {\r\n            var scrapingSetting = valueScrapingSettings_1[_i];\r\n            try {\r\n                var rawValue = this.extractRawValueFromDocument(document, scrapingSetting);\r\n                var parsedValue = this.valueParser[scrapingSetting.type](rawValue);\r\n                result.isSuccessful = true;\r\n                result.error = null;\r\n                result.settings = scrapingSetting;\r\n                result.value = parsedValue;\r\n                return result;\r\n            }\r\n            catch (error) {\r\n                result.isSuccessful = false;\r\n                result.error = error;\r\n                result.settings = scrapingSetting;\r\n                if (scrapingSetting.failOnError)\r\n                    return result;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    JsdomScraper.prototype.extractRawValueFromDocument = function (document, valueScrapingSetting) {\r\n        var extractMethod = valueScrapingSetting.extract || \"queryselector\";\r\n        switch (extractMethod) {\r\n            case \"queryselector\":\r\n                {\r\n                    var querySelectorSettings = valueScrapingSetting;\r\n                    if (!querySelectorSettings.elementSelector)\r\n                        throw new Error(\"elementSelector is missing\");\r\n                    var elements = document.querySelectorAll(querySelectorSettings.elementSelector);\r\n                    if (elements.length === 0)\r\n                        throw new Error(\"Element with selector \" + querySelectorSettings.elementSelector + \" is missing\");\r\n                    if (elements.length > 1)\r\n                        throw new Error(\"There are more than one element with selector \" + querySelectorSettings.elementSelector);\r\n                    if (querySelectorSettings.attribute)\r\n                        return elements[0].getAttribute(querySelectorSettings.attribute);\r\n                    else\r\n                        return elements[0].textContent;\r\n                }\r\n                ;\r\n            case \"regex\":\r\n                {\r\n                    var regexSettings = valueScrapingSetting;\r\n                    if (!regexSettings.regex)\r\n                        throw new Error(\"regex missing\");\r\n                    var text = document.querySelector(\"html\").innerHTML;\r\n                    var regex = new RegExp(regexSettings.regex, \"gmi\");\r\n                    var matches = regex.exec(text);\r\n                    if (!matches.length)\r\n                        throw new Error(\"No value matches\");\r\n                    return matches[1];\r\n                }\r\n                ;\r\n            default:\r\n                throw new Error(\"Unknown extract method\");\r\n        }\r\n    };\r\n    JsdomScraper.prototype.emptyValueScrapingResult = function () {\r\n        return {\r\n            value: null,\r\n            isSuccessful: true,\r\n            error: null,\r\n            settings: null\r\n        };\r\n    };\r\n    return JsdomScraper;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = JsdomScraper;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianNkb20tc2NyYXBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImpzZG9tLXNjcmFwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDhDQUE4QztBQUM5QyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFFekIsSUFBWSxLQUFLLFdBQU0sT0FBTyxDQUFDLENBQUE7QUFDL0IsNkJBQTRCLGdCQUFnQixDQUFDLENBQUE7QUFFN0M7SUFBQTtRQUNZLGdCQUFXLEdBQUcsSUFBSSxzQkFBZSxFQUFFLENBQUM7SUFxSWhELENBQUM7SUFuSUcsNkJBQU0sR0FBTixVQUFPLEdBQVcsRUFBRSxNQUE0QjtRQUFoRCxpQkE4Q0M7UUE3Q0csRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDTCxNQUFNLElBQUksS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDeEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDUixNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDNUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUM1QixNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFFNUMsSUFBTSxNQUFNLEdBQW1DO1lBQzNDLFlBQVksRUFBRSxLQUFLO1lBQ25CLEtBQUssRUFBRSxJQUFJO1lBQ1gsTUFBTSxFQUFFLEVBQUU7U0FDYixDQUFDO1FBQ0YsbUhBQW1IO1FBQ25ILE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxVQUFBLE9BQU87WUFDdEIsS0FBSyxDQUFDLEdBQUcsQ0FBQztnQkFDTixHQUFHLEVBQUUsR0FBRztnQkFDUixTQUFTLEVBQUUsZ0hBQWdIO2dCQUMzSCxRQUFRLEVBQUU7b0JBQ04sc0JBQXNCLEVBQUUsS0FBSztvQkFDN0Isd0JBQXdCLEVBQUUsS0FBSztpQkFDbEM7Z0JBQ0QsSUFBSSxF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LENBQUM7b0JBRXJDLElBQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDO29CQUV0RCxJQUFNLEtBQUssR0FBRyxJQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO29CQUVyRCxJQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUNqQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7d0JBQ2hCLE1BQU0sSUFBSSxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQztvQkFFeEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdEIsQ0FBQztnQkFBQSxDQUFDO1lBQ0Y7Z0JBQ0ksTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBQ2xELENBQUM7SUFDTCxDQUFDO0lBRU8sK0NBQXdCLEdBQWhDO1FBQ0ksTUFBTSxDQUFDO1lBQ0gsS0FBSyxFQUFFLElBQUk7WUFDWCxZQUFZLEVBQUUsSUFBSTtZQUNsQixLQUFLLEVBQUUsSUFBSTtZQUNYLFFBQVEsRUFBRSxJQUFJO1NBQ2pCLENBQUM7SUFDTixDQUFDO0lBQ0wsbUJBQUM7QUFBRCxDQUFDLEFBdElELElBc0lDO0FBdElEOzhCQXNJQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XHJcbnJlcXVpcmUoXCIuLi9leHRlbnNpb25zXCIpO1xyXG5cclxuaW1wb3J0ICogYXMganNkb20gZnJvbSBcImpzZG9tXCI7XHJcbmltcG9ydCBWYWx1ZVBhcnNlckhhc2ggZnJvbSBcIi4vdmFsdWUtcGFyc2VyXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBKc2RvbVNjcmFwZXIgaW1wbGVtZW50cyBTY3JhcGluZy5JU2NyYXBlciB7XHJcbiAgICBwcml2YXRlIHZhbHVlUGFyc2VyID0gbmV3IFZhbHVlUGFyc2VySGFzaCgpO1xyXG5cclxuICAgIHNjcmFwZSh1cmw6IHN0cmluZywgdmFsdWVzOiBBcGkuU2NyYXBpbmdTZXR0aW5ncyk6IFByb21pc2U8U2NyYXBpbmcuV2ViU2hvcFNjcmFwaW5nUmVzdWx0PiB7XHJcbiAgICAgICAgaWYgKCF1cmwpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInVybCBpcyB1bmRlZmluZWRcIik7XHJcbiAgICAgICAgaWYgKCF2YWx1ZXMpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInZhbHVlcyBpcyB1bmRlZmluZWQuXCIpO1xyXG4gICAgICAgIGlmICghT2JqZWN0LmtleXModmFsdWVzKS5sZW5ndGgpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHZhbHVlcyB0byBleHRyYWN0XCIpO1xyXG5cclxuICAgICAgICBjb25zdCByZXN1bHQ6IFNjcmFwaW5nLldlYlNob3BTY3JhcGluZ1Jlc3VsdCA9IHtcclxuICAgICAgICAgICAgaXNTdWNjZXNzZnVsOiBmYWxzZSxcclxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgIHZhbHVlczoge31cclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIFwiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS81MC4wLjI2NjEuMTAyIFNhZmFyaS81MzcuMzZcIlxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAganNkb20uZW52KHtcclxuICAgICAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICAgICAgdXNlckFnZW50OiBcIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdPVzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvNTAuMC4yNjYxLjEwMiBTYWZhcmkvNTM3LjM2XCIsXHJcbiAgICAgICAgICAgICAgICBmZWF0dXJlczoge1xyXG4gICAgICAgICAgICAgICAgICAgIEZldGNoRXh0ZXJuYWxSZXNvdXJjZXM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIFByb2Nlc3NFeHRlcm5hbFJlc291cmNlczogZmFsc2VcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBkb25lOiAoZXJyLCB3aW5kb3cpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyICYmIGVyci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmlzU3VjY2Vzc2Z1bCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZXJyb3IgPSBlcnI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXModmFsdWVzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2godmFsdWVOYW1lID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXR0aW5ncyA9IHZhbHVlc1t2YWx1ZU5hbWVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC52YWx1ZXNbdmFsdWVOYW1lXSA9IHRoaXMuc2NyYXBlVmFsdWUod2luZG93LmRvY3VtZW50LCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5pc1N1Y2Nlc3NmdWwgPSBPYmplY3Qua2V5cyhyZXN1bHQudmFsdWVzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCh2YWx1ZU5hbWUgPT4gcmVzdWx0LnZhbHVlc1t2YWx1ZU5hbWVdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmV2ZXJ5KHYgPT4gdi5pc1N1Y2Nlc3NmdWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpOyAgXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNjcmFwZVZhbHVlKGRvY3VtZW50OiBEb2N1bWVudCwgdmFsdWVTY3JhcGluZ1NldHRpbmdzOiBBcGkuVmFsdWVTY3JhcGluZ1NldHRpbmdzW10pOiBTY3JhcGluZy5WYWx1ZVNjcmFwaW5nUmVzdWx0IHtcclxuICAgICAgICBpZiAoIWRvY3VtZW50KVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJkb2N1bWVudCBpcyB1bmRlZmluZWRcIik7XHJcbiAgICAgICAgaWYgKCF2YWx1ZVNjcmFwaW5nU2V0dGluZ3MpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInZhbHVlU2NyYXBpbmdTZXR0aW5ncyBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZW1wdHlWYWx1ZVNjcmFwaW5nUmVzdWx0KCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IHNjcmFwaW5nU2V0dGluZyBvZiB2YWx1ZVNjcmFwaW5nU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJhd1ZhbHVlID0gdGhpcy5leHRyYWN0UmF3VmFsdWVGcm9tRG9jdW1lbnQoZG9jdW1lbnQsIHNjcmFwaW5nU2V0dGluZyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWRWYWx1ZSA9IHRoaXMudmFsdWVQYXJzZXJbc2NyYXBpbmdTZXR0aW5nLnR5cGVdKHJhd1ZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXN1bHQuaXNTdWNjZXNzZnVsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5lcnJvciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuc2V0dGluZ3MgPSBzY3JhcGluZ1NldHRpbmc7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQudmFsdWUgPSBwYXJzZWRWYWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LmlzU3VjY2Vzc2Z1bCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LmVycm9yID0gZXJyb3I7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuc2V0dGluZ3MgPSBzY3JhcGluZ1NldHRpbmc7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjcmFwaW5nU2V0dGluZy5mYWlsT25FcnJvcilcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZXh0cmFjdFJhd1ZhbHVlRnJvbURvY3VtZW50KGRvY3VtZW50OiBEb2N1bWVudCwgdmFsdWVTY3JhcGluZ1NldHRpbmc6IEFwaS5WYWx1ZVNjcmFwaW5nU2V0dGluZ3MpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IGV4dHJhY3RNZXRob2QgPSB2YWx1ZVNjcmFwaW5nU2V0dGluZy5leHRyYWN0IHx8IFwicXVlcnlzZWxlY3RvclwiO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGV4dHJhY3RNZXRob2QpIHtcclxuICAgICAgICAgICAgY2FzZSBcInF1ZXJ5c2VsZWN0b3JcIjpcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcXVlcnlTZWxlY3RvclNldHRpbmdzID0gdmFsdWVTY3JhcGluZ1NldHRpbmcgYXMgQXBpLlF1ZXJ5U2VsZWN0b3JFeHRyYWN0U2V0dGluZ3M7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFxdWVyeVNlbGVjdG9yU2V0dGluZ3MuZWxlbWVudFNlbGVjdG9yKVxyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZWxlbWVudFNlbGVjdG9yIGlzIG1pc3NpbmdgKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXVlcnlTZWxlY3RvclNldHRpbmdzLmVsZW1lbnRTZWxlY3Rvcik7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudHMubGVuZ3RoID09PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRWxlbWVudCB3aXRoIHNlbGVjdG9yICR7cXVlcnlTZWxlY3RvclNldHRpbmdzLmVsZW1lbnRTZWxlY3Rvcn0gaXMgbWlzc2luZ2ApO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnRzLmxlbmd0aCA+IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGVyZSBhcmUgbW9yZSB0aGFuIG9uZSBlbGVtZW50IHdpdGggc2VsZWN0b3IgJHtxdWVyeVNlbGVjdG9yU2V0dGluZ3MuZWxlbWVudFNlbGVjdG9yfWApO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChxdWVyeVNlbGVjdG9yU2V0dGluZ3MuYXR0cmlidXRlKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50c1swXS5nZXRBdHRyaWJ1dGUocXVlcnlTZWxlY3RvclNldHRpbmdzLmF0dHJpYnV0ZSk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRzWzBdLnRleHRDb250ZW50O1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjYXNlIFwicmVnZXhcIjpcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVnZXhTZXR0aW5ncyA9IHZhbHVlU2NyYXBpbmdTZXR0aW5nIGFzIEFwaS5SZWdleEV4dHJhY3RTZXR0aW5ncztcclxuICAgICAgICAgICAgICAgIGlmICghcmVnZXhTZXR0aW5ncy5yZWdleClcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJyZWdleCBtaXNzaW5nXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaHRtbFwiKS5pbm5lckhUTUw7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKHJlZ2V4U2V0dGluZ3MucmVnZXgsIFwiZ21pXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSByZWdleC5leGVjKHRleHQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVzLmxlbmd0aClcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyB2YWx1ZSBtYXRjaGVzXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzWzFdO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biBleHRyYWN0IG1ldGhvZFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbXB0eVZhbHVlU2NyYXBpbmdSZXN1bHQoKTogU2NyYXBpbmcuVmFsdWVTY3JhcGluZ1Jlc3VsdCB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdmFsdWU6IG51bGwsXHJcbiAgICAgICAgICAgIGlzU3VjY2Vzc2Z1bDogdHJ1ZSxcclxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgIHNldHRpbmdzOiBudWxsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/scrapers/jsdom-scraper.ts\n ** module id = 22\n ** module chunks = 0\n **/","/// <reference path=\"typings/index.d.ts\" />\r\nif (!Array.prototype.toHash) {\r\n    Array.prototype.toHash = function toHash(keySelector, valueSelector) {\r\n        valueSelector = valueSelector || (function (e) { return (e); });\r\n        return this.reduce(function (hash, elem) {\r\n            var key = keySelector(elem);\r\n            var value = valueSelector(elem);\r\n            hash[key] = value;\r\n            return hash;\r\n        }, {});\r\n    };\r\n}\r\nif (!Object.entries) {\r\n    Object.entries = function (obj) { return Object.keys(obj)\r\n        .map(function (key) { return ([key, obj[key]]); }); };\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZW5zaW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImV4dGVuc2lvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMkNBQTJDO0FBRTNDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQzFCLEtBQUssQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLGdCQUFzQixXQUFnQyxFQUFFLGFBQThCO1FBQzNHLGFBQWEsR0FBRyxhQUFhLElBQUksQ0FBQyxVQUFDLENBQUksSUFBSyxPQUFBLENBQUUsQ0FBYyxDQUFDLEVBQWpCLENBQWlCLENBQUMsQ0FBQztRQUUvRCxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFDLElBQUksRUFBRSxJQUFJO1lBQzFCLElBQU0sR0FBRyxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM5QixJQUFNLEtBQUssR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFbEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUVsQixNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2hCLENBQUMsRUFDRCxFQUFFLENBQTBCLENBQUM7SUFDakMsQ0FBQyxDQUFDO0FBQ04sQ0FBQztBQUVELEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDbEIsTUFBTSxDQUFDLE9BQU8sR0FBRyxVQUFDLEdBQVEsSUFBSyxPQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO1NBQzFDLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBakIsQ0FBaUIsQ0FBQyxFQURILENBQ0csQ0FBQztBQUN2QyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cInR5cGluZ3MvaW5kZXguZC50c1wiIC8+XHJcblxyXG5pZiAoIUFycmF5LnByb3RvdHlwZS50b0hhc2gpIHtcclxuICAgIEFycmF5LnByb3RvdHlwZS50b0hhc2ggPSBmdW5jdGlvbiB0b0hhc2g8VCwgSz4oa2V5U2VsZWN0b3I6IChlbGVtOiBUKSA9PiBzdHJpbmcsIHZhbHVlU2VsZWN0b3I/OiAoZWxlbTogVCkgPT4gSyk6IHsgW2tleTogc3RyaW5nXTogSzsgfSB7XHJcbiAgICAgICAgdmFsdWVTZWxlY3RvciA9IHZhbHVlU2VsZWN0b3IgfHwgKChlOiBUKSA9PiAoKGUgYXMgYW55KSBhcyBLKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZHVjZSgoaGFzaCwgZWxlbSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBrZXkgPSBrZXlTZWxlY3RvcihlbGVtKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZVNlbGVjdG9yKGVsZW0pO1xyXG5cclxuICAgICAgICAgICAgaGFzaFtrZXldID0gdmFsdWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaGFzaDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHt9KSBhcyB7IFtrZXk6IHN0cmluZ106IEs7IH07XHJcbiAgICB9O1xyXG59XHJcblxyXG5pZiAoIU9iamVjdC5lbnRyaWVzKSB7XHJcbiAgICBPYmplY3QuZW50cmllcyA9IChvYmo6IGFueSkgPT4gT2JqZWN0LmtleXMob2JqKVxyXG4gICAgICAgIC5tYXAoa2V5ID0+IChba2V5LCBvYmpba2V5XV0pKTtcclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/extensions.ts\n ** module id = 23\n ** module chunks = 0\n **/","module.exports = require(\"jsdom\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"jsdom\"\n ** module id = 24\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar ValueParserHash = (function () {\r\n    function ValueParserHash() {\r\n        this.parsers = {};\r\n        this.parsers[\"string\"] = this.string;\r\n        this.parsers[\"number\"] = this.number;\r\n    }\r\n    ValueParserHash.prototype.string = function (input) {\r\n        return (input || \"\").trim();\r\n    };\r\n    ValueParserHash.prototype.number = function (input) {\r\n        if (!input)\r\n            throw new Error(\"Number is missing.\");\r\n        var src = input.replace(/[^0-9\\.]/g, \"\");\r\n        var number = parseFloat(src);\r\n        if (number && !isNaN(number))\r\n            return number;\r\n        throw new Error(\"Number format is not valid.\");\r\n    };\r\n    return ValueParserHash;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ValueParserHash;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsdWUtcGFyc2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidmFsdWUtcGFyc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDZDQUE2Qzs7QUFFN0M7SUFHSTtRQUZBLFlBQU8sR0FBRyxFQUFFLENBQUM7UUFHVCxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDckMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3pDLENBQUM7SUFFRCxnQ0FBTSxHQUFOLFVBQU8sS0FBYTtRQUNoQixNQUFNLENBQUMsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUVELGdDQUFNLEdBQU4sVUFBTyxLQUFhO1FBQ2hCLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQ1AsTUFBTSxJQUFJLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBRTFDLElBQU0sR0FBRyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRTNDLElBQU0sTUFBTSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUUvQixFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDekIsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUVsQixNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUNMLHNCQUFDO0FBQUQsQ0FBQyxBQXpCRCxJQXlCQztBQXpCRDtpQ0F5QkMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBWYWx1ZVBhcnNlckhhc2gge1xyXG4gICAgcGFyc2VycyA9IHt9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMucGFyc2Vyc1tcInN0cmluZ1wiXSA9IHRoaXMuc3RyaW5nO1xyXG4gICAgICAgIHRoaXMucGFyc2Vyc1tcIm51bWJlclwiXSA9IHRoaXMubnVtYmVyO1xyXG4gICAgfVxyXG5cclxuICAgIHN0cmluZyhpbnB1dDogc3RyaW5nKTogYW55IHtcclxuICAgICAgICByZXR1cm4gKGlucHV0IHx8IFwiXCIpLnRyaW0oKTtcclxuICAgIH1cclxuXHJcbiAgICBudW1iZXIoaW5wdXQ6IHN0cmluZyk6IGFueSB7XHJcbiAgICAgICAgaWYgKCFpbnB1dClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTnVtYmVyIGlzIG1pc3NpbmcuXCIpO1xyXG5cclxuICAgICAgICBjb25zdCBzcmMgPSBpbnB1dC5yZXBsYWNlKC9bXjAtOVxcLl0vZywgXCJcIik7XHJcblxyXG4gICAgICAgIGNvbnN0IG51bWJlciA9IHBhcnNlRmxvYXQoc3JjKTtcclxuXHJcbiAgICAgICAgaWYgKG51bWJlciAmJiAhaXNOYU4obnVtYmVyKSlcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuXHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTnVtYmVyIGZvcm1hdCBpcyBub3QgdmFsaWQuXCIpO1xyXG4gICAgfVxyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/scrapers/value-parser.ts\n ** module id = 25\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar async = require(\"async\");\r\nvar ScrapeQueueService = (function () {\r\n    function ScrapeQueueService(scrapeService, scrapingThreads, delayBetweenProductScraping) {\r\n        var _this = this;\r\n        this.scrapeService = scrapeService;\r\n        if (!scrapeService)\r\n            throw new Error(\"scrapeService is missing\");\r\n        this.queue = async.queue(function (productId, callback) {\r\n            console.log(\"Scraping data for product \" + productId);\r\n            _this.scrapeService.scrapeProductData(productId)\r\n                .then(function (res) {\r\n                Object.keys(res)\r\n                    .forEach(function (webShop) {\r\n                    var result = res[webShop];\r\n                    if (result.isSuccessful)\r\n                        console.log(\"Scraping product \" + productId + \" from shop \" + webShop + \" completed successfuly\");\r\n                    else {\r\n                        console.error(\"Scraping product \" + productId + \" from shop \" + webShop + \" failed\");\r\n                        console.error(result.error);\r\n                    }\r\n                });\r\n                setTimeout(callback, delayBetweenProductScraping);\r\n            })\r\n                .catch(function (err) { return callback(err); });\r\n        }, scrapingThreads);\r\n    }\r\n    /**\r\n     * Enqueues scraping data and saving results for a product.\r\n     * Method returns a promise which will be resolved when processing finishes.\r\n     */\r\n    ScrapeQueueService.prototype.enqueue = function (productId) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return new Promise(function (resolve, reject) {\r\n            _this.queue.push(productId, function (err) {\r\n                if (err)\r\n                    reject(err);\r\n                else\r\n                    resolve(productId);\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Enqueues scraping data and saving results for a product before other enqueued products.\r\n     * Method returns a promise which will be resolved when processing finishes.\r\n     */\r\n    ScrapeQueueService.prototype.enqueuePriore = function (productId) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return new Promise(function (resolve, reject) {\r\n            _this.queue.unshift(productId, function (err) {\r\n                if (err)\r\n                    reject(err);\r\n                else\r\n                    resolve(productId);\r\n            });\r\n        });\r\n    };\r\n    return ScrapeQueueService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ScrapeQueueService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyYXBlLXF1ZXVlLXNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzY3JhcGUtcXVldWUtc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSw2Q0FBNkM7O0FBRTdDLElBQVksS0FBSyxXQUFNLE9BQU8sQ0FBQyxDQUFBO0FBSS9CO0lBR0ksNEJBQW9CLGFBQTRCLEVBQUUsZUFBdUIsRUFBRSwyQkFBbUM7UUFIbEgsaUJBaUVDO1FBOUR1QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QyxFQUFFLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQztZQUNmLE1BQU0sSUFBSSxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUVoRCxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsVUFBQyxTQUFpQixFQUFFLFFBQVE7WUFDakQsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQkFBNkIsU0FBVyxDQUFDLENBQUM7WUFFdEQsS0FBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUM7aUJBQzFDLElBQUksQ0FBQyxVQUFBLEdBQUc7Z0JBQ0wsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7cUJBQ1gsT0FBTyxDQUFDLFVBQUEsT0FBTztvQkFDWixJQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQzVCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUM7d0JBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQW9CLFNBQVMsbUJBQWMsT0FBTywyQkFBd0IsQ0FBQyxDQUFDO29CQUM1RixJQUFJLENBQUMsQ0FBQzt3QkFDRixPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFvQixTQUFTLG1CQUFjLE9BQU8sWUFBUyxDQUFDLENBQUM7d0JBQzNFLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNoQyxDQUFDO2dCQUNMLENBQUMsQ0FBQyxDQUFDO2dCQUVQLFVBQVUsQ0FBQyxRQUFRLEVBQUUsMkJBQTJCLENBQUMsQ0FBQztZQUN0RCxDQUFDLENBQUM7aUJBQ0QsS0FBSyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFiLENBQWEsQ0FBQyxDQUFDO1FBRXJDLENBQUMsRUFBRSxlQUFlLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsb0NBQU8sR0FBUCxVQUFRLFNBQWlCO1FBQXpCLGlCQVlDO1FBWEcsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDWCxNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFFOUMsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFDLFVBQUMsT0FBTyxFQUFFLE1BQU07WUFDL0IsS0FBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQUEsR0FBRztnQkFDMUIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO29CQUNKLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDaEIsSUFBSTtvQkFDQSxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDM0IsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRDs7O09BR0c7SUFDSCwwQ0FBYSxHQUFiLFVBQWMsU0FBaUI7UUFBL0IsaUJBWUM7UUFYRyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUU5QyxNQUFNLENBQUMsSUFBSSxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsTUFBTTtZQUMvQixLQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsVUFBQSxHQUFHO2dCQUM3QixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUM7b0JBQ0osTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNoQixJQUFJO29CQUNBLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMzQixDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNMLHlCQUFDO0FBQUQsQ0FBQyxBQWpFRCxJQWlFQztBQWpFRDtvQ0FpRUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcblxyXG5pbXBvcnQgKiBhcyBhc3luYyBmcm9tIFwiYXN5bmNcIjtcclxuXHJcbmltcG9ydCBTY3JhcGVTZXJ2aWNlIGZyb20gXCIuL3NjcmFwZS1zZXJ2aWNlXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY3JhcGVRdWV1ZVNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBxdWV1ZTogQXN5bmNRdWV1ZTxzdHJpbmc+O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc2NyYXBlU2VydmljZTogU2NyYXBlU2VydmljZSwgc2NyYXBpbmdUaHJlYWRzOiBudW1iZXIsIGRlbGF5QmV0d2VlblByb2R1Y3RTY3JhcGluZzogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKCFzY3JhcGVTZXJ2aWNlKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzY3JhcGVTZXJ2aWNlIGlzIG1pc3NpbmdcIik7XHJcblxyXG4gICAgICAgIHRoaXMucXVldWUgPSBhc3luYy5xdWV1ZSgocHJvZHVjdElkOiBzdHJpbmcsIGNhbGxiYWNrKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTY3JhcGluZyBkYXRhIGZvciBwcm9kdWN0ICR7cHJvZHVjdElkfWApO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zY3JhcGVTZXJ2aWNlLnNjcmFwZVByb2R1Y3REYXRhKHByb2R1Y3RJZClcclxuICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMocmVzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaCh3ZWJTaG9wID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlc1t3ZWJTaG9wXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaXNTdWNjZXNzZnVsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTY3JhcGluZyBwcm9kdWN0ICR7cHJvZHVjdElkfSBmcm9tIHNob3AgJHt3ZWJTaG9wfSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bHlgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFNjcmFwaW5nIHByb2R1Y3QgJHtwcm9kdWN0SWR9IGZyb20gc2hvcCAke3dlYlNob3B9IGZhaWxlZGApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IocmVzdWx0LmVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoY2FsbGJhY2ssIGRlbGF5QmV0d2VlblByb2R1Y3RTY3JhcGluZyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBjYWxsYmFjayhlcnIpKTtcclxuXHJcbiAgICAgICAgfSwgc2NyYXBpbmdUaHJlYWRzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEVucXVldWVzIHNjcmFwaW5nIGRhdGEgYW5kIHNhdmluZyByZXN1bHRzIGZvciBhIHByb2R1Y3QuXHJcbiAgICAgKiBNZXRob2QgcmV0dXJucyBhIHByb21pc2Ugd2hpY2ggd2lsbCBiZSByZXNvbHZlZCB3aGVuIHByb2Nlc3NpbmcgZmluaXNoZXMuICAgICBcclxuICAgICAqL1xyXG4gICAgZW5xdWV1ZShwcm9kdWN0SWQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICAgICAgaWYgKCFwcm9kdWN0SWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInByb2R1Y3RJZCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucXVldWUucHVzaChwcm9kdWN0SWQsIGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocHJvZHVjdElkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFbnF1ZXVlcyBzY3JhcGluZyBkYXRhIGFuZCBzYXZpbmcgcmVzdWx0cyBmb3IgYSBwcm9kdWN0IGJlZm9yZSBvdGhlciBlbnF1ZXVlZCBwcm9kdWN0cy5cclxuICAgICAqIE1ldGhvZCByZXR1cm5zIGEgcHJvbWlzZSB3aGljaCB3aWxsIGJlIHJlc29sdmVkIHdoZW4gcHJvY2Vzc2luZyBmaW5pc2hlcy4gICAgIFxyXG4gICAgICovXHJcbiAgICBlbnF1ZXVlUHJpb3JlKHByb2R1Y3RJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKCFwcm9kdWN0SWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInByb2R1Y3RJZCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucXVldWUudW5zaGlmdChwcm9kdWN0SWQsIGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocHJvZHVjdElkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/scrape-queue-service.ts\n ** module id = 26\n ** module chunks = 0\n **/","module.exports = require(\"async\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"async\"\n ** module id = 27\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar schedule = require(\"node-schedule\");\r\nvar uuid = require(\"node-uuid\");\r\nvar ScrapeSchedulerService = (function () {\r\n    function ScrapeSchedulerService(queue, productService, schedules) {\r\n        this.queue = queue;\r\n        this.productService = productService;\r\n        this.schedules = schedules;\r\n        if (!queue)\r\n            throw new Error(\"queue is undefined\");\r\n        if (!productService)\r\n            throw new Error(\"productService is undefined\");\r\n        if (!schedules && !schedules.length)\r\n            throw new Error(\"schedules is undefined or empty\");\r\n    }\r\n    ScrapeSchedulerService.prototype.run = function () {\r\n        var _this = this;\r\n        if (schedule.scheduledJobs && Object.keys(schedule.scheduledJobs).length)\r\n            return false;\r\n        this.schedules\r\n            .map(function (rule) { return schedule.scheduleJob(uuid.v1(), rule, function () {\r\n            console.log(new Date() + \" Running product scraping for scheduler rule \" + rule);\r\n            _this.productService\r\n                .all()\r\n                .then(function (products) {\r\n                products.forEach(function (p) { return _this.queue.enqueue(p.id); });\r\n            });\r\n        }); });\r\n        return true;\r\n    };\r\n    return ScrapeSchedulerService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ScrapeSchedulerService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyYXBlLXNjaGVkdWxlci1zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic2NyYXBlLXNjaGVkdWxlci1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDhDQUE4Qzs7QUFFOUMsSUFBWSxRQUFRLFdBQU0sZUFBZSxDQUFDLENBQUE7QUFDMUMsSUFBWSxJQUFJLFdBQU0sV0FBVyxDQUFDLENBQUE7QUFLbEM7SUFDSSxnQ0FBb0IsS0FBeUIsRUFDekIsY0FBOEIsRUFDOUIsU0FBbUI7UUFGbkIsVUFBSyxHQUFMLEtBQUssQ0FBb0I7UUFDekIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLGNBQVMsR0FBVCxTQUFTLENBQVU7UUFDbkMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7WUFDUCxNQUFNLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDMUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUM7WUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1FBQ25ELEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQztZQUNoQyxNQUFNLElBQUksS0FBSyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7SUFDM0QsQ0FBQztJQUVELG9DQUFHLEdBQUg7UUFBQSxpQkFrQkM7UUFqQkcsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLGFBQWEsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDckUsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUVqQixJQUFJLENBQUMsU0FBUzthQUNULEdBQUcsQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUN2QyxJQUFJLEVBQ0o7WUFDSSxPQUFPLENBQUMsR0FBRyxDQUFJLElBQUksSUFBSSxFQUFFLHFEQUFnRCxJQUFNLENBQUMsQ0FBQztZQUVqRixLQUFJLENBQUMsY0FBYztpQkFDZCxHQUFHLEVBQUU7aUJBQ0wsSUFBSSxDQUFDLFVBQUEsUUFBUTtnQkFDVixRQUFRLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsS0FBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUF4QixDQUF3QixDQUFDLENBQUM7WUFDcEQsQ0FBQyxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUMsRUFWTyxDQVVQLENBQUMsQ0FBQztRQUVaLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUNMLDZCQUFDO0FBQUQsQ0FBQyxBQS9CRCxJQStCQztBQS9CRDt3Q0ErQkMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxyXG5cclxuaW1wb3J0ICogYXMgc2NoZWR1bGUgZnJvbSBcIm5vZGUtc2NoZWR1bGVcIjtcclxuaW1wb3J0ICogYXMgdXVpZCBmcm9tIFwibm9kZS11dWlkXCI7XHJcblxyXG5pbXBvcnQgU2NyYXBlUXVldWVTZXJ2aWNlIGZyb20gXCIuL3NjcmFwZS1xdWV1ZS1zZXJ2aWNlXCI7XHJcbmltcG9ydCBQcm9kdWN0U2VydmljZSBmcm9tIFwiLi9wcm9kdWN0cy9wcm9kdWN0LXNlcnZpY2VcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNjcmFwZVNjaGVkdWxlclNlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBxdWV1ZTogU2NyYXBlUXVldWVTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBwcm9kdWN0U2VydmljZTogUHJvZHVjdFNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIHNjaGVkdWxlczogc3RyaW5nW10pIHtcclxuICAgICAgICBpZiAoIXF1ZXVlKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJxdWV1ZSBpcyB1bmRlZmluZWRcIik7XHJcbiAgICAgICAgaWYgKCFwcm9kdWN0U2VydmljZSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHJvZHVjdFNlcnZpY2UgaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgICAgIGlmICghc2NoZWR1bGVzICYmICFzY2hlZHVsZXMubGVuZ3RoKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzY2hlZHVsZXMgaXMgdW5kZWZpbmVkIG9yIGVtcHR5XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHJ1bigpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoc2NoZWR1bGUuc2NoZWR1bGVkSm9icyAmJiBPYmplY3Qua2V5cyhzY2hlZHVsZS5zY2hlZHVsZWRKb2JzKS5sZW5ndGgpXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgdGhpcy5zY2hlZHVsZXNcclxuICAgICAgICAgICAgLm1hcChydWxlID0+IHNjaGVkdWxlLnNjaGVkdWxlSm9iKHV1aWQudjEoKSxcclxuICAgICAgICAgICAgICAgIHJ1bGUsXHJcbiAgICAgICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCR7bmV3IERhdGUoKX0gUnVubmluZyBwcm9kdWN0IHNjcmFwaW5nIGZvciBzY2hlZHVsZXIgcnVsZSAke3J1bGV9YCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdFNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmFsbCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHByb2R1Y3RzID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RzLmZvckVhY2gocCA9PiB0aGlzLnF1ZXVlLmVucXVldWUocC5pZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/scrape-scheduler-service.ts\n ** module id = 28\n ** module chunks = 0\n **/","module.exports = require(\"node-schedule\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-schedule\"\n ** module id = 29\n ** module chunks = 0\n **/"],"sourceRoot":""}