{"version":3,"sources":["webpack:///webpack/bootstrap 252966747bcd63c8ab49","webpack:///./server/extensions.ts","webpack:///./server/app.ts","webpack:///./server/web-server.ts","webpack:///external \"http\"","webpack:///external \"express\"","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///./server/config.ts","webpack:///external \"fs\"","webpack:///./server/web/routes/authentication-route.ts","webpack:///./server/data-access/db.ts","webpack:///external \"mongodb\"","webpack:///./server/services/authentication/mongo-authentication-token-storage.ts","webpack:///./server/services/authentication/authentication-token-provider.ts","webpack:///external \"node-uuid\"","webpack:///external \"moment\"","webpack:///./server/services/users/mongo-user-account-storage.ts","webpack:///./server/services/users/user-account-service.ts","webpack:///./server/web/authentication-middleware.ts","webpack:///./server/web/routes/product-route.ts","webpack:///./server/services/products/mongo-product-storage.ts","webpack:///./server/services/products/product-service.ts","webpack:///./server/services/event-bus.ts","webpack:///external \"events\"","webpack:///./server/services/products/product-validator.ts","webpack:///./server/validator/index.ts","webpack:///./server/validator/error-accumulator.ts","webpack:///./server/validator/validation-context.ts","webpack:///./server/validator/rules/index.ts","webpack:///./server/validator/rules/primitive-type-rules.ts","webpack:///./server/validator/rules/rules-base.ts","webpack:///./server/validator/rules/object-rules.ts","webpack:///./server/validator/rules/hash-rules.ts","webpack:///./server/validator/rules/array-rules.ts","webpack:///./server/web/routes/web-shop-route.ts","webpack:///./server/services/web-shop/mongo-web-shop-storage.ts","webpack:///./server/services/web-shop/web-shop-service.ts","webpack:///./server/services/web-shop/web-shop-validator.ts","webpack:///./server/scrape-server.ts","webpack:///./server/services/scraping/scrape-service.ts","webpack:///./server/scrapers/jsdom-scraper.ts","webpack:///external \"jsdom\"","webpack:///./server/scrapers/value-parser.ts","webpack:///external \"path\"","webpack:///./server/services/scraping/scrape-queue-service.ts","webpack:///external \"async\"","webpack:///./server/services/scraping/scrape-scheduler-service.ts","webpack:///external \"node-schedule\""],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;ACtCA;AACA;AACA;AACA,yDAAwD,YAAY,EAAE;AACtE;AACA;AACA;AACA;AACA;AACA,UAAS,IAAI;AACb;AACA;AACA;AACA,sCAAqC;AACrC,8BAA6B,0BAA0B,EAAE,EAAE;AAC3D;AACA,4CAA2C,2mE;;;;;;AChB3C;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,+mB;;;;;;ACN3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,4CAA2C,2lG;;;;;;AC5B3C,kC;;;;;;ACAA,qC;;;;;;ACAA,yC;;;;;;ACAA,2C;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,2vB;;;;;;ACP3C,gC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAA+B,+BAA+B,EAAE;AAChE,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,EAAC;AACD,4CAA2C,qDAAqD,EAAE;AAClG,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,m4I;;;;;;ACrC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC,kCAAkC,EAAE;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,2gG;;;;;;ACvC3C,qC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC,qBAAoB,6BAA6B,GAAG,SAAS;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS,EAAE,EAAE;AACb;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT;AACA,UAAS,EAAE,EAAE;AACb,gCAA+B,2BAA2B,EAAE;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,qBAAqB,6BAA6B,EAAE,EAAE;AACtF;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,22J;;;;;;AChD3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,mCAAmC,EAAE;AAChF,gDAA+C,oBAAoB,EAAE;AACrE;AACA;AACA,cAAa;AACb,wCAAuC,oBAAoB,EAAE;AAC7D,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,20I;;;;;;AC7C3C,uC;;;;;;ACAA,oC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,gBAAgB,qBAAqB,GAAG,SAAS,EAAE,EAAE;AACrF,iCAAgC,mBAAmB,EAAE;AACrD,iCAAgC,iBAAiB,EAAE;AACnD;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,ulE;;;;;;ACtB3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,m3E;;;;;;AC3B3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAwD;AACxD;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,iCAAgC,uCAAuC,EAAE;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,2mI;;;;;;AC5C3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC,0BAA0B,EAAE;AAC9D,gCAA+B,yCAAyC,EAAE;AAC1E,EAAC;AACD;AACA;AACA,oCAAmC,2BAA2B,EAAE;AAChE,gCAA+B,iCAAiC,EAAE;AAClE,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,2uJ;;;;;;AC/C3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,iBAAiB,GAAG,SAAS,EAAE,EAAE;AACjE,iCAAgC,oBAAoB,EAAE;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,gBAAgB,SAAS,GAAG,SAAS,EAAE,EAAE;AACzE,iCAAgC,mBAAmB,EAAE;AACrD,iCAAgC,iBAAiB,EAAE;AACnD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,gBAAgB,eAAe,GAAG,SAAS,EAAE,EAAE;AAC/E,iCAAgC,mBAAmB,EAAE;AACrD,iCAAgC,iBAAiB,EAAE;AACnD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,UAAS,EAAE,EAAE;AACb,gCAA+B,gBAAgB,EAAE;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT,2BAA0B;AAC1B;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,UAAS,EAAE,QAAQ,EAAE;AACrB,iCAAgC,6BAA6B,EAAE;AAC/D;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,2iP;;;;;;AC9E3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,oCAAmC,oCAAoC,EAAE;AACzE,oCAAmC,8BAA8B,EAAE;AACnE;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,mrT;;;;;;ACpG3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA,4CAA2C,+sC;;;;;;ACrB3C,oC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAkD,yCAAyC;AAC3F;AACA,4BAA2B,4CAA4C;AACvE,qCAAoC,wBAAwB,EAAE,GAAG,yCAAyC;AAC1G,+FAA8F,gFAAgF,EAAE,GAAG,4DAA4D;AAC/O,0CAAyC;AACzC,yCAAwC,qBAAqB,EAAE;AAC/D,yCAAwC,qCAAqC,EAAE;AAC/E,6BAA4B,EAAE,GAAG,+DAA+D;AAChG,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,+4G;;;;;;AC1B3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAoB,uBAAuB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,qBAAoB,uBAAuB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA,4CAA2C,u6K;;;;;;AC3D3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,+wD;;;;;;ACxB3C;AACA;AACA;AACA;AACA,wCAAuC,sBAAsB;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAqD,qDAAqD,EAAE;AAC5G,cAAa;AACb;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,2pL;;;;;;ACtD3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,2lB;;;;;;ACT3C;AACA;AACA;AACA,oBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,EAAC;AACD;AACA;AACA,8BAA6B,gBAAgB;AAC7C;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA6B,gBAAgB;AAC7C;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,mve;;;;;;ACvL3C;AACA;AACA;AACA,oBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAoB,uBAAuB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gEAA+D,kEAAkE,EAAE;AACnI,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC,sBAAsB;AAC5D,wCAAuC,uBAAuB;AAC9D;AACA;AACA;AACA,kDAAiD,cAAc,EAAE;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA,UAAS;AACT;AACA;AACA;AACA,+CAA8C,0DAA0D;AACxG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,uCAAsC,sBAAsB;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,sBAAsB;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,iDAAgD,sCAAsC,EAAE;AACxF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,6CAA4C,aAAa,EAAE;AAC3D;AACA;AACA;AACA,4CAA2C,+vhC;;;;;;AChV3C;AACA;AACA;AACA,oBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA,oCAAmC,sBAAsB;AACzD;AACA;AACA;AACA,4CAA2C,myS;;;;;;AC9F3C;AACA;AACA;AACA,oBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,4BAA4B;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA,oCAAmC,sBAAsB;AACzD;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,uqW;;;;;;AC9G3C;AACA;AACA;AACA,oBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAuC,mEAAmE,EAAE;AAC5G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,4BAA4B;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA,oCAAmC,sBAAsB;AACzD;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,m9X;;;;;;ACrH3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C;AAC5C;AACA;AACA;AACA;AACA,UAAS,EAAE,EAAE;AACb;AACA,MAAK;AACL,gCAA+B,sCAAsC,EAAE;AACvE,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,UAAS;AACT;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,+vJ;;;;;;ACjD3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,iBAAiB,GAAG,SAAS,EAAE,EAAE;AACjE,iCAAgC,oBAAoB,EAAE;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC,gBAAgB,SAAS,GAAG,SAAS,EAAE,EAAE;AACzE,iCAAgC,0BAA0B,EAAE;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT;AACA;AACA;AACA,UAAS,EAAE,EAAE;AACb,gCAA+B,gBAAgB,EAAE;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA,UAAS;AACT;AACA,UAAS,EAAE,EAAE;AACb,gCAA+B,gBAAgB,EAAE;AACjD;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,mkK;;;;;;ACrD3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAsC;AACtC;AACA,gCAA+B,8BAA8B,EAAE,EAAE,EAAE;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAA+B,8BAA8B,EAAE;AAC/D;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,uvH;;;;;;AC7C3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA8B,oDAAoD;AAClF,yCAAwC,kBAAkB,EAAE,GAAG,2DAA2D;AAC1H,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,m9D;;;;;;ACrB3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,4CAA2C,+rH;;;;;;AC7B3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAoC,mCAAmC,aAAa,EAAE,EAAE,EAAE;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA0C;AAC1C,2CAA0C,qCAAqC,oBAAoB,EAAE,gBAAgB,yBAAyB,EAAE,EAAE,EAAE,EAAE,EAAE;AACxJ;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA,wCAAuC;AACvC,mDAAkD;AAClD;AACA;AACA,UAAS,EAAE,EAAE,EAAE,EAAE;AACjB;AACA;AACA;AACA;AACA;AACA,sCAAqC;AACrC;AACA,gCAA+B,eAAe,EAAE,EAAE,EAAE;AACpD;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,usM;;;;;;ACpD3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAAyC;AACzC;AACA;AACA;AACA,0DAAyD;AACzD;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB;AACA,wDAAuD,iCAAiC,EAAE;AAC1F,kDAAiD,uBAAuB,EAAE;AAC1E;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0EAAyE,qCAAqC;AAC9G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,u5a;;;;;;AClI3C,mC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,u0F;;;;;;AC7B3C,kC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA,cAAa;AACb,wCAAuC,sBAAsB,EAAE;AAC/D,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,mnM;;;;;;AClE3C,mC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAkC;AAClC;AACA;AACA;AACA;AACA,gDAA+C,kCAAkC,EAAE;AACnF,cAAa;AACb,UAAS,EAAE,EAAE;AACb;AACA;AACA;AACA,EAAC;AACD,+CAA8C,cAAc;AAC5D;AACA,4CAA2C,unH;;;;;;ACnC3C,2C","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 252966747bcd63c8ab49\n **/","/// <reference path=\"typings/index.d.ts\" />\r\nif (!Array.prototype.toHash) {\r\n    Array.prototype.toHash = function toHash(keySelector, valueSelector) {\r\n        valueSelector = valueSelector || (function (e) { return (e); });\r\n        return this.reduce(function (hash, elem) {\r\n            var key = keySelector(elem);\r\n            var value = valueSelector(elem);\r\n            hash[key] = value;\r\n            return hash;\r\n        }, {});\r\n    };\r\n}\r\nif (!Object.entries) {\r\n    Object.entries = function (obj) { return Object.keys(obj)\r\n        .map(function (key) { return ([key, obj[key]]); }); };\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZW5zaW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImV4dGVuc2lvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMkNBQTJDO0FBRTNDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQzFCLEtBQUssQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLGdCQUFzQixXQUFnQyxFQUFFLGFBQThCO1FBQzNHLGFBQWEsR0FBRyxhQUFhLElBQUksQ0FBQyxVQUFDLENBQUksSUFBSyxPQUFBLENBQUUsQ0FBYyxDQUFDLEVBQWpCLENBQWlCLENBQUMsQ0FBQztRQUUvRCxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFDLElBQUksRUFBRSxJQUFJO1lBQzFCLElBQU0sR0FBRyxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM5QixJQUFNLEtBQUssR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFbEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUVsQixNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2hCLENBQUMsRUFDRCxFQUFFLENBQTBCLENBQUM7SUFDakMsQ0FBQyxDQUFDO0FBQ04sQ0FBQztBQUVELEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDbEIsTUFBTSxDQUFDLE9BQU8sR0FBRyxVQUFDLEdBQVEsSUFBSyxPQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO1NBQzFDLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBakIsQ0FBaUIsQ0FBQyxFQURILENBQ0csQ0FBQztBQUN2QyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cInR5cGluZ3MvaW5kZXguZC50c1wiIC8+XHJcblxyXG5pZiAoIUFycmF5LnByb3RvdHlwZS50b0hhc2gpIHtcclxuICAgIEFycmF5LnByb3RvdHlwZS50b0hhc2ggPSBmdW5jdGlvbiB0b0hhc2g8VCwgSz4oa2V5U2VsZWN0b3I6IChlbGVtOiBUKSA9PiBzdHJpbmcsIHZhbHVlU2VsZWN0b3I/OiAoZWxlbTogVCkgPT4gSyk6IHsgW2tleTogc3RyaW5nXTogSzsgfSB7XHJcbiAgICAgICAgdmFsdWVTZWxlY3RvciA9IHZhbHVlU2VsZWN0b3IgfHwgKChlOiBUKSA9PiAoKGUgYXMgYW55KSBhcyBLKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZHVjZSgoaGFzaCwgZWxlbSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBrZXkgPSBrZXlTZWxlY3RvcihlbGVtKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZVNlbGVjdG9yKGVsZW0pO1xyXG5cclxuICAgICAgICAgICAgaGFzaFtrZXldID0gdmFsdWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaGFzaDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHt9KSBhcyB7IFtrZXk6IHN0cmluZ106IEs7IH07XHJcbiAgICB9O1xyXG59XHJcblxyXG5pZiAoIU9iamVjdC5lbnRyaWVzKSB7XHJcbiAgICBPYmplY3QuZW50cmllcyA9IChvYmo6IGFueSkgPT4gT2JqZWN0LmtleXMob2JqKVxyXG4gICAgICAgIC5tYXAoa2V5ID0+IChba2V5LCBvYmpba2V5XV0pKTtcclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/extensions.ts\n ** module id = 1\n ** module chunks = 0\n **/","/// <reference path=\"./typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar webServer = require(\"./web-server\");\r\nvar scrapeServer = require(\"./scrape-server\");\r\nscrapeServer.run();\r\nwebServer.run();\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDRDQUE0Qzs7QUFFNUMsSUFBWSxTQUFTLFdBQU0sY0FBYyxDQUFDLENBQUE7QUFDMUMsSUFBWSxZQUFZLFdBQU0saUJBQWlCLENBQUMsQ0FBQTtBQUVoRCxZQUFZLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDbkIsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vdHlwaW5ncy9pbmRleC5kLnRzXCIvPlxyXG5cclxuaW1wb3J0ICogYXMgd2ViU2VydmVyIGZyb20gXCIuL3dlYi1zZXJ2ZXJcIjtcclxuaW1wb3J0ICogYXMgc2NyYXBlU2VydmVyIGZyb20gXCIuL3NjcmFwZS1zZXJ2ZXJcIjtcclxuXHJcbnNjcmFwZVNlcnZlci5ydW4oKTtcclxud2ViU2VydmVyLnJ1bigpOyJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/app.ts\n ** module id = 2\n ** module chunks = 0\n **/","/// <reference path=\"./typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar http = require(\"http\");\r\nvar express = require(\"express\");\r\nvar bodyparser = require(\"body-parser\");\r\nvar cookieparser = require(\"cookie-parser\");\r\nvar config_1 = require(\"./config\");\r\nvar authentication_route_1 = require(\"./web/routes/authentication-route\");\r\nvar product_route_1 = require(\"./web/routes/product-route\");\r\nvar web_shop_route_1 = require(\"./web/routes/web-shop-route\");\r\nvar app = express();\r\napp.use(cookieparser());\r\napp.use(\"/api\", bodyparser.json());\r\napp.use(\"/api\", authentication_route_1.default);\r\napp.use(\"/api/products\", product_route_1.default);\r\napp.use(\"/api/shops\", web_shop_route_1.default);\r\napp.use(\"/\", express.static(\"./out/client\"));\r\napp.use(\"/\", function (req, res) {\r\n    res.sendfile(\"./out/client\" + '/index.html');\r\n});\r\nvar port = process.env.PORT || config_1.default.fallbackPort;\r\nfunction run() {\r\n    var server = http.createServer(app);\r\n    server.listen(port, function () {\r\n        console.info(\"Web server started at http://localhost:\" + port + \"/\");\r\n    });\r\n}\r\nexports.run = run;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLXNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIndlYi1zZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsNENBQTRDOztBQUU1QyxJQUFZLElBQUksV0FBTyxNQUFNLENBQUMsQ0FBQTtBQUM5QixJQUFZLE9BQU8sV0FBTyxTQUFTLENBQUMsQ0FBQTtBQUdwQyxJQUFZLFVBQVUsV0FBTSxhQUFhLENBQUMsQ0FBQTtBQUMxQyxJQUFZLFlBQVksV0FBTSxlQUFlLENBQUMsQ0FBQTtBQUU5Qyx1QkFBbUIsVUFBVSxDQUFDLENBQUE7QUFFOUIscUNBQWlDLG1DQUFtQyxDQUFDLENBQUE7QUFDckUsOEJBQXlCLDRCQUE0QixDQUFDLENBQUE7QUFDdEQsK0JBQXlCLDZCQUE2QixDQUFDLENBQUE7QUFFdkQsSUFBSSxHQUFHLEdBQUcsT0FBTyxFQUFFLENBQUM7QUFFcEIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDO0FBQ3hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBRW5DLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLDhCQUFvQixDQUFDLENBQUM7QUFDdEMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsdUJBQVksQ0FBQyxDQUFDO0FBQ3ZDLEdBQUcsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLHdCQUFZLENBQUMsQ0FBQztBQUdwQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7QUFFN0MsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsVUFBVSxHQUFHLEVBQUUsR0FBRztJQUMzQixHQUFHLENBQUMsUUFBUSxDQUFDLGNBQWMsR0FBRyxhQUFhLENBQUMsQ0FBQztBQUNqRCxDQUFDLENBQUMsQ0FBQztBQUVILElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLGdCQUFNLENBQUMsWUFBWSxDQUFDO0FBRXJEO0lBQ0ksSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRTtRQUNoQixPQUFPLENBQUMsSUFBSSxDQUFDLDRDQUEwQyxJQUFJLE1BQUcsQ0FBQyxDQUFDO0lBQ3BFLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQU5lLFdBQUcsTUFNbEIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cclxuXHJcbmltcG9ydCAqIGFzIGh0dHAgIGZyb20gXCJodHRwXCI7XHJcbmltcG9ydCAqIGFzIGV4cHJlc3MgIGZyb20gXCJleHByZXNzXCI7XHJcbmltcG9ydCAqIGFzIGlvIGZyb20gXCJzb2NrZXQuaW9cIjtcclxuXHJcbmltcG9ydCAqIGFzIGJvZHlwYXJzZXIgZnJvbSBcImJvZHktcGFyc2VyXCI7XHJcbmltcG9ydCAqIGFzIGNvb2tpZXBhcnNlciBmcm9tIFwiY29va2llLXBhcnNlclwiO1xyXG5cclxuaW1wb3J0IGNvbmZpZyBmcm9tIFwiLi9jb25maWdcIjtcclxuXHJcbmltcG9ydCBhdXRoZW50aWNhdGlvblJvdXRlciBmcm9tIFwiLi93ZWIvcm91dGVzL2F1dGhlbnRpY2F0aW9uLXJvdXRlXCI7XHJcbmltcG9ydCBwcm9kdWN0Um91dGUgZnJvbSBcIi4vd2ViL3JvdXRlcy9wcm9kdWN0LXJvdXRlXCI7XHJcbmltcG9ydCB3ZWJTaG9wUm91dGUgZnJvbSBcIi4vd2ViL3JvdXRlcy93ZWItc2hvcC1yb3V0ZVwiO1xyXG5cclxubGV0IGFwcCA9IGV4cHJlc3MoKTtcclxuXHJcbmFwcC51c2UoY29va2llcGFyc2VyKCkpO1xyXG5hcHAudXNlKFwiL2FwaVwiLCBib2R5cGFyc2VyLmpzb24oKSk7XHJcblxyXG5hcHAudXNlKFwiL2FwaVwiLCBhdXRoZW50aWNhdGlvblJvdXRlcik7XHJcbmFwcC51c2UoXCIvYXBpL3Byb2R1Y3RzXCIsIHByb2R1Y3RSb3V0ZSk7XHJcbmFwcC51c2UoXCIvYXBpL3Nob3BzXCIsIHdlYlNob3BSb3V0ZSk7XHJcblxyXG5cclxuYXBwLnVzZShcIi9cIiwgZXhwcmVzcy5zdGF0aWMoXCIuL291dC9jbGllbnRcIikpO1xyXG5cclxuYXBwLnVzZShcIi9cIiwgZnVuY3Rpb24gKHJlcSwgcmVzKSB7XHJcbiAgICByZXMuc2VuZGZpbGUoXCIuL291dC9jbGllbnRcIiArICcvaW5kZXguaHRtbCcpO1xyXG59KTtcclxuXHJcbmNvbnN0IHBvcnQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IGNvbmZpZy5mYWxsYmFja1BvcnQ7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcnVuKCkge1xyXG4gICAgY29uc3Qgc2VydmVyID0gaHR0cC5jcmVhdGVTZXJ2ZXIoYXBwKTtcclxuXHJcbiAgICBzZXJ2ZXIubGlzdGVuKHBvcnQsICgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmluZm8oYFdlYiBzZXJ2ZXIgc3RhcnRlZCBhdCBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vYCk7XHJcbiAgICB9KTtcclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web-server.ts\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"http\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"http\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"body-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"body-parser\"\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = require(\"cookie-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"cookie-parser\"\n ** module id = 7\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"typings/index.d.ts\"/>\r\nvar fs = require(\"fs\");\r\nvar configContent = fs.readFileSync(\"./config.json\", \"utf8\");\r\nvar configuration = JSON.parse(configContent);\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = configuration;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29uZmlnLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwwQ0FBMEM7QUFDMUMsSUFBWSxFQUFFLFdBQU0sSUFBSSxDQUFDLENBQUE7QUFHekIsSUFBSSxhQUFhLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxlQUFlLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDN0QsSUFBSSxhQUFhLEdBQWtCLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7QUFFN0Q7a0JBQWUsYUFBYSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cInR5cGluZ3MvaW5kZXguZC50c1wiLz5cclxuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XHJcblxyXG5cclxubGV0IGNvbmZpZ0NvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoXCIuL2NvbmZpZy5qc29uXCIsIFwidXRmOFwiKTtcclxubGV0IGNvbmZpZ3VyYXRpb24gPSA8Q29uZmlndXJhdGlvbj5KU09OLnBhcnNlKGNvbmZpZ0NvbnRlbnQpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY29uZmlndXJhdGlvbjsiXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/config.ts\n ** module id = 8\n ** module chunks = 0\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 9\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"../../typings/index.d.ts\" />\r\nvar express = require(\"express\");\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar mongo_authentication_token_storage_1 = require(\"../../services/authentication/mongo-authentication-token-storage\");\r\nvar authentication_token_provider_1 = require(\"../../services/authentication/authentication-token-provider\");\r\nvar mongo_user_account_storage_1 = require(\"../../services/users/mongo-user-account-storage\");\r\nvar user_account_service_1 = require(\"../../services/users/user-account-service\");\r\nvar authentication_middleware_1 = require(\"../../web/authentication-middleware\");\r\nvar db = new db_1.default();\r\nvar tokenStorage = new mongo_authentication_token_storage_1.default(db);\r\nvar tokenProvider = new authentication_token_provider_1.default(tokenStorage);\r\nvar authenticationMiddleware = new authentication_middleware_1.default(tokenProvider);\r\nvar userAccountService = new user_account_service_1.default(new mongo_user_account_storage_1.default(db));\r\nvar router = express.Router();\r\nrouter.post(\"/login\", function (req, res) {\r\n    var info = req.body;\r\n    userAccountService.validateCredentials(info.login, info.password)\r\n        .then(function () {\r\n        var result = {\r\n            ok: true,\r\n            error: \"\"\r\n        };\r\n        authenticationMiddleware.signIn(req, res, info.login)\r\n            .then(function () { return res.json(result).end(); });\r\n    })\r\n        .catch(function (error) {\r\n        var result = {\r\n            ok: false,\r\n            error: error\r\n        };\r\n        res.json(result).end();\r\n    });\r\n});\r\nrouter.use(\"*\", function (res, req, next) { return authenticationMiddleware.run(res, req, next); });\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = router;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aGVudGljYXRpb24tcm91dGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhdXRoZW50aWNhdGlvbi1yb3V0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsaURBQWlEO0FBQ2pELElBQVksT0FBTyxXQUFNLFNBQVMsQ0FBQyxDQUFBO0FBRW5DLG1CQUFlLHNCQUFzQixDQUFDLENBQUE7QUFFdEMsbURBQTRDLGtFQUFrRSxDQUFDLENBQUE7QUFDL0csOENBQXdDLDZEQUE2RCxDQUFDLENBQUE7QUFFdEcsMkNBQW9DLGlEQUFpRCxDQUFDLENBQUE7QUFDdEYscUNBQStCLDJDQUEyQyxDQUFDLENBQUE7QUFFM0UsMENBQXFDLHFDQUFxQyxDQUFDLENBQUE7QUFFM0UsSUFBTSxFQUFFLEdBQUcsSUFBSSxZQUFFLEVBQUUsQ0FBQztBQUVwQixJQUFNLFlBQVksR0FBRyxJQUFJLDRDQUErQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQzdELElBQU0sYUFBYSxHQUFHLElBQUksdUNBQTJCLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDcEUsSUFBTSx3QkFBd0IsR0FBRyxJQUFJLG1DQUF3QixDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBRTdFLElBQU0sa0JBQWtCLEdBQUcsSUFBSSw4QkFBa0IsQ0FBQyxJQUFJLG9DQUF1QixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFFbkYsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBRWhDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUNwQixVQUFDLEdBQUcsRUFBRSxHQUFHO0lBQ0wsSUFBTSxJQUFJLEdBQWtDLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFFckQsa0JBQWtCLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDO1NBQzVELElBQUksQ0FBQztRQUNGLElBQU0sTUFBTSxHQUFnQztZQUN4QyxFQUFFLEVBQUUsSUFBSTtZQUNSLEtBQUssRUFBRSxFQUFFO1NBQ1osQ0FBQztRQUNGLHdCQUF3QixDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUM7YUFDaEQsSUFBSSxDQUFDLGNBQU0sT0FBQSxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUF0QixDQUFzQixDQUFDLENBQUM7SUFDNUMsQ0FBQyxDQUFDO1NBQ0QsS0FBSyxDQUFDLFVBQUEsS0FBSztRQUNSLElBQU0sTUFBTSxHQUFnQztZQUN4QyxFQUFFLEVBQUUsS0FBSztZQUNULEtBQUssRUFBRSxLQUFLO1NBQ2YsQ0FBQztRQUVGLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDM0IsQ0FBQyxDQUFDLENBQUM7QUFDWCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLFVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLElBQUssT0FBQSx3QkFBd0IsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBNUMsQ0FBNEMsQ0FBQyxDQUFDO0FBRWxGO2tCQUFlLE1BQU0sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxyXG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XHJcblxyXG5pbXBvcnQgRGIgZnJvbSBcIi4uLy4uL2RhdGEtYWNjZXNzL2RiXCI7XHJcblxyXG5pbXBvcnQgTW9uZ29BdXRoZW50aWNhdGlvblRva2VuU3RvcmFnZSBmcm9tIFwiLi4vLi4vc2VydmljZXMvYXV0aGVudGljYXRpb24vbW9uZ28tYXV0aGVudGljYXRpb24tdG9rZW4tc3RvcmFnZVwiO1xyXG5pbXBvcnQgQXV0aGVudGljYXRpb25Ub2tlblByb3ZpZGVyIGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9hdXRoZW50aWNhdGlvbi9hdXRoZW50aWNhdGlvbi10b2tlbi1wcm92aWRlclwiO1xyXG5cclxuaW1wb3J0IE1vbmdvVXNlckFjY291bnRTdG9yYWdlIGZyb20gXCIuLi8uLi9zZXJ2aWNlcy91c2Vycy9tb25nby11c2VyLWFjY291bnQtc3RvcmFnZVwiO1xyXG5pbXBvcnQgVXNlckFjY291bnRTZXJ2aWNlIGZyb20gXCIuLi8uLi9zZXJ2aWNlcy91c2Vycy91c2VyLWFjY291bnQtc2VydmljZVwiO1xyXG5cclxuaW1wb3J0IEF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZSBmcm9tIFwiLi4vLi4vd2ViL2F1dGhlbnRpY2F0aW9uLW1pZGRsZXdhcmVcIjtcclxuXHJcbmNvbnN0IGRiID0gbmV3IERiKCk7XHJcblxyXG5jb25zdCB0b2tlblN0b3JhZ2UgPSBuZXcgTW9uZ29BdXRoZW50aWNhdGlvblRva2VuU3RvcmFnZShkYik7XHJcbmNvbnN0IHRva2VuUHJvdmlkZXIgPSBuZXcgQXV0aGVudGljYXRpb25Ub2tlblByb3ZpZGVyKHRva2VuU3RvcmFnZSk7XHJcbmNvbnN0IGF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZSA9IG5ldyBBdXRoZW50aWNhdGlvbk1pZGRsZXdhcmUodG9rZW5Qcm92aWRlcik7XHJcblxyXG5jb25zdCB1c2VyQWNjb3VudFNlcnZpY2UgPSBuZXcgVXNlckFjY291bnRTZXJ2aWNlKG5ldyBNb25nb1VzZXJBY2NvdW50U3RvcmFnZShkYikpO1xyXG5cclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuXHJcbnJvdXRlci5wb3N0KFwiL2xvZ2luXCIsXHJcbihyZXEsIHJlcykgPT4ge1xyXG4gICAgY29uc3QgaW5mbzogQXBpLkF1dGhlbnRpY2F0aW9uQ3JlZGVudGlhbHMgPSByZXEuYm9keTtcclxuXHJcbiAgICB1c2VyQWNjb3VudFNlcnZpY2UudmFsaWRhdGVDcmVkZW50aWFscyhpbmZvLmxvZ2luLCBpbmZvLnBhc3N3b3JkKVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0OiBBcGkuSUF1dGhlbnRpY2F0aW9uUmVzcG9uc2UgPSB7XHJcbiAgICAgICAgICAgICAgICBvazogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGVycm9yOiBcIlwiXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZS5zaWduSW4ocmVxLCByZXMsIGluZm8ubG9naW4pXHJcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiByZXMuanNvbihyZXN1bHQpLmVuZCgpKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogQXBpLklBdXRoZW50aWNhdGlvblJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgICAgICAgb2s6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXMuanNvbihyZXN1bHQpLmVuZCgpO1xyXG4gICAgICAgIH0pO1xyXG59KTtcclxuXHJcbnJvdXRlci51c2UoXCIqXCIsIChyZXMsIHJlcSwgbmV4dCkgPT4gYXV0aGVudGljYXRpb25NaWRkbGV3YXJlLnJ1bihyZXMsIHJlcSwgbmV4dCkpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcm91dGVyOyJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web/routes/authentication-route.ts\n ** module id = 10\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"../typings/index.d.ts\" />\r\nvar mongo = require(\"mongodb\");\r\nvar config_1 = require(\"../config\");\r\nvar db = new Promise(function (resolve, reject) {\r\n    mongo.MongoClient.connect(config_1.default.mongoUrl, function (err, db) {\r\n        if (err) {\r\n            reject(err);\r\n        }\r\n        else {\r\n            console.info(\"Connected to Mongo server at \" + config_1.default.mongoUrl);\r\n            resolve(db);\r\n        }\r\n    });\r\n});\r\nvar Database = (function () {\r\n    function Database() {\r\n    }\r\n    Database.prototype.collection = function (collection) {\r\n        if (!collection)\r\n            throw new Error(\"collection is undefined\");\r\n        if (!Database.Collections[collection])\r\n            throw new Error(\"Collection \" + collection + \" is unknown\");\r\n        return this.connect()\r\n            .then(function (db) { return db.collection(collection); });\r\n    };\r\n    Database.prototype.connect = function () {\r\n        return db;\r\n    };\r\n    Database.Collections = {\r\n        sessions: \"sessions\",\r\n        webshops: \"webshops\",\r\n        products: \"products\",\r\n        users: \"users\"\r\n    };\r\n    return Database;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = Database;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsOENBQThDO0FBQzlDLElBQVksS0FBSyxXQUFNLFNBQVMsQ0FBQyxDQUFBO0FBQ2pDLHVCQUFtQixXQUFXLENBQUMsQ0FBQTtBQUUvQixJQUFJLEVBQUUsR0FBc0IsSUFBSSxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsTUFBTTtJQUNwRCxLQUFLLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxnQkFBTSxDQUFDLFFBQVEsRUFDekMsVUFBQyxHQUFHLEVBQUUsRUFBRTtRQUNKLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDTixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ0osT0FBTyxDQUFDLElBQUksQ0FBQyxrQ0FBZ0MsZ0JBQU0sQ0FBQyxRQUFVLENBQUMsQ0FBQztZQUNoRSxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDaEIsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUM7QUFFSDtJQUFBO0lBcUJBLENBQUM7SUFiRyw2QkFBVSxHQUFWLFVBQVcsVUFBa0I7UUFDekIsRUFBRSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUM7WUFDWixNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFDL0MsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0JBQWMsVUFBVSxnQkFBYSxDQUFDLENBQUM7UUFFM0QsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7YUFDaEIsSUFBSSxDQUFDLFVBQUEsRUFBRSxJQUFJLE9BQUEsRUFBRSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFBekIsQ0FBeUIsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFTywwQkFBTyxHQUFmO1FBQ0ksTUFBTSxDQUFDLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFuQk0sb0JBQVcsR0FBRztRQUNqQixRQUFRLEVBQUUsVUFBVTtRQUNwQixRQUFRLEVBQUUsVUFBVTtRQUNwQixRQUFRLEVBQUUsVUFBVTtRQUNwQixLQUFLLEVBQUUsT0FBTztLQUNqQixDQUFDO0lBZU4sZUFBQztBQUFELENBQUMsQUFyQkQsSUFxQkM7QUFyQkQ7MEJBcUJDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuaW1wb3J0ICogYXMgbW9uZ28gZnJvbSBcIm1vbmdvZGJcIjtcclxuaW1wb3J0IGNvbmZpZyBmcm9tIFwiLi4vY29uZmlnXCI7XHJcblxyXG5sZXQgZGI6IFByb21pc2U8bW9uZ28uRGI+ID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgbW9uZ28uTW9uZ29DbGllbnQuY29ubmVjdChjb25maWcubW9uZ29VcmwsXHJcbiAgICAoZXJyLCBkYikgPT4ge1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5pbmZvKGBDb25uZWN0ZWQgdG8gTW9uZ28gc2VydmVyIGF0ICR7Y29uZmlnLm1vbmdvVXJsfWApO1xyXG4gICAgICAgICAgICByZXNvbHZlKGRiKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEYXRhYmFzZSB7XHJcbiAgICBzdGF0aWMgQ29sbGVjdGlvbnMgPSB7XHJcbiAgICAgICAgc2Vzc2lvbnM6IFwic2Vzc2lvbnNcIixcclxuICAgICAgICB3ZWJzaG9wczogXCJ3ZWJzaG9wc1wiLFxyXG4gICAgICAgIHByb2R1Y3RzOiBcInByb2R1Y3RzXCIsXHJcbiAgICAgICAgdXNlcnM6IFwidXNlcnNcIlxyXG4gICAgfTtcclxuXHJcbiAgICBjb2xsZWN0aW9uKGNvbGxlY3Rpb246IHN0cmluZyk6IFByb21pc2U8bW9uZ28uQ29sbGVjdGlvbj4ge1xyXG4gICAgICAgIGlmICghY29sbGVjdGlvbilcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY29sbGVjdGlvbiBpcyB1bmRlZmluZWRcIik7XHJcbiAgICAgICAgaWYgKCFEYXRhYmFzZS5Db2xsZWN0aW9uc1tjb2xsZWN0aW9uXSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb2xsZWN0aW9uICR7Y29sbGVjdGlvbn0gaXMgdW5rbm93bmApO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0KClcclxuICAgICAgICAgICAgLnRoZW4oZGIgPT4gZGIuY29sbGVjdGlvbihjb2xsZWN0aW9uKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjb25uZWN0KCk6IFByb21pc2U8bW9uZ28uRGI+IHtcclxuICAgICAgICByZXR1cm4gZGI7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/data-access/db.ts\n ** module id = 11\n ** module chunks = 0\n **/","module.exports = require(\"mongodb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongodb\"\n ** module id = 12\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar MongoAuthenticationTokenStorage = (function () {\r\n    function MongoAuthenticationTokenStorage(db) {\r\n        this.db = db;\r\n        if (!db)\r\n            throw new Error(\"db is undefined\");\r\n    }\r\n    MongoAuthenticationTokenStorage.prototype.find = function (authenticationToken) {\r\n        if (!authenticationToken)\r\n            throw new Error(\"authenticationToken is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.sessions)\r\n            .then(function (c) { return new Promise(function (resolve, reject) {\r\n            c.find({ token: authenticationToken }, { _id: 0 })\r\n                .limit(1)\r\n                .next(function (err, doc) {\r\n                if (err)\r\n                    reject(err);\r\n                else\r\n                    resolve(doc);\r\n            });\r\n        }); });\r\n    };\r\n    MongoAuthenticationTokenStorage.prototype.save = function (authenticationInfo) {\r\n        if (!authenticationInfo)\r\n            throw new Error(\"authenticationInfo is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.sessions)\r\n            .then(function (c) { return c.updateOne({\r\n            token: authenticationInfo.token\r\n        }, authenticationInfo, {\r\n            upsert: true\r\n        }); })\r\n            .then(function () { return authenticationInfo; });\r\n    };\r\n    MongoAuthenticationTokenStorage.prototype.remove = function (authenticationToken) {\r\n        if (!authenticationToken)\r\n            throw new Error(\"authenticationToken is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.sessions)\r\n            .then(function (c) { return c.deleteOne({ token: authenticationToken }); });\r\n    };\r\n    return MongoAuthenticationTokenStorage;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = MongoAuthenticationTokenStorage;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uZ28tYXV0aGVudGljYXRpb24tdG9rZW4tc3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1vbmdvLWF1dGhlbnRpY2F0aW9uLXRva2VuLXN0b3JhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsaURBQWlEOztBQUVqRCxtQkFBcUIsc0JBQXNCLENBQUMsQ0FBQTtBQUU1QztJQUVJLHlDQUFvQixFQUFZO1FBQVosT0FBRSxHQUFGLEVBQUUsQ0FBVTtRQUM1QixFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNKLE1BQU0sSUFBSSxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQsOENBQUksR0FBSixVQUFLLG1CQUEyQjtRQUM1QixFQUFFLENBQUMsQ0FBQyxDQUFDLG1CQUFtQixDQUFDO1lBQ3JCLE1BQU0sSUFBSSxLQUFLLENBQUMsa0NBQWtDLENBQUMsQ0FBQztRQUV4RCxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7YUFDVCxVQUFVLENBQUMsWUFBUSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUM7YUFDekMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsSUFBSSxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsTUFBTTtZQUNuQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLG1CQUFtQixFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUM7aUJBQzdDLEtBQUssQ0FBQyxDQUFDLENBQUM7aUJBQ1IsSUFBSSxDQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7Z0JBQ1gsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO29CQUNKLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDaEIsSUFBSTtvQkFDQSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDckIsQ0FBQyxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUMsRUFUUyxDQVNULENBQUMsQ0FBQztJQUNaLENBQUM7SUFFRCw4Q0FBSSxHQUFKLFVBQUssa0JBQXFEO1FBQ3RELEVBQUUsQ0FBQyxDQUFDLENBQUMsa0JBQWtCLENBQUM7WUFDcEIsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1FBRXZELE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTthQUNULFVBQVUsQ0FBQyxZQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQzthQUN6QyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsU0FBUyxDQUNsQjtZQUNJLEtBQUssRUFBRSxrQkFBa0IsQ0FBQyxLQUFLO1NBQ2xDLEVBQ0Qsa0JBQWtCLEVBQ2xCO1lBQ0ksTUFBTSxFQUFFLElBQUk7U0FDZixDQUFDLEVBUEssQ0FPTCxDQUFDO2FBQ04sSUFBSSxDQUFDLGNBQU0sT0FBQSxrQkFBa0IsRUFBbEIsQ0FBa0IsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFRCxnREFBTSxHQUFOLFVBQU8sbUJBQTJCO1FBQzlCLEVBQUUsQ0FBQyxDQUFDLENBQUMsbUJBQW1CLENBQUM7WUFDckIsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBRXhELE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTthQUNULFVBQVUsQ0FBQyxZQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQzthQUN6QyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxFQUFFLG1CQUFtQixFQUFFLENBQUMsRUFBM0MsQ0FBMkMsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUFDTCxzQ0FBQztBQUFELENBQUMsQUFsREQsSUFrREM7QUFsREQ7aURBa0RDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCBEYXRhYmFzZSBmcm9tIFwiLi4vLi4vZGF0YS1hY2Nlc3MvZGJcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vbmdvQXV0aGVudGljYXRpb25Ub2tlblN0b3JhZ2UgaW1wbGVtZW50cyBBdXRoZW50aWNhdGlvbi5JQXV0aGVudGljYXRpb25Ub2tlblN0b3JhZ2Uge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZGI6IERhdGFiYXNlKSB7XHJcbiAgICAgICAgaWYgKCFkYilcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZGIgaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmQoYXV0aGVudGljYXRpb25Ub2tlbjogc3RyaW5nKTogUHJvbWlzZTxBdXRoZW50aWNhdGlvbi5BdXRoZW50aWNhdGlvbkluZm8+IHtcclxuICAgICAgICBpZiAoIWF1dGhlbnRpY2F0aW9uVG9rZW4pXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImF1dGhlbnRpY2F0aW9uVG9rZW4gaXMgdW5kZWZpbmVkXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5kYlxyXG4gICAgICAgICAgICAuY29sbGVjdGlvbihEYXRhYmFzZS5Db2xsZWN0aW9ucy5zZXNzaW9ucylcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjLmZpbmQoeyB0b2tlbjogYXV0aGVudGljYXRpb25Ub2tlbiB9LCB7IF9pZDogMCB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5saW1pdCgxKVxyXG4gICAgICAgICAgICAgICAgICAgIC5uZXh0KChlcnIsIGRvYykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZG9jKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNhdmUoYXV0aGVudGljYXRpb25JbmZvOiBBdXRoZW50aWNhdGlvbi5BdXRoZW50aWNhdGlvbkluZm8pOiBQcm9taXNlPEF1dGhlbnRpY2F0aW9uLkF1dGhlbnRpY2F0aW9uSW5mbz4ge1xyXG4gICAgICAgIGlmICghYXV0aGVudGljYXRpb25JbmZvKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJhdXRoZW50aWNhdGlvbkluZm8gaXMgdW5kZWZpbmVkXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5kYlxyXG4gICAgICAgICAgICAuY29sbGVjdGlvbihEYXRhYmFzZS5Db2xsZWN0aW9ucy5zZXNzaW9ucylcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLnVwZGF0ZU9uZShcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0b2tlbjogYXV0aGVudGljYXRpb25JbmZvLnRva2VuXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgYXV0aGVudGljYXRpb25JbmZvLFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwc2VydDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IGF1dGhlbnRpY2F0aW9uSW5mbyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlKGF1dGhlbnRpY2F0aW9uVG9rZW46IHN0cmluZyk6IFByb21pc2U8YW55PiB7XHJcbiAgICAgICAgaWYgKCFhdXRoZW50aWNhdGlvblRva2VuKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJhdXRoZW50aWNhdGlvblRva2VuIGlzIHVuZGVmaW5lZFwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGJcclxuICAgICAgICAgICAgLmNvbGxlY3Rpb24oRGF0YWJhc2UuQ29sbGVjdGlvbnMuc2Vzc2lvbnMpXHJcbiAgICAgICAgICAgIC50aGVuKGMgPT4gYy5kZWxldGVPbmUoeyB0b2tlbjogYXV0aGVudGljYXRpb25Ub2tlbiB9KSk7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/authentication/mongo-authentication-token-storage.ts\n ** module id = 13\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"../../typings/index.d.ts\" />\r\nvar uuid = require(\"node-uuid\");\r\nvar moment = require(\"moment\");\r\nvar AuthenticationTokenProvider = (function () {\r\n    function AuthenticationTokenProvider(storage) {\r\n        this.storage = storage;\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n    AuthenticationTokenProvider.prototype.validate = function (authenticationToken) {\r\n        var _this = this;\r\n        if (!authenticationToken)\r\n            return Promise.reject(null);\r\n        return new Promise(function (resolve, reject) {\r\n            _this.storage\r\n                .find(authenticationToken)\r\n                .then(function (info) {\r\n                var now = moment.utc().toDate();\r\n                if (info.expiresAt < now)\r\n                    _this.storage\r\n                        .remove(authenticationToken)\r\n                        .then(function () { return reject(\"Token is expired\"); })\r\n                        .catch(function (err) { return reject(err); });\r\n                else\r\n                    resolve(info);\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n    };\r\n    AuthenticationTokenProvider.prototype.generate = function (userId) {\r\n        if (!userId)\r\n            throw new Error(\"userId is undefined\");\r\n        var info = {\r\n            userId: userId,\r\n            token: uuid.v1(),\r\n            expiresAt: moment.utc().add(moment.duration(5, \"day\")).toDate()\r\n        };\r\n        return this.storage\r\n            .save(info);\r\n    };\r\n    return AuthenticationTokenProvider;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = AuthenticationTokenProvider;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aGVudGljYXRpb24tdG9rZW4tcHJvdmlkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhdXRoZW50aWNhdGlvbi10b2tlbi1wcm92aWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsaURBQWlEO0FBQ2pELElBQVksSUFBSSxXQUFNLFdBQVcsQ0FBQyxDQUFBO0FBQ2xDLElBQVksTUFBTSxXQUFNLFFBQVEsQ0FBQyxDQUFBO0FBRWpDO0lBRUkscUNBQW9CLE9BQW1EO1FBQW5ELFlBQU8sR0FBUCxPQUFPLENBQTRDO1FBQ25FLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCw4Q0FBUSxHQUFSLFVBQVMsbUJBQTJCO1FBQXBDLGlCQW9CQztRQW5CRyxFQUFFLENBQUMsQ0FBQyxDQUFDLG1CQUFtQixDQUFDO1lBQ3JCLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRWhDLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBb0MsVUFBQyxPQUFPLEVBQUUsTUFBTTtZQUNsRSxLQUFJLENBQUMsT0FBTztpQkFDUCxJQUFJLENBQUMsbUJBQW1CLENBQUM7aUJBQ3pCLElBQUksQ0FBQyxVQUFBLElBQUk7Z0JBQ04sSUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUVsQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztvQkFDckIsS0FBSSxDQUFDLE9BQU87eUJBQ1AsTUFBTSxDQUFDLG1CQUFtQixDQUFDO3lCQUMzQixJQUFJLENBQUMsY0FBTSxPQUFBLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxFQUExQixDQUEwQixDQUFDO3lCQUN0QyxLQUFLLENBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQVgsQ0FBVyxDQUFDLENBQUM7Z0JBQ25DLElBQUk7b0JBQ0EsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RCLENBQUMsQ0FBQztpQkFDRCxLQUFLLENBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQVgsQ0FBVyxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsOENBQVEsR0FBUixVQUFTLE1BQWM7UUFDbkIsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDUixNQUFNLElBQUksS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFFM0MsSUFBTSxJQUFJLEdBQXNDO1lBQzVDLE1BQU0sRUFBRSxNQUFNO1lBQ2QsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDaEIsU0FBUyxFQUFFLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUU7U0FDbEUsQ0FBQztRQUVGLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTzthQUNkLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBQ0wsa0NBQUM7QUFBRCxDQUFDLEFBMUNELElBMENDO0FBMUNEOzZDQTBDQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XHJcbmltcG9ydCAqIGFzIHV1aWQgZnJvbSBcIm5vZGUtdXVpZFwiO1xyXG5pbXBvcnQgKiBhcyBtb21lbnQgZnJvbSBcIm1vbWVudFwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXV0aGVudGljYXRpb25Ub2tlblByb3ZpZGVyIGltcGxlbWVudHMgQXV0aGVudGljYXRpb24uSUF1dGhlbnRpY2F0aW9uVG9rZW5Qcm92aWRlciB7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzdG9yYWdlOiBBdXRoZW50aWNhdGlvbi5JQXV0aGVudGljYXRpb25Ub2tlblN0b3JhZ2UpIHtcclxuICAgICAgICBpZiAoIXN0b3JhZ2UpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInN0b3JhZ2UgaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlKGF1dGhlbnRpY2F0aW9uVG9rZW46IHN0cmluZyk6IFByb21pc2U8QXV0aGVudGljYXRpb24uQXV0aGVudGljYXRpb25JbmZvPiB7XHJcbiAgICAgICAgaWYgKCFhdXRoZW50aWNhdGlvblRva2VuKVxyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobnVsbCk7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxBdXRoZW50aWNhdGlvbi5BdXRoZW50aWNhdGlvbkluZm8+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zdG9yYWdlXHJcbiAgICAgICAgICAgICAgICAuZmluZChhdXRoZW50aWNhdGlvblRva2VuKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oaW5mbyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm93ID0gbW9tZW50LnV0YygpLnRvRGF0ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5mby5leHBpcmVzQXQgPCBub3cpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmFnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZShhdXRoZW50aWNhdGlvblRva2VuKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gcmVqZWN0KFwiVG9rZW4gaXMgZXhwaXJlZFwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gcmVqZWN0KGVycikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpbmZvKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IHJlamVjdChlcnIpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZW5lcmF0ZSh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8QXV0aGVudGljYXRpb24uQXV0aGVudGljYXRpb25JbmZvPiB7XHJcbiAgICAgICAgaWYgKCF1c2VySWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInVzZXJJZCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIGNvbnN0IGluZm86IEF1dGhlbnRpY2F0aW9uLkF1dGhlbnRpY2F0aW9uSW5mbyA9IHtcclxuICAgICAgICAgICAgdXNlcklkOiB1c2VySWQsXHJcbiAgICAgICAgICAgIHRva2VuOiB1dWlkLnYxKCksXHJcbiAgICAgICAgICAgIGV4cGlyZXNBdDogbW9tZW50LnV0YygpLmFkZChtb21lbnQuZHVyYXRpb24oNSwgXCJkYXlcIikpLnRvRGF0ZSgpXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZVxyXG4gICAgICAgICAgICAuc2F2ZShpbmZvKTtcclxuICAgIH1cclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/authentication/authentication-token-provider.ts\n ** module id = 14\n ** module chunks = 0\n **/","module.exports = require(\"node-uuid\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-uuid\"\n ** module id = 15\n ** module chunks = 0\n **/","module.exports = require(\"moment\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"moment\"\n ** module id = 16\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar MongoUserAccountStorage = (function () {\r\n    function MongoUserAccountStorage(db) {\r\n        this.db = db;\r\n        if (!db)\r\n            throw new Error(\"db is undefined\");\r\n    }\r\n    MongoUserAccountStorage.prototype.findByUserName = function (userName) {\r\n        if (!userName)\r\n            throw new Error(\"userName is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.users)\r\n            .then(function (c) { return c.find({ userName: userName }, { _id: 0 }); })\r\n            .then(function (r) { return r.limit(1); })\r\n            .then(function (c) { return c.next(); });\r\n    };\r\n    return MongoUserAccountStorage;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = MongoUserAccountStorage;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uZ28tdXNlci1hY2NvdW50LXN0b3JhZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJtb25nby11c2VyLWFjY291bnQtc3RvcmFnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnREFBZ0Q7O0FBRWhELG1CQUFxQixzQkFBc0IsQ0FBQyxDQUFBO0FBRTVDO0lBQ0ksaUNBQW9CLEVBQVk7UUFBWixPQUFFLEdBQUYsRUFBRSxDQUFVO1FBQzVCLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ0osTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxnREFBYyxHQUFkLFVBQWUsUUFBZ0I7UUFDM0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7WUFDVixNQUFNLElBQUksS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFFN0MsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO2FBQ1QsVUFBVSxDQUFDLFlBQVEsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDO2FBQ3RDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBMUMsQ0FBMEMsQ0FBQzthQUNyRCxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFWLENBQVUsQ0FBQzthQUNyQixJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQVIsQ0FBUSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNMLDhCQUFDO0FBQUQsQ0FBQyxBQWhCRCxJQWdCQztBQWhCRDt5Q0FnQkMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcblxyXG5pbXBvcnQgRGF0YWJhc2UgZnJvbSBcIi4uLy4uL2RhdGEtYWNjZXNzL2RiXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb25nb1VzZXJBY2NvdW50U3RvcmFnZSBpbXBsZW1lbnRzIFVzZXJzLklVc2VyQWNjb3VudFN0b3JhZ2Uge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBkYjogRGF0YWJhc2UpIHtcclxuICAgICAgICBpZiAoIWRiKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJkYiBpcyB1bmRlZmluZWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZEJ5VXNlck5hbWUodXNlck5hbWU6IHN0cmluZyk6IFByb21pc2U8VXNlcnMuVXNlckFjY291bnQ+IHtcclxuICAgICAgICBpZiAoIXVzZXJOYW1lKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1c2VyTmFtZSBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmRiXHJcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKERhdGFiYXNlLkNvbGxlY3Rpb25zLnVzZXJzKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMuZmluZCh7IHVzZXJOYW1lOiB1c2VyTmFtZSB9LCB7IF9pZDogMCB9KSlcclxuICAgICAgICAgICAgLnRoZW4ociA9PiByLmxpbWl0KDEpKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMubmV4dCgpKTtcclxuICAgIH1cclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/users/mongo-user-account-storage.ts\n ** module id = 17\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar UserAccountService = (function () {\r\n    function UserAccountService(userAccountStorage) {\r\n        this.userAccountStorage = userAccountStorage;\r\n        if (!userAccountStorage)\r\n            throw new Error(\"userAccountStorage is undefined\");\r\n    }\r\n    UserAccountService.prototype.validateCredentials = function (userName, password) {\r\n        var _this = this;\r\n        if (!userName || !password)\r\n            return Promise.reject(\"Login and password required.\");\r\n        return new Promise(function (resolve, reject) {\r\n            _this.userAccountStorage\r\n                .findByUserName(userName)\r\n                .then(function (user) {\r\n                if (user != null && user.isActive && user.password === password)\r\n                    resolve(true);\r\n                else\r\n                    reject(\"User credentials is not valid.\");\r\n            });\r\n        });\r\n    };\r\n    return UserAccountService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = UserAccountService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1hY2NvdW50LXNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1c2VyLWFjY291bnQtc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpREFBaUQ7O0FBRWpEO0lBQ0ksNEJBQW9CLGtCQUE2QztRQUE3Qyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQTJCO1FBQzdELEVBQUUsQ0FBQyxDQUFDLENBQUMsa0JBQWtCLENBQUM7WUFDcEIsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFFRCxnREFBbUIsR0FBbkIsVUFBb0IsUUFBZ0IsRUFBRSxRQUFnQjtRQUF0RCxpQkFlQztRQWRHLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxJQUFJLENBQUMsUUFBUSxDQUFDO1lBQ3ZCLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLDhCQUE4QixDQUFDLENBQUM7UUFHMUQsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFDLFVBQUMsT0FBTyxFQUFFLE1BQU07WUFDL0IsS0FBSSxDQUFDLGtCQUFrQjtpQkFDbEIsY0FBYyxDQUFDLFFBQVEsQ0FBQztpQkFDeEIsSUFBSSxDQUFDLFVBQUEsSUFBSTtnQkFDTixFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxRQUFRLENBQUM7b0JBQzVELE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDbEIsSUFBSTtvQkFDQSxNQUFNLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztZQUNqRCxDQUFDLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNMLHlCQUFDO0FBQUQsQ0FBQyxBQXRCRCxJQXNCQztBQXRCRDtvQ0FzQkMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckFjY291bnRTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdXNlckFjY291bnRTdG9yYWdlOiBVc2Vycy5JVXNlckFjY291bnRTdG9yYWdlKSB7XHJcbiAgICAgICAgaWYgKCF1c2VyQWNjb3VudFN0b3JhZ2UpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInVzZXJBY2NvdW50U3RvcmFnZSBpcyB1bmRlZmluZWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGVDcmVkZW50aWFscyh1c2VyTmFtZTogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICBpZiAoIXVzZXJOYW1lIHx8ICFwYXNzd29yZClcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KFwiTG9naW4gYW5kIHBhc3N3b3JkIHJlcXVpcmVkLlwiKTtcclxuXHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudXNlckFjY291bnRTdG9yYWdlXHJcbiAgICAgICAgICAgICAgICAuZmluZEJ5VXNlck5hbWUodXNlck5hbWUpXHJcbiAgICAgICAgICAgICAgICAudGhlbih1c2VyID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodXNlciAhPSBudWxsICYmIHVzZXIuaXNBY3RpdmUgJiYgdXNlci5wYXNzd29yZCA9PT0gcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJVc2VyIGNyZWRlbnRpYWxzIGlzIG5vdCB2YWxpZC5cIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/users/user-account-service.ts\n ** module id = 18\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar AuthenticationMiddleware = (function () {\r\n    function AuthenticationMiddleware(authenticationTokenProvider) {\r\n        this.authenticationTokenProvider = authenticationTokenProvider;\r\n        if (!authenticationTokenProvider)\r\n            throw new Error(\"authenticationTokenProvider is undefined\");\r\n    }\r\n    /**\r\n     * Request handler which checks authentication and setups the request.user.\r\n     * If request is not authenticated the 401 Not authorized status will be returned to the client.\r\n     */\r\n    AuthenticationMiddleware.prototype.run = function (request, response, next) {\r\n        var authenticationToken = (request.cookies || {})[AuthenticationMiddleware.authenticationCookieName];\r\n        this.authenticationTokenProvider\r\n            .validate(authenticationToken)\r\n            .then(function (user) {\r\n            request.user = user;\r\n            next();\r\n        })\r\n            .catch(function () { return response.sendStatus(401).end(); });\r\n    };\r\n    /**\r\n     * Adds authentication cookie to response.\r\n     */\r\n    AuthenticationMiddleware.prototype.signIn = function (request, response, userId) {\r\n        if (!response)\r\n            throw new Error(\"response is undefined\");\r\n        if (!userId)\r\n            throw new Error(\"userId is undefined\");\r\n        return this.authenticationTokenProvider\r\n            .generate(userId)\r\n            .then(function (info) {\r\n            response.cookie(AuthenticationMiddleware.authenticationCookieName, info.token, {\r\n                httpOnly: true,\r\n                expires: info.expiresAt\r\n            });\r\n        });\r\n    };\r\n    AuthenticationMiddleware.authenticationCookieName = \"auth\";\r\n    return AuthenticationMiddleware;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = AuthenticationMiddleware;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aGVudGljYXRpb24tbWlkZGxld2FyZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0aW9uLW1pZGRsZXdhcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOENBQThDOztBQUk5QztJQUdJLGtDQUFvQiwyQkFBd0U7UUFBeEUsZ0NBQTJCLEdBQTNCLDJCQUEyQixDQUE2QztRQUN4RixFQUFFLENBQUMsQ0FBQyxDQUFDLDJCQUEyQixDQUFDO1lBQzdCLE1BQU0sSUFBSSxLQUFLLENBQUMsMENBQTBDLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0gsc0NBQUcsR0FBSCxVQUFJLE9BQXdCLEVBQUUsUUFBMEIsRUFBRSxJQUEwQjtRQUNoRixJQUFNLG1CQUFtQixHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUMsQ0FBQyx3QkFBd0IsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBRXZHLElBQUksQ0FBQywyQkFBMkI7YUFDM0IsUUFBUSxDQUFDLG1CQUFtQixDQUFDO2FBQzdCLElBQUksQ0FBQyxVQUFBLElBQUk7WUFDTixPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztZQUNwQixJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQzthQUNELEtBQUssQ0FBQyxjQUFNLE9BQUEsUUFBUSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBOUIsQ0FBOEIsQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFFRDs7T0FFRztJQUNILHlDQUFNLEdBQU4sVUFBTyxPQUF3QixFQUFFLFFBQTBCLEVBQUUsTUFBYztRQUN2RSxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztZQUNWLE1BQU0sSUFBSSxLQUFLLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUM3QyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUNSLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUUzQyxNQUFNLENBQUMsSUFBSSxDQUFDLDJCQUEyQjthQUNsQyxRQUFRLENBQUMsTUFBTSxDQUFDO2FBQ2hCLElBQUksQ0FBQyxVQUFBLElBQUk7WUFDTixRQUFRLENBQUMsTUFBTSxDQUFDLHdCQUF3QixDQUFDLHdCQUF3QixFQUM3RCxJQUFJLENBQUMsS0FBSyxFQUFFO2dCQUNSLFFBQVEsRUFBRSxJQUFJO2dCQUNkLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUzthQUMxQixDQUFDLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUF4Q00saURBQXdCLEdBQUcsTUFBTSxDQUFDO0lBeUM3QywrQkFBQztBQUFELENBQUMsQUExQ0QsSUEwQ0M7QUExQ0Q7MENBMENDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZSB7XHJcbiAgICBzdGF0aWMgYXV0aGVudGljYXRpb25Db29raWVOYW1lID0gXCJhdXRoXCI7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhdXRoZW50aWNhdGlvblRva2VuUHJvdmlkZXI6IEF1dGhlbnRpY2F0aW9uLklBdXRoZW50aWNhdGlvblRva2VuUHJvdmlkZXIpIHtcclxuICAgICAgICBpZiAoIWF1dGhlbnRpY2F0aW9uVG9rZW5Qcm92aWRlcilcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiYXV0aGVudGljYXRpb25Ub2tlblByb3ZpZGVyIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmVxdWVzdCBoYW5kbGVyIHdoaWNoIGNoZWNrcyBhdXRoZW50aWNhdGlvbiBhbmQgc2V0dXBzIHRoZSByZXF1ZXN0LnVzZXIuXHJcbiAgICAgKiBJZiByZXF1ZXN0IGlzIG5vdCBhdXRoZW50aWNhdGVkIHRoZSA0MDEgTm90IGF1dGhvcml6ZWQgc3RhdHVzIHdpbGwgYmUgcmV0dXJuZWQgdG8gdGhlIGNsaWVudC5cclxuICAgICAqL1xyXG4gICAgcnVuKHJlcXVlc3Q6IGV4cHJlc3MuUmVxdWVzdCwgcmVzcG9uc2U6IGV4cHJlc3MuUmVzcG9uc2UsIG5leHQ6IGV4cHJlc3MuTmV4dEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgY29uc3QgYXV0aGVudGljYXRpb25Ub2tlbiA9IChyZXF1ZXN0LmNvb2tpZXMgfHwge30pW0F1dGhlbnRpY2F0aW9uTWlkZGxld2FyZS5hdXRoZW50aWNhdGlvbkNvb2tpZU5hbWVdO1xyXG5cclxuICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uVG9rZW5Qcm92aWRlclxyXG4gICAgICAgICAgICAudmFsaWRhdGUoYXV0aGVudGljYXRpb25Ub2tlbilcclxuICAgICAgICAgICAgLnRoZW4odXNlciA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnVzZXIgPSB1c2VyO1xyXG4gICAgICAgICAgICAgICAgbmV4dCgpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goKCkgPT4gcmVzcG9uc2Uuc2VuZFN0YXR1cyg0MDEpLmVuZCgpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYXV0aGVudGljYXRpb24gY29va2llIHRvIHJlc3BvbnNlLlxyXG4gICAgICovXHJcbiAgICBzaWduSW4ocmVxdWVzdDogZXhwcmVzcy5SZXF1ZXN0LCByZXNwb25zZTogZXhwcmVzcy5SZXNwb25zZSwgdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgICAgIGlmICghcmVzcG9uc2UpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInJlc3BvbnNlIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoIXVzZXJJZClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidXNlcklkIGlzIHVuZGVmaW5lZFwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXV0aGVudGljYXRpb25Ub2tlblByb3ZpZGVyXHJcbiAgICAgICAgICAgIC5nZW5lcmF0ZSh1c2VySWQpXHJcbiAgICAgICAgICAgIC50aGVuKGluZm8gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuY29va2llKEF1dGhlbnRpY2F0aW9uTWlkZGxld2FyZS5hdXRoZW50aWNhdGlvbkNvb2tpZU5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5mby50b2tlbiwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBodHRwT25seTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJlczogaW5mby5leHBpcmVzQXRcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web/authentication-middleware.ts\n ** module id = 19\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar express = require(\"express\");\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar mongo_product_storage_1 = require(\"../../services/products/mongo-product-storage\");\r\nvar product_service_1 = require(\"../../services/products/product-service\");\r\nvar db = new db_1.default();\r\nvar productService = new product_service_1.default(new mongo_product_storage_1.default(db));\r\nvar router = express.Router();\r\nrouter.get(\"/:id\", function (req, res) {\r\n    var productId = (req.params || {})[\"id\"];\r\n    if (!productId) {\r\n        res.send(404, \"Not found\")\r\n            .end();\r\n        return;\r\n    }\r\n    productService.one(productId)\r\n        .then(function (product) { return res.json(product); })\r\n        .catch(function (err) { return res.send(404, \"Not found\").end(); });\r\n});\r\nrouter.get(\"/\", function (req, res) {\r\n    productService.all()\r\n        .then(function (products) { return res.json(products); })\r\n        .catch(function (err) { return res.send(500, err).end(); });\r\n});\r\nrouter.post(\"/\", function (request, response) {\r\n    var product = request.body;\r\n    productService.save(product)\r\n        .then(function (product) {\r\n        console.log(\"Product saved successfuly\");\r\n        var responseData = {\r\n            ok: true,\r\n            entity: product\r\n        };\r\n        response.json(responseData).end();\r\n    })\r\n        .catch(function (err) {\r\n        console.log(\"Product saving failed\");\r\n        var responseData = {\r\n            ok: false,\r\n            errors: err\r\n        };\r\n        response.json(responseData).end();\r\n    });\r\n});\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = router;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1yb3V0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInByb2R1Y3Qtcm91dGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsZ0RBQWdEOztBQUVoRCxJQUFZLE9BQU8sV0FBTSxTQUFTLENBQUMsQ0FBQTtBQUVuQyxtQkFBZSxzQkFBc0IsQ0FBQyxDQUFBO0FBQ3RDLHNDQUFnQywrQ0FBK0MsQ0FBQyxDQUFBO0FBQ2hGLGdDQUEyQix5Q0FBeUMsQ0FBQyxDQUFBO0FBRXJFLElBQU0sRUFBRSxHQUFHLElBQUksWUFBRSxFQUFFLENBQUM7QUFFcEIsSUFBTSxjQUFjLEdBQUcsSUFBSSx5QkFBYyxDQUFDLElBQUksK0JBQW1CLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUV2RSxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7QUFFaEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsVUFBQyxHQUFHLEVBQUUsR0FBRztJQUN4QixJQUFNLFNBQVMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFM0MsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ2IsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDO2FBQ3JCLEdBQUcsRUFBRSxDQUFDO1FBQ1gsTUFBTSxDQUFDO0lBQ1gsQ0FBQztJQUdELGNBQWMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDO1NBQ3hCLElBQUksQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQWpCLENBQWlCLENBQUM7U0FDbEMsS0FBSyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQWhDLENBQWdDLENBQUMsQ0FBQztBQUN4RCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLFVBQUMsR0FBRyxFQUFFLEdBQUc7SUFDckIsY0FBYyxDQUFDLEdBQUcsRUFBRTtTQUNmLElBQUksQ0FBQyxVQUFBLFFBQVEsSUFBSSxPQUFBLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQWxCLENBQWtCLENBQUM7U0FDcEMsS0FBSyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQXhCLENBQXdCLENBQUMsQ0FBQztBQUNoRCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFVBQUMsT0FBTyxFQUFFLFFBQVE7SUFDL0IsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztJQUU3QixjQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztTQUN2QixJQUFJLENBQUMsVUFBQSxPQUFPO1FBQ1QsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBRXpDLElBQU0sWUFBWSxHQUFtQztZQUNqRCxFQUFFLEVBQUUsSUFBSTtZQUNSLE1BQU0sRUFBRSxPQUFPO1NBQ2xCLENBQUM7UUFFRixRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ3RDLENBQUMsQ0FBQztTQUNELEtBQUssQ0FBQyxVQUFBLEdBQUc7UUFDTixPQUFPLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFFckMsSUFBTSxZQUFZLEdBQXNCO1lBQ3BDLEVBQUUsRUFBRSxLQUFLO1lBQ1QsTUFBTSxFQUFFLEdBQUc7U0FDZCxDQUFDO1FBRUYsUUFBUSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUN0QyxDQUFDLENBQUMsQ0FBQztBQUNYLENBQUMsQ0FBQyxDQUFDO0FBRUg7a0JBQWUsTUFBTSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cclxuXHJcbmltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcclxuXHJcbmltcG9ydCBEYiBmcm9tIFwiLi4vLi4vZGF0YS1hY2Nlc3MvZGJcIjtcclxuaW1wb3J0IE1vbmdvUHJvZHVjdFN0b3JhZ2UgZnJvbSBcIi4uLy4uL3NlcnZpY2VzL3Byb2R1Y3RzL21vbmdvLXByb2R1Y3Qtc3RvcmFnZVwiO1xyXG5pbXBvcnQgUHJvZHVjdFNlcnZpY2UgZnJvbSBcIi4uLy4uL3NlcnZpY2VzL3Byb2R1Y3RzL3Byb2R1Y3Qtc2VydmljZVwiO1xyXG5cclxuY29uc3QgZGIgPSBuZXcgRGIoKTtcclxuXHJcbmNvbnN0IHByb2R1Y3RTZXJ2aWNlID0gbmV3IFByb2R1Y3RTZXJ2aWNlKG5ldyBNb25nb1Byb2R1Y3RTdG9yYWdlKGRiKSk7XHJcblxyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5cclxucm91dGVyLmdldChcIi86aWRcIiwgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCBwcm9kdWN0SWQgPSAocmVxLnBhcmFtcyB8fCB7fSlbXCJpZFwiXTtcclxuXHJcbiAgICBpZiAoIXByb2R1Y3RJZCkge1xyXG4gICAgICAgIHJlcy5zZW5kKDQwNCwgXCJOb3QgZm91bmRcIilcclxuICAgICAgICAgICAgLmVuZCgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJvZHVjdFNlcnZpY2Uub25lKHByb2R1Y3RJZClcclxuICAgICAgICAudGhlbihwcm9kdWN0ID0+IHJlcy5qc29uKHByb2R1Y3QpKVxyXG4gICAgICAgIC5jYXRjaChlcnIgPT4gcmVzLnNlbmQoNDA0LCBcIk5vdCBmb3VuZFwiKS5lbmQoKSk7XHJcbn0pO1xyXG5cclxucm91dGVyLmdldChcIi9cIiwgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBwcm9kdWN0U2VydmljZS5hbGwoKVxyXG4gICAgICAgIC50aGVuKHByb2R1Y3RzID0+IHJlcy5qc29uKHByb2R1Y3RzKSlcclxuICAgICAgICAuY2F0Y2goZXJyID0+IHJlcy5zZW5kKDUwMCwgZXJyKS5lbmQoKSk7XHJcbn0pO1xyXG5cclxucm91dGVyLnBvc3QoXCIvXCIsIChyZXF1ZXN0LCByZXNwb25zZSkgPT4ge1xyXG4gICAgY29uc3QgcHJvZHVjdCA9IHJlcXVlc3QuYm9keTtcclxuXHJcbiAgICBwcm9kdWN0U2VydmljZS5zYXZlKHByb2R1Y3QpXHJcbiAgICAgICAgLnRoZW4ocHJvZHVjdCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUHJvZHVjdCBzYXZlZCBzdWNjZXNzZnVseVwiKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YTogQXBpLklQb3N0UmVzcG9uc2U8QXBpLlByb2R1Y3Q+ID0ge1xyXG4gICAgICAgICAgICAgICAgb2s6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBlbnRpdHk6IHByb2R1Y3RcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24ocmVzcG9uc2VEYXRhKS5lbmQoKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlByb2R1Y3Qgc2F2aW5nIGZhaWxlZFwiKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YTogQXBpLklGYWlsUmVzcG9uc2UgPSB7XHJcbiAgICAgICAgICAgICAgICBvazogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBlcnJvcnM6IGVyclxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2UuanNvbihyZXNwb25zZURhdGEpLmVuZCgpO1xyXG4gICAgICAgIH0pO1xyXG59KTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjsiXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web/routes/product-route.ts\n ** module id = 20\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar MongoProductStorage = (function () {\r\n    function MongoProductStorage(db) {\r\n        this.db = db;\r\n        if (!db)\r\n            throw new Error(\"db is missing\");\r\n    }\r\n    MongoProductStorage.prototype.all = function () {\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.find({}, { _id: 0 }); })\r\n            .then(function (c) { return c.toArray(); });\r\n    };\r\n    MongoProductStorage.prototype.one = function (id) {\r\n        if (!id)\r\n            throw new Error(\"id is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.find({ id: id }, { _id: 0 }); })\r\n            .then(function (c) { return c.limit(1); })\r\n            .then(function (c) { return c.next(); });\r\n    };\r\n    MongoProductStorage.prototype.findByTitle = function (title) {\r\n        if (!title)\r\n            return Promise.reject(\"Title is empty\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.find({ title: title }, { _id: 0 }); })\r\n            .then(function (c) { return c.limit(1); })\r\n            .then(function (c) { return c.next(); });\r\n    };\r\n    MongoProductStorage.prototype.save = function (product) {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.updateOne({\r\n            id: product.id\r\n        }, {\r\n            $set: {\r\n                id: product.id,\r\n                title: product.title,\r\n                scrapingUrls: product.scrapingUrls\r\n            }\r\n        }, {\r\n            upsert: true\r\n        }); })\r\n            .then(function () { return product; });\r\n    };\r\n    MongoProductStorage.prototype.setScrapingData = function (productId, webShopId, values, log) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        if (!webShopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        if (!values)\r\n            throw new Error(\"values is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.products)\r\n            .then(function (c) { return c.updateOne({\r\n            id: productId\r\n        }, {\r\n            $set: (_a = {},\r\n                _a[\"values.\" + webShopId] = values,\r\n                _a[\"log.\" + webShopId] = log,\r\n                _a\r\n            )\r\n        }, {\r\n            upsert: true\r\n        }); var _a; })\r\n            .then(function (r) { return _this.one(productId); });\r\n    };\r\n    return MongoProductStorage;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = MongoProductStorage;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uZ28tcHJvZHVjdC1zdG9yYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibW9uZ28tcHJvZHVjdC1zdG9yYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDs7QUFFakQsbUJBQXFCLHNCQUFzQixDQUFDLENBQUE7QUFFNUM7SUFDSSw2QkFBb0IsRUFBWTtRQUFaLE9BQUUsR0FBRixFQUFFLENBQVU7UUFDNUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDSixNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRCxpQ0FBRyxHQUFIO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO2FBQ1QsVUFBVSxDQUFDLFlBQVEsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDO2FBQ3pDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQXRCLENBQXNCLENBQUM7YUFDakMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFYLENBQVcsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRCxpQ0FBRyxHQUFILFVBQUksRUFBVTtRQUNWLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ0osTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRXZDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTthQUNULFVBQVUsQ0FBQyxZQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQzthQUN6QyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQTlCLENBQThCLENBQUM7YUFDekMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBVixDQUFVLENBQUM7YUFDckIsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFSLENBQVEsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCx5Q0FBVyxHQUFYLFVBQVksS0FBYTtRQUNyQixFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUNQLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFFNUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO2FBQ1QsVUFBVSxDQUFDLFlBQVEsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDO2FBQ3pDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFBLEtBQUssRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQTdCLENBQTZCLENBQUM7YUFDeEMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBVixDQUFVLENBQUM7YUFDckIsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFSLENBQVEsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCxrQ0FBSSxHQUFKLFVBQUssT0FBb0I7UUFDckIsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDVCxNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFFNUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO2FBQ1QsVUFBVSxDQUFDLFlBQVEsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDO2FBQ3pDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDbkIsRUFBRSxFQUFFLE9BQU8sQ0FBQyxFQUFFO1NBQ2pCLEVBQ0c7WUFDSSxJQUFJLEVBQUU7Z0JBQ0YsRUFBRSxFQUFFLE9BQU8sQ0FBQyxFQUFFO2dCQUNkLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSztnQkFDcEIsWUFBWSxFQUFFLE9BQU8sQ0FBQyxZQUFZO2FBQ3JDO1NBQ0osRUFDRDtZQUNJLE1BQU0sRUFBRSxJQUFJO1NBQ2YsQ0FBQyxFQVpLLENBWUwsQ0FBQzthQUNOLElBQUksQ0FBQyxjQUFNLE9BQUEsT0FBTyxFQUFQLENBQU8sQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCw2Q0FBZSxHQUFmLFVBQWdCLFNBQWlCLEVBQUUsU0FBaUIsRUFBRSxNQUF5QixFQUFFLEdBQWtCO1FBQW5HLGlCQXdCQztRQXZCRyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUM5QyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUM5QyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUNSLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUUzQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7YUFDVCxVQUFVLENBQUMsWUFBUSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUM7YUFDekMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLFNBQVMsQ0FDbEI7WUFDSSxFQUFFLEVBQUUsU0FBUztTQUNoQixFQUNEO1lBQ0ksSUFBSSxFQUFFO2dCQUNGLEdBQUMsWUFBVSxTQUFXLENBQUMsR0FBRSxNQUFNO2dCQUMvQixHQUFDLFNBQU8sU0FBVyxDQUFDLEdBQUUsR0FBRzs7YUFDNUI7U0FDSixFQUNEO1lBQ0ksTUFBTSxFQUFFLElBQUk7U0FDZixDQUFDLFVBWkssQ0FZTCxDQUFDO2FBQ04sSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsS0FBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBbkIsQ0FBbUIsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFDTCwwQkFBQztBQUFELENBQUMsQUFsRkQsSUFrRkM7QUFsRkQ7cUNBa0ZDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCBEYXRhYmFzZSBmcm9tIFwiLi4vLi4vZGF0YS1hY2Nlc3MvZGJcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vbmdvUHJvZHVjdFN0b3JhZ2UgaW1wbGVtZW50cyBQcm9kdWN0cy5JUHJvZHVjdFN0b3JhZ2Uge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBkYjogRGF0YWJhc2UpIHtcclxuICAgICAgICBpZiAoIWRiKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJkYiBpcyBtaXNzaW5nXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGFsbCgpOiBQcm9taXNlPEFwaS5Qcm9kdWN0W10+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kYlxyXG4gICAgICAgICAgICAuY29sbGVjdGlvbihEYXRhYmFzZS5Db2xsZWN0aW9ucy5wcm9kdWN0cylcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLmZpbmQoe30sIHsgX2lkOiAwIH0pKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMudG9BcnJheSgpKTtcclxuICAgIH1cclxuXHJcbiAgICBvbmUoaWQ6IHN0cmluZyk6IFByb21pc2U8QXBpLlByb2R1Y3Q+IHtcclxuICAgICAgICBpZiAoIWlkKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpZCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmRiXHJcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKERhdGFiYXNlLkNvbGxlY3Rpb25zLnByb2R1Y3RzKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMuZmluZCh7IGlkOiBpZCB9LCB7IF9pZDogMCB9KSlcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLmxpbWl0KDEpKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMubmV4dCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBmaW5kQnlUaXRsZSh0aXRsZTogc3RyaW5nKTogUHJvbWlzZTxBcGkuUHJvZHVjdD4ge1xyXG4gICAgICAgIGlmICghdGl0bGUpXHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChcIlRpdGxlIGlzIGVtcHR5XCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5kYlxyXG4gICAgICAgICAgICAuY29sbGVjdGlvbihEYXRhYmFzZS5Db2xsZWN0aW9ucy5wcm9kdWN0cylcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLmZpbmQoeyB0aXRsZSB9LCB7IF9pZDogMCB9KSlcclxuICAgICAgICAgICAgLnRoZW4oYyA9PiBjLmxpbWl0KDEpKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMubmV4dCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlKHByb2R1Y3Q6IEFwaS5Qcm9kdWN0KTogUHJvbWlzZTxBcGkuUHJvZHVjdD4ge1xyXG4gICAgICAgIGlmICghcHJvZHVjdClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHJvZHVjdCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmRiXHJcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKERhdGFiYXNlLkNvbGxlY3Rpb25zLnByb2R1Y3RzKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMudXBkYXRlT25lKHtcclxuICAgICAgICAgICAgICAgIGlkOiBwcm9kdWN0LmlkXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNldDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogcHJvZHVjdC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHByb2R1Y3QudGl0bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmFwaW5nVXJsczogcHJvZHVjdC5zY3JhcGluZ1VybHNcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwc2VydDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHByb2R1Y3QpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNjcmFwaW5nRGF0YShwcm9kdWN0SWQ6IHN0cmluZywgd2ViU2hvcElkOiBzdHJpbmcsIHZhbHVlczogQXBpLlNjcmFwZWRWYWx1ZXMsIGxvZzogQXBpLlNjcmFwZUxvZyk6IFByb21pc2U8QXBpLlByb2R1Y3Q+IHtcclxuICAgICAgICBpZiAoIXByb2R1Y3RJZClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHJvZHVjdElkIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoIXdlYlNob3BJZClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwid2ViU2hvcElkIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoIXZhbHVlcylcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidmFsdWVzIGlzIHVuZGVmaW5lZFwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGJcclxuICAgICAgICAgICAgLmNvbGxlY3Rpb24oRGF0YWJhc2UuQ29sbGVjdGlvbnMucHJvZHVjdHMpXHJcbiAgICAgICAgICAgIC50aGVuKGMgPT4gYy51cGRhdGVPbmUoXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHByb2R1Y3RJZFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2V0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtgdmFsdWVzLiR7d2ViU2hvcElkfWBdOiB2YWx1ZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtgbG9nLiR7d2ViU2hvcElkfWBdOiBsb2dcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwc2VydDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICAgIC50aGVuKHIgPT4gdGhpcy5vbmUocHJvZHVjdElkKSk7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/products/mongo-product-storage.ts\n ** module id = 21\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar moment = require(\"moment\");\r\nvar uuid = require(\"node-uuid\");\r\nvar event_bus_1 = require(\"../event-bus\");\r\nvar product_validator_1 = require(\"./product-validator\");\r\nvar ProductService = (function () {\r\n    function ProductService(storage) {\r\n        this.storage = storage;\r\n        this.validator = new product_validator_1.default();\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n    ProductService.prototype.all = function () {\r\n        return this.storage.all();\r\n    };\r\n    ProductService.prototype.save = function (product) {\r\n        var _this = this;\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n        if (!product.id)\r\n            product.id = uuid.v1();\r\n        return this.validator\r\n            .validate(product)\r\n            .then(function (product) {\r\n            return _this.storage\r\n                .findByTitle(product.title)\r\n                .then(function (found) {\r\n                if (found && found.id !== product.id) {\r\n                    throw {\r\n                        \"title\": [\"Product with such title already exists\"]\r\n                    };\r\n                }\r\n            })\r\n                .then(function () { return _this.storage.save(product); })\r\n                .then(function () { return _this.one(product.id); })\r\n                .then(function (product) {\r\n                event_bus_1.eventBus.emit(event_bus_1.EventNames.ProductUpdated, product.id);\r\n                return product;\r\n            });\r\n        });\r\n    };\r\n    ProductService.prototype.one = function (productId) {\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return this.storage.one(productId);\r\n    };\r\n    ProductService.prototype.findByTitle = function (title) {\r\n        return this.storage.findByTitle(title);\r\n    };\r\n    ProductService.prototype.updateScrapedData = function (productId, webshopId, data) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        if (!webshopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        if (!data)\r\n            throw new Error(\"data is undefined\");\r\n        var now = moment.utc().toDate();\r\n        return this.one(productId)\r\n            .then(function (product) {\r\n            if (!product.values)\r\n                product.values = {};\r\n            var values = product.values[webshopId] ||\r\n                {\r\n                    title: null,\r\n                    price: null,\r\n                    image: null\r\n                };\r\n            product.values[webshopId] = values;\r\n            if (!product.log)\r\n                product.log = {};\r\n            var log = product.log[webshopId] ||\r\n                {\r\n                    url: null,\r\n                    scrapedAt: null,\r\n                    error: data.error,\r\n                    values: {}\r\n                };\r\n            product.log[webshopId] = log;\r\n            log.url = product.scrapingUrls[webshopId];\r\n            log.scrapedAt = now;\r\n            log.error = data.error;\r\n            Object.keys(data.values)\r\n                .forEach(function (name) {\r\n                var value = data.values[name];\r\n                if (value.isSuccessful)\r\n                    values[name] = value.value;\r\n                log.values[name] = {\r\n                    scrapedAt: now,\r\n                    error: value.error\r\n                };\r\n            });\r\n            return _this.storage.setScrapingData(product.id, webshopId, values, log);\r\n        });\r\n    };\r\n    return ProductService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ProductService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicHJvZHVjdC1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDs7QUFFakQsSUFBWSxNQUFNLFdBQU0sUUFBUSxDQUFDLENBQUE7QUFDakMsSUFBWSxJQUFJLFdBQU0sV0FBVyxDQUFDLENBQUE7QUFFbEMsMEJBQXFDLGNBQWMsQ0FBQyxDQUFBO0FBRXBELGtDQUE2QixxQkFBcUIsQ0FBQyxDQUFBO0FBRW5EO0lBR0ksd0JBQW9CLE9BQWlDO1FBQWpDLFlBQU8sR0FBUCxPQUFPLENBQTBCO1FBRjdDLGNBQVMsR0FBRyxJQUFJLDJCQUFnQixFQUFFLENBQUM7UUFHdkMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDVCxNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUVELDRCQUFHLEdBQUg7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUM5QixDQUFDO0lBRUQsNkJBQUksR0FBSixVQUFLLE9BQW9CO1FBQXpCLGlCQTBCQztRQXpCRyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUNULE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUU1QyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDWixPQUFPLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUUzQixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVM7YUFDaEIsUUFBUSxDQUFDLE9BQU8sQ0FBQzthQUNqQixJQUFJLENBQUMsVUFBQSxPQUFPO1lBQ1QsTUFBTSxDQUFDLEtBQUksQ0FBQyxPQUFPO2lCQUNkLFdBQVcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO2lCQUMxQixJQUFJLENBQUMsVUFBQSxLQUFL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QUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMxQyxHQUFHLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztZQUNwQixHQUFHLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7WUFFdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO2lCQUNuQixPQUFPLENBQUMsVUFBQSxJQUFJO2dCQUNULElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBRWhDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUM7b0JBQ25CLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDO2dCQUUvQixHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHO29CQUNmLFNBQVMsRUFBRSxHQUFHO29CQUNkLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztpQkFDckIsQ0FBQztZQUNOLENBQUMsQ0FBQyxDQUFDO1lBRVAsTUFBTSxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM1RSxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFDTCxxQkFBQztBQUFELENBQUMsQUF6R0QsSUF5R0M7QUF6R0Q7Z0NBeUdDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tIFwibW9tZW50XCI7XHJcbmltcG9ydCAqIGFzIHV1aWQgZnJvbSBcIm5vZGUtdXVpZFwiO1xyXG5cclxuaW1wb3J0IHsgZXZlbnRCdXMsIEV2ZW50TmFtZXMgfSBmcm9tIFwiLi4vZXZlbnQtYnVzXCI7XHJcblxyXG5pbXBvcnQgUHJvZHVjdFZhbGlkYXRvciBmcm9tIFwiLi9wcm9kdWN0LXZhbGlkYXRvclwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvZHVjdFNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSB2YWxpZGF0b3IgPSBuZXcgUHJvZHVjdFZhbGlkYXRvcigpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc3RvcmFnZTogUHJvZHVjdHMuSVByb2R1Y3RTdG9yYWdlKSB7XHJcbiAgICAgICAgaWYgKCFzdG9yYWdlKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzdG9yYWdlIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBhbGwoKTogUHJvbWlzZTxBcGkuUHJvZHVjdFtdPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5hbGwoKTtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlKHByb2R1Y3Q6IEFwaS5Qcm9kdWN0KTogUHJvbWlzZTxBcGkuUHJvZHVjdD4ge1xyXG4gICAgICAgIGlmICghcHJvZHVjdClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHJvZHVjdCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIGlmICghcHJvZHVjdC5pZClcclxuICAgICAgICAgICAgcHJvZHVjdC5pZCA9IHV1aWQudjEoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdG9yXHJcbiAgICAgICAgICAgIC52YWxpZGF0ZShwcm9kdWN0KVxyXG4gICAgICAgICAgICAudGhlbihwcm9kdWN0ID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2VcclxuICAgICAgICAgICAgICAgICAgICAuZmluZEJ5VGl0bGUocHJvZHVjdC50aXRsZSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmb3VuZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCAmJiBmb3VuZC5pZCAhPT0gcHJvZHVjdC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidGl0bGVcIjogW1wiUHJvZHVjdCB3aXRoIHN1Y2ggdGl0bGUgYWxyZWFkeSBleGlzdHNcIl1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMuc3RvcmFnZS5zYXZlKHByb2R1Y3QpKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMub25lKHByb2R1Y3QuaWQpKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKHByb2R1Y3QgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudEJ1cy5lbWl0KEV2ZW50TmFtZXMuUHJvZHVjdFVwZGF0ZWQsIHByb2R1Y3QuaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvZHVjdDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7ICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBvbmUocHJvZHVjdElkOiBzdHJpbmcpOiBQcm9taXNlPEFwaS5Qcm9kdWN0PiB7XHJcbiAgICAgICAgaWYgKCFwcm9kdWN0SWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInByb2R1Y3RJZCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2Uub25lKHByb2R1Y3RJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZEJ5VGl0bGUodGl0bGU6IHN0cmluZyk6IFByb21pc2U8QXBpLlByb2R1Y3Q+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdG9yYWdlLmZpbmRCeVRpdGxlKHRpdGxlKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVTY3JhcGVkRGF0YShwcm9kdWN0SWQ6IHN0cmluZywgd2Vic2hvcElkOiBzdHJpbmcsIGRhdGE6IFNjcmFwaW5nLldlYlNob3BTY3JhcGluZ1Jlc3VsdCk6IFByb21pc2U8QXBpLlByb2R1Y3Q+IHtcclxuICAgICAgICBpZiAoIXByb2R1Y3RJZClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHJvZHVjdElkIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoIXdlYnNob3BJZClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwid2ViU2hvcElkIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoIWRhdGEpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImRhdGEgaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgICAgIGNvbnN0IG5vdyA9IG1vbWVudC51dGMoKS50b0RhdGUoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMub25lKHByb2R1Y3RJZClcclxuICAgICAgICAgICAgLnRoZW4ocHJvZHVjdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXByb2R1Y3QudmFsdWVzKVxyXG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3QudmFsdWVzID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gcHJvZHVjdC52YWx1ZXNbd2Vic2hvcElkXSB8fFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBwcm9kdWN0LnZhbHVlc1t3ZWJzaG9wSWRdID0gdmFsdWVzO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghcHJvZHVjdC5sb2cpXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5sb2cgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2cgPSBwcm9kdWN0LmxvZ1t3ZWJzaG9wSWRdIHx8XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmFwZWRBdDogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGRhdGEuZXJyb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlczoge31cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcHJvZHVjdC5sb2dbd2Vic2hvcElkXSA9IGxvZztcclxuXHJcbiAgICAgICAgICAgICAgICBsb2cudXJsID0gcHJvZHVjdC5zY3JhcGluZ1VybHNbd2Vic2hvcElkXTtcclxuICAgICAgICAgICAgICAgIGxvZy5zY3JhcGVkQXQgPSBub3c7XHJcbiAgICAgICAgICAgICAgICBsb2cuZXJyb3IgPSBkYXRhLmVycm9yO1xyXG5cclxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGRhdGEudmFsdWVzKVxyXG4gICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKG5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGRhdGEudmFsdWVzW25hbWVdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmlzU3VjY2Vzc2Z1bClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tuYW1lXSA9IHZhbHVlLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLnZhbHVlc1tuYW1lXSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmFwZWRBdDogbm93LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHZhbHVlLmVycm9yXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5zZXRTY3JhcGluZ0RhdGEocHJvZHVjdC5pZCwgd2Vic2hvcElkLCB2YWx1ZXMsIGxvZyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/products/product-service.ts\n ** module id = 22\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar events_1 = require(\"events\");\r\nvar EventNames = (function () {\r\n    function EventNames() {\r\n    }\r\n    /**\r\n     * Published when product inserted or updated.\r\n     * Params is product id: string.\r\n     */\r\n    EventNames.ProductUpdated = \"product-updated\";\r\n    /**\r\n     * Published when product data is scraped.\r\n     * Param is product id: string.\r\n     */\r\n    EventNames.ProductScraped = \"product-scraped\";\r\n    return EventNames;\r\n}());\r\nexports.EventNames = EventNames;\r\nvar eventBus = new events_1.EventEmitter();\r\nexports.eventBus = eventBus;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnQtYnVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZXZlbnQtYnVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDZDQUE2Qzs7QUFFN0MsdUJBQTZCLFFBQVEsQ0FBQyxDQUFBO0FBRXRDO0lBQUE7SUFXQSxDQUFDO0lBVkc7OztPQUdHO0lBQ0kseUJBQWMsR0FBRyxpQkFBaUIsQ0FBQztJQUMxQzs7O09BR0c7SUFDSSx5QkFBYyxHQUFHLGlCQUFpQixDQUFDO0lBQzlDLGlCQUFDO0FBQUQsQ0FBQyxBQVhELElBV0M7QUFJa0Isa0JBQVUsY0FKNUI7QUFFRCxJQUFNLFFBQVEsR0FBRyxJQUFJLHFCQUFZLEVBQUU7QUFFMUIsZ0JBQVEsWUFGbUI7QUFFSiIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcblxyXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tIFwiZXZlbnRzXCI7XHJcblxyXG5jbGFzcyBFdmVudE5hbWVzIHtcclxuICAgIC8qKlxyXG4gICAgICogUHVibGlzaGVkIHdoZW4gcHJvZHVjdCBpbnNlcnRlZCBvciB1cGRhdGVkLlxyXG4gICAgICogUGFyYW1zIGlzIHByb2R1Y3QgaWQ6IHN0cmluZy5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIFByb2R1Y3RVcGRhdGVkID0gXCJwcm9kdWN0LXVwZGF0ZWRcIjtcclxuICAgIC8qKlxyXG4gICAgICogUHVibGlzaGVkIHdoZW4gcHJvZHVjdCBkYXRhIGlzIHNjcmFwZWQuXHJcbiAgICAgKiBQYXJhbSBpcyBwcm9kdWN0IGlkOiBzdHJpbmcuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBQcm9kdWN0U2NyYXBlZCA9IFwicHJvZHVjdC1zY3JhcGVkXCI7XHJcbn1cclxuXHJcbmNvbnN0IGV2ZW50QnVzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuZXhwb3J0IHsgZXZlbnRCdXMsIEV2ZW50TmFtZXMgfTsiXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/event-bus.ts\n ** module id = 23\n ** module chunks = 0\n **/","module.exports = require(\"events\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"events\"\n ** module id = 24\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar validator_1 = require(\"../../validator\");\r\nvar ProductValidator = (function () {\r\n    function ProductValidator() {\r\n        this.validator = validator_1.rules.obj({\r\n            id: validator_1.rules.str().notEmpty({ errorMessage: \"Product ID is required\" }),\r\n            title: validator_1.rules.str()\r\n                .notEmpty({ errorMessage: \"Product title is required\" })\r\n                .must(function (t) { return t.length < 1024; }, { errorMessage: \"Product title too long\" }),\r\n            scrapingUrls: validator_1.rules.hash(validator_1.rules.str().must(function (url) { return !url || (url.indexOf(\"http://\") === 0 || url.indexOf(\"https://\") === 0); }, { errorMessage: \"URL must starts from http:// or https:// \" }))\r\n                .before(function (urls) { return Object.keys(urls)\r\n                .map(function (shopId) { return urls[shopId]; })\r\n                .filter(function (url) { return url && url.trim().length > 0; })\r\n                .length > 0; }, { errorMessage: \"At least one scraping URL must be specified.\" })\r\n        });\r\n    }\r\n    ProductValidator.prototype.validate = function (product) {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n        return validator_1.validateWithPromise(product, this.validator);\r\n    };\r\n    return ProductValidator;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ProductValidator;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC12YWxpZGF0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwcm9kdWN0LXZhbGlkYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpREFBaUQ7O0FBRWpELDBCQUF1RSxpQkFBaUIsQ0FBQyxDQUFBO0FBRXpGO0lBQUE7UUFDVyxjQUFTLEdBQUcsaUJBQUssQ0FBQyxHQUFHLENBQWM7WUFDdEMsRUFBRSxFQUFFLGlCQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsWUFBWSxFQUFFLHdCQUF3QixFQUFFLENBQUM7WUFDcEUsS0FBSyxFQUFFLGlCQUFLLENBQUMsR0FBRyxFQUFFO2lCQUNiLFFBQVEsQ0FBQyxFQUFFLFlBQVksRUFBRSwyQkFBMkIsRUFBRSxDQUFDO2lCQUN2RCxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsTUFBTSxHQUFHLElBQUksRUFBZixDQUFlLEVBQUUsRUFBRSxZQUFZLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQztZQUMzRSxZQUFZLEVBQUUsaUJBQUssQ0FBQyxJQUFJLENBQ3BCLGlCQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUF2RSxDQUF1RSxFQUFFLEVBQUUsWUFBWSxFQUFFLDJDQUEyQyxFQUFFLENBQUMsQ0FBQztpQkFDL0osTUFBTSxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7aUJBQzVCLEdBQUcsQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBWixDQUFZLENBQUM7aUJBQzNCLE1BQU0sQ0FBQyxVQUFDLEdBQVcsSUFBSyxPQUFBLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBNUIsQ0FBNEIsQ0FBQztpQkFDckQsTUFBTSxHQUFHLENBQUMsRUFIQyxDQUdELEVBQ2YsRUFBRSxZQUFZLEVBQUUsOENBQThDLEVBQUUsQ0FBQztTQUN4RSxDQUFDLENBQUM7SUFTUCxDQUFDO0lBTkcsbUNBQVEsR0FBUixVQUFTLE9BQW9CO1FBQ3pCLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBRTVDLE1BQU0sQ0FBQywrQkFBUSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUNMLHVCQUFDO0FBQUQsQ0FBQyxBQXRCRCxJQXNCQztBQXRCRDtrQ0FzQkMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxyXG5cclxuaW1wb3J0IHsgdmFsaWRhdGVXaXRoUHJvbWlzZSBhcyB2YWxpZGF0ZSwgVmFsaWRhdGlvblJ1bGUsIHJ1bGVzIH0gZnJvbSBcIi4uLy4uL3ZhbGlkYXRvclwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvZHVjdFZhbGlkYXRvciB7XHJcbiAgICBwdWJsaWMgdmFsaWRhdG9yID0gcnVsZXMub2JqPEFwaS5Qcm9kdWN0Pih7XHJcbiAgICAgICAgaWQ6IHJ1bGVzLnN0cigpLm5vdEVtcHR5KHsgZXJyb3JNZXNzYWdlOiBcIlByb2R1Y3QgSUQgaXMgcmVxdWlyZWRcIiB9KSxcclxuICAgICAgICB0aXRsZTogcnVsZXMuc3RyKClcclxuICAgICAgICAgICAgLm5vdEVtcHR5KHsgZXJyb3JNZXNzYWdlOiBcIlByb2R1Y3QgdGl0bGUgaXMgcmVxdWlyZWRcIiB9KVxyXG4gICAgICAgICAgICAubXVzdCh0ID0+IHQubGVuZ3RoIDwgMTAyNCwgeyBlcnJvck1lc3NhZ2U6IFwiUHJvZHVjdCB0aXRsZSB0b28gbG9uZ1wiIH0pLFxyXG4gICAgICAgIHNjcmFwaW5nVXJsczogcnVsZXMuaGFzaChcclxuICAgICAgICAgICAgcnVsZXMuc3RyKCkubXVzdCh1cmwgPT4gIXVybCB8fCAodXJsLmluZGV4T2YoXCJodHRwOi8vXCIpID09PSAwIHx8IHVybC5pbmRleE9mKFwiaHR0cHM6Ly9cIikgPT09IDApLCB7IGVycm9yTWVzc2FnZTogXCJVUkwgbXVzdCBzdGFydHMgZnJvbSBodHRwOi8vIG9yIGh0dHBzOi8vIFwiIH0pKVxyXG4gICAgICAgICAgICAuYmVmb3JlKHVybHMgPT4gT2JqZWN0LmtleXModXJscylcclxuICAgICAgICAgICAgICAgIC5tYXAoc2hvcElkID0+IHVybHNbc2hvcElkXSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHVybDogc3RyaW5nKSA9PiB1cmwgJiYgdXJsLnRyaW0oKS5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgLmxlbmd0aCA+IDAsXHJcbiAgICAgICAgICAgIHsgZXJyb3JNZXNzYWdlOiBcIkF0IGxlYXN0IG9uZSBzY3JhcGluZyBVUkwgbXVzdCBiZSBzcGVjaWZpZWQuXCIgfSlcclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICB2YWxpZGF0ZShwcm9kdWN0OiBBcGkuUHJvZHVjdCk6IFByb21pc2U8QXBpLlByb2R1Y3Q+IHtcclxuICAgICAgICBpZiAoIXByb2R1Y3QpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInByb2R1Y3QgaXMgdW5kZWZpbmVkXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdmFsaWRhdGUocHJvZHVjdCwgdGhpcy52YWxpZGF0b3IpO1xyXG4gICAgfVxyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/products/product-validator.ts\n ** module id = 25\n ** module chunks = 0\n **/","\"use strict\";\r\nvar error_accumulator_1 = require(\"./error-accumulator\");\r\nvar validation_context_1 = require(\"./validation-context\");\r\nvar rules = require(\"./rules\");\r\nexports.rules = rules;\r\nfunction validateWithCallback(value, done) {\r\n    var validators = [];\r\n    for (var _i = 2; _i < arguments.length; _i++) {\r\n        validators[_i - 2] = arguments[_i];\r\n    }\r\n    if (!done) {\r\n        throw new Error(\"Done callback is required.\");\r\n    }\r\n    if (!validators || !validators.length) {\r\n        throw new Error(\"At least one validator is required\");\r\n    }\r\n    var errorAccumulator = new error_accumulator_1.default();\r\n    var validationContext = new validation_context_1.default(\"\", errorAccumulator);\r\n    var rule = rules.combineRules.apply(rules, validators);\r\n    var parsedValue = rule.runParse(value, value, value);\r\n    rule.runValidate(validationContext, function () {\r\n        if (errorAccumulator.valid()) {\r\n            var validationResult = {\r\n                valid: true,\r\n                convertedValue: parsedValue\r\n            };\r\n            done(validationResult);\r\n        }\r\n        else {\r\n            var validationResult = {\r\n                valid: false,\r\n                convertedValue: null,\r\n                errors: errorAccumulator.errors()\r\n            };\r\n            done(validationResult);\r\n        }\r\n    }, parsedValue, parsedValue, parsedValue);\r\n}\r\nexports.validateWithCallback = validateWithCallback;\r\nfunction validateWithPromise(value) {\r\n    var validators = [];\r\n    for (var _i = 1; _i < arguments.length; _i++) {\r\n        validators[_i - 1] = arguments[_i];\r\n    }\r\n    if (!validators || !validators.length) {\r\n        throw new Error(\"At least one validator is required\");\r\n    }\r\n    return new Promise(function (resolve, reject) {\r\n        validateWithCallback.apply(void 0, [value, function (result) {\r\n            if (result.valid) {\r\n                resolve(result.convertedValue);\r\n            }\r\n            else {\r\n                reject(result.errors);\r\n            }\r\n        }].concat(validators));\r\n    });\r\n}\r\nexports.validateWithPromise = validateWithPromise;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0Esa0NBQTZCLHFCQUFxQixDQUFDLENBQUE7QUFDbkQsbUNBQThCLHNCQUFzQixDQUFDLENBQUE7QUFFckQsSUFBWSxLQUFLLFdBQU0sU0FBUyxDQUFDLENBQUE7QUFHeEIsYUFBSztBQUVkLDhCQUF3QyxLQUFVLEVBQUUsSUFBMkM7SUFBRSxvQkFBa0M7U0FBbEMsV0FBa0MsQ0FBbEMsc0JBQWtDLENBQWxDLElBQWtDO1FBQWxDLG1DQUFrQzs7SUFDL0gsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ1IsTUFBTSxJQUFJLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFDRCxFQUFFLENBQUMsQ0FBQyxDQUFDLFVBQVUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sSUFBSSxLQUFLLENBQUMsb0NBQW9DLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRUQsSUFBTSxnQkFBZ0IsR0FBRyxJQUFJLDJCQUFnQixFQUFFLENBQUM7SUFDaEQsSUFBTSxpQkFBaUIsR0FBRyxJQUFJLDRCQUFpQixDQUFDLEVBQUUsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0lBRXRFLElBQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxZQUFZLE9BQWxCLEtBQUssRUFBaUIsVUFBVSxDQUFDLENBQUM7SUFFL0MsSUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBRXZELElBQUksQ0FBQyxXQUFXLENBQ1osaUJBQWlCLEVBQ2pCO1FBQ0ksRUFBRSxDQUFDLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzNCLElBQU0sZ0JBQWdCLEdBQXdCO2dCQUMxQyxLQUFLLEVBQUUsSUFBSTtnQkFDWCxjQUFjLEVBQUUsV0FBVzthQUM5QixDQUFDO1lBQ0YsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDM0IsQ0FBQztRQUNELElBQUksQ0FBQyxDQUFDO1lBQ0YsSUFBTSxnQkFBZ0IsR0FBd0I7Z0JBQzFDLEtBQUssRUFBRSxLQUFLO2dCQUNaLGNBQWMsRUFBRSxJQUFJO2dCQUNwQixNQUFNLEVBQUUsZ0JBQWdCLENBQUMsTUFBTSxFQUFFO2FBQ3BDLENBQUM7WUFDRixJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUMzQixDQUFDO0lBQ0wsQ0FBQyxFQUNELFdBQVcsRUFDWCxXQUFXLEVBQ1gsV0FBVyxDQUFDLENBQUM7QUFDckIsQ0FBQztBQXJDZSw0QkFBb0IsdUJBcUNuQyxDQUFBO0FBRUQsNkJBQXVDLEtBQVU7SUFBRSxvQkFBa0M7U0FBbEMsV0FBa0MsQ0FBbEMsc0JBQWtDLENBQWxDLElBQWtDO1FBQWxDLG1DQUFrQzs7SUFDakYsRUFBRSxDQUFDLENBQUMsQ0FBQyxVQUFVLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNwQyxNQUFNLElBQUksS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVELE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxVQUFDLE9BQU8sRUFBRSxNQUFNO1FBQy9CLG9CQUFvQixnQkFDaEIsS0FBSyxFQUNMLFVBQUEsTUFBTTtZQUNGLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNmLE9BQU8sQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDbkMsQ0FBQztZQUNELElBQUksQ0FBQyxDQUFDO2dCQUNGLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUIsQ0FBQztRQUNMLENBQUMsU0FDRSxVQUFVLEVBQUMsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztBQUNQLENBQUM7QUFsQmUsMkJBQW1CLHNCQWtCbEMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZhbGlkYXRpb25SdWxlLCBWYWxpZGF0aW9uUmVzdWx0IH0gZnJvbSBcIi4vZGVmaW5pdGlvbnNcIjtcclxuaW1wb3J0IEVycm9yQWNjdW11bGF0b3IgZnJvbSBcIi4vZXJyb3ItYWNjdW11bGF0b3JcIjtcclxuaW1wb3J0IFZhbGlkYXRpb25Db250ZXh0IGZyb20gXCIuL3ZhbGlkYXRpb24tY29udGV4dFwiO1xyXG5cclxuaW1wb3J0ICogYXMgcnVsZXMgZnJvbSBcIi4vcnVsZXNcIjtcclxuXHJcbmV4cG9ydCAqIGZyb20gXCIuL2RlZmluaXRpb25zXCI7XHJcbmV4cG9ydCB7IHJ1bGVzIH07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVXaXRoQ2FsbGJhY2s8VD4odmFsdWU6IGFueSwgZG9uZTogKHJlc3VsdDogVmFsaWRhdGlvblJlc3VsdDxUPikgPT4gdm9pZCwgLi4udmFsaWRhdG9yczogVmFsaWRhdGlvblJ1bGU8VD5bXSk6IHZvaWQge1xyXG4gICAgaWYgKCFkb25lKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRG9uZSBjYWxsYmFjayBpcyByZXF1aXJlZC5cIik7XHJcbiAgICB9XHJcbiAgICBpZiAoIXZhbGlkYXRvcnMgfHwgIXZhbGlkYXRvcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXQgbGVhc3Qgb25lIHZhbGlkYXRvciBpcyByZXF1aXJlZFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlcnJvckFjY3VtdWxhdG9yID0gbmV3IEVycm9yQWNjdW11bGF0b3IoKTtcclxuICAgIGNvbnN0IHZhbGlkYXRpb25Db250ZXh0ID0gbmV3IFZhbGlkYXRpb25Db250ZXh0KFwiXCIsIGVycm9yQWNjdW11bGF0b3IpO1xyXG5cclxuICAgIGNvbnN0IHJ1bGUgPSBydWxlcy5jb21iaW5lUnVsZXMoLi4udmFsaWRhdG9ycyk7XHJcblxyXG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSBydWxlLnJ1blBhcnNlKHZhbHVlLCB2YWx1ZSwgdmFsdWUpO1xyXG5cclxuICAgIHJ1bGUucnVuVmFsaWRhdGUoXHJcbiAgICAgICAgdmFsaWRhdGlvbkNvbnRleHQsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3JBY2N1bXVsYXRvci52YWxpZCgpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0PFQ+ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnZlcnRlZFZhbHVlOiBwYXJzZWRWYWx1ZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGRvbmUodmFsaWRhdGlvblJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0PFQ+ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBjb252ZXJ0ZWRWYWx1ZTogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9yQWNjdW11bGF0b3IuZXJyb3JzKClcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBkb25lKHZhbGlkYXRpb25SZXN1bHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBwYXJzZWRWYWx1ZSxcclxuICAgICAgICBwYXJzZWRWYWx1ZSxcclxuICAgICAgICBwYXJzZWRWYWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVdpdGhQcm9taXNlPFQ+KHZhbHVlOiBhbnksIC4uLnZhbGlkYXRvcnM6IFZhbGlkYXRpb25SdWxlPFQ+W10pOiBQcm9taXNlPFQ+IHtcclxuICAgIGlmICghdmFsaWRhdG9ycyB8fCAhdmFsaWRhdG9ycy5sZW5ndGgpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBdCBsZWFzdCBvbmUgdmFsaWRhdG9yIGlzIHJlcXVpcmVkXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgdmFsaWRhdGVXaXRoQ2FsbGJhY2soXHJcbiAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICByZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmNvbnZlcnRlZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXN1bHQuZXJyb3JzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgLi4udmFsaWRhdG9ycyk7XHJcbiAgICB9KTtcclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/validator/index.ts\n ** module id = 26\n ** module chunks = 0\n **/","\"use strict\";\r\nvar ErrorAccumulator = (function () {\r\n    function ErrorAccumulator() {\r\n        this.errorHash = {};\r\n        this.isValid = true;\r\n    }\r\n    ErrorAccumulator.prototype.report = function (path, errorMessage) {\r\n        if (!errorMessage) {\r\n            return;\r\n        }\r\n        var messages = this.errorHash[path] = (this.errorHash[path] || []);\r\n        messages.push(errorMessage);\r\n        this.isValid = false;\r\n    };\r\n    ErrorAccumulator.prototype.errors = function () {\r\n        return this.errorHash;\r\n    };\r\n    ErrorAccumulator.prototype.valid = function () {\r\n        return this.isValid;\r\n    };\r\n    return ErrorAccumulator;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ErrorAccumulator;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3ItYWNjdW11bGF0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJlcnJvci1hY2N1bXVsYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBRUE7SUFBQTtRQUNZLGNBQVMsR0FBd0IsRUFBRSxDQUFDO1FBQ3BDLFlBQU8sR0FBRyxJQUFJLENBQUM7SUFvQjNCLENBQUM7SUFsQkcsaUNBQU0sR0FBTixVQUFPLElBQVksRUFBRSxZQUFvQjtRQUNyQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDaEIsTUFBTSxDQUFDO1FBQ1gsQ0FBQztRQUVELElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3JFLFFBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFNUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7SUFDekIsQ0FBQztJQUVELGlDQUFNLEdBQU47UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUMxQixDQUFDO0lBRUQsZ0NBQUssR0FBTDtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3hCLENBQUM7SUFDTCx1QkFBQztBQUFELENBQUMsQUF0QkQsSUFzQkM7QUF0QkQ7a0NBc0JDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3JIYXNoIH0gZnJvbSBcIi4vZGVmaW5pdGlvbnNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVycm9yQWNjdW11bGF0b3Ige1xyXG4gICAgcHJpdmF0ZSBlcnJvckhhc2g6IFZhbGlkYXRpb25FcnJvckhhc2ggPSB7fTtcclxuICAgIHByaXZhdGUgaXNWYWxpZCA9IHRydWU7XHJcblxyXG4gICAgcmVwb3J0KHBhdGg6IHN0cmluZywgZXJyb3JNZXNzYWdlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICBpZiAoIWVycm9yTWVzc2FnZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBtZXNzYWdlcyA9IHRoaXMuZXJyb3JIYXNoW3BhdGhdID0gKHRoaXMuZXJyb3JIYXNoW3BhdGhdIHx8IFtdKTtcclxuICAgICAgICBtZXNzYWdlcy5wdXNoKGVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5pc1ZhbGlkID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZXJyb3JzKCk6IFZhbGlkYXRpb25FcnJvckhhc2gge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVycm9ySGFzaDtcclxuICAgIH1cclxuXHJcbiAgICB2YWxpZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pc1ZhbGlkO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/validator/error-accumulator.ts\n ** module id = 27\n ** module chunks = 0\n **/","\"use strict\";\r\nvar error_accumulator_1 = require(\"./error-accumulator\");\r\nvar ValidationContext = (function () {\r\n    function ValidationContext(path, errorAccumulator, errorCallback) {\r\n        if (errorCallback === void 0) { errorCallback = null; }\r\n        this.path = path;\r\n        this.errorAccumulator = errorAccumulator;\r\n        this.errorCallback = errorCallback;\r\n        this.errorBuffer = null;\r\n    }\r\n    ValidationContext.prototype.reportError = function (message) {\r\n        if (this.errorCallback && !this.errorCallback(message)) {\r\n            return;\r\n        }\r\n        (this.errorBuffer || this.errorAccumulator).report(this.path, message);\r\n    };\r\n    ValidationContext.prototype.property = function (propertyName, errorCallback) {\r\n        return this.nest(propertyName, errorCallback);\r\n    };\r\n    ValidationContext.prototype.index = function (index, errorCallback) {\r\n        return this.nest(\"[\" + index + \"]\", errorCallback);\r\n    };\r\n    ValidationContext.prototype.nest = function (path, errorCallback) {\r\n        if (!path) {\r\n            throw new Error(\"path is undefined\");\r\n        }\r\n        var fullPath = path;\r\n        if (this.path) {\r\n            fullPath = path[0] === \"[\" ? this.path + path : this.path + \".\" + path;\r\n        }\r\n        var result = new ValidationContext(fullPath, this.errorBuffer || this.errorAccumulator, errorCallback);\r\n        return result;\r\n    };\r\n    ValidationContext.prototype.bufferErrors = function () {\r\n        var result = new ValidationContext(this.path, this.errorAccumulator, this.errorCallback);\r\n        result.errorBuffer = new error_accumulator_1.default();\r\n        return result;\r\n    };\r\n    ValidationContext.prototype.flushErrors = function () {\r\n        var _this = this;\r\n        if (this.errorBuffer) {\r\n            var errors_1 = this.errorBuffer.errors();\r\n            Object.keys(errors_1)\r\n                .forEach(function (path) {\r\n                var messages = errors_1[path];\r\n                messages.forEach(function (message) { return _this.errorAccumulator.report(path, message); });\r\n            });\r\n        }\r\n        this.errorBuffer = null;\r\n    };\r\n    return ValidationContext;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ValidationContext;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvbi1jb250ZXh0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidmFsaWRhdGlvbi1jb250ZXh0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxrQ0FBNkIscUJBQXFCLENBQUMsQ0FBQTtBQUVuRDtJQUdJLDJCQUNXLElBQVksRUFDWCxnQkFBa0MsRUFDbEMsYUFBdUQ7UUFBL0QsNkJBQStELEdBQS9ELG9CQUErRDtRQUZ4RCxTQUFJLEdBQUosSUFBSSxDQUFRO1FBQ1gscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyxrQkFBYSxHQUFiLGFBQWEsQ0FBMEM7UUFMM0QsZ0JBQVcsR0FBcUIsSUFBSSxDQUFDO0lBTTdDLENBQUM7SUFFRCx1Q0FBVyxHQUFYLFVBQVksT0FBZTtRQUN2QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckQsTUFBTSxDQUFDO1FBQ1gsQ0FBQztRQUVELENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztJQUMzRSxDQUFDO0lBRUQsb0NBQVEsR0FBUixVQUFTLFlBQW9CLEVBQUUsYUFBaUQ7UUFDNUUsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFFRCxpQ0FBSyxHQUFMLFVBQU0sS0FBYSxFQUFFLGFBQWlEO1FBQ2xFLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQUksS0FBSyxNQUFHLEVBQUUsYUFBYSxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUVPLGdDQUFJLEdBQVosVUFBYSxJQUFZLEVBQUUsYUFBZ0Q7UUFDdkUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1IsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7UUFFRCxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDcEIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDWixRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUM7UUFDM0UsQ0FBQztRQUVELElBQU0sTUFBTSxHQUFHLElBQUksaUJBQWlCLENBQ2hDLFFBQVEsRUFDUixJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsRUFDekMsYUFBYSxDQUNoQixDQUFDO1FBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNsQixDQUFDO0lBRUQsd0NBQVksR0FBWjtRQUNJLElBQU0sTUFBTSxHQUFHLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzNGLE1BQU0sQ0FBQyxXQUFXLEdBQUcsSUFBSSwyQkFBZ0IsRUFBRSxDQUFDO1FBRTVDLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUVELHVDQUFXLEdBQVg7UUFBQSxpQkFXQztRQVZHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ25CLElBQU0sUUFBTSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDekMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFNLENBQUM7aUJBQ2QsT0FBTyxDQUFDLFVBQUEsSUFBSTtnQkFDVCxJQUFNLFFBQVEsR0FBRyxRQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlCLFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBQSxPQUFPLElBQUksT0FBQSxLQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsRUFBM0MsQ0FBMkMsQ0FBQyxDQUFDO1lBQzdFLENBQUMsQ0FBQyxDQUFDO1FBQ1gsQ0FBQztRQUVELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO0lBQzVCLENBQUM7SUFDTCx3QkFBQztBQUFELENBQUMsQUEvREQsSUErREM7QUEvREQ7bUNBK0RDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJVmFsaWRhdGlvbkNvbnRleHQgfSBmcm9tIFwiLi9kZWZpbml0aW9uc1wiO1xyXG5cclxuaW1wb3J0IEVycm9yQWNjdW11bGF0b3IgZnJvbSBcIi4vZXJyb3ItYWNjdW11bGF0b3JcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZhbGlkYXRpb25Db250ZXh0IGltcGxlbWVudHMgSVZhbGlkYXRpb25Db250ZXh0IHtcclxuICAgIHByaXZhdGUgZXJyb3JCdWZmZXI6IEVycm9yQWNjdW11bGF0b3IgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHB1YmxpYyBwYXRoOiBzdHJpbmcsXHJcbiAgICAgICAgcHJpdmF0ZSBlcnJvckFjY3VtdWxhdG9yOiBFcnJvckFjY3VtdWxhdG9yLFxyXG4gICAgICAgIHByaXZhdGUgZXJyb3JDYWxsYmFjazogKGVycm9yTWVzc2FnZTogc3RyaW5nKSA9PiBib29sZWFuID0gbnVsbCkge1xyXG4gICAgfVxyXG5cclxuICAgIHJlcG9ydEVycm9yKG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmVycm9yQ2FsbGJhY2sgJiYgIXRoaXMuZXJyb3JDYWxsYmFjayhtZXNzYWdlKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAodGhpcy5lcnJvckJ1ZmZlciB8fCB0aGlzLmVycm9yQWNjdW11bGF0b3IpLnJlcG9ydCh0aGlzLnBhdGgsIG1lc3NhZ2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3BlcnR5KHByb3BlcnR5TmFtZTogc3RyaW5nLCBlcnJvckNhbGxiYWNrPzogKGVycm9yTWVzc2FnZTogc3RyaW5nKSA9PiBib29sZWFuKTogVmFsaWRhdGlvbkNvbnRleHQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5lc3QocHJvcGVydHlOYW1lLCBlcnJvckNhbGxiYWNrKTtcclxuICAgIH1cclxuXHJcbiAgICBpbmRleChpbmRleDogbnVtYmVyLCBlcnJvckNhbGxiYWNrPzogKGVycm9yTWVzc2FnZTogc3RyaW5nKSA9PiBib29sZWFuKTogVmFsaWRhdGlvbkNvbnRleHQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5lc3QoYFske2luZGV4fV1gLCBlcnJvckNhbGxiYWNrKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG5lc3QocGF0aDogc3RyaW5nLCBlcnJvckNhbGxiYWNrOiAoZXJyb3JNZXNzYWdlOiBzdHJpbmcpID0+IGJvb2xlYW4pOiBWYWxpZGF0aW9uQ29udGV4dCB7XHJcbiAgICAgICAgaWYgKCFwYXRoKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInBhdGggaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGZ1bGxQYXRoID0gcGF0aDtcclxuICAgICAgICBpZiAodGhpcy5wYXRoKSB7XHJcbiAgICAgICAgICAgIGZ1bGxQYXRoID0gcGF0aFswXSA9PT0gXCJbXCIgPyB0aGlzLnBhdGggKyBwYXRoIDogdGhpcy5wYXRoICsgXCIuXCIgKyBwYXRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxyXG4gICAgICAgICAgICBmdWxsUGF0aCxcclxuICAgICAgICAgICAgdGhpcy5lcnJvckJ1ZmZlciB8fCB0aGlzLmVycm9yQWNjdW11bGF0b3IsXHJcbiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2tcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGJ1ZmZlckVycm9ycygpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgVmFsaWRhdGlvbkNvbnRleHQodGhpcy5wYXRoLCB0aGlzLmVycm9yQWNjdW11bGF0b3IsIHRoaXMuZXJyb3JDYWxsYmFjayk7XHJcbiAgICAgICAgcmVzdWx0LmVycm9yQnVmZmVyID0gbmV3IEVycm9yQWNjdW11bGF0b3IoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBmbHVzaEVycm9ycygpIHtcclxuICAgICAgICBpZiAodGhpcy5lcnJvckJ1ZmZlcikge1xyXG4gICAgICAgICAgICBjb25zdCBlcnJvcnMgPSB0aGlzLmVycm9yQnVmZmVyLmVycm9ycygpO1xyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhlcnJvcnMpXHJcbiAgICAgICAgICAgICAgICAuZm9yRWFjaChwYXRoID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlcyA9IGVycm9yc1twYXRoXTtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlcy5mb3JFYWNoKG1lc3NhZ2UgPT4gdGhpcy5lcnJvckFjY3VtdWxhdG9yLnJlcG9ydChwYXRoLCBtZXNzYWdlKSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZXJyb3JCdWZmZXIgPSBudWxsO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/validator/validation-context.ts\n ** module id = 28\n ** module chunks = 0\n **/","\"use strict\";\r\nfunction __export(m) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n__export(require(\"./primitive-type-rules\"));\r\n__export(require(\"./object-rules\"));\r\n__export(require(\"./hash-rules\"));\r\n__export(require(\"./array-rules\"));\r\n__export(require(\"./rules-base\"));\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsaUJBQWMsd0JBQXdCLENBQUMsRUFBQTtBQUN2QyxpQkFBYyxnQkFBZ0IsQ0FBQyxFQUFBO0FBQy9CLGlCQUFjLGNBQWMsQ0FBQyxFQUFBO0FBQzdCLGlCQUFjLGVBQWUsQ0FBQyxFQUFBO0FBQzlCLGlCQUFjLGNBQWMsQ0FBQyxFQUFBIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0ICogZnJvbSBcIi4vcHJpbWl0aXZlLXR5cGUtcnVsZXNcIjtcclxuZXhwb3J0ICogZnJvbSBcIi4vb2JqZWN0LXJ1bGVzXCI7XHJcbmV4cG9ydCAqIGZyb20gXCIuL2hhc2gtcnVsZXNcIjtcclxuZXhwb3J0ICogZnJvbSBcIi4vYXJyYXktcnVsZXNcIjtcclxuZXhwb3J0ICogZnJvbSBcIi4vcnVsZXMtYmFzZVwiO1xyXG4iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/validator/rules/index.ts\n ** module id = 29\n ** module chunks = 0\n **/","\"use strict\";\r\nvar __extends = (this && this.__extends) || function (d, b) {\r\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};\r\nvar rules_base_1 = require(\"./rules-base\");\r\nvar StringRules = (function (_super) {\r\n    __extends(StringRules, _super);\r\n    function StringRules() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    StringRules.prototype.clone = function () {\r\n        return new StringRules();\r\n    };\r\n    /**\r\n     * Checks if value has string type. Undefined value is passed as correct.\r\n     * This rule is applied automatically, don't add call this method manually.\r\n     */\r\n    StringRules.prototype.isString = function (options) {\r\n        options = rules_base_1.ensureRuleOptions(options, {\r\n            errorMessage: \"Value must be a string.\",\r\n            stopOnFailure: true\r\n        });\r\n        return this.checkAndConvert(function (done, value) {\r\n            if (value && typeof value !== \"string\") {\r\n                done(options.errorMessage);\r\n            }\r\n            else {\r\n                done();\r\n            }\r\n        }, null, true, options.stopOnFailure);\r\n    };\r\n    StringRules.prototype.parseString = function (options) {\r\n        options = rules_base_1.ensureRuleOptions(options, {\r\n            errorMessage: \"Value must be a string.\",\r\n            stopOnFailure: true\r\n        });\r\n        return this.parse(function (v) {\r\n            if (!v) {\r\n                return \"\";\r\n            }\r\n            return \"\" + v;\r\n        }, options);\r\n    };\r\n    StringRules.prototype.notEmpty = function (options) {\r\n        options = rules_base_1.ensureRuleOptions(options, {\r\n            errorMessage: \"Value can not be empty.\",\r\n            stopOnFailure: true\r\n        });\r\n        return this.checkAndConvert(function (done, parsedValue) {\r\n            if (!parsedValue || parsedValue.trim().length === 0) {\r\n                done(options.errorMessage);\r\n            }\r\n            else {\r\n                done();\r\n            }\r\n        }, null, false, options.stopOnFailure);\r\n    };\r\n    StringRules.prototype.maxLength = function (maxLength, options) {\r\n        if (maxLength <= 0) {\r\n            throw new Error(\"Max length must be greater than zero.\");\r\n        }\r\n        options = rules_base_1.ensureRuleOptions(options, {\r\n            errorMessage: \"Value is too long.\",\r\n            stopOnFailure: false\r\n        });\r\n        return this.checkAndConvert(function (done, value) {\r\n            if (value && value.length > maxLength) {\r\n                done(options.errorMessage);\r\n            }\r\n            else {\r\n                done();\r\n            }\r\n        }, null, false, options.stopOnFailure);\r\n    };\r\n    StringRules.prototype.minLength = function (minLength, options) {\r\n        if (minLength <= 0) {\r\n            throw new Error(\"Min length must be greater than zero.\");\r\n        }\r\n        options = rules_base_1.ensureRuleOptions(options, {\r\n            errorMessage: \"Value is too short.\",\r\n            stopOnFailure: false\r\n        });\r\n        return this.checkAndConvert(function (done, value) {\r\n            if (value && value.length < minLength) {\r\n                done(options.errorMessage);\r\n            }\r\n            else {\r\n                done();\r\n            }\r\n        }, null, false, options.stopOnFailure);\r\n    };\r\n    return StringRules;\r\n}(rules_base_1.SequentialRuleSet));\r\nexports.StringRules = StringRules;\r\nvar NumberRules = (function (_super) {\r\n    __extends(NumberRules, _super);\r\n    function NumberRules() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    NumberRules.prototype.clone = function () {\r\n        return new NumberRules();\r\n    };\r\n    /**\r\n     * Checks if value is number. Null or undefined values are passed as correct.\r\n     * This rule is applied automatically, don't call it.\r\n     */\r\n    NumberRules.prototype.isNumber = function (options) {\r\n        options = rules_base_1.ensureRuleOptions(options, {\r\n            errorMessage: \"Value is not valid number.\",\r\n            stopOnFailure: true\r\n        });\r\n        return this.checkAndConvert(function (done, value) {\r\n            if (value === null || value === undefined) {\r\n                done();\r\n                return;\r\n            }\r\n            if (typeof value !== \"number\") {\r\n                done(options.errorMessage);\r\n                return;\r\n            }\r\n            done();\r\n        }, null, true, options.stopOnFailure);\r\n    };\r\n    /**\r\n     * Parses number.\r\n     */\r\n    NumberRules.prototype.parseNumber = function (options) {\r\n        options = rules_base_1.ensureRuleOptions(options, {\r\n            errorMessage: \"Value is not valid number.\",\r\n            stopOnFailure: false\r\n        });\r\n        var failResult = new Object();\r\n        return this.checkAndConvert(function (done, convertedValue, obj, root) {\r\n            if (convertedValue == failResult) {\r\n                done(options.errorMessage);\r\n            }\r\n            else {\r\n                done();\r\n            }\r\n        }, function (inputValue, validatingObject, rootObject) {\r\n            if (inputValue === null || inputValue === undefined) {\r\n                return inputValue;\r\n            }\r\n            var converted = parseFloat(inputValue);\r\n            if (converted === null || converted === undefined || isNaN(converted)) {\r\n                return failResult;\r\n            }\r\n            return converted;\r\n        }, false, options.stopOnFailure);\r\n    };\r\n    return NumberRules;\r\n}(rules_base_1.SequentialRuleSet));\r\nexports.NumberRules = NumberRules;\r\nfunction str(convert, options) {\r\n    if (convert === void 0) { convert = true; }\r\n    options = rules_base_1.ensureRuleOptions(options, {\r\n        errorMessage: \"Value is not a string.\",\r\n        stopOnFailure: true\r\n    });\r\n    if (convert) {\r\n        return new StringRules().parseString(options);\r\n    }\r\n    else {\r\n        return new StringRules().isString(options);\r\n    }\r\n}\r\nexports.str = str;\r\nfunction num(convert, options) {\r\n    if (convert === void 0) { convert = true; }\r\n    options = rules_base_1.ensureRuleOptions(options, {\r\n        errorMessage: \"Value is not a valid number.\",\r\n        stopOnFailure: true\r\n    });\r\n    if (convert) {\r\n        return new NumberRules().parseNumber(options);\r\n    }\r\n    else {\r\n        return new NumberRules().isNumber(options);\r\n    }\r\n}\r\nexports.num = num;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpbWl0aXZlLXR5cGUtcnVsZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwcmltaXRpdmUtdHlwZS1ydWxlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSwyQkFBcUQsY0FBYyxDQUFDLENBQUE7QUFFcEU7SUFBaUMsK0JBQXlCO0lBQTFEO1FBQWlDLDhCQUF5QjtJQWtIMUQsQ0FBQztJQWhIYSwyQkFBSyxHQUFmO1FBQ0ksTUFBTSxDQUFPLElBQUksV0FBVyxFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVEOzs7T0FHRztJQUNILDhCQUFRLEdBQVIsVUFBUyxPQUFxQjtRQUMxQixPQUFPLEdBQUcsOEJBQWlCLENBQUMsT0FBTyxFQUFFO1lBQ2pDLFlBQVksRUFBRSx5QkFBeUI7WUFDdkMsYUFBYSxFQUFFLElBQUk7U0FDdEIsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQ3ZCLFVBQUMsSUFBSSxFQUFFLEtBQUs7WUFDUixFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDckMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUMvQixDQUFDO1lBQ0QsSUFBSSxDQUFDLENBQUM7Z0JBQ0YsSUFBSSxFQUFFLENBQUM7WUFDWCxDQUFDO1FBQ0wsQ0FBQyxFQUNELElBQUksRUFDSixJQUFJLEVBQ0osT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFRCxpQ0FBVyxHQUFYLFVBQVksT0FBcUI7UUFDN0IsT0FBTyxHQUFHLDhCQUFpQixDQUFDLE9BQU8sRUFBRTtZQUNqQyxZQUFZLEVBQUUseUJBQXlCO1lBQ3ZDLGFBQWEsRUFBRSxJQUFJO1NBQ3RCLENBQUMsQ0FBQTtRQUVGLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUNiLFVBQUEsQ0FBQztZQUNHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FB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Q0FBQyxDQUFDO0lBQy9DLENBQUM7QUFDTCxDQUFDO0FBWmUsV0FBRyxNQVlsQixDQUFBO0FBRUQsYUFBb0IsT0FBdUIsRUFBRSxPQUFxQjtJQUE5Qyx1QkFBdUIsR0FBdkIsY0FBdUI7SUFDdkMsT0FBTyxHQUFHLDhCQUFpQixDQUFDLE9BQU8sRUFBRTtRQUNqQyxZQUFZLEVBQUUsOEJBQThCO1FBQzVDLGFBQWEsRUFBRSxJQUFJO0tBQ3RCLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDVixNQUFNLENBQUMsSUFBSSxXQUFXLEVBQUUsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUNELElBQUksQ0FBQyxDQUFDO1FBQ0YsTUFBTSxDQUFDLElBQUksV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQy9DLENBQUM7QUFDTCxDQUFDO0FBWmUsV0FBRyxNQVlsQixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUnVsZU9wdGlvbnMgfSBmcm9tIFwiLi4vZGVmaW5pdGlvbnNcIjtcclxuaW1wb3J0IHsgU2VxdWVudGlhbFJ1bGVTZXQsIGVuc3VyZVJ1bGVPcHRpb25zIH0gZnJvbSBcIi4vcnVsZXMtYmFzZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFN0cmluZ1J1bGVzIGV4dGVuZHMgU2VxdWVudGlhbFJ1bGVTZXQ8c3RyaW5nPiB7XHJcblxyXG4gICAgcHJvdGVjdGVkIGNsb25lKCk6IHRoaXMge1xyXG4gICAgICAgIHJldHVybiA8dGhpcz5uZXcgU3RyaW5nUnVsZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogXHJcbiAgICAgKiBDaGVja3MgaWYgdmFsdWUgaGFzIHN0cmluZyB0eXBlLiBVbmRlZmluZWQgdmFsdWUgaXMgcGFzc2VkIGFzIGNvcnJlY3QuIFxyXG4gICAgICogVGhpcyBydWxlIGlzIGFwcGxpZWQgYXV0b21hdGljYWxseSwgZG9uJ3QgYWRkIGNhbGwgdGhpcyBtZXRob2QgbWFudWFsbHkuXHJcbiAgICAgKi9cclxuICAgIGlzU3RyaW5nKG9wdGlvbnM/OiBSdWxlT3B0aW9ucyk6IHRoaXMge1xyXG4gICAgICAgIG9wdGlvbnMgPSBlbnN1cmVSdWxlT3B0aW9ucyhvcHRpb25zLCB7XHJcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZTogXCJWYWx1ZSBtdXN0IGJlIGEgc3RyaW5nLlwiLFxyXG4gICAgICAgICAgICBzdG9wT25GYWlsdXJlOiB0cnVlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrQW5kQ29udmVydChcclxuICAgICAgICAgICAgKGRvbmUsIHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlICE9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9uZShvcHRpb25zLmVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG51bGwsXHJcbiAgICAgICAgICAgIHRydWUsXHJcbiAgICAgICAgICAgIG9wdGlvbnMuc3RvcE9uRmFpbHVyZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcGFyc2VTdHJpbmcob3B0aW9ucz86IFJ1bGVPcHRpb25zKTogdGhpcyB7XHJcbiAgICAgICAgb3B0aW9ucyA9IGVuc3VyZVJ1bGVPcHRpb25zKG9wdGlvbnMsIHtcclxuICAgICAgICAgICAgZXJyb3JNZXNzYWdlOiBcIlZhbHVlIG11c3QgYmUgYSBzdHJpbmcuXCIsXHJcbiAgICAgICAgICAgIHN0b3BPbkZhaWx1cmU6IHRydWVcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZShcclxuICAgICAgICAgICAgdiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXYpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcIiArIHY7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIG5vdEVtcHR5KG9wdGlvbnM/OiBSdWxlT3B0aW9ucyk6IHRoaXMge1xyXG5cclxuICAgICAgICBvcHRpb25zID0gZW5zdXJlUnVsZU9wdGlvbnMob3B0aW9ucywge1xyXG4gICAgICAgICAgICBlcnJvck1lc3NhZ2U6IFwiVmFsdWUgY2FuIG5vdCBiZSBlbXB0eS5cIixcclxuICAgICAgICAgICAgc3RvcE9uRmFpbHVyZTogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja0FuZENvbnZlcnQoXHJcbiAgICAgICAgICAgIChkb25lLCBwYXJzZWRWYWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFwYXJzZWRWYWx1ZSB8fCBwYXJzZWRWYWx1ZS50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9uZShvcHRpb25zLmVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG51bGwsXHJcbiAgICAgICAgICAgIGZhbHNlLFxyXG4gICAgICAgICAgICBvcHRpb25zLnN0b3BPbkZhaWx1cmUpO1xyXG4gICAgfVxyXG5cclxuICAgIG1heExlbmd0aChtYXhMZW5ndGg6IG51bWJlciwgb3B0aW9ucz86IFJ1bGVPcHRpb25zKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKG1heExlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1heCBsZW5ndGggbXVzdCBiZSBncmVhdGVyIHRoYW4gemVyby5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9wdGlvbnMgPSBlbnN1cmVSdWxlT3B0aW9ucyhvcHRpb25zLCB7XHJcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZTogXCJWYWx1ZSBpcyB0b28gbG9uZy5cIixcclxuICAgICAgICAgICAgc3RvcE9uRmFpbHVyZTogZmFsc2VcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tBbmRDb252ZXJ0KFxyXG4gICAgICAgICAgICAoZG9uZSwgdmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggPiBtYXhMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb25lKG9wdGlvbnMuZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbnVsbCxcclxuICAgICAgICAgICAgZmFsc2UsXHJcbiAgICAgICAgICAgIG9wdGlvbnMuc3RvcE9uRmFpbHVyZSk7XHJcbiAgICB9XHJcblxyXG4gICAgbWluTGVuZ3RoKG1pbkxlbmd0aDogbnVtYmVyLCBvcHRpb25zPzogUnVsZU9wdGlvbnMpOiB0aGlzIHtcclxuICAgICAgICBpZiAobWluTGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWluIGxlbmd0aCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvLlwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9wdGlvbnMgPSBlbnN1cmVSdWxlT3B0aW9ucyhvcHRpb25zLCB7XHJcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZTogXCJWYWx1ZSBpcyB0b28gc2hvcnQuXCIsXHJcbiAgICAgICAgICAgIHN0b3BPbkZhaWx1cmU6IGZhbHNlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrQW5kQ29udmVydChcclxuICAgICAgICAgICAgKGRvbmUsIHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWUubGVuZ3RoIDwgbWluTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9uZShvcHRpb25zLmVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG51bGwsXHJcbiAgICAgICAgICAgIGZhbHNlLFxyXG4gICAgICAgICAgICBvcHRpb25zLnN0b3BPbkZhaWx1cmUpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTnVtYmVyUnVsZXMgZXh0ZW5kcyBTZXF1ZW50aWFsUnVsZVNldDxudW1iZXI+IHtcclxuXHJcbiAgICBwcm90ZWN0ZWQgY2xvbmUoKTogTnVtYmVyUnVsZXMge1xyXG4gICAgICAgIHJldHVybiBuZXcgTnVtYmVyUnVsZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogXHJcbiAgICAgKiBDaGVja3MgaWYgdmFsdWUgaXMgbnVtYmVyLiBOdWxsIG9yIHVuZGVmaW5lZCB2YWx1ZXMgYXJlIHBhc3NlZCBhcyBjb3JyZWN0LiBcclxuICAgICAqIFRoaXMgcnVsZSBpcyBhcHBsaWVkIGF1dG9tYXRpY2FsbHksIGRvbid0IGNhbGwgaXQuIFxyXG4gICAgICovXHJcbiAgICBpc051bWJlcihvcHRpb25zPzogUnVsZU9wdGlvbnMpOiB0aGlzIHtcclxuICAgICAgICBvcHRpb25zID0gZW5zdXJlUnVsZU9wdGlvbnMob3B0aW9ucywge1xyXG4gICAgICAgICAgICBlcnJvck1lc3NhZ2U6IFwiVmFsdWUgaXMgbm90IHZhbGlkIG51bWJlci5cIixcclxuICAgICAgICAgICAgc3RvcE9uRmFpbHVyZTogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja0FuZENvbnZlcnQoXHJcbiAgICAgICAgICAgIChkb25lLCB2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IFwibnVtYmVyXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb25lKG9wdGlvbnMuZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZG9uZSgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBudWxsLFxyXG4gICAgICAgICAgICB0cnVlLFxyXG4gICAgICAgICAgICBvcHRpb25zLnN0b3BPbkZhaWx1cmUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGFyc2VzIG51bWJlci5cclxuICAgICAqL1xyXG4gICAgcGFyc2VOdW1iZXIob3B0aW9ucz86IFJ1bGVPcHRpb25zKTogdGhpcyB7XHJcbiAgICAgICAgb3B0aW9ucyA9IGVuc3VyZVJ1bGVPcHRpb25zKG9wdGlvbnMsIHtcclxuICAgICAgICAgICAgZXJyb3JNZXNzYWdlOiBcIlZhbHVlIGlzIG5vdCB2YWxpZCBudW1iZXIuXCIsXHJcbiAgICAgICAgICAgIHN0b3BPbkZhaWx1cmU6IGZhbHNlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGZhaWxSZXN1bHQgPSBuZXcgT2JqZWN0KCk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrQW5kQ29udmVydChcclxuICAgICAgICAgICAgKGRvbmUsIGNvbnZlcnRlZFZhbHVlLCBvYmosIHJvb3QpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChjb252ZXJ0ZWRWYWx1ZSA9PSBmYWlsUmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9uZShvcHRpb25zLmVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIChpbnB1dFZhbHVlLCB2YWxpZGF0aW5nT2JqZWN0LCByb290T2JqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXRWYWx1ZSA9PT0gbnVsbCB8fCBpbnB1dFZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5wdXRWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb252ZXJ0ZWQgPSBwYXJzZUZsb2F0KGlucHV0VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnZlcnRlZCA9PT0gbnVsbCB8fCBjb252ZXJ0ZWQgPT09IHVuZGVmaW5lZCB8fCBpc05hTihjb252ZXJ0ZWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDxudW1iZXI+PGFueT5mYWlsUmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBjb252ZXJ0ZWQ7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZhbHNlLFxyXG4gICAgICAgICAgICBvcHRpb25zLnN0b3BPbkZhaWx1cmUpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHN0cihjb252ZXJ0OiBib29sZWFuID0gdHJ1ZSwgb3B0aW9ucz86IFJ1bGVPcHRpb25zKTogU3RyaW5nUnVsZXMge1xyXG4gICAgb3B0aW9ucyA9IGVuc3VyZVJ1bGVPcHRpb25zKG9wdGlvbnMsIHtcclxuICAgICAgICBlcnJvck1lc3NhZ2U6IFwiVmFsdWUgaXMgbm90IGEgc3RyaW5nLlwiLFxyXG4gICAgICAgIHN0b3BPbkZhaWx1cmU6IHRydWVcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChjb252ZXJ0KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdSdWxlcygpLnBhcnNlU3RyaW5nKG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdSdWxlcygpLmlzU3RyaW5nKG9wdGlvbnMpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbnVtKGNvbnZlcnQ6IGJvb2xlYW4gPSB0cnVlLCBvcHRpb25zPzogUnVsZU9wdGlvbnMpOiBOdW1iZXJSdWxlcyB7XHJcbiAgICBvcHRpb25zID0gZW5zdXJlUnVsZU9wdGlvbnMob3B0aW9ucywge1xyXG4gICAgICAgIGVycm9yTWVzc2FnZTogXCJWYWx1ZSBpcyBub3QgYSB2YWxpZCBudW1iZXIuXCIsXHJcbiAgICAgICAgc3RvcE9uRmFpbHVyZTogdHJ1ZVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGNvbnZlcnQpIHtcclxuICAgICAgICByZXR1cm4gbmV3IE51bWJlclJ1bGVzKCkucGFyc2VOdW1iZXIob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gbmV3IE51bWJlclJ1bGVzKCkuaXNOdW1iZXIob3B0aW9ucyk7XHJcbiAgICB9XHJcbn1cclxuIl19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/validator/rules/primitive-type-rules.ts\n ** module id = 30\n ** module chunks = 0\n **/","\"use strict\";\r\nvar __extends = (this && this.__extends) || function (d, b) {\r\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};\r\nfunction ensureRuleOptions(options, defaultRuleOptions) {\r\n    options = options || defaultRuleOptions;\r\n    if (!options) {\r\n        throw new Error(\"Options is required\");\r\n    }\r\n    if (defaultRuleOptions.stopOnFailure === null || defaultRuleOptions.stopOnFailure === undefined) {\r\n        defaultRuleOptions.stopOnFailure = false;\r\n    }\r\n    if (options.stopOnFailure === null || options.stopOnFailure === undefined) {\r\n        options.stopOnFailure = defaultRuleOptions.stopOnFailure;\r\n    }\r\n    var result = {\r\n        errorMessage: options.errorMessage || defaultRuleOptions.errorMessage,\r\n        stopOnFailure: options.stopOnFailure\r\n    };\r\n    if (!result.errorMessage) {\r\n        throw new Error(\"Error message is required.\");\r\n    }\r\n    return result;\r\n}\r\nexports.ensureRuleOptions = ensureRuleOptions;\r\n/**\r\n * Combines rules array into single rule which runs all rules.\r\n * Parsing stage is run for all rules one by one using previous rule result as input for next rule.\r\n * Validation stage is run for all rules sequentially but stops if rule with stopOnFailure = true is failed.\r\n */\r\nfunction combineRules() {\r\n    var rules = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        rules[_i - 0] = arguments[_i];\r\n    }\r\n    rules = rules || [];\r\n    return {\r\n        stopOnFailure: false,\r\n        /** Runs parsing on all rules. */\r\n        runParse: function (inputValue, validatingObject, rootObject) {\r\n            return rules.reduce(function (currentValue, rule) { return rule.runParse(currentValue, validatingObject, rootObject); }, inputValue);\r\n        },\r\n        /** Runs all chained rules. */\r\n        runValidate: function (context, doneCallback, parsedValue, validatingObject, rootObject) {\r\n            if (!context) {\r\n                throw new Error(\"context is required.\");\r\n            }\r\n            if (!doneCallback) {\r\n                throw new Error(\"done callback is required.\");\r\n            }\r\n            var allRulesValid = true;\r\n            var rulesToRun = rules.slice();\r\n            var runRule = function () {\r\n                var rule = rulesToRun.shift();\r\n                if (rule) {\r\n                    rule.runValidate(context, function (success) {\r\n                        if (!success && rule.stopOnFailure) {\r\n                            doneCallback(false);\r\n                            return;\r\n                        }\r\n                        allRulesValid = allRulesValid && success;\r\n                        // Runs next rule recursively\r\n                        runRule();\r\n                    }, parsedValue, validatingObject, rootObject);\r\n                }\r\n                else {\r\n                    doneCallback(allRulesValid);\r\n                }\r\n            };\r\n            runRule();\r\n        }\r\n    };\r\n}\r\nexports.combineRules = combineRules;\r\n/**\r\n * Base class which can contain a set of rules which runs sequentially,\r\n * accumulates errors.\r\n * Each next rule validates conversion result of previous rule if successful or last successful value or input.\r\n */\r\nvar SequentialRuleSet = (function () {\r\n    function SequentialRuleSet() {\r\n        this.rules = [];\r\n        this.stopOnFailure = false;\r\n    }\r\n    /** Runs parsing on all rules. */\r\n    SequentialRuleSet.prototype.runParse = function (inputValue, validatingObject, rootObject) {\r\n        return combineRules.apply(void 0, this.rules).runParse(inputValue, validatingObject, rootObject);\r\n    };\r\n    /** Runs all chained rules. */\r\n    SequentialRuleSet.prototype.runValidate = function (context, doneCallback, parsedValue, validatingObject, rootObject) {\r\n        if (!context) {\r\n            throw new Error(\"context is required.\");\r\n        }\r\n        if (!doneCallback) {\r\n            throw new Error(\"done callback is required.\");\r\n        }\r\n        combineRules.apply(void 0, this.rules).runValidate(context, doneCallback, parsedValue, validatingObject, rootObject);\r\n    };\r\n    /**\r\n     * Adds a rule which uses custom functions for validation and converting.\r\n     * If parsing function is not provided value is passed to validation function without conversion.\r\n     */\r\n    SequentialRuleSet.prototype.checkAndConvert = function (validationFn, parseFn, putRuleFirst, stopOnFailure) {\r\n        if (putRuleFirst === void 0) { putRuleFirst = false; }\r\n        if (stopOnFailure === void 0) { stopOnFailure = false; }\r\n        if (!validationFn) {\r\n            throw new Error(\"Validation function is required.\");\r\n        }\r\n        parseFn = (parseFn || (function (input) { return input; }));\r\n        return this.withRule({\r\n            stopOnFailure: stopOnFailure,\r\n            runParse: parseFn,\r\n            runValidate: function (context, done, inputValue, validatingObject, rootObject) {\r\n                validationFn(function (errorMessage) {\r\n                    if (errorMessage) {\r\n                        context.reportError(errorMessage);\r\n                        done(false);\r\n                    }\r\n                    else {\r\n                        done(true);\r\n                    }\r\n                }, inputValue, validatingObject, rootObject);\r\n            }\r\n        }, putRuleFirst);\r\n    };\r\n    /** Fails if input value is null or undefined. */\r\n    SequentialRuleSet.prototype.required = function (options) {\r\n        options = ensureRuleOptions(options, { errorMessage: \"Value is required.\", stopOnFailure: true });\r\n        return this.checkAndConvert(function (done, input) {\r\n            if (input === null || input === undefined) {\r\n                done(options.errorMessage);\r\n            }\r\n            else {\r\n                done();\r\n            }\r\n        }, null, true, options.stopOnFailure);\r\n    };\r\n    /**\r\n     * Parses input value.\r\n     * Parse rules runs first.\r\n     * If transformation function returns null or undefined or throws an error fails with specified error message.\r\n     */\r\n    SequentialRuleSet.prototype.parse = function (convertFn, options) {\r\n        if (!convertFn) {\r\n            throw new Error(\"Transformation function is required.\");\r\n        }\r\n        options = ensureRuleOptions(options, {\r\n            errorMessage: \"Conversion failed.\",\r\n            stopOnFailure: true\r\n        });\r\n        var failResult = new Object();\r\n        return this.checkAndConvert(function (done, convertedValue, obj, root) {\r\n            if (convertedValue == failResult) {\r\n                done(options.errorMessage);\r\n            }\r\n            else {\r\n                done();\r\n            }\r\n        }, function (inputValue, validatingObject, rootObject) {\r\n            try {\r\n                var converted = convertFn(inputValue, validatingObject, rootObject);\r\n                if (converted === null || converted === undefined) {\r\n                    return failResult;\r\n                }\r\n                return converted;\r\n            }\r\n            catch (e) {\r\n                return failResult;\r\n            }\r\n        }, false, options.stopOnFailure);\r\n    };\r\n    SequentialRuleSet.prototype.must = function (predicate, options) {\r\n        if (!predicate) {\r\n            throw new Error(\"Predicate is required.\");\r\n        }\r\n        options = ensureRuleOptions(options, {\r\n            errorMessage: \"Value is not valid.\",\r\n            stopOnFailure: false\r\n        });\r\n        return this.checkAndConvert(function (done, input, obj, root) {\r\n            if (!predicate(input, obj, root)) {\r\n                done(options.errorMessage);\r\n            }\r\n            else {\r\n                done();\r\n            }\r\n        }, null, false, options.stopOnFailure);\r\n    };\r\n    SequentialRuleSet.prototype.withRule = function (rule, putRuleFirst) {\r\n        if (putRuleFirst === void 0) { putRuleFirst = false; }\r\n        if (!rule) {\r\n            throw new Error(\"rule is required\");\r\n        }\r\n        var copy = this.clone();\r\n        copy.stopOnFailure = this.stopOnFailure;\r\n        if (putRuleFirst) {\r\n            copy.rules = [rule].concat(this.rules);\r\n        }\r\n        else {\r\n            copy.rules = this.rules.concat([rule]);\r\n        }\r\n        return copy;\r\n    };\r\n    return SequentialRuleSet;\r\n}());\r\nexports.SequentialRuleSet = SequentialRuleSet;\r\n/**\r\n * Encapsulates rule enclosed in set of rules run before and after the rule.\r\n *\r\n * Parsing only run for main rule. All other rules uses main rule parsing result as input.\r\n *\r\n * The main rule is run only if all rules run before has been run successfuly.\r\n * The rules to run after would be only run if main rule run successfuly.\r\n *\r\n * Enclosing rule would be run successfuly only if all rules (before, main and after) has run successfuly.\r\n */\r\nvar EnclosingValidationRuleBase = (function () {\r\n    function EnclosingValidationRuleBase(rule) {\r\n        this.rule = rule;\r\n        this.rulesBefore = [];\r\n        this.rulesAfter = [];\r\n        this.stopOnFailure = false;\r\n        if (!rule) {\r\n            throw new Error(\"Validation rule is required.\");\r\n        }\r\n    }\r\n    EnclosingValidationRuleBase.prototype.runParse = function (inputValue, validatingObject, rootObject) {\r\n        return combineRules(this.rule).runParse(inputValue, validatingObject, rootObject);\r\n    };\r\n    EnclosingValidationRuleBase.prototype.runValidate = function (context, doneCallback, obj, validatingObject, rootObject) {\r\n        var all = (this.rulesBefore || []).concat([\r\n            this.rule\r\n        ], (this.rulesAfter || []));\r\n        combineRules.apply(void 0, all).runValidate(context, doneCallback, obj, validatingObject, rootObject);\r\n    };\r\n    EnclosingValidationRuleBase.prototype.stopOnFail = function (stopOnFailure) {\r\n        if (stopOnFailure === void 0) { stopOnFailure = true; }\r\n        var copy = this.clone();\r\n        copy.stopOnFailure = stopOnFailure;\r\n        return copy;\r\n    };\r\n    /** Disables null object. */\r\n    EnclosingValidationRuleBase.prototype.required = function (options) {\r\n        options = ensureRuleOptions(options, {\r\n            errorMessage: \"Object is required.\",\r\n            stopOnFailure: true\r\n        });\r\n        var result = this.copy();\r\n        result.rulesBefore = [any(function (v) { return v !== null && v !== undefined; }, options)].concat(result.rulesBefore);\r\n        return result;\r\n    };\r\n    /** Adds a rule which is run before validation. */\r\n    EnclosingValidationRuleBase.prototype.runBefore = function (rule) {\r\n        if (!rule) {\r\n            throw new Error(\"rule is required\");\r\n        }\r\n        var result = this.copy();\r\n        result.rulesBefore = this.rulesBefore.concat([rule]);\r\n        return result;\r\n    };\r\n    /** Adds a rule which is run after validation. */\r\n    EnclosingValidationRuleBase.prototype.runAfter = function (rule) {\r\n        if (!rule) {\r\n            throw new Error(\"rule is required\");\r\n        }\r\n        var result = this.copy();\r\n        result.rulesAfter = this.rulesAfter.concat([rule]);\r\n        return result;\r\n    };\r\n    EnclosingValidationRuleBase.prototype.before = function (predicate, options) {\r\n        if (!predicate) {\r\n            throw new Error(\"Predicate is required.\");\r\n        }\r\n        return this.runBefore(any(predicate, options));\r\n    };\r\n    EnclosingValidationRuleBase.prototype.after = function (predicate, options) {\r\n        if (!predicate) {\r\n            throw new Error(\"Predicate is required.\");\r\n        }\r\n        return this.runAfter(any(predicate, options));\r\n    };\r\n    EnclosingValidationRuleBase.prototype.withMainRule = function (rule) {\r\n        if (!rule) {\r\n            throw new Error(\"Rule is required.\");\r\n        }\r\n        var result = this.copy();\r\n        result.rule = rule;\r\n        return result;\r\n    };\r\n    EnclosingValidationRuleBase.prototype.copy = function () {\r\n        var result = this.clone();\r\n        result.rulesBefore = this.rulesBefore.slice();\r\n        result.rulesAfter = this.rulesAfter.slice();\r\n        result.stopOnFailure = this.stopOnFailure;\r\n        return result;\r\n    };\r\n    return EnclosingValidationRuleBase;\r\n}());\r\nexports.EnclosingValidationRuleBase = EnclosingValidationRuleBase;\r\nvar EmptyRule = (function () {\r\n    function EmptyRule() {\r\n        this.stopOnFailure = false;\r\n    }\r\n    EmptyRule.prototype.runParse = function (inputValue, validatingObject, rootObject) {\r\n        return inputValue;\r\n    };\r\n    /** Runs all chained rules. */\r\n    EmptyRule.prototype.runValidate = function (context, doneCallback, parsedValue, validatingObject, rootObject) {\r\n        doneCallback(true);\r\n    };\r\n    return EmptyRule;\r\n}());\r\nexports.EmptyRule = EmptyRule;\r\nvar AnyRules = (function (_super) {\r\n    __extends(AnyRules, _super);\r\n    function AnyRules(stopOnFailure) {\r\n        _super.call(this);\r\n        this.stopOnFailure = stopOnFailure;\r\n    }\r\n    AnyRules.prototype.clone = function () {\r\n        return new AnyRules(this.stopOnFailure);\r\n    };\r\n    return AnyRules;\r\n}(SequentialRuleSet));\r\nexports.AnyRules = AnyRules;\r\n/** Validates any value using given predicate. */\r\nfunction any(predicate, options) {\r\n    options = ensureRuleOptions(options, {\r\n        stopOnFailure: false\r\n    });\r\n    predicate = predicate || (function (v) { return true; });\r\n    return new AnyRules(options.stopOnFailure).must(predicate, options);\r\n}\r\nexports.any = any;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnVsZXMtYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInJ1bGVzLWJhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBRUEsMkJBQWtDLE9BQW9CLEVBQUUsa0JBQStCO0lBQ25GLE9BQU8sR0FBRyxPQUFPLElBQUksa0JBQWtCLENBQUM7SUFDeEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ1gsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxFQUFFLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLEtBQUssSUFBSSxJQUFJLGtCQUFrQixDQUFDLGFBQWEsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQzlGLGtCQUFrQixDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7SUFDN0MsQ0FBQztJQUVELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEtBQUssSUFBSSxJQUFJLE9BQU8sQ0FBQyxhQUFhLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztRQUN4RSxPQUFPLENBQUMsYUFBYSxHQUFHLGtCQUFrQixDQUFDLGFBQWEsQ0FBQztJQUM3RCxDQUFDO0lBRUQsSUFBTSxNQUFNLEdBQWdCO1FBQ3hCLFlBQVksRUFBRSxPQUFPLENBQUMsWUFBWSxJQUFJLGtCQUFrQixDQUFDLFlBQVk7UUFDckUsYUFBYSxFQUFFLE9BQU8sQ0FBQyxhQUFhO0tBQ3ZDLENBQUM7SUFFRixFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLE1BQU0sSUFBSSxLQUFLLENBQUMsNEJBQTRCLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUNsQixDQUFDO0FBeEJlLHlCQUFpQixvQkF3QmhDLENBQUE7QUFFRDs7OztHQUlHO0FBQ0g7SUFBZ0MsZUFBNkI7U0FBN0IsV0FBNkIsQ0FB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RSxnQkFBc0IsRUFBRSxVQUFnQjtRQUM5RCxNQUFNLENBQUksVUFBVSxDQUFDO0lBQ3pCLENBQUM7SUFFRCw4QkFBOEI7SUFDOUIsK0JBQVcsR0FBWCxVQUFZLE9BQTJCLEVBQ25DLFlBQXdDLEVBQ3hDLFdBQWdCLEVBQ2hCLGdCQUFzQixFQUN0QixVQUFnQjtRQUNoQixZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkIsQ0FBQztJQUNMLGdCQUFDO0FBQUQsQ0FBQyxBQWhCRCxJQWdCQztBQWhCWSxpQkFBUyxZQWdCckIsQ0FBQTtBQUVEO0lBQWlDLDRCQUFvQjtJQUNqRCxrQkFBWSxhQUFzQjtRQUM5QixpQkFBTyxDQUFDO1FBQ1IsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7SUFDdkMsQ0FBQztJQUVTLHdCQUFLLEdBQWY7UUFDSSxNQUFNLENBQUMsSUFBSSxRQUFRLENBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFDTCxlQUFDO0FBQUQsQ0FBQyxBQVRELENBQWlDLGlCQUFpQixHQVNqRDtBQVRZLGdCQUFRLFdBU3BCLENBQUE7QUFFRCxpREFBaUQ7QUFDakQsYUFBdUIsU0FBaUUsRUFBRSxPQUFxQjtJQUMzRyxPQUFPLEdBQUcsaUJBQWlCLENBQUMsT0FBTyxFQUFFO1FBQ2pDLGFBQWEsRUFBRSxLQUFLO0tBQ3ZCLENBQUMsQ0FBQztJQUVILFNBQVMsR0FBRyxTQUFTLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLElBQUksRUFBSixDQUFJLENBQUMsQ0FBQztJQUNyQyxNQUFNLENBQUMsSUFBSSxRQUFRLENBQUksT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDM0UsQ0FBQztBQVBlLFdBQUcsTUFPbEIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZhbGlkYXRpb25SdWxlLCBJVmFsaWRhdGlvbkNvbnRleHQsIFJ1bGVPcHRpb25zIH0gZnJvbSBcIi4uL2RlZmluaXRpb25zXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZW5zdXJlUnVsZU9wdGlvbnMob3B0aW9uczogUnVsZU9wdGlvbnMsIGRlZmF1bHRSdWxlT3B0aW9uczogUnVsZU9wdGlvbnMpOiBSdWxlT3B0aW9ucyB7XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCBkZWZhdWx0UnVsZU9wdGlvbnM7XHJcbiAgICBpZiAoIW9wdGlvbnMpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJPcHRpb25zIGlzIHJlcXVpcmVkXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChkZWZhdWx0UnVsZU9wdGlvbnMuc3RvcE9uRmFpbHVyZSA9PT0gbnVsbCB8fCBkZWZhdWx0UnVsZU9wdGlvbnMuc3RvcE9uRmFpbHVyZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgZGVmYXVsdFJ1bGVPcHRpb25zLnN0b3BPbkZhaWx1cmUgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3B0aW9ucy5zdG9wT25GYWlsdXJlID09PSBudWxsIHx8IG9wdGlvbnMuc3RvcE9uRmFpbHVyZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgb3B0aW9ucy5zdG9wT25GYWlsdXJlID0gZGVmYXVsdFJ1bGVPcHRpb25zLnN0b3BPbkZhaWx1cmU7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzdWx0OiBSdWxlT3B0aW9ucyA9IHtcclxuICAgICAgICBlcnJvck1lc3NhZ2U6IG9wdGlvbnMuZXJyb3JNZXNzYWdlIHx8IGRlZmF1bHRSdWxlT3B0aW9ucy5lcnJvck1lc3NhZ2UsXHJcbiAgICAgICAgc3RvcE9uRmFpbHVyZTogb3B0aW9ucy5zdG9wT25GYWlsdXJlXHJcbiAgICB9O1xyXG5cclxuICAgIGlmICghcmVzdWx0LmVycm9yTWVzc2FnZSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVycm9yIG1lc3NhZ2UgaXMgcmVxdWlyZWQuXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbi8qKiBcclxuICogQ29tYmluZXMgcnVsZXMgYXJyYXkgaW50byBzaW5nbGUgcnVsZSB3aGljaCBydW5zIGFsbCBydWxlcy5cclxuICogUGFyc2luZyBzdGFnZSBpcyBydW4gZm9yIGFsbCBydWxlcyBvbmUgYnkgb25lIHVzaW5nIHByZXZpb3VzIHJ1bGUgcmVzdWx0IGFzIGlucHV0IGZvciBuZXh0IHJ1bGUuXHJcbiAqIFZhbGlkYXRpb24gc3RhZ2UgaXMgcnVuIGZvciBhbGwgcnVsZXMgc2VxdWVudGlhbGx5IGJ1dCBzdG9wcyBpZiBydWxlIHdpdGggc3RvcE9uRmFpbHVyZSA9IHRydWUgaXMgZmFpbGVkLiAgXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY29tYmluZVJ1bGVzPFQ+KC4uLnJ1bGVzOiBWYWxpZGF0aW9uUnVsZTxUPltdKTogVmFsaWRhdGlvblJ1bGU8VD4ge1xyXG4gICAgcnVsZXMgPSBydWxlcyB8fCBbXTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHN0b3BPbkZhaWx1cmU6IGZhbHNlLFxyXG4gICAgICAgIC8qKiBSdW5zIHBhcnNpbmcgb24gYWxsIHJ1bGVzLiAqL1xyXG4gICAgICAgIHJ1blBhcnNlKGlucHV0VmFsdWU6IGFueSwgdmFsaWRhdGluZ09iamVjdD86IGFueSwgcm9vdE9iamVjdD86IGFueSk6IFQge1xyXG4gICAgICAgICAgICByZXR1cm4gcnVsZXMucmVkdWNlKChjdXJyZW50VmFsdWUsIHJ1bGUpID0+IHJ1bGUucnVuUGFyc2UoY3VycmVudFZhbHVlLCB2YWxpZGF0aW5nT2JqZWN0LCByb290T2JqZWN0KSwgaW5wdXRWYWx1ZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvKiogUnVucyBhbGwgY2hhaW5lZCBydWxlcy4gKi9cclxuICAgICAgICBydW5WYWxpZGF0ZShjb250ZXh0OiBJVmFsaWRhdGlvbkNvbnRleHQsXHJcbiAgICAgICAgICAgIGRvbmVDYWxsYmFjazogKHN1Y2Nlc3M6IGJvb2xlYW4pID0+IHZvaWQsXHJcbiAgICAgICAgICAgIHBhcnNlZFZhbHVlOiBhbnksXHJcbiAgICAgICAgICAgIHZhbGlkYXRpbmdPYmplY3Q/OiBhbnksXHJcbiAgICAgICAgICAgIHJvb3RPYmplY3Q/OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFjb250ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjb250ZXh0IGlzIHJlcXVpcmVkLlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWRvbmVDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZG9uZSBjYWxsYmFjayBpcyByZXF1aXJlZC5cIik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBhbGxSdWxlc1ZhbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgY29uc3QgcnVsZXNUb1J1biA9IFsuLi5ydWxlc107XHJcblxyXG4gICAgICAgICAgICBjb25zdCBydW5SdWxlID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcnVsZSA9IHJ1bGVzVG9SdW4uc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgIGlmIChydWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVsZS5ydW5WYWxpZGF0ZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHN1Y2Nlc3MpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3VjY2VzcyAmJiBydWxlLnN0b3BPbkZhaWx1cmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lQ2FsbGJhY2soZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGxSdWxlc1ZhbGlkID0gYWxsUnVsZXNWYWxpZCAmJiBzdWNjZXNzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJ1bnMgbmV4dCBydWxlIHJlY3Vyc2l2ZWx5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydW5SdWxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlZFZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW5nT2JqZWN0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByb290T2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvbmVDYWxsYmFjayhhbGxSdWxlc1ZhbGlkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHJ1blJ1bGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XHJcblxyXG4vKipcclxuICogQmFzZSBjbGFzcyB3aGljaCBjYW4gY29udGFpbiBhIHNldCBvZiBydWxlcyB3aGljaCBydW5zIHNlcXVlbnRpYWxseSwgXHJcbiAqIGFjY3VtdWxhdGVzIGVycm9ycy4gXHJcbiAqIEVhY2ggbmV4dCBydWxlIHZhbGlkYXRlcyBjb252ZXJzaW9uIHJlc3VsdCBvZiBwcmV2aW91cyBydWxlIGlmIHN1Y2Nlc3NmdWwgb3IgbGFzdCBzdWNjZXNzZnVsIHZhbHVlIG9yIGlucHV0LiBcclxuICovXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBTZXF1ZW50aWFsUnVsZVNldDxUPiBpbXBsZW1lbnRzIFZhbGlkYXRpb25SdWxlPFQ+IHtcclxuICAgIHByaXZhdGUgcnVsZXM6IFZhbGlkYXRpb25SdWxlPFQ+W10gPSBbXTtcclxuXHJcbiAgICBzdG9wT25GYWlsdXJlID0gZmFsc2U7XHJcblxyXG4gICAgLyoqIFJ1bnMgcGFyc2luZyBvbiBhbGwgcnVsZXMuICovXHJcbiAgICBydW5QYXJzZShpbnB1dFZhbHVlOiBhbnksIHZhbGlkYXRpbmdPYmplY3Q/OiBhbnksIHJvb3RPYmplY3Q/OiBhbnkpOiBUIHtcclxuICAgICAgICByZXR1cm4gY29tYmluZVJ1bGVzKC4uLnRoaXMucnVsZXMpLnJ1blBhcnNlKGlucHV0VmFsdWUsIHZhbGlkYXRpbmdPYmplY3QsIHJvb3RPYmplY3QpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiBSdW5zIGFsbCBjaGFpbmVkIHJ1bGVzLiAqL1xyXG4gICAgcnVuVmFsaWRhdGUoXHJcbiAgICAgICAgY29udGV4dDogSVZhbGlkYXRpb25Db250ZXh0LFxyXG4gICAgICAgIGRvbmVDYWxsYmFjazogKHN1Y2Nlc3M6IGJvb2xlYW4pID0+IHZvaWQsXHJcbiAgICAgICAgcGFyc2VkVmFsdWU6IGFueSxcclxuICAgICAgICB2YWxpZGF0aW5nT2JqZWN0PzogYW55LFxyXG4gICAgICAgIHJvb3RPYmplY3Q/OiBhbnkpOiB2b2lkIHtcclxuXHJcbiAgICAgICAgaWYgKCFjb250ZXh0KSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvbnRleHQgaXMgcmVxdWlyZWQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWRvbmVDYWxsYmFjaykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJkb25lIGNhbGxiYWNrIGlzIHJlcXVpcmVkLlwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbWJpbmVSdWxlcyguLi50aGlzLnJ1bGVzKS5ydW5WYWxpZGF0ZShcclxuICAgICAgICAgICAgY29udGV4dCxcclxuICAgICAgICAgICAgZG9uZUNhbGxiYWNrLFxyXG4gICAgICAgICAgICBwYXJzZWRWYWx1ZSxcclxuICAgICAgICAgICAgdmFsaWRhdGluZ09iamVjdCxcclxuICAgICAgICAgICAgcm9vdE9iamVjdFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIFxyXG4gICAgICogQWRkcyBhIHJ1bGUgd2hpY2ggdXNlcyBjdXN0b20gZnVuY3Rpb25zIGZvciB2YWxpZGF0aW9uIGFuZCBjb252ZXJ0aW5nLiBcclxuICAgICAqIElmIHBhcnNpbmcgZnVuY3Rpb24gaXMgbm90IHByb3ZpZGVkIHZhbHVlIGlzIHBhc3NlZCB0byB2YWxpZGF0aW9uIGZ1bmN0aW9uIHdpdGhvdXQgY29udmVyc2lvbi4gXHJcbiAgICAgKi9cclxuICAgIGNoZWNrQW5kQ29udmVydChcclxuICAgICAgICB2YWxpZGF0aW9uRm46IChkb25lQ2FsbGJhY2s6IChlcnJvck1lc3NhZ2U/OiBzdHJpbmcpID0+IHZvaWQsIHBhcnNlZFZhbHVlOiBULCB2YWxpZGF0aW5nT2JqZWN0PzogYW55LCByb290T2JqZWN0PzogYW55KSA9PiB2b2lkLFxyXG4gICAgICAgIHBhcnNlRm4/OiAoaW5wdXRWYWx1ZTogYW55LCB2YWxpZGF0aW5nT2JqZWN0PzogYW55LCByb290T2JqZWN0PzogYW55KSA9PiBULFxyXG4gICAgICAgIHB1dFJ1bGVGaXJzdDogYm9vbGVhbiA9IGZhbHNlLFxyXG4gICAgICAgIHN0b3BPbkZhaWx1cmUgPSBmYWxzZSkge1xyXG5cclxuICAgICAgICBpZiAoIXZhbGlkYXRpb25Gbikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJWYWxpZGF0aW9uIGZ1bmN0aW9uIGlzIHJlcXVpcmVkLlwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHBhcnNlRm4gPSAocGFyc2VGbiB8fCAoaW5wdXQgPT4gaW5wdXQpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMud2l0aFJ1bGUoXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHN0b3BPbkZhaWx1cmU6IHN0b3BPbkZhaWx1cmUsXHJcblxyXG4gICAgICAgICAgICAgICAgcnVuUGFyc2U6IHBhcnNlRm4sXHJcblxyXG4gICAgICAgICAgICAgICAgcnVuVmFsaWRhdGUoXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dDogSVZhbGlkYXRpb25Db250ZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgIGRvbmU6IChzdWNjZXNzOiBib29sZWFuKSA9PiB2b2lkLFxyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0VmFsdWU6IGFueSxcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW5nT2JqZWN0PzogYW55LFxyXG4gICAgICAgICAgICAgICAgICAgIHJvb3RPYmplY3Q/OiBhbnkpOiB2b2lkIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbkZuKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZXJyb3JNZXNzYWdlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JNZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5yZXBvcnRFcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGluZ09iamVjdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm9vdE9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHB1dFJ1bGVGaXJzdCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIEZhaWxzIGlmIGlucHV0IHZhbHVlIGlzIG51bGwgb3IgdW5kZWZpbmVkLiAqL1xyXG4gICAgcmVxdWlyZWQob3B0aW9ucz86IFJ1bGVPcHRpb25zKTogdGhpcyB7XHJcbiAgICAgICAgb3B0aW9ucyA9IGVuc3VyZVJ1bGVPcHRpb25zKG9wdGlvbnMsIHsgZXJyb3JNZXNzYWdlOiBcIlZhbHVlIGlzIHJlcXVpcmVkLlwiLCBzdG9wT25GYWlsdXJlOiB0cnVlIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja0FuZENvbnZlcnQoXHJcbiAgICAgICAgICAgIChkb25lLCBpbnB1dCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlucHV0ID09PSBudWxsIHx8IGlucHV0ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb25lKG9wdGlvbnMuZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbnVsbCxcclxuICAgICAgICAgICAgdHJ1ZSxcclxuICAgICAgICAgICAgb3B0aW9ucy5zdG9wT25GYWlsdXJlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogXHJcbiAgICAgKiBQYXJzZXMgaW5wdXQgdmFsdWUuXHJcbiAgICAgKiBQYXJzZSBydWxlcyBydW5zIGZpcnN0LlxyXG4gICAgICogSWYgdHJhbnNmb3JtYXRpb24gZnVuY3Rpb24gcmV0dXJucyBudWxsIG9yIHVuZGVmaW5lZCBvciB0aHJvd3MgYW4gZXJyb3IgZmFpbHMgd2l0aCBzcGVjaWZpZWQgZXJyb3IgbWVzc2FnZS5cclxuICAgICAqL1xyXG4gICAgcGFyc2UoY29udmVydEZuOiAoaW5wdXRWYWx1ZTogYW55LCB2YWxpZGF0aW5nT2JqZWN0PzogYW55LCByb290T2JqZWN0PzogYW55KSA9PiBULCBvcHRpb25zPzogUnVsZU9wdGlvbnMpOiB0aGlzIHtcclxuICAgICAgICBpZiAoIWNvbnZlcnRGbikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUcmFuc2Zvcm1hdGlvbiBmdW5jdGlvbiBpcyByZXF1aXJlZC5cIilcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9wdGlvbnMgPSBlbnN1cmVSdWxlT3B0aW9ucyhvcHRpb25zLCB7XHJcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZTogXCJDb252ZXJzaW9uIGZhaWxlZC5cIixcclxuICAgICAgICAgICAgc3RvcE9uRmFpbHVyZTogdHJ1ZVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIGNvbnN0IGZhaWxSZXN1bHQgPSBuZXcgT2JqZWN0KCk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrQW5kQ29udmVydChcclxuICAgICAgICAgICAgKGRvbmUsIGNvbnZlcnRlZFZhbHVlLCBvYmosIHJvb3QpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChjb252ZXJ0ZWRWYWx1ZSA9PSBmYWlsUmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9uZShvcHRpb25zLmVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIChpbnB1dFZhbHVlLCB2YWxpZGF0aW5nT2JqZWN0LCByb290T2JqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnZlcnRlZCA9IGNvbnZlcnRGbihpbnB1dFZhbHVlLCB2YWxpZGF0aW5nT2JqZWN0LCByb290T2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udmVydGVkID09PSBudWxsIHx8IGNvbnZlcnRlZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA8VD48YW55PmZhaWxSZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29udmVydGVkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gPFQ+PGFueT5mYWlsUmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmYWxzZSxcclxuICAgICAgICAgICAgb3B0aW9ucy5zdG9wT25GYWlsdXJlKTtcclxuICAgIH1cclxuXHJcbiAgICBtdXN0KHByZWRpY2F0ZTogKHZhbHVlOiBULCB2YWxpZGF0aW5nT2JqZWN0PzogYW55LCByb290T2JqZWN0PzogYW55KSA9PiBib29sZWFuLCBvcHRpb25zPzogUnVsZU9wdGlvbnMpOiB0aGlzIHtcclxuICAgICAgICBpZiAoIXByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQcmVkaWNhdGUgaXMgcmVxdWlyZWQuXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb3B0aW9ucyA9IGVuc3VyZVJ1bGVPcHRpb25zKG9wdGlvbnMsIHtcclxuICAgICAgICAgICAgZXJyb3JNZXNzYWdlOiBcIlZhbHVlIGlzIG5vdCB2YWxpZC5cIixcclxuICAgICAgICAgICAgc3RvcE9uRmFpbHVyZTogZmFsc2VcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tBbmRDb252ZXJ0KFxyXG4gICAgICAgICAgICAoZG9uZSwgaW5wdXQsIG9iaiwgcm9vdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFwcmVkaWNhdGUoaW5wdXQsIG9iaiwgcm9vdCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb25lKG9wdGlvbnMuZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbnVsbCxcclxuICAgICAgICAgICAgZmFsc2UsXHJcbiAgICAgICAgICAgIG9wdGlvbnMuc3RvcE9uRmFpbHVyZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIHdpdGhSdWxlKHJ1bGU6IFZhbGlkYXRpb25SdWxlPFQ+LCBwdXRSdWxlRmlyc3Q6IGJvb2xlYW4gPSBmYWxzZSk6IHRoaXMge1xyXG4gICAgICAgIGlmICghcnVsZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJydWxlIGlzIHJlcXVpcmVkXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY29weSA9IHRoaXMuY2xvbmUoKTtcclxuXHJcbiAgICAgICAgY29weS5zdG9wT25GYWlsdXJlID0gdGhpcy5zdG9wT25GYWlsdXJlO1xyXG5cclxuICAgICAgICBpZiAocHV0UnVsZUZpcnN0KSB7XHJcbiAgICAgICAgICAgIGNvcHkucnVsZXMgPSBbcnVsZSwgLi4udGhpcy5ydWxlc107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb3B5LnJ1bGVzID0gWy4uLnRoaXMucnVsZXMsIHJ1bGVdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIDx0aGlzPmNvcHk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IGNsb25lKCk6IFNlcXVlbnRpYWxSdWxlU2V0PFQ+O1xyXG59XHJcblxyXG4vKiogXHJcbiAqIEVuY2Fwc3VsYXRlcyBydWxlIGVuY2xvc2VkIGluIHNldCBvZiBydWxlcyBydW4gYmVmb3JlIGFuZCBhZnRlciB0aGUgcnVsZS5cclxuICogXHJcbiAqIFBhcnNpbmcgb25seSBydW4gZm9yIG1haW4gcnVsZS4gQWxsIG90aGVyIHJ1bGVzIHVzZXMgbWFpbiBydWxlIHBhcnNpbmcgcmVzdWx0IGFzIGlucHV0LlxyXG4gKiBcclxuICogVGhlIG1haW4gcnVsZSBpcyBydW4gb25seSBpZiBhbGwgcnVsZXMgcnVuIGJlZm9yZSBoYXMgYmVlbiBydW4gc3VjY2Vzc2Z1bHkuXHJcbiAqIFRoZSBydWxlcyB0byBydW4gYWZ0ZXIgd291bGQgYmUgb25seSBydW4gaWYgbWFpbiBydWxlIHJ1biBzdWNjZXNzZnVseS5cclxuICogXHJcbiAqIEVuY2xvc2luZyBydWxlIHdvdWxkIGJlIHJ1biBzdWNjZXNzZnVseSBvbmx5IGlmIGFsbCBydWxlcyAoYmVmb3JlLCBtYWluIGFuZCBhZnRlcikgaGFzIHJ1biBzdWNjZXNzZnVseS4gIFxyXG4gKi9cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEVuY2xvc2luZ1ZhbGlkYXRpb25SdWxlQmFzZTxUPiBpbXBsZW1lbnRzIFZhbGlkYXRpb25SdWxlPFQ+IHtcclxuICAgIHByaXZhdGUgcnVsZXNCZWZvcmU6IFZhbGlkYXRpb25SdWxlPFQ+W10gPSBbXTtcclxuICAgIHByaXZhdGUgcnVsZXNBZnRlcjogVmFsaWRhdGlvblJ1bGU8VD5bXSA9IFtdO1xyXG5cclxuICAgIHN0b3BPbkZhaWx1cmUgPSBmYWxzZTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcnVsZTogVmFsaWRhdGlvblJ1bGU8VD4pIHtcclxuICAgICAgICBpZiAoIXJ1bGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVmFsaWRhdGlvbiBydWxlIGlzIHJlcXVpcmVkLlwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcnVuUGFyc2UoaW5wdXRWYWx1ZTogYW55LCB2YWxpZGF0aW5nT2JqZWN0PzogYW55LCByb290T2JqZWN0PzogYW55KTogVCB7XHJcbiAgICAgICAgcmV0dXJuIGNvbWJpbmVSdWxlcyh0aGlzLnJ1bGUpLnJ1blBhcnNlKGlucHV0VmFsdWUsIHZhbGlkYXRpbmdPYmplY3QsIHJvb3RPYmplY3QpO1xyXG4gICAgfVxyXG5cclxuICAgIHJ1blZhbGlkYXRlKFxyXG4gICAgICAgIGNvbnRleHQ6IElWYWxpZGF0aW9uQ29udGV4dCxcclxuICAgICAgICBkb25lQ2FsbGJhY2s6IChzdWNjZXNzOiBib29sZWFuKSA9PiB2b2lkLFxyXG4gICAgICAgIG9iajogYW55LFxyXG4gICAgICAgIHZhbGlkYXRpbmdPYmplY3Q/OiBhbnksXHJcbiAgICAgICAgcm9vdE9iamVjdD86IGFueSk6IHZvaWQge1xyXG5cclxuICAgICAgICBjb25zdCBhbGwgPSBbXHJcbiAgICAgICAgICAgIC4uLih0aGlzLnJ1bGVzQmVmb3JlIHx8IFtdKSxcclxuICAgICAgICAgICAgdGhpcy5ydWxlLFxyXG4gICAgICAgICAgICAuLi4odGhpcy5ydWxlc0FmdGVyIHx8IFtdKVxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIGNvbWJpbmVSdWxlcyguLi5hbGwpLnJ1blZhbGlkYXRlKFxyXG4gICAgICAgICAgICBjb250ZXh0LFxyXG4gICAgICAgICAgICBkb25lQ2FsbGJhY2ssXHJcbiAgICAgICAgICAgIG9iaixcclxuICAgICAgICAgICAgdmFsaWRhdGluZ09iamVjdCxcclxuICAgICAgICAgICAgcm9vdE9iamVjdCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHN0b3BPbkZhaWwoc3RvcE9uRmFpbHVyZTogYm9vbGVhbiA9IHRydWUpOiB0aGlzIHtcclxuICAgICAgICBjb25zdCBjb3B5ID0gdGhpcy5jbG9uZSgpO1xyXG5cclxuICAgICAgICBjb3B5LnN0b3BPbkZhaWx1cmUgPSBzdG9wT25GYWlsdXJlO1xyXG5cclxuICAgICAgICByZXR1cm4gPHRoaXM+Y29weTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogRGlzYWJsZXMgbnVsbCBvYmplY3QuICovXHJcbiAgICByZXF1aXJlZChvcHRpb25zPzogUnVsZU9wdGlvbnMpOiB0aGlzIHtcclxuXHJcbiAgICAgICAgb3B0aW9ucyA9IGVuc3VyZVJ1bGVPcHRpb25zKG9wdGlvbnMsIHtcclxuICAgICAgICAgICAgZXJyb3JNZXNzYWdlOiBcIk9iamVjdCBpcyByZXF1aXJlZC5cIixcclxuICAgICAgICAgICAgc3RvcE9uRmFpbHVyZTogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmNvcHkoKTtcclxuXHJcbiAgICAgICAgcmVzdWx0LnJ1bGVzQmVmb3JlID0gW2FueTxUPih2ID0+IHYgIT09IG51bGwgJiYgdiAhPT0gdW5kZWZpbmVkLCBvcHRpb25zKSwgLi4ucmVzdWx0LnJ1bGVzQmVmb3JlXTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICAvKiogQWRkcyBhIHJ1bGUgd2hpY2ggaXMgcnVuIGJlZm9yZSB2YWxpZGF0aW9uLiAqL1xyXG4gICAgcnVuQmVmb3JlKHJ1bGU6IFZhbGlkYXRpb25SdWxlPFQ+KTogdGhpcyB7XHJcbiAgICAgICAgaWYgKCFydWxlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInJ1bGUgaXMgcmVxdWlyZWRcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmNvcHkoKTtcclxuICAgICAgICByZXN1bHQucnVsZXNCZWZvcmUgPSBbLi4udGhpcy5ydWxlc0JlZm9yZSwgcnVsZV07XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIEFkZHMgYSBydWxlIHdoaWNoIGlzIHJ1biBhZnRlciB2YWxpZGF0aW9uLiAqL1xyXG4gICAgcnVuQWZ0ZXIocnVsZTogVmFsaWRhdGlvblJ1bGU8VD4pOiB0aGlzIHtcclxuICAgICAgICBpZiAoIXJ1bGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicnVsZSBpcyByZXF1aXJlZFwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuY29weSgpO1xyXG4gICAgICAgIHJlc3VsdC5ydWxlc0FmdGVyID0gWy4uLnRoaXMucnVsZXNBZnRlciwgcnVsZV07XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGJlZm9yZShwcmVkaWNhdGU6IChvYmo6IFQsIHZhbGlkYXRpbmdPYmplY3Q/OiBhbnksIHJvb3RPYmplY3Q/OiBhbnkpID0+IGJvb2xlYW4sIG9wdGlvbnM/OiBSdWxlT3B0aW9ucyk6IHRoaXMge1xyXG4gICAgICAgIGlmICghcHJlZGljYXRlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlByZWRpY2F0ZSBpcyByZXF1aXJlZC5cIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5ydW5CZWZvcmUoYW55PFQ+KHByZWRpY2F0ZSwgb3B0aW9ucykpO1xyXG4gICAgfVxyXG5cclxuICAgIGFmdGVyKHByZWRpY2F0ZTogKG9iajogVCwgdmFsaWRhdGluZ09iamVjdD86IGFueSwgcm9vdE9iamVjdD86IGFueSkgPT4gYm9vbGVhbiwgb3B0aW9ucz86IFJ1bGVPcHRpb25zKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKCFwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHJlZGljYXRlIGlzIHJlcXVpcmVkLlwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnJ1bkFmdGVyKGFueTxUPihwcmVkaWNhdGUsIG9wdGlvbnMpKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgd2l0aE1haW5SdWxlKHJ1bGU6IFZhbGlkYXRpb25SdWxlPFQ+KTogdGhpcyB7XHJcbiAgICAgICAgaWYgKCFydWxlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlJ1bGUgaXMgcmVxdWlyZWQuXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5jb3B5KCk7XHJcbiAgICAgICAgcmVzdWx0LnJ1bGUgPSBydWxlO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBhYnN0cmFjdCBjbG9uZSgpOiB0aGlzO1xyXG5cclxuICAgIHByaXZhdGUgY29weSgpOiB0aGlzIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmNsb25lKCk7XHJcblxyXG4gICAgICAgIHJlc3VsdC5ydWxlc0JlZm9yZSA9IFsuLi50aGlzLnJ1bGVzQmVmb3JlXTtcclxuICAgICAgICByZXN1bHQucnVsZXNBZnRlciA9IFsuLi50aGlzLnJ1bGVzQWZ0ZXJdO1xyXG4gICAgICAgIHJlc3VsdC5zdG9wT25GYWlsdXJlID0gdGhpcy5zdG9wT25GYWlsdXJlO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRW1wdHlSdWxlPFQ+IGltcGxlbWVudHMgVmFsaWRhdGlvblJ1bGU8VD4ge1xyXG5cclxuICAgIHN0b3BPbkZhaWx1cmUgPSBmYWxzZTtcclxuXHJcbiAgICBydW5QYXJzZShpbnB1dFZhbHVlOiBhbnksIHZhbGlkYXRpbmdPYmplY3Q/OiBhbnksIHJvb3RPYmplY3Q/OiBhbnkpOiBUIHtcclxuICAgICAgICByZXR1cm4gPFQ+aW5wdXRWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogUnVucyBhbGwgY2hhaW5lZCBydWxlcy4gKi9cclxuICAgIHJ1blZhbGlkYXRlKGNvbnRleHQ6IElWYWxpZGF0aW9uQ29udGV4dCxcclxuICAgICAgICBkb25lQ2FsbGJhY2s6IChzdWNjZXNzOiBib29sZWFuKSA9PiB2b2lkLFxyXG4gICAgICAgIHBhcnNlZFZhbHVlOiBhbnksXHJcbiAgICAgICAgdmFsaWRhdGluZ09iamVjdD86IGFueSxcclxuICAgICAgICByb290T2JqZWN0PzogYW55KTogdm9pZCB7XHJcbiAgICAgICAgZG9uZUNhbGxiYWNrKHRydWUpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQW55UnVsZXM8VD4gZXh0ZW5kcyBTZXF1ZW50aWFsUnVsZVNldDxUPiB7XHJcbiAgICBjb25zdHJ1Y3RvcihzdG9wT25GYWlsdXJlOiBib29sZWFuKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICB0aGlzLnN0b3BPbkZhaWx1cmUgPSBzdG9wT25GYWlsdXJlO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBjbG9uZSgpOiBBbnlSdWxlczxUPiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBBbnlSdWxlczxUPih0aGlzLnN0b3BPbkZhaWx1cmUpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKiogVmFsaWRhdGVzIGFueSB2YWx1ZSB1c2luZyBnaXZlbiBwcmVkaWNhdGUuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBhbnk8VD4ocHJlZGljYXRlPzogKHZhbHVlOiBULCBlbnRpdHk/OiBhbnksIHJvb3RFbnRpdHk/OiBhbnkpID0+IGJvb2xlYW4sIG9wdGlvbnM/OiBSdWxlT3B0aW9ucyk6IEFueVJ1bGVzPFQ+IHtcclxuICAgIG9wdGlvbnMgPSBlbnN1cmVSdWxlT3B0aW9ucyhvcHRpb25zLCB7XHJcbiAgICAgICAgc3RvcE9uRmFpbHVyZTogZmFsc2VcclxuICAgIH0pO1xyXG5cclxuICAgIHByZWRpY2F0ZSA9IHByZWRpY2F0ZSB8fCAodiA9PiB0cnVlKTtcclxuICAgIHJldHVybiBuZXcgQW55UnVsZXM8VD4ob3B0aW9ucy5zdG9wT25GYWlsdXJlKS5tdXN0KHByZWRpY2F0ZSwgb3B0aW9ucyk7XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/validator/rules/rules-base.ts\n ** module id = 31\n ** module chunks = 0\n **/","\"use strict\";\r\nvar __extends = (this && this.__extends) || function (d, b) {\r\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};\r\nvar rules_base_1 = require(\"./rules-base\");\r\nvar ObjectValidationRuleCore = (function () {\r\n    function ObjectValidationRuleCore(properties, expandable, stopOnFailure) {\r\n        this.properties = properties;\r\n        this.expandable = expandable;\r\n        this.stopOnFailure = stopOnFailure;\r\n        if (!properties) {\r\n            throw new Error(\"Properties is required.\");\r\n        }\r\n    }\r\n    ObjectValidationRuleCore.prototype.runParse = function (obj, validatingObject, rootObject) {\r\n        if (obj === null || obj === undefined) {\r\n            return obj;\r\n        }\r\n        var result = {};\r\n        for (var property in this.properties) {\r\n            var validator = this.properties[property];\r\n            var sourceValue = obj[property];\r\n            var parsedValue = validator.runParse(sourceValue, obj, rootObject);\r\n            result[property] = parsedValue;\r\n        }\r\n        if (this.expandable) {\r\n            for (var property in obj) {\r\n                if (!this.properties[property]) {\r\n                    result[property] = obj[property];\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    ObjectValidationRuleCore.prototype.runValidate = function (context, doneCallback, obj, validatingObject, rootObject) {\r\n        if (obj === null || obj === undefined) {\r\n            doneCallback(true);\r\n            return;\r\n        }\r\n        var propertyRules = [];\r\n        for (var property in this.properties) {\r\n            var validator = this.properties[property];\r\n            propertyRules.push({\r\n                property: property,\r\n                validator: validator\r\n            });\r\n        }\r\n        var allValid = true;\r\n        var run = function () {\r\n            var rule = propertyRules.shift();\r\n            if (rule) {\r\n                var propertyContext = context.property(rule.property);\r\n                var propertyValue = obj[rule.property];\r\n                rule.validator.runValidate(propertyContext, function (success) {\r\n                    allValid = allValid && success;\r\n                    run();\r\n                }, propertyValue, obj, rootObject);\r\n            }\r\n            else {\r\n                doneCallback(allValid);\r\n            }\r\n        };\r\n        run();\r\n    };\r\n    return ObjectValidationRuleCore;\r\n}());\r\nvar ObjectValidationRule = (function (_super) {\r\n    __extends(ObjectValidationRule, _super);\r\n    function ObjectValidationRule(properties, isExpandable, stopsOnMainRuleFailure) {\r\n        _super.call(this, new ObjectValidationRuleCore(properties, isExpandable, stopsOnMainRuleFailure));\r\n        this.properties = properties;\r\n        this.isExpandable = isExpandable;\r\n        this.stopsOnMainRuleFailure = stopsOnMainRuleFailure;\r\n    }\r\n    ObjectValidationRule.prototype.clone = function () {\r\n        return new ObjectValidationRule(this.properties, this.isExpandable, this.stopsOnMainRuleFailure);\r\n    };\r\n    ObjectValidationRule.prototype.expandable = function () {\r\n        this.isExpandable = true;\r\n        return this.makeCopy();\r\n    };\r\n    ObjectValidationRule.prototype.makeCopy = function () {\r\n        return this.withMainRule(new ObjectValidationRule(this.properties, this.isExpandable, this.stopsOnMainRuleFailure));\r\n    };\r\n    return ObjectValidationRule;\r\n}(rules_base_1.EnclosingValidationRuleBase));\r\nexports.ObjectValidationRule = ObjectValidationRule;\r\nfunction obj(properties, stopOnFailure) {\r\n    if (stopOnFailure === void 0) { stopOnFailure = true; }\r\n    return new ObjectValidationRule(properties, false, stopOnFailure);\r\n}\r\nexports.obj = obj;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JqZWN0LXJ1bGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsib2JqZWN0LXJ1bGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLDJCQUE2QyxjQUFjLENBQUMsQ0FBQTtBQVU1RDtJQUVJLGtDQUNZLFVBQW1DLEVBQ25DLFVBQW1CLEVBQ3BCLGFBQXNCO1FBRnJCLGVBQVUsR0FBVixVQUFVLENBQXlCO1FBQ25DLGVBQVUsR0FBVixVQUFVLENBQVM7UUFDcEIsa0JBQWEsR0FBYixhQUFhLENBQVM7UUFFN0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1FBQy9DLENBQUM7SUFDTCxDQUFDO0lBRUQsMkNBQVEsR0FBUixVQUFTLEdBQVEsRUFBRSxnQkFBc0IsRUFBRSxVQUFnQjtRQUN2RCxFQUFFLENBQUMsQ0FBQyxHQUFHLEtBQUssSUFBSSxJQUFJLEdBQUcsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxHQUFHLENBQUM7UUFDZixDQUFDO1FBRUQsSUFBTSxNQUFNLEdBQU0sRUFBRSxDQUFDO1FBRXJCLEdBQUcsQ0FBQyxDQUFDLElBQUksUUFBUSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBRW5DLElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDNUMsSUFBTSxXQUFXLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRWxDLElBQU0sV0FBVyxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUNyRSxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsV0FBVyxDQUFDO1FBQ25DLENBQUM7UUFFRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENB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Q3BCLElBQUksQ0FBQyxVQUFVLEVBQ2YsSUFBSSxDQUFDLFlBQVksRUFDakIsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBQ0wsMkJBQUM7QUFBRCxDQUFDLEFBMUJELENBQTZELHdDQUEyQixHQTBCdkY7QUExQlksNEJBQW9CLHVCQTBCaEMsQ0FBQTtBQUVELGFBQXVCLFVBQW1DLEVBQUUsYUFBb0I7SUFBcEIsNkJBQW9CLEdBQXBCLG9CQUFvQjtJQUM1RSxNQUFNLENBQUMsSUFBSSxvQkFBb0IsQ0FBSSxVQUFVLEVBQUUsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBQ3pFLENBQUM7QUFGZSxXQUFHLE1BRWxCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWYWxpZGF0aW9uUnVsZSwgSVZhbGlkYXRpb25Db250ZXh0IH0gZnJvbSBcIi4uL2RlZmluaXRpb25zXCI7XHJcbmltcG9ydCB7IEVuY2xvc2luZ1ZhbGlkYXRpb25SdWxlQmFzZSAgfSBmcm9tIFwiLi9ydWxlcy1iYXNlXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElQcm9wZXJ0eVZhbGlkYXRpb25IYXNoIHtcclxuICAgIFtwcm9wZXJ0eTogc3RyaW5nXTogVmFsaWRhdGlvblJ1bGU8YW55PjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJT2JqZWN0IHtcclxuICAgIFtwcm9wZXJ0eTogc3RyaW5nXTogYW55O1xyXG59XHJcblxyXG5jbGFzcyBPYmplY3RWYWxpZGF0aW9uUnVsZUNvcmU8VCBleHRlbmRzIElPYmplY3Q+IGltcGxlbWVudHMgVmFsaWRhdGlvblJ1bGU8VD4ge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcHJvcGVydGllczogSVByb3BlcnR5VmFsaWRhdGlvbkhhc2gsXHJcbiAgICAgICAgcHJpdmF0ZSBleHBhbmRhYmxlOiBib29sZWFuLFxyXG4gICAgICAgIHB1YmxpYyBzdG9wT25GYWlsdXJlOiBib29sZWFuKSB7XHJcblxyXG4gICAgICAgIGlmICghcHJvcGVydGllcykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQcm9wZXJ0aWVzIGlzIHJlcXVpcmVkLlwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcnVuUGFyc2Uob2JqOiBhbnksIHZhbGlkYXRpbmdPYmplY3Q/OiBhbnksIHJvb3RPYmplY3Q/OiBhbnkpOiBUIHtcclxuICAgICAgICBpZiAob2JqID09PSBudWxsIHx8IG9iaiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmo7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCByZXN1bHQgPSA8VD57fTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgcHJvcGVydHkgaW4gdGhpcy5wcm9wZXJ0aWVzKSB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB2YWxpZGF0b3IgPSB0aGlzLnByb3BlcnRpZXNbcHJvcGVydHldO1xyXG4gICAgICAgICAgICBjb25zdCBzb3VyY2VWYWx1ZSA9IG9ialtwcm9wZXJ0eV07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBwYXJzZWRWYWx1ZSA9IHZhbGlkYXRvci5ydW5QYXJzZShzb3VyY2VWYWx1ZSwgb2JqLCByb290T2JqZWN0KTtcclxuICAgICAgICAgICAgcmVzdWx0W3Byb3BlcnR5XSA9IHBhcnNlZFZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZXhwYW5kYWJsZSkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBwcm9wZXJ0eSBpbiBvYmopIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5wcm9wZXJ0aWVzW3Byb3BlcnR5XSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wZXJ0eV0gPSBvYmpbcHJvcGVydHldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIHJ1blZhbGlkYXRlKFxyXG4gICAgICAgIGNvbnRleHQ6IElWYWxpZGF0aW9uQ29udGV4dCxcclxuICAgICAgICBkb25lQ2FsbGJhY2s6IChzdWNjZXNzOiBib29sZWFuKSA9PiB2b2lkLFxyXG4gICAgICAgIG9iajogYW55LFxyXG4gICAgICAgIHZhbGlkYXRpbmdPYmplY3Q/OiBhbnksXHJcbiAgICAgICAgcm9vdE9iamVjdD86IGFueSk6IHZvaWQge1xyXG5cclxuICAgICAgICBpZiAob2JqID09PSBudWxsIHx8IG9iaiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGRvbmVDYWxsYmFjayh0cnVlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlSdWxlczogQXJyYXk8eyBwcm9wZXJ0eTogc3RyaW5nOyB2YWxpZGF0b3I6IFZhbGlkYXRpb25SdWxlPGFueT47IH0+ID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgcHJvcGVydHkgaW4gdGhpcy5wcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRvciA9IHRoaXMucHJvcGVydGllc1twcm9wZXJ0eV07XHJcbiAgICAgICAgICAgIHByb3BlcnR5UnVsZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eSxcclxuICAgICAgICAgICAgICAgIHZhbGlkYXRvclxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBhbGxWYWxpZCA9IHRydWU7XHJcbiAgICAgICAgY29uc3QgcnVuID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBydWxlID0gcHJvcGVydHlSdWxlcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICBpZiAocnVsZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlDb250ZXh0ID0gY29udGV4dC5wcm9wZXJ0eShydWxlLnByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBvYmpbcnVsZS5wcm9wZXJ0eV07XHJcbiAgICAgICAgICAgICAgICBydWxlLnZhbGlkYXRvci5ydW5WYWxpZGF0ZShcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUNvbnRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgKHN1Y2Nlc3MpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsVmFsaWQgPSBhbGxWYWxpZCAmJiBzdWNjZXNzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcnVuKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgIG9iaixcclxuICAgICAgICAgICAgICAgICAgICByb290T2JqZWN0XHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZG9uZUNhbGxiYWNrKGFsbFZhbGlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJ1bigpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgT2JqZWN0VmFsaWRhdGlvblJ1bGU8VCBleHRlbmRzIElPYmplY3Q+IGV4dGVuZHMgRW5jbG9zaW5nVmFsaWRhdGlvblJ1bGVCYXNlPFQ+IHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHByb3BlcnRpZXM6IElQcm9wZXJ0eVZhbGlkYXRpb25IYXNoLFxyXG4gICAgICAgIHByaXZhdGUgaXNFeHBhbmRhYmxlOiBib29sZWFuLFxyXG4gICAgICAgIHByaXZhdGUgc3RvcHNPbk1haW5SdWxlRmFpbHVyZTogYm9vbGVhbikge1xyXG4gICAgICAgIHN1cGVyKG5ldyBPYmplY3RWYWxpZGF0aW9uUnVsZUNvcmU8VD4ocHJvcGVydGllcywgaXNFeHBhbmRhYmxlLCBzdG9wc09uTWFpblJ1bGVGYWlsdXJlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGNsb25lKCk6IHRoaXMge1xyXG4gICAgICAgIHJldHVybiA8dGhpcz5uZXcgT2JqZWN0VmFsaWRhdGlvblJ1bGU8VD4odGhpcy5wcm9wZXJ0aWVzLCB0aGlzLmlzRXhwYW5kYWJsZSwgdGhpcy5zdG9wc09uTWFpblJ1bGVGYWlsdXJlKTtcclxuICAgIH1cclxuXHJcbiAgICBleHBhbmRhYmxlKCk6IHRoaXMge1xyXG4gICAgICAgIHRoaXMuaXNFeHBhbmRhYmxlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWFrZUNvcHkoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1ha2VDb3B5KCk6IHRoaXMge1xyXG4gICAgICAgIHJldHVybiB0aGlzLndpdGhNYWluUnVsZShcclxuICAgICAgICAgICAgbmV3IE9iamVjdFZhbGlkYXRpb25SdWxlPFQ+KFxyXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5pc0V4cGFuZGFibGUsXHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BzT25NYWluUnVsZUZhaWx1cmUpKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG9iajxUPihwcm9wZXJ0aWVzOiBJUHJvcGVydHlWYWxpZGF0aW9uSGFzaCwgc3RvcE9uRmFpbHVyZSA9IHRydWUpOiBPYmplY3RWYWxpZGF0aW9uUnVsZTxUPiB7XHJcbiAgICByZXR1cm4gbmV3IE9iamVjdFZhbGlkYXRpb25SdWxlPFQ+KHByb3BlcnRpZXMsIGZhbHNlLCBzdG9wT25GYWlsdXJlKTtcclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/validator/rules/object-rules.ts\n ** module id = 32\n ** module chunks = 0\n **/","\"use strict\";\r\nvar __extends = (this && this.__extends) || function (d, b) {\r\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};\r\nvar rules_base_1 = require(\"./rules-base\");\r\nvar HashValidationRuleCore = (function () {\r\n    function HashValidationRuleCore(elementValidationRule, skipInvalidElements, filterHashFn, stopOnFailure) {\r\n        this.elementValidationRule = elementValidationRule;\r\n        this.skipInvalidElements = skipInvalidElements;\r\n        this.filterHashFn = filterHashFn;\r\n        this.stopOnFailure = stopOnFailure;\r\n        if (!elementValidationRule) {\r\n            throw new Error(\"Element validation rule required\");\r\n        }\r\n    }\r\n    HashValidationRuleCore.prototype.runParse = function (hash, validatingObject, rootObject) {\r\n        if (hash === null || hash === undefined) {\r\n            return hash;\r\n        }\r\n        var result = {};\r\n        for (var key in hash) {\r\n            var inputValue = hash[key];\r\n            var parsedValue = this.elementValidationRule.runParse(inputValue, hash, rootObject);\r\n            if (!this.filterHashFn || this.filterHashFn(key, parsedValue, inputValue)) {\r\n                result[key] = parsedValue;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    HashValidationRuleCore.prototype.runValidate = function (context, doneCallback, hash, validatingObject, rootObject) {\r\n        var _this = this;\r\n        var hashKeys = [];\r\n        for (var key in hash) {\r\n            hashKeys.push(key);\r\n        }\r\n        var valid = true;\r\n        var run = function () {\r\n            if (hashKeys.length) {\r\n                var key_1 = hashKeys.shift();\r\n                var inputValue = hash[key_1];\r\n                var keyContext_1 = context.property(\"\" + key_1).bufferErrors();\r\n                _this.elementValidationRule.runValidate(keyContext_1, function (success) {\r\n                    if (_this.skipInvalidElements) {\r\n                        if (!success) {\r\n                            delete hash[key_1];\r\n                        }\r\n                    }\r\n                    else {\r\n                        valid = valid && success;\r\n                        keyContext_1.flushErrors();\r\n                    }\r\n                    run();\r\n                }, inputValue, hash, rootObject);\r\n            }\r\n            else {\r\n                doneCallback(valid);\r\n            }\r\n        };\r\n        run();\r\n    };\r\n    return HashValidationRuleCore;\r\n}());\r\nvar HashValidationRule = (function (_super) {\r\n    __extends(HashValidationRule, _super);\r\n    function HashValidationRule(elementValidationRule, skipInvalidElementsProp, filterHashFn, stopOnMainRuleFailure) {\r\n        _super.call(this, new HashValidationRuleCore(elementValidationRule, skipInvalidElementsProp, filterHashFn, stopOnMainRuleFailure));\r\n        this.elementValidationRule = elementValidationRule;\r\n        this.skipInvalidElementsProp = skipInvalidElementsProp;\r\n        this.filterHashFn = filterHashFn;\r\n        this.stopOnMainRuleFailure = stopOnMainRuleFailure;\r\n    }\r\n    HashValidationRule.prototype.clone = function () {\r\n        return new HashValidationRule(this.elementValidationRule, this.skipInvalidElementsProp, this.filterHashFn, this.stopOnMainRuleFailure);\r\n    };\r\n    /**\r\n     * Don't fail on invalid element. Instead don't include invalid elements in result hash.\r\n     * Note new rule never fails instead return empty hash.\r\n     */\r\n    HashValidationRule.prototype.skipInvalidElements = function (skipInvalidElements) {\r\n        if (skipInvalidElements === void 0) { skipInvalidElements = true; }\r\n        this.skipInvalidElementsProp = skipInvalidElements;\r\n        return this.makeCopy();\r\n    };\r\n    /** Filter result hash by applying predicate to each hash item and include only items passed the test. */\r\n    HashValidationRule.prototype.filter = function (predicate) {\r\n        if (!predicate) {\r\n            throw new Error(\"Predicate is required.\");\r\n        }\r\n        this.filterHashFn = predicate;\r\n        return this.makeCopy();\r\n    };\r\n    HashValidationRule.prototype.makeCopy = function () {\r\n        return this.withMainRule(new HashValidationRule(this.elementValidationRule, this.skipInvalidElementsProp, this.filterHashFn, this.stopOnMainRuleFailure));\r\n    };\r\n    return HashValidationRule;\r\n}(rules_base_1.EnclosingValidationRuleBase));\r\nexports.HashValidationRule = HashValidationRule;\r\n/**\r\n * Validates a map of objects with the same structure.\r\n */\r\nfunction hash(elementValidationRule, stopOnFailure) {\r\n    if (stopOnFailure === void 0) { stopOnFailure = true; }\r\n    if (!elementValidationRule) {\r\n        throw new Error(\"Element validation rule is required.\");\r\n    }\r\n    return new HashValidationRule(elementValidationRule, false, null, stopOnFailure);\r\n}\r\nexports.hash = hash;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFzaC1ydWxlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhhc2gtcnVsZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsMkJBQTRDLGNBQWMsQ0FBQyxDQUFBO0FBTTNEO0lBRUksZ0NBQ1kscUJBQStDLEVBQy9DLG1CQUE0QixFQUM1QixZQUF3RSxFQUN6RSxhQUFhO1FBSFosMEJBQXFCLEdBQXJCLHFCQUFxQixDQUEwQjtRQUMvQyx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQVM7UUFDNUIsaUJBQVksR0FBWixZQUFZLENBQTREO1FBQ3pFLGtCQUFhLEdBQWIsYUFBYSxDQUFBO1FBRXBCLEVBQUUsQ0FBQyxDQUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLE1BQU0sSUFBSSxLQUFLLENBQUMsa0NBQWtDLENBQUMsQ0FBQztRQUN4RCxDQUFDO0lBQ0wsQ0FBQztJQUVELHlDQUFRLEdBQVIsVUFBUyxJQUFTLEVBQUUsZ0JBQXNCLEVBQUUsVUFBZ0I7UUFDeEQsRUFBRSxDQUFDLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxJQUFJLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2hCLENBQUM7UUFFRCxJQUFNLE1BQU0sR0FBb0IsRUFBRSxDQUFDO1FBRW5DLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDbkIsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzdCLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztZQUN0RixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxD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RDtRQUN4RCxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDYixNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDOUMsQ0FBQztRQUVELElBQUksQ0FBQyxZQUFZLEdBQUcsU0FBUyxDQUFDO1FBRTlCLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVPLHFDQUFRLEdBQWhCO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQ3BCLElBQUksa0JBQWtCLENBQ2xCLElBQUksQ0FBQyxxQkFBcUIsRUFDMUIsSUFBSSxDQUFDLHVCQUF1QixFQUM1QixJQUFJLENBQUMsWUFBWSxFQUNqQixJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFDTCx5QkFBQztBQUFELENBQUMsQUFoREQsQ0FBa0Qsd0NBQTJCLEdBZ0Q1RTtBQWhEWSwwQkFBa0IscUJBZ0Q5QixDQUFBO0FBR0Q7O0dBRUc7QUFDSCxjQUErQixxQkFBK0MsRUFBRSxhQUFvQjtJQUFwQiw2QkFBb0IsR0FBcEIsb0JBQW9CO0lBQ2hHLEVBQUUsQ0FBQyxDQUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLE1BQU0sSUFBSSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUksa0JBQWtCLENBQVcscUJBQXFCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxhQUFhLENBQUMsQ0FBQztBQUMvRixDQUFDO0FBTmUsWUFBSSxPQU1uQixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVmFsaWRhdGlvblJ1bGUsIElWYWxpZGF0aW9uQ29udGV4dCB9IGZyb20gXCIuLi9kZWZpbml0aW9uc1wiO1xyXG5pbXBvcnQgeyBFbmNsb3NpbmdWYWxpZGF0aW9uUnVsZUJhc2UgfSBmcm9tIFwiLi9ydWxlcy1iYXNlXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElIYXNoPFRFbGVtZW50PiB7XHJcbiAgICBba2V5OiBzdHJpbmddOiBURWxlbWVudDtcclxufVxyXG5cclxuY2xhc3MgSGFzaFZhbGlkYXRpb25SdWxlQ29yZTxURWxlbWVudD4gaW1wbGVtZW50cyBWYWxpZGF0aW9uUnVsZTxJSGFzaDxURWxlbWVudD4+IHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGVsZW1lbnRWYWxpZGF0aW9uUnVsZTogVmFsaWRhdGlvblJ1bGU8VEVsZW1lbnQ+LFxyXG4gICAgICAgIHByaXZhdGUgc2tpcEludmFsaWRFbGVtZW50czogYm9vbGVhbixcclxuICAgICAgICBwcml2YXRlIGZpbHRlckhhc2hGbjogKGtleTogc3RyaW5nLCB2YWx1ZT86IFRFbGVtZW50LCByYXdWYWx1ZT86IGFueSkgPT4gYm9vbGVhbixcclxuICAgICAgICBwdWJsaWMgc3RvcE9uRmFpbHVyZSkge1xyXG5cclxuICAgICAgICBpZiAoIWVsZW1lbnRWYWxpZGF0aW9uUnVsZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbGVtZW50IHZhbGlkYXRpb24gcnVsZSByZXF1aXJlZFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcnVuUGFyc2UoaGFzaDogYW55LCB2YWxpZGF0aW5nT2JqZWN0PzogYW55LCByb290T2JqZWN0PzogYW55KTogSUhhc2g8VEVsZW1lbnQ+IHtcclxuICAgICAgICBpZiAoaGFzaCA9PT0gbnVsbCB8fCBoYXNoID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGhhc2g7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCByZXN1bHQ6IElIYXNoPFRFbGVtZW50PiA9IHt9O1xyXG5cclxuICAgICAgICBmb3IgKGxldCBrZXkgaW4gaGFzaCkge1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dFZhbHVlID0gaGFzaFtrZXldO1xyXG4gICAgICAgICAgICBjb25zdCBwYXJzZWRWYWx1ZSA9IHRoaXMuZWxlbWVudFZhbGlkYXRpb25SdWxlLnJ1blBhcnNlKGlucHV0VmFsdWUsIGhhc2gsIHJvb3RPYmplY3QpO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZmlsdGVySGFzaEZuIHx8IHRoaXMuZmlsdGVySGFzaEZuKGtleSwgcGFyc2VkVmFsdWUsIGlucHV0VmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IHBhcnNlZFZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIHJ1blZhbGlkYXRlKFxyXG4gICAgICAgIGNvbnRleHQ6IElWYWxpZGF0aW9uQ29udGV4dCxcclxuICAgICAgICBkb25lQ2FsbGJhY2s6IChzdWNjZXNzOiBib29sZWFuKSA9PiB2b2lkLFxyXG4gICAgICAgIGhhc2g6IGFueSxcclxuICAgICAgICB2YWxpZGF0aW5nT2JqZWN0PzogYW55LFxyXG4gICAgICAgIHJvb3RPYmplY3Q/OiBhbnkpOiB2b2lkIHtcclxuXHJcbiAgICAgICAgY29uc3QgaGFzaEtleXM6IHN0cmluZ1tdID0gW107XHJcbiAgICAgICAgZm9yIChsZXQga2V5IGluIGhhc2gpIHtcclxuICAgICAgICAgICAgaGFzaEtleXMucHVzaChrZXkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHZhbGlkID0gdHJ1ZTtcclxuICAgICAgICBjb25zdCBydW4gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChoYXNoS2V5cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IGhhc2hLZXlzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dFZhbHVlID0gaGFzaFtrZXldO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGtleUNvbnRleHQgPSBjb250ZXh0LnByb3BlcnR5KGAke2tleX1gKS5idWZmZXJFcnJvcnMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRWYWxpZGF0aW9uUnVsZS5ydW5WYWxpZGF0ZShcclxuICAgICAgICAgICAgICAgICAgICBrZXlDb250ZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5za2lwSW52YWxpZEVsZW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaGFzaFtrZXldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSB2YWxpZCAmJiBzdWNjZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5Q29udGV4dC5mbHVzaEVycm9ycygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBydW4oKTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0VmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFzaCxcclxuICAgICAgICAgICAgICAgICAgICByb290T2JqZWN0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRvbmVDYWxsYmFjayh2YWxpZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBydW4oKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEhhc2hWYWxpZGF0aW9uUnVsZTxURWxlbWVudD4gZXh0ZW5kcyBFbmNsb3NpbmdWYWxpZGF0aW9uUnVsZUJhc2U8SUhhc2g8VEVsZW1lbnQ+PiB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBlbGVtZW50VmFsaWRhdGlvblJ1bGU6IFZhbGlkYXRpb25SdWxlPFRFbGVtZW50PixcclxuICAgICAgICBwcml2YXRlIHNraXBJbnZhbGlkRWxlbWVudHNQcm9wOiBib29sZWFuLFxyXG4gICAgICAgIHByaXZhdGUgZmlsdGVySGFzaEZuOiAoa2V5OiBzdHJpbmcsIHZhbHVlPzogVEVsZW1lbnQpID0+IGJvb2xlYW4sXHJcbiAgICAgICAgcHJpdmF0ZSBzdG9wT25NYWluUnVsZUZhaWx1cmUpIHtcclxuXHJcbiAgICAgICAgc3VwZXIobmV3IEhhc2hWYWxpZGF0aW9uUnVsZUNvcmU8VEVsZW1lbnQ+KGVsZW1lbnRWYWxpZGF0aW9uUnVsZSwgc2tpcEludmFsaWRFbGVtZW50c1Byb3AsIGZpbHRlckhhc2hGbiwgc3RvcE9uTWFpblJ1bGVGYWlsdXJlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGNsb25lKCk6IHRoaXMge1xyXG4gICAgICAgIHJldHVybiA8dGhpcz5uZXcgSGFzaFZhbGlkYXRpb25SdWxlPFRFbGVtZW50PihcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50VmFsaWRhdGlvblJ1bGUsXHJcbiAgICAgICAgICAgIHRoaXMuc2tpcEludmFsaWRFbGVtZW50c1Byb3AsXHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVySGFzaEZuLFxyXG4gICAgICAgICAgICB0aGlzLnN0b3BPbk1haW5SdWxlRmFpbHVyZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBEb24ndCBmYWlsIG9uIGludmFsaWQgZWxlbWVudC4gSW5zdGVhZCBkb24ndCBpbmNsdWRlIGludmFsaWQgZWxlbWVudHMgaW4gcmVzdWx0IGhhc2guXHJcbiAgICAgKiBOb3RlIG5ldyBydWxlIG5ldmVyIGZhaWxzIGluc3RlYWQgcmV0dXJuIGVtcHR5IGhhc2guXHJcbiAgICAgKi9cclxuICAgIHNraXBJbnZhbGlkRWxlbWVudHMoc2tpcEludmFsaWRFbGVtZW50cyA9IHRydWUpOiB0aGlzIHtcclxuICAgICAgICB0aGlzLnNraXBJbnZhbGlkRWxlbWVudHNQcm9wID0gc2tpcEludmFsaWRFbGVtZW50cztcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWFrZUNvcHkoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogRmlsdGVyIHJlc3VsdCBoYXNoIGJ5IGFwcGx5aW5nIHByZWRpY2F0ZSB0byBlYWNoIGhhc2ggaXRlbSBhbmQgaW5jbHVkZSBvbmx5IGl0ZW1zIHBhc3NlZCB0aGUgdGVzdC4gKi9cclxuICAgIGZpbHRlcihwcmVkaWNhdGU6IChrZXk6IHN0cmluZywgdmFsdWU/OiBURWxlbWVudCkgPT4gYm9vbGVhbik6IHRoaXMge1xyXG4gICAgICAgIGlmICghcHJlZGljYXRlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlByZWRpY2F0ZSBpcyByZXF1aXJlZC5cIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmZpbHRlckhhc2hGbiA9IHByZWRpY2F0ZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWFrZUNvcHkoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1ha2VDb3B5KCk6IHRoaXMge1xyXG4gICAgICAgIHJldHVybiB0aGlzLndpdGhNYWluUnVsZShcclxuICAgICAgICAgICAgbmV3IEhhc2hWYWxpZGF0aW9uUnVsZTxURWxlbWVudD4oXHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRWYWxpZGF0aW9uUnVsZSxcclxuICAgICAgICAgICAgICAgIHRoaXMuc2tpcEludmFsaWRFbGVtZW50c1Byb3AsXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlckhhc2hGbixcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RvcE9uTWFpblJ1bGVGYWlsdXJlKSk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogVmFsaWRhdGVzIGEgbWFwIG9mIG9iamVjdHMgd2l0aCB0aGUgc2FtZSBzdHJ1Y3R1cmUuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaGFzaDxURWxlbWVudD4oZWxlbWVudFZhbGlkYXRpb25SdWxlOiBWYWxpZGF0aW9uUnVsZTxURWxlbWVudD4sIHN0b3BPbkZhaWx1cmUgPSB0cnVlKTogSGFzaFZhbGlkYXRpb25SdWxlPFRFbGVtZW50PiB7XHJcbiAgICBpZiAoIWVsZW1lbnRWYWxpZGF0aW9uUnVsZSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVsZW1lbnQgdmFsaWRhdGlvbiBydWxlIGlzIHJlcXVpcmVkLlwiKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbmV3IEhhc2hWYWxpZGF0aW9uUnVsZTxURWxlbWVudD4oZWxlbWVudFZhbGlkYXRpb25SdWxlLCBmYWxzZSwgbnVsbCwgc3RvcE9uRmFpbHVyZSk7XHJcbn1cclxuXHJcbiJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/validator/rules/hash-rules.ts\n ** module id = 33\n ** module chunks = 0\n **/","\"use strict\";\r\nvar __extends = (this && this.__extends) || function (d, b) {\r\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};\r\nvar rules_base_1 = require(\"./rules-base\");\r\nvar ArrayValidationRuleCore = (function () {\r\n    function ArrayValidationRuleCore(elementValidationRule, skipInvalidElements, filterElementFn, stopOnFailure) {\r\n        this.elementValidationRule = elementValidationRule;\r\n        this.skipInvalidElements = skipInvalidElements;\r\n        this.filterElementFn = filterElementFn;\r\n        this.stopOnFailure = stopOnFailure;\r\n        if (!elementValidationRule) {\r\n            throw new Error(\"Element validator is required.\");\r\n        }\r\n    }\r\n    ArrayValidationRuleCore.prototype.runParse = function (array, validatingObject, rootObject) {\r\n        var _this = this;\r\n        if (array === null || array === undefined) {\r\n            return array;\r\n        }\r\n        // We don't filter array elements here because we need to keep source indexes in validation context errors.\r\n        return array.map(function (e) { return _this.elementValidationRule.runParse(e, array, rootObject); });\r\n    };\r\n    ArrayValidationRuleCore.prototype.runValidate = function (context, doneCallback, array, validatingObject, rootObject) {\r\n        var _this = this;\r\n        if (array === null || array === undefined) {\r\n            doneCallback(true);\r\n            return;\r\n        }\r\n        var srcIndex = 0;\r\n        var srcLength = array.length;\r\n        var index = 0;\r\n        var valid = true;\r\n        var run = function () {\r\n            if (srcIndex < srcLength) {\r\n                var element = array[index];\r\n                if (_this.filterElementFn && !_this.filterElementFn(element, srcIndex)) {\r\n                    array.splice(index, 1);\r\n                    srcIndex++;\r\n                    run();\r\n                }\r\n                else {\r\n                    var elementContext_1 = context.index(srcIndex).bufferErrors();\r\n                    _this.elementValidationRule.runValidate(elementContext_1, function (success) {\r\n                        if (_this.skipInvalidElements) {\r\n                            if (!success) {\r\n                                array.splice(index, 1);\r\n                            }\r\n                            else {\r\n                                index++;\r\n                            }\r\n                        }\r\n                        else {\r\n                            elementContext_1.flushErrors();\r\n                            valid = valid && success;\r\n                            index++;\r\n                        }\r\n                        srcIndex++;\r\n                        run();\r\n                    }, element, array, rootObject);\r\n                }\r\n            }\r\n            else {\r\n                doneCallback(valid);\r\n            }\r\n        };\r\n        run();\r\n    };\r\n    return ArrayValidationRuleCore;\r\n}());\r\nexports.ArrayValidationRuleCore = ArrayValidationRuleCore;\r\nvar ArrayValidationRule = (function (_super) {\r\n    __extends(ArrayValidationRule, _super);\r\n    function ArrayValidationRule(elementValidationRule, skipInvalidElementsProp, filterElementFn, stopOnMainRuleFailure) {\r\n        _super.call(this, new ArrayValidationRuleCore(elementValidationRule, skipInvalidElementsProp, filterElementFn, stopOnMainRuleFailure));\r\n        this.elementValidationRule = elementValidationRule;\r\n        this.skipInvalidElementsProp = skipInvalidElementsProp;\r\n        this.filterElementFn = filterElementFn;\r\n        this.stopOnMainRuleFailure = stopOnMainRuleFailure;\r\n    }\r\n    ArrayValidationRule.prototype.clone = function () {\r\n        return new ArrayValidationRule(this.elementValidationRule, this.skipInvalidElementsProp, this.filterElementFn, this.stopOnMainRuleFailure);\r\n    };\r\n    /**\r\n     * Don't fail on invalid element. Instead don't include invalid elements in result array.\r\n     * Note new rule never fails instead it returns empty array.\r\n     */\r\n    ArrayValidationRule.prototype.skipInvalidElements = function (skipInvalidElements) {\r\n        if (skipInvalidElements === void 0) { skipInvalidElements = true; }\r\n        this.skipInvalidElementsProp = skipInvalidElements;\r\n        return this.makeCopy();\r\n    };\r\n    /** Filter result array by applying predicate to each hash item and include only items passed the test. */\r\n    ArrayValidationRule.prototype.filter = function (predicate) {\r\n        if (!predicate) {\r\n            throw new Error(\"Predicate is required.\");\r\n        }\r\n        this.filterElementFn = predicate;\r\n        return this.makeCopy();\r\n    };\r\n    ArrayValidationRule.prototype.makeCopy = function () {\r\n        return this.withMainRule(new ArrayValidationRule(this.elementValidationRule, this.skipInvalidElementsProp, this.filterElementFn, this.stopOnMainRuleFailure));\r\n    };\r\n    return ArrayValidationRule;\r\n}(rules_base_1.EnclosingValidationRuleBase));\r\nexports.ArrayValidationRule = ArrayValidationRule;\r\n/** Validates an array of the elements with the same structure. */\r\nfunction arr(elementValidationRule, stopOnFailure) {\r\n    if (stopOnFailure === void 0) { stopOnFailure = true; }\r\n    if (!elementValidationRule) {\r\n        throw new Error(\"Element validation rule is required.\");\r\n    }\r\n    return new ArrayValidationRule(elementValidationRule, false, null, stopOnFailure);\r\n}\r\nexports.arr = arr;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJyYXktcnVsZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhcnJheS1ydWxlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSwyQkFBNEMsY0FBYyxDQUFDLENBQUE7QUFHM0Q7SUFFSSxpQ0FDWSxxQkFBK0MsRUFDL0MsbUJBQTRCLEVBQzVCLGVBQStELEVBQ2hFLGFBQXNCO1FBSHJCLDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBMEI7UUFDL0Msd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFTO1FBQzVCLG9CQUFlLEdBQWYsZUFBZSxDQUFnRDtRQUNoRSxrQkFBYSxHQUFiLGFBQWEsQ0FBUztRQUU3QixFQUFFLENBQUMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQztZQUN6QixNQUFNLElBQUksS0FBSyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7UUFDdEQsQ0FBQztJQUNMLENBQUM7SUFFRCwwQ0FBUSxHQUFSLFVBQVMsS0FBWSxFQUFFLGdCQUFzQixFQUFFLFVBQWdCO1FBQS9ELGlCQU1DO1FBTEcsRUFBRSxDQUFDLENBQUMsS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUN4QyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQ2pCLENBQUM7UUFDRCwyR0FBMkc7UUFDM0csTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxLQUFJLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsVUFBVSxDQUFDLEVBQXpELENBQXlELENBQUMsQ0FBQztJQUNyRixDQUFDO0lBRUQsNkNBQVcsR0FBWCxVQUNJLE9BQTJCLEVBQzNCLFlBQXdDLEVBQ3hDLEtBQVksRUFDWixnQkFBc0IsRUFDdEIsVUFBZ0I7UUFMcEIsaUJBZ0VDO1FBekRHLEVBQUUsQ0FBQyxDQUFDLEtBQUssS0FBSyxJQUFJLElBQUksS0FBSyxLQUFLLFNB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Q29udGVudCI6WyJpbXBvcnQgeyBWYWxpZGF0aW9uUnVsZSwgSVZhbGlkYXRpb25Db250ZXh0IH0gZnJvbSBcIi4uL2RlZmluaXRpb25zXCI7XHJcbmltcG9ydCB7IEVuY2xvc2luZ1ZhbGlkYXRpb25SdWxlQmFzZSB9IGZyb20gXCIuL3J1bGVzLWJhc2VcIjtcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgQXJyYXlWYWxpZGF0aW9uUnVsZUNvcmU8VEVsZW1lbnQ+IGltcGxlbWVudHMgVmFsaWRhdGlvblJ1bGU8VEVsZW1lbnRbXT4ge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgZWxlbWVudFZhbGlkYXRpb25SdWxlOiBWYWxpZGF0aW9uUnVsZTxURWxlbWVudD4sXHJcbiAgICAgICAgcHJpdmF0ZSBza2lwSW52YWxpZEVsZW1lbnRzOiBib29sZWFuLFxyXG4gICAgICAgIHByaXZhdGUgZmlsdGVyRWxlbWVudEZuOiAoZWxlbWVudDogVEVsZW1lbnQsIGluZGV4PzogbnVtYmVyKSA9PiBib29sZWFuLFxyXG4gICAgICAgIHB1YmxpYyBzdG9wT25GYWlsdXJlOiBib29sZWFuKSB7XHJcblxyXG4gICAgICAgIGlmICghZWxlbWVudFZhbGlkYXRpb25SdWxlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVsZW1lbnQgdmFsaWRhdG9yIGlzIHJlcXVpcmVkLlwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcnVuUGFyc2UoYXJyYXk6IGFueVtdLCB2YWxpZGF0aW5nT2JqZWN0PzogYW55LCByb290T2JqZWN0PzogYW55KTogVEVsZW1lbnRbXSB7XHJcbiAgICAgICAgaWYgKGFycmF5ID09PSBudWxsIHx8IGFycmF5ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFycmF5O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBXZSBkb24ndCBmaWx0ZXIgYXJyYXkgZWxlbWVudHMgaGVyZSBiZWNhdXNlIHdlIG5lZWQgdG8ga2VlcCBzb3VyY2UgaW5kZXhlcyBpbiB2YWxpZGF0aW9uIGNvbnRleHQgZXJyb3JzLlxyXG4gICAgICAgIHJldHVybiBhcnJheS5tYXAoZSA9PiB0aGlzLmVsZW1lbnRWYWxpZGF0aW9uUnVsZS5ydW5QYXJzZShlLCBhcnJheSwgcm9vdE9iamVjdCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHJ1blZhbGlkYXRlKFxyXG4gICAgICAgIGNvbnRleHQ6IElWYWxpZGF0aW9uQ29udGV4dCxcclxuICAgICAgICBkb25lQ2FsbGJhY2s6IChzdWNjZXNzOiBib29sZWFuKSA9PiB2b2lkLFxyXG4gICAgICAgIGFycmF5OiBhbnlbXSxcclxuICAgICAgICB2YWxpZGF0aW5nT2JqZWN0PzogYW55LFxyXG4gICAgICAgIHJvb3RPYmplY3Q/OiBhbnkpOiB2b2lkIHtcclxuXHJcbiAgICAgICAgaWYgKGFycmF5ID09PSBudWxsIHx8IGFycmF5ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgZG9uZUNhbGxiYWNrKHRydWUpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgc3JjSW5kZXggPSAwO1xyXG4gICAgICAgIGxldCBzcmNMZW5ndGggPSBhcnJheS5sZW5ndGg7XHJcbiAgICAgICAgbGV0IGluZGV4ID0gMDtcclxuXHJcbiAgICAgICAgbGV0IHZhbGlkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgY29uc3QgcnVuID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoc3JjSW5kZXggPCBzcmNMZW5ndGgpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gYXJyYXlbaW5kZXhdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpbHRlckVsZW1lbnRGbiAmJiAhdGhpcy5maWx0ZXJFbGVtZW50Rm4oZWxlbWVudCwgc3JjSW5kZXgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyYXkuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICBzcmNJbmRleCsrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBydW4oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRDb250ZXh0ID0gY29udGV4dC5pbmRleChzcmNJbmRleCkuYnVmZmVyRXJyb3JzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFZhbGlkYXRpb25SdWxlLnJ1blZhbGlkYXRlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50Q29udGV4dCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5za2lwSW52YWxpZEVsZW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5LnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRDb250ZXh0LmZsdXNoRXJyb3JzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkID0gdmFsaWQgJiYgc3VjY2VzcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyY0luZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydW4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RPYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZG9uZUNhbGxiYWNrKHZhbGlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcnVuKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBcnJheVZhbGlkYXRpb25SdWxlPFRFbGVtZW50PiBleHRlbmRzIEVuY2xvc2luZ1ZhbGlkYXRpb25SdWxlQmFzZTxURWxlbWVudFtdPiB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBlbGVtZW50VmFsaWRhdGlvblJ1bGU6IFZhbGlkYXRpb25SdWxlPFRFbGVtZW50PixcclxuICAgICAgICBwcml2YXRlIHNraXBJbnZhbGlkRWxlbWVudHNQcm9wOiBib29sZWFuLFxyXG4gICAgICAgIHByaXZhdGUgZmlsdGVyRWxlbWVudEZuOiAoZWxlbWVudDogVEVsZW1lbnQsIGluZGV4PzogbnVtYmVyKSA9PiBib29sZWFuLFxyXG4gICAgICAgIHByaXZhdGUgc3RvcE9uTWFpblJ1bGVGYWlsdXJlKSB7XHJcblxyXG4gICAgICAgIHN1cGVyKG5ldyBBcnJheVZhbGlkYXRpb25SdWxlQ29yZTxURWxlbWVudD4oXHJcbiAgICAgICAgICAgIGVsZW1lbnRWYWxpZGF0aW9uUnVsZSxcclxuICAgICAgICAgICAgc2tpcEludmFsaWRFbGVtZW50c1Byb3AsXHJcbiAgICAgICAgICAgIGZpbHRlckVsZW1lbnRGbixcclxuICAgICAgICAgICAgc3RvcE9uTWFpblJ1bGVGYWlsdXJlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGNsb25lKCk6IHRoaXMge1xyXG4gICAgICAgIHJldHVybiA8dGhpcz5uZXcgQXJyYXlWYWxpZGF0aW9uUnVsZTxURWxlbWVudD4oXHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudFZhbGlkYXRpb25SdWxlLFxyXG4gICAgICAgICAgICB0aGlzLnNraXBJbnZhbGlkRWxlbWVudHNQcm9wLFxyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckVsZW1lbnRGbixcclxuICAgICAgICAgICAgdGhpcy5zdG9wT25NYWluUnVsZUZhaWx1cmUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRG9uJ3QgZmFpbCBvbiBpbnZhbGlkIGVsZW1lbnQuIEluc3RlYWQgZG9uJ3QgaW5jbHVkZSBpbnZhbGlkIGVsZW1lbnRzIGluIHJlc3VsdCBhcnJheS5cclxuICAgICAqIE5vdGUgbmV3IHJ1bGUgbmV2ZXIgZmFpbHMgaW5zdGVhZCBpdCByZXR1cm5zIGVtcHR5IGFycmF5LlxyXG4gICAgICovXHJcbiAgICBza2lwSW52YWxpZEVsZW1lbnRzKHNraXBJbnZhbGlkRWxlbWVudHMgPSB0cnVlKTogdGhpcyB7XHJcbiAgICAgICAgdGhpcy5za2lwSW52YWxpZEVsZW1lbnRzUHJvcCA9IHNraXBJbnZhbGlkRWxlbWVudHM7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLm1ha2VDb3B5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIEZpbHRlciByZXN1bHQgYXJyYXkgYnkgYXBwbHlpbmcgcHJlZGljYXRlIHRvIGVhY2ggaGFzaCBpdGVtIGFuZCBpbmNsdWRlIG9ubHkgaXRlbXMgcGFzc2VkIHRoZSB0ZXN0LiAqL1xyXG4gICAgZmlsdGVyKHByZWRpY2F0ZTogKGVsZW1lbnQ6IFRFbGVtZW50LCBpbmRleD86IG51bWJlcikgPT4gYm9vbGVhbik6IHRoaXMge1xyXG4gICAgICAgIGlmICghcHJlZGljYXRlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlByZWRpY2F0ZSBpcyByZXF1aXJlZC5cIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmZpbHRlckVsZW1lbnRGbiA9IHByZWRpY2F0ZTtcclxuICAgICAgICByZXR1cm4gdGhpcy5tYWtlQ29weSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbWFrZUNvcHkoKTogdGhpcyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMud2l0aE1haW5SdWxlKG5ldyBBcnJheVZhbGlkYXRpb25SdWxlPFRFbGVtZW50PihcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50VmFsaWRhdGlvblJ1bGUsXHJcbiAgICAgICAgICAgIHRoaXMuc2tpcEludmFsaWRFbGVtZW50c1Byb3AsXHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyRWxlbWVudEZuLFxyXG4gICAgICAgICAgICB0aGlzLnN0b3BPbk1haW5SdWxlRmFpbHVyZSkpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKiogVmFsaWRhdGVzIGFuIGFycmF5IG9mIHRoZSBlbGVtZW50cyB3aXRoIHRoZSBzYW1lIHN0cnVjdHVyZS4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGFycjxURWxlbWVudD4oZWxlbWVudFZhbGlkYXRpb25SdWxlOiBWYWxpZGF0aW9uUnVsZTxURWxlbWVudD4sIHN0b3BPbkZhaWx1cmUgPSB0cnVlKTogQXJyYXlWYWxpZGF0aW9uUnVsZTxURWxlbWVudD4ge1xyXG4gICAgaWYgKCFlbGVtZW50VmFsaWRhdGlvblJ1bGUpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbGVtZW50IHZhbGlkYXRpb24gcnVsZSBpcyByZXF1aXJlZC5cIik7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBBcnJheVZhbGlkYXRpb25SdWxlPFRFbGVtZW50PihcclxuICAgICAgICBlbGVtZW50VmFsaWRhdGlvblJ1bGUsXHJcbiAgICAgICAgZmFsc2UsXHJcbiAgICAgICAgbnVsbCxcclxuICAgICAgICBzdG9wT25GYWlsdXJlKTtcclxufVxyXG4iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/validator/rules/array-rules.ts\n ** module id = 34\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar express = require(\"express\");\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar mongo_web_shop_storage_1 = require(\"../../services/web-shop/mongo-web-shop-storage\");\r\nvar web_shop_service_1 = require(\"../../services/web-shop/web-shop-service\");\r\nvar db = new db_1.default();\r\nvar webShopService = new web_shop_service_1.default(new mongo_web_shop_storage_1.default(db));\r\nvar router = express.Router();\r\nrouter.get(\"/\", function (request, response) {\r\n    webShopService.all()\r\n        .then(function (shops) {\r\n        var model = shops.map(function (s) { return ({\r\n            id: s.id,\r\n            isBase: s.isBase,\r\n            title: s.title,\r\n            deliveryPrice: s.deliveryPrice\r\n        }); });\r\n        response.json(model).end();\r\n    })\r\n        .catch(function (err) { return response.send(500, err).end(); });\r\n});\r\nrouter.post(\"/\", function (request, response) {\r\n    var webShop = request.body;\r\n    if (!webShop.id) {\r\n        response.send(400, \"Bad request. Web shop identifier is missing\").end();\r\n    }\r\n    else {\r\n        webShopService.save(webShop)\r\n            .then(function (result) {\r\n            if (result[\"ok\"] === false) {\r\n                response.json(result).end();\r\n            }\r\n            else {\r\n                var updatedWebShop = result;\r\n                var okResponse = {\r\n                    ok: true,\r\n                    entity: updatedWebShop\r\n                };\r\n                response.json(okResponse).end();\r\n            }\r\n        })\r\n            .catch(function (err) {\r\n            response.send(500, err).end();\r\n        });\r\n    }\r\n});\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = router;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLXNob3Atcm91dGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3ZWItc2hvcC1yb3V0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpREFBaUQ7O0FBRWpELElBQVksT0FBTyxXQUFNLFNBQVMsQ0FBQyxDQUFBO0FBRW5DLG1CQUFlLHNCQUFzQixDQUFDLENBQUE7QUFFdEMsdUNBQWdDLGdEQUFnRCxDQUFDLENBQUE7QUFDakYsaUNBQTJCLDBDQUEwQyxDQUFDLENBQUE7QUFFdEUsSUFBTSxFQUFFLEdBQUcsSUFBSSxZQUFFLEVBQUUsQ0FBQztBQUVwQixJQUFNLGNBQWMsR0FBRyxJQUFJLDBCQUFjLENBQUMsSUFBSSxnQ0FBbUIsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBRXZFLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUVoQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxVQUFDLE9BQU8sRUFBRSxRQUFRO0lBQzlCLGNBQWMsQ0FBQyxHQUFHLEVBQUU7U0FDZixJQUFJLENBQUMsVUFBQSxLQUFLO1FBQ1AsSUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUM7WUFDMUIsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFO1lBQ1IsTUFBTSxFQUFFLENBQUMsQ0FBQyxNQUFNO1lBQ2hCLEtBQUssRUFBRSxDQUFDLENBQUMsS0FBSztZQUNkLGFBQWEsRUFBRSxDQUFDLENBQUMsYUFBYTtTQUNqQyxDQUFDLEVBTDJCLENBSzNCLENBQUMsQ0FBQztRQUNKLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDL0IsQ0FBQyxDQUFDO1NBQ0QsS0FBSyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQTdCLENBQTZCLENBQUMsQ0FBQztBQUNyRCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFVBQUMsT0FBTyxFQUFFLFFBQVE7SUFDL0IsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztJQUU3QixFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2QsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsNkNBQTZDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUM1RSxDQUFDO0lBQ0QsSUFBSSxDQUFDLENBQUM7UUFDRixjQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUN2QixJQUFJLENBQUMsVUFBQSxNQUFNO1lBQ1IsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ3pCLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDaEMsQ0FBQztZQUNELElBQUksQ0FBQyxDQUFDO2dCQUNGLElBQU0sY0FBYyxHQUFnQixNQUFNLENBQUM7Z0JBQzNDLElBQU0sVUFBVSxHQUFzQztvQkFDbEQsRUFBRSxFQUFFLElBQUk7b0JBQ1IsTUFBTSxFQUFFLGNBQWM7aUJBQ3pCLENBQUM7Z0JBRUYsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNwQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDO2FBQ0QsS0FBSyxDQUFDLFVBQUEsR0FBRztZQUNOLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUg7a0JBQWUsTUFBTSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XHJcblxyXG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XHJcblxyXG5pbXBvcnQgRGIgZnJvbSBcIi4uLy4uL2RhdGEtYWNjZXNzL2RiXCI7XHJcblxyXG5pbXBvcnQgTW9uZ29XZWJTaG9wU3RvcmFnZSBmcm9tIFwiLi4vLi4vc2VydmljZXMvd2ViLXNob3AvbW9uZ28td2ViLXNob3Atc3RvcmFnZVwiO1xyXG5pbXBvcnQgV2ViU2hvcFNlcnZpY2UgZnJvbSBcIi4uLy4uL3NlcnZpY2VzL3dlYi1zaG9wL3dlYi1zaG9wLXNlcnZpY2VcIjtcclxuXHJcbmNvbnN0IGRiID0gbmV3IERiKCk7XHJcblxyXG5jb25zdCB3ZWJTaG9wU2VydmljZSA9IG5ldyBXZWJTaG9wU2VydmljZShuZXcgTW9uZ29XZWJTaG9wU3RvcmFnZShkYikpO1xyXG5cclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuXHJcbnJvdXRlci5nZXQoXCIvXCIsIChyZXF1ZXN0LCByZXNwb25zZSkgPT4ge1xyXG4gICAgd2ViU2hvcFNlcnZpY2UuYWxsKClcclxuICAgICAgICAudGhlbihzaG9wcyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vZGVsID0gc2hvcHMubWFwKHMgPT4gKHtcclxuICAgICAgICAgICAgICAgIGlkOiBzLmlkLFxyXG4gICAgICAgICAgICAgICAgaXNCYXNlOiBzLmlzQmFzZSxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiBzLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgZGVsaXZlcnlQcmljZTogcy5kZWxpdmVyeVByaWNlIFxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24obW9kZWwpLmVuZCgpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVyciA9PiByZXNwb25zZS5zZW5kKDUwMCwgZXJyKS5lbmQoKSk7XHJcbn0pO1xyXG5cclxucm91dGVyLnBvc3QoXCIvXCIsIChyZXF1ZXN0LCByZXNwb25zZSkgPT4ge1xyXG4gICAgY29uc3Qgd2ViU2hvcCA9IHJlcXVlc3QuYm9keTtcclxuXHJcbiAgICBpZiAoIXdlYlNob3AuaWQpIHtcclxuICAgICAgICByZXNwb25zZS5zZW5kKDQwMCwgXCJCYWQgcmVxdWVzdC4gV2ViIHNob3AgaWRlbnRpZmllciBpcyBtaXNzaW5nXCIpLmVuZCgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgd2ViU2hvcFNlcnZpY2Uuc2F2ZSh3ZWJTaG9wKVxyXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdFtcIm9rXCJdID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmpzb24ocmVzdWx0KS5lbmQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRXZWJTaG9wID0gPEFwaS5XZWJTaG9wPnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBva1Jlc3BvbnNlOiBBcGkuSVN1Y2Nlc3NSZXNwb25zZTxBcGkuV2ViU2hvcD4gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9rOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHk6IHVwZGF0ZWRXZWJTaG9wXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuanNvbihva1Jlc3BvbnNlKS5lbmQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZS5zZW5kKDUwMCwgZXJyKS5lbmQoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcm91dGVyOyJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/web/routes/web-shop-route.ts\n ** module id = 35\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar db_1 = require(\"../../data-access/db\");\r\nvar MongoWebShopStorage = (function () {\r\n    function MongoWebShopStorage(db) {\r\n        this.db = db;\r\n        if (!db)\r\n            throw new Error(\"db is undefined\");\r\n    }\r\n    MongoWebShopStorage.prototype.all = function () {\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.find({}, { _id: 0 }); })\r\n            .then(function (c) { return c.toArray(); });\r\n    };\r\n    MongoWebShopStorage.prototype.one = function (id) {\r\n        if (!id)\r\n            throw new Error(\"id is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.find({ id: id }, { _id: 0 }); })\r\n            .then(function (c) { return c.limit(1).next(); });\r\n    };\r\n    MongoWebShopStorage.prototype.save = function (webShop) {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.updateOne({\r\n            id: webShop.id\r\n        }, {\r\n            $set: {\r\n                deliveryPrice: webShop.deliveryPrice\r\n            }\r\n        }); })\r\n            .then(function () { return webShop; });\r\n    };\r\n    MongoWebShopStorage.prototype.put = function (webShop) {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return this.db\r\n            .collection(db_1.default.Collections.webshops)\r\n            .then(function (c) { return c.updateOne({\r\n            id: webShop.id\r\n        }, webShop, {\r\n            upsert: true\r\n        }); })\r\n            .then(function () { return webShop; });\r\n    };\r\n    return MongoWebShopStorage;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = MongoWebShopStorage;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uZ28td2ViLXNob3Atc3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1vbmdvLXdlYi1zaG9wLXN0b3JhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsaURBQWlEOztBQUVqRCxtQkFBcUIsc0JBQXNCLENBQUMsQ0FBQTtBQUU1QztJQUNJLDZCQUFvQixFQUFZO1FBQVosT0FBRSxHQUFGLEVBQUUsQ0FBVTtRQUM1QixFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNKLE1BQU0sSUFBSSxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQsaUNBQUcsR0FBSDtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTthQUNULFVBQVUsQ0FBQyxZQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQzthQUN6QyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUF0QixDQUFzQixDQUFDO2FBQ2pDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBWCxDQUFXLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQsaUNBQUcsR0FBSCxVQUFJLEVBQVU7UUFDVixFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNKLE1BQU0sSUFBSSxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUV2QyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7YUFDVCxVQUFVLENBQUMsWUFBUSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUM7YUFDekMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUE5QixDQUE4QixDQUFDO2FBQ3pDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQWpCLENBQWlCLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQsa0NBQUksR0FBSixVQUFLLE9BQW9CO1FBQ3JCLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBRTVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTthQUNULFVBQVUsQ0FBQyxZQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQzthQUN6QyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsU0FBUyxDQUNsQjtZQUNJLEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBRTtTQUNqQixFQUNEO1lBQ0ksSUFBSSxFQUFFO2dCQUNGLGFBQWEsRUFBRSxPQUFPLENBQUMsYUFBYTthQUN2QztTQUNKLENBQ0osRUFUVSxDQVNWLENBQUM7YUFDRCxJQUFJLENBQUMsY0FBTSxPQUFBLE9BQU8sRUFBUCxDQUFPLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRUQsaUNBQUcsR0FBSCxVQUFJLE9BQW9CO1FBQ3BCLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBRTVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTthQUNULFVBQVUsQ0FBQyxZQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQzthQUN6QyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsU0FBUyxDQUNsQjtZQUNJLEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBRTtTQUNqQixFQUNELE9BQU8sRUFDUDtZQUNJLE1BQU0sRUFBRSxJQUFJO1NBQ2YsQ0FDSixFQVJVLENBUVYsQ0FBQzthQUNELElBQUksQ0FBQyxjQUFNLE9BQUEsT0FBTyxFQUFQLENBQU8sQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFDTCwwQkFBQztBQUFELENBQUMsQUEzREQsSUEyREM7QUEzREQ7cUNBMkRDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCBEYXRhYmFzZSBmcm9tIFwiLi4vLi4vZGF0YS1hY2Nlc3MvZGJcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vbmdvV2ViU2hvcFN0b3JhZ2UgaW1wbGVtZW50cyBXZWJTaG9wcy5JV2ViU2hvcFN0b3JhZ2Uge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBkYjogRGF0YWJhc2UpIHtcclxuICAgICAgICBpZiAoIWRiKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJkYiBpcyB1bmRlZmluZWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgYWxsKCk6IFByb21pc2U8QXBpLldlYlNob3BbXT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRiXHJcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKERhdGFiYXNlLkNvbGxlY3Rpb25zLndlYnNob3BzKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMuZmluZCh7fSwgeyBfaWQ6IDAgfSkpXHJcbiAgICAgICAgICAgIC50aGVuKGMgPT4gYy50b0FycmF5KCkpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uZShpZDogc3RyaW5nKTogUHJvbWlzZTxBcGkuV2ViU2hvcD4ge1xyXG4gICAgICAgIGlmICghaWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImlkIGlzIHVuZGVmaW5lZFwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGJcclxuICAgICAgICAgICAgLmNvbGxlY3Rpb24oRGF0YWJhc2UuQ29sbGVjdGlvbnMud2Vic2hvcHMpXHJcbiAgICAgICAgICAgIC50aGVuKGMgPT4gYy5maW5kKHsgaWQ6IGlkIH0sIHsgX2lkOiAwIH0pKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMubGltaXQoMSkubmV4dCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlKHdlYlNob3A6IEFwaS5XZWJTaG9wKTogUHJvbWlzZTxBcGkuV2ViU2hvcD4ge1xyXG4gICAgICAgIGlmICghd2ViU2hvcClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwid2ViU2hvcCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmRiXHJcbiAgICAgICAgICAgIC5jb2xsZWN0aW9uKERhdGFiYXNlLkNvbGxlY3Rpb25zLndlYnNob3BzKVxyXG4gICAgICAgICAgICAudGhlbihjID0+IGMudXBkYXRlT25lKFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiB3ZWJTaG9wLmlkXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICRzZXQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlQcmljZTogd2ViU2hvcC5kZWxpdmVyeVByaWNlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB3ZWJTaG9wKTtcclxuICAgIH1cclxuXHJcbiAgICBwdXQod2ViU2hvcDogQXBpLldlYlNob3ApOiBQcm9taXNlPEFwaS5XZWJTaG9wPiB7XHJcbiAgICAgICAgaWYgKCF3ZWJTaG9wKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ3ZWJTaG9wIGlzIHVuZGVmaW5lZFwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGJcclxuICAgICAgICAgICAgLmNvbGxlY3Rpb24oRGF0YWJhc2UuQ29sbGVjdGlvbnMud2Vic2hvcHMpXHJcbiAgICAgICAgICAgIC50aGVuKGMgPT4gYy51cGRhdGVPbmUoXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHdlYlNob3AuaWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB3ZWJTaG9wLFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwc2VydDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB3ZWJTaG9wKTtcclxuICAgIH1cclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/web-shop/mongo-web-shop-storage.ts\n ** module id = 36\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar web_shop_validator_1 = require(\"./web-shop-validator\");\r\nvar WebShopService = (function () {\r\n    function WebShopService(storage) {\r\n        this.storage = storage;\r\n        this.validator = new web_shop_validator_1.default();\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n    WebShopService.prototype.all = function () {\r\n        return this.storage.all();\r\n    };\r\n    WebShopService.prototype.one = function (webShopId) {\r\n        if (!webShopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        return this.storage.one(webShopId);\r\n    };\r\n    WebShopService.prototype.save = function (webShop) {\r\n        var _this = this;\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return this.validator\r\n            .validate(webShop)\r\n            .then(function (webShop) { return _this.storage\r\n            .save(webShop)\r\n            .then(function () { return _this.one(webShop.id); }); });\r\n    };\r\n    WebShopService.prototype.put = function (webShop) {\r\n        var _this = this;\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return this.storage\r\n            .put(webShop)\r\n            .then(function () { return _this.one(webShop.id); })\r\n            .catch(function (err) {\r\n            throw {\r\n                \"\": \"\" + err\r\n            };\r\n        });\r\n    };\r\n    return WebShopService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = WebShopService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLXNob3Atc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIndlYi1zaG9wLXNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsaURBQWlEOztBQUVqRCxtQ0FBNkIsc0JBQXNCLENBQUMsQ0FBQTtBQUVwRDtJQUlJLHdCQUFvQixPQUFpQztRQUFqQyxZQUFPLEdBQVAsT0FBTyxDQUEwQjtRQUY3QyxjQUFTLEdBQUcsSUFBSSw0QkFBZ0IsRUFBRSxDQUFDO1FBR3ZDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCw0QkFBRyxHQUFIO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDOUIsQ0FBQztJQUVELDRCQUFHLEdBQUgsVUFBSSxTQUFpQjtRQUNqQixFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUM5QyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVELDZCQUFJLEdBQUosVUFBSyxPQUFvQjtRQUF6QixpQkFTQztRQVJHLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBRTVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUzthQUNoQixRQUFRLENBQUMsT0FBTyxDQUFDO2FBQ2pCLElBQUksQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLEtBQUksQ0FBQyxPQUFPO2FBQ3hCLElBQUksQ0FBQyxPQUFPLENBQUM7YUFDYixJQUFJLENBQUMsY0FBTSxPQUFBLEtBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFwQixDQUFvQixDQUFDLEVBRnBCLENBRW9CLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBRUQsNEJBQUcsR0FBSCxVQUFJLE9BQW9CO1FBQXhCLGlCQVlDO1FBWEcsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDVCxNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFFNUMsTUFBTSxDQUE0QixJQUFJLENBQUMsT0FBTzthQUN6QyxHQUFHLENBQUMsT0FBTyxDQUFDO2FBQ1osSUFBSSxDQUFDLGNBQU0sT0FBQSxLQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBcEIsQ0FBb0IsQ0FBQzthQUNoQyxLQUFLLENBQUMsVUFBQSxHQUFHO1lBQ04sTUFBTTtnQkFDRixFQUFFLEVBQUUsS0FBRyxHQUFLO2FBQ2YsQ0FBQztRQUNOLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUNMLHFCQUFDO0FBQUQsQ0FBQyxBQTNDRCxJQTJDQztBQTNDRDtnQ0EyQ0MsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxyXG5cclxuaW1wb3J0IFdlYlNob3BWYWxpZGF0b3IgZnJvbSBcIi4vd2ViLXNob3AtdmFsaWRhdG9yXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXZWJTaG9wU2VydmljZSB7XHJcblxyXG4gICAgcHJpdmF0ZSB2YWxpZGF0b3IgPSBuZXcgV2ViU2hvcFZhbGlkYXRvcigpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc3RvcmFnZTogV2ViU2hvcHMuSVdlYlNob3BTdG9yYWdlKSB7XHJcbiAgICAgICAgaWYgKCFzdG9yYWdlKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzdG9yYWdlIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBhbGwoKTogUHJvbWlzZTxBcGkuV2ViU2hvcFtdPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5hbGwoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbmUod2ViU2hvcElkOiBzdHJpbmcpOiBQcm9taXNlPEFwaS5XZWJTaG9wPiB7XHJcbiAgICAgICAgaWYgKCF3ZWJTaG9wSWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIndlYlNob3BJZCBpcyB1bmRlZmluZWRcIik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5vbmUod2ViU2hvcElkKTtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlKHdlYlNob3A6IEFwaS5XZWJTaG9wKTogUHJvbWlzZTxBcGkuV2ViU2hvcCB8IEFwaS5WYWxpZGF0aW9uUmVzdWx0PiB7XHJcbiAgICAgICAgaWYgKCF3ZWJTaG9wKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ3ZWJTaG9wIGlzIHVuZGVmaW5lZFwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdG9yXHJcbiAgICAgICAgICAgIC52YWxpZGF0ZSh3ZWJTaG9wKVxyXG4gICAgICAgICAgICAudGhlbih3ZWJTaG9wID0+IHRoaXMuc3RvcmFnZVxyXG4gICAgICAgICAgICAgICAgLnNhdmUod2ViU2hvcClcclxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMub25lKHdlYlNob3AuaWQpKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHV0KHdlYlNob3A6IEFwaS5XZWJTaG9wKTogUHJvbWlzZTxBcGkuV2ViU2hvcD4ge1xyXG4gICAgICAgIGlmICghd2ViU2hvcClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwid2ViU2hvcCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiA8UHJvbWlzZTxBcGkuV2ViU2hvcD4+PGFueT50aGlzLnN0b3JhZ2VcclxuICAgICAgICAgICAgLnB1dCh3ZWJTaG9wKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLm9uZSh3ZWJTaG9wLmlkKSlcclxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJcIjogYCR7ZXJyfWBcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/web-shop/web-shop-service.ts\n ** module id = 37\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar validator_1 = require(\"../../validator\");\r\nvar WebShopValidator = (function () {\r\n    function WebShopValidator() {\r\n        /** Only updateable fields is validated */\r\n        this.validator = validator_1.rules.obj({\r\n            deliveryPrice: validator_1.rules.num()\r\n                .parseNumber({ errorMessage: \"Price is not recognized as number\" })\r\n                .must(function (price) { return price > 0; }, { errorMessage: \"Delivery price must be greater than zero\" })\r\n        }).expandable();\r\n    }\r\n    WebShopValidator.prototype.validate = function (webShop) {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n        return validator_1.validateWithPromise(webShop, this.validator);\r\n    };\r\n    return WebShopValidator;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = WebShopValidator;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLXNob3AtdmFsaWRhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsid2ViLXNob3AtdmFsaWRhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDs7QUFFakQsMEJBQXVFLGlCQUFpQixDQUFDLENBQUE7QUFFekY7SUFBQTtRQUNJLDBDQUEwQztRQUNuQyxjQUFTLEdBQWdDLGlCQUFLLENBQUMsR0FBRyxDQUFjO1lBQ25FLGFBQWEsRUFBRSxpQkFBSyxDQUFDLEdBQUcsRUFBRTtpQkFDckIsV0FBVyxDQUFDLEVBQUUsWUFBWSxFQUFFLG1DQUFtQyxFQUFFLENBQUM7aUJBQ2xFLElBQUksQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssR0FBRyxDQUFDLEVBQVQsQ0FBUyxFQUFFLEVBQUUsWUFBWSxFQUFFLDBDQUEwQyxFQUFFLENBQUM7U0FDOUYsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBUXBCLENBQUM7SUFORyxtQ0FBUSxHQUFSLFVBQVMsT0FBb0I7UUFDekIsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDVCxNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFFNUMsTUFBTSxDQUFDLCtCQUFRLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBQ0wsdUJBQUM7QUFBRCxDQUFDLEFBZEQsSUFjQztBQWREO2tDQWNDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCB7IHZhbGlkYXRlV2l0aFByb21pc2UgYXMgdmFsaWRhdGUsIFZhbGlkYXRpb25SdWxlLCBydWxlcyB9IGZyb20gXCIuLi8uLi92YWxpZGF0b3JcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdlYlNob3BWYWxpZGF0b3Ige1xyXG4gICAgLyoqIE9ubHkgdXBkYXRlYWJsZSBmaWVsZHMgaXMgdmFsaWRhdGVkICovXHJcbiAgICBwdWJsaWMgdmFsaWRhdG9yOiBWYWxpZGF0aW9uUnVsZTxBcGkuV2ViU2hvcD4gPSBydWxlcy5vYmo8QXBpLldlYlNob3A+KHtcclxuICAgICAgICBkZWxpdmVyeVByaWNlOiBydWxlcy5udW0oKVxyXG4gICAgICAgICAgICAucGFyc2VOdW1iZXIoeyBlcnJvck1lc3NhZ2U6IFwiUHJpY2UgaXMgbm90IHJlY29nbml6ZWQgYXMgbnVtYmVyXCIgfSlcclxuICAgICAgICAgICAgLm11c3QocHJpY2UgPT4gcHJpY2UgPiAwLCB7IGVycm9yTWVzc2FnZTogXCJEZWxpdmVyeSBwcmljZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvXCIgfSlcclxuICAgIH0pLmV4cGFuZGFibGUoKTtcclxuXHJcbiAgICB2YWxpZGF0ZSh3ZWJTaG9wOiBBcGkuV2ViU2hvcCk6IFByb21pc2U8QXBpLldlYlNob3A+IHtcclxuICAgICAgICBpZiAoIXdlYlNob3ApXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIndlYlNob3AgaXMgdW5kZWZpbmVkXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdmFsaWRhdGUod2ViU2hvcCwgdGhpcy52YWxpZGF0b3IpO1xyXG4gICAgfVxyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/web-shop/web-shop-validator.ts\n ** module id = 38\n ** module chunks = 0\n **/","/// <reference path=\"typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar config_1 = require(\"./config\");\r\nvar db_1 = require(\"./data-access/db\");\r\nvar mongo_web_shop_storage_1 = require(\"./services/web-shop/mongo-web-shop-storage\");\r\nvar web_shop_service_1 = require(\"./services/web-shop/web-shop-service\");\r\nvar mongo_product_storage_1 = require(\"./services/products/mongo-product-storage\");\r\nvar product_service_1 = require(\"./services/products/product-service\");\r\nvar scrape_service_1 = require(\"./services/scraping/scrape-service\");\r\nvar scrape_queue_service_1 = require(\"./services/scraping/scrape-queue-service\");\r\nvar scrape_scheduler_service_1 = require(\"./services/scraping/scrape-scheduler-service\");\r\nvar event_bus_1 = require(\"./services/event-bus\");\r\nvar db = new db_1.default();\r\nvar productService = new product_service_1.default(new mongo_product_storage_1.default(db));\r\nvar webShopService = new web_shop_service_1.default(new mongo_web_shop_storage_1.default(db));\r\nvar scrapeService = new scrape_service_1.default(productService, webShopService);\r\nvar queue = new scrape_queue_service_1.default(scrapeService, config_1.default.scrapingThreads, config_1.default.delayBetweenShopScrapingMs);\r\nvar scheduler = new scrape_scheduler_service_1.default(queue, productService, config_1.default.schedules);\r\nfunction run() {\r\n    // Re-run scraping when product data is changed.\r\n    event_bus_1.eventBus.on(event_bus_1.EventNames.ProductUpdated, function (productId) {\r\n        queue.enqueuePriore(productId);\r\n    });\r\n    if (scheduler.run())\r\n        console.info(\"Scrape server running\");\r\n    else\r\n        console.error(\"Error running scrape server\");\r\n}\r\nexports.run = run;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyYXBlLXNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNjcmFwZS1zZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMENBQTBDOztBQUUxQyx1QkFBMEIsVUFBVSxDQUFDLENBQUE7QUFFckMsbUJBQXFCLGtCQUFrQixDQUFDLENBQUE7QUFFeEMsdUNBQWdDLDRDQUE0QyxDQUFDLENBQUE7QUFDN0UsaUNBQTJCLHNDQUFzQyxDQUFDLENBQUE7QUFFbEUsc0NBQWdDLDJDQUEyQyxDQUFDLENBQUE7QUFDNUUsZ0NBQTJCLHFDQUFxQyxDQUFDLENBQUE7QUFFakUsK0JBQTBCLG9DQUFvQyxDQUFDLENBQUE7QUFDL0QscUNBQStCLDBDQUEwQyxDQUFDLENBQUE7QUFDMUUseUNBQW1DLDhDQUE4QyxDQUFDLENBQUE7QUFFbEYsMEJBQXFDLHNCQUFzQixDQUFDLENBQUE7QUFFNUQsSUFBTSxFQUFFLEdBQUcsSUFBSSxZQUFRLEVBQUUsQ0FBQztBQUcxQixJQUFNLGNBQWMsR0FBRyxJQUFJLHlCQUFjLENBQUMsSUFBSSwrQkFBbUIsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ3ZFLElBQU0sY0FBYyxHQUFHLElBQUksMEJBQWMsQ0FBQyxJQUFJLGdDQUFtQixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFFdkUsSUFBTSxhQUFhLEdBQUcsSUFBSSx3QkFBYSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsQ0FBQztBQUV4RSxJQUFNLEtBQUssR0FBRyxJQUFJLDhCQUFrQixDQUFDLGFBQWEsRUFBRSxnQkFBYSxDQUFDLGVBQWUsRUFBRSxnQkFBYSxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFDN0gsSUFBTSxTQUFTLEdBQUcsSUFBSSxrQ0FBc0IsQ0FBQyxLQUFLLEVBQUUsY0FBYyxFQUFFLGdCQUFhLENBQUMsU0FBUyxDQUFDLENBQUM7QUFFN0Y7SUFFSSxnREFBZ0Q7SUFDaEQsb0JBQVEsQ0FBQyxFQUFFLENBQUMsc0JBQVUsQ0FBQyxjQUFjLEVBQUUsVUFBQSxTQUFTO1FBQzVDLEtBQUssQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFHSCxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDaEIsT0FBTyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0lBQzFDLElBQUk7UUFDQSxPQUFPLENBQUMsS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7QUFDckQsQ0FBQztBQVplLFdBQUcsTUFZbEIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJ0eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcblxyXG5pbXBvcnQgY29uZmlndXJhdGlvbiBmcm9tIFwiLi9jb25maWdcIjtcclxuXHJcbmltcG9ydCBEYXRhYmFzZSBmcm9tIFwiLi9kYXRhLWFjY2Vzcy9kYlwiO1xyXG5cclxuaW1wb3J0IE1vbmdvV2ViU2hvcFNlcnZpY2UgZnJvbSBcIi4vc2VydmljZXMvd2ViLXNob3AvbW9uZ28td2ViLXNob3Atc3RvcmFnZVwiO1xyXG5pbXBvcnQgV2ViU2hvcFNlcnZpY2UgZnJvbSBcIi4vc2VydmljZXMvd2ViLXNob3Avd2ViLXNob3Atc2VydmljZVwiO1xyXG5cclxuaW1wb3J0IE1vbmdvUHJvZHVjdFN0b3JhZ2UgZnJvbSBcIi4vc2VydmljZXMvcHJvZHVjdHMvbW9uZ28tcHJvZHVjdC1zdG9yYWdlXCI7XHJcbmltcG9ydCBQcm9kdWN0U2VydmljZSBmcm9tIFwiLi9zZXJ2aWNlcy9wcm9kdWN0cy9wcm9kdWN0LXNlcnZpY2VcIjtcclxuXHJcbmltcG9ydCBTY3JhcGVTZXJ2aWNlIGZyb20gXCIuL3NlcnZpY2VzL3NjcmFwaW5nL3NjcmFwZS1zZXJ2aWNlXCI7XHJcbmltcG9ydCBTY3JhcGVRdWV1ZVNlcnZpY2UgZnJvbSBcIi4vc2VydmljZXMvc2NyYXBpbmcvc2NyYXBlLXF1ZXVlLXNlcnZpY2VcIjtcclxuaW1wb3J0IFNjcmFwZVNjaGVkdWxlclNlcnZpY2UgZnJvbSBcIi4vc2VydmljZXMvc2NyYXBpbmcvc2NyYXBlLXNjaGVkdWxlci1zZXJ2aWNlXCI7XHJcblxyXG5pbXBvcnQgeyBldmVudEJ1cywgRXZlbnROYW1lcyB9IGZyb20gXCIuL3NlcnZpY2VzL2V2ZW50LWJ1c1wiO1xyXG5cclxuY29uc3QgZGIgPSBuZXcgRGF0YWJhc2UoKTtcclxuXHJcblxyXG5jb25zdCBwcm9kdWN0U2VydmljZSA9IG5ldyBQcm9kdWN0U2VydmljZShuZXcgTW9uZ29Qcm9kdWN0U3RvcmFnZShkYikpO1xyXG5jb25zdCB3ZWJTaG9wU2VydmljZSA9IG5ldyBXZWJTaG9wU2VydmljZShuZXcgTW9uZ29XZWJTaG9wU2VydmljZShkYikpO1xyXG5cclxuY29uc3Qgc2NyYXBlU2VydmljZSA9IG5ldyBTY3JhcGVTZXJ2aWNlKHByb2R1Y3RTZXJ2aWNlLCB3ZWJTaG9wU2VydmljZSk7XHJcblxyXG5jb25zdCBxdWV1ZSA9IG5ldyBTY3JhcGVRdWV1ZVNlcnZpY2Uoc2NyYXBlU2VydmljZSwgY29uZmlndXJhdGlvbi5zY3JhcGluZ1RocmVhZHMsIGNvbmZpZ3VyYXRpb24uZGVsYXlCZXR3ZWVuU2hvcFNjcmFwaW5nTXMpO1xyXG5jb25zdCBzY2hlZHVsZXIgPSBuZXcgU2NyYXBlU2NoZWR1bGVyU2VydmljZShxdWV1ZSwgcHJvZHVjdFNlcnZpY2UsIGNvbmZpZ3VyYXRpb24uc2NoZWR1bGVzKTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBydW4oKSB7XHJcblxyXG4gICAgLy8gUmUtcnVuIHNjcmFwaW5nIHdoZW4gcHJvZHVjdCBkYXRhIGlzIGNoYW5nZWQuXHJcbiAgICBldmVudEJ1cy5vbihFdmVudE5hbWVzLlByb2R1Y3RVcGRhdGVkLCBwcm9kdWN0SWQgPT4ge1xyXG4gICAgICAgIHF1ZXVlLmVucXVldWVQcmlvcmUocHJvZHVjdElkKTtcclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICBpZiAoc2NoZWR1bGVyLnJ1bigpKVxyXG4gICAgICAgIGNvbnNvbGUuaW5mbyhcIlNjcmFwZSBzZXJ2ZXIgcnVubmluZ1wiKTtcclxuICAgIGVsc2VcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcnVubmluZyBzY3JhcGUgc2VydmVyXCIpO1xyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/scrape-server.ts\n ** module id = 39\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar jsdom_scraper_1 = require(\"../../scrapers/jsdom-scraper\");\r\nvar event_bus_1 = require(\"../event-bus\");\r\nvar ScrapeService = (function () {\r\n    function ScrapeService(productService, webShopService) {\r\n        this.productService = productService;\r\n        this.webShopService = webShopService;\r\n        this.scraper = new jsdom_scraper_1.default();\r\n        if (!productService)\r\n            throw new Error(\"productService is undefined\");\r\n        if (!webShopService)\r\n            throw new Error(\"webShopService is undefined\");\r\n        this.webShops = this.webShopService\r\n            .all()\r\n            .then(function (shops) { return shops.toHash(function (s) { return s.id; }); });\r\n    }\r\n    ScrapeService.prototype.scrapeProductData = function (productId) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return this.webShops.then(function (shops) {\r\n            return _this.productService.one(productId)\r\n                .then(function (product) { return Promise.all(_this.scrapeProduct(product, shops))\r\n                .then(function (results) { return results.toHash(function (e) { return e.webShopId; }, function (e) { return e.scrapingResult; }); }); })\r\n                .then(function (r) {\r\n                event_bus_1.eventBus.emit(event_bus_1.EventNames.ProductScraped, productId);\r\n                return r;\r\n            });\r\n        });\r\n    };\r\n    ScrapeService.prototype.scrapeProduct = function (product, shops) {\r\n        var _this = this;\r\n        return Object.keys(product.scrapingUrls)\r\n            .map(function (webShopId) { return _this.scrapeProductFromShopAndSave(product, webShopId, shops)\r\n            .then(function (productScrapeResult) { return ({\r\n            webShopId: webShopId,\r\n            scrapingResult: productScrapeResult\r\n        }); }); });\r\n    };\r\n    ScrapeService.prototype.scrapeProductFromShopAndSave = function (product, webShopId, shops) {\r\n        var _this = this;\r\n        return this.scraper\r\n            .scrape(product.scrapingUrls[webShopId], shops[webShopId].scrapingSettings)\r\n            .then(function (result) { return _this.productService\r\n            .updateScrapedData(product.id, webShopId, result)\r\n            .then(function () { return result; }); });\r\n    };\r\n    return ScrapeService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ScrapeService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyYXBlLXNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzY3JhcGUtc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpREFBaUQ7O0FBS2pELDhCQUF5Qiw4QkFBOEIsQ0FBQyxDQUFBO0FBRXhELDBCQUFxQyxjQUFjLENBQUMsQ0FBQTtBQU1wRDtJQUlJLHVCQUFvQixjQUE4QixFQUN0QyxjQUE4QjtRQUR0QixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDdEMsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBSmxDLFlBQU8sR0FBRyxJQUFJLHVCQUFZLEVBQUUsQ0FBQztRQUtqQyxFQUFFLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQztZQUNoQixNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7UUFDbkQsRUFBRSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUM7WUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1FBRW5ELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLGNBQWM7YUFDOUIsR0FBRyxFQUFFO2FBQ0wsSUFBSSxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSyxDQUFDLE1BQU0sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxFQUFFLEVBQUosQ0FBSSxDQUFDLEVBQXZCLENBQXVCLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQseUNBQWlCLEdBQWpCLFVBQWtCLFNBQWlCO1FBQW5DLGlCQWNDO1FBYkcsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDWCxNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFFOUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQUEsS0FBSztZQUMzQixNQUFNLENBQUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDO2lCQUNwQyxJQUFJLENBQUMsVUFBQSxPQUFPLElBQUksT0FBQSxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO2lCQUMzRCxJQUFJLENBQUMsVUFBQSxPQUFPLElBQUksT0FBQSxPQUFPLENBQUMsTUFBTSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLFNBQVMsRUFBWCxDQUFXLEVBQUUsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsY0FBYyxFQUFoQixDQUFnQixDQUFDLEVBQXZELENBQXVELENBQUMsRUFENUQsQ0FDNEQsQ0FBQztpQkFDN0UsSUFBSSxDQUFDLFVBQUEsQ0FBQztnQkFDSCxvQkFBUSxDQUFDLElBQUksQ0FBQyxzQkFBVSxDQUFDLGNBQWMsRUFBRSxTQUFTLENBQUMsQ0FBQztnQkFFcEQsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNiLENBQUMsQ0FBQyxDQUFDO1FBQ1gsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRU8scUNBQWEsR0FBckIsVUFBc0IsT0FBb0IsRUFBRSxLQUFrQjtRQUE5RCxpQkFRQztRQU5HLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUM7YUFDbkMsR0FBRyxDQUFDLFVBQUEsU0FBUyxJQUFJLE9BQUEsS0FBSSxDQUFDLDRCQUE0QixDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxDQUFDO2FBQ3pFLElBQUksQ0FBQyxVQUFBLG1CQUFtQixJQUFJLE9BQUEsQ0FBQztZQUMxQixTQUFTLEVBQUUsU0FBUztZQUNwQixjQUFjLEVBQUUsbUJBQW1CO1NBQ3RDLENBQUMsRUFIMkIsQ0FHM0IsQ0FBQyxFQUpXLENBSVgsQ0FBQyxDQUFDO0lBQ2pCLENBQUM7SUFFTyxvREFBNEIsR0FBcEMsVUFBcUMsT0FBb0IsRUFBRSxTQUFpQixFQUFFLEtBQWtCO1FBQWhHLGlCQU1DO1FBTEcsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPO2FBQ2QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDO2FBQzFFLElBQUksQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLEtBQUksQ0FBQyxjQUFjO2FBQzlCLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQzthQUNoRCxJQUFJLENBQUMsY0FBTSxPQUFBLE1BQU0sRUFBTixDQUFNLENBQUMsRUFGUCxDQUVPLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBQ0wsb0JBQUM7QUFBRCxDQUFDLEFBakRELElBaURDO0FBakREOytCQWlEQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XHJcblxyXG5pbXBvcnQgUHJvZHVjdFNlcnZpY2UgZnJvbSBcIi4uL3Byb2R1Y3RzL3Byb2R1Y3Qtc2VydmljZVwiO1xyXG5pbXBvcnQgV2ViU2hvcFNlcnZpY2UgZnJvbSBcIi4uL3dlYi1zaG9wL3dlYi1zaG9wLXNlcnZpY2VcIjtcclxuXHJcbmltcG9ydCBKc2RvbVNjcmFwZXIgZnJvbSBcIi4uLy4uL3NjcmFwZXJzL2pzZG9tLXNjcmFwZXJcIjtcclxuXHJcbmltcG9ydCB7IGV2ZW50QnVzLCBFdmVudE5hbWVzIH0gZnJvbSBcIi4uL2V2ZW50LWJ1c1wiO1xyXG5cclxuaW50ZXJmYWNlIFdlYlNob3BIYXNoIHtcclxuICAgIFt3ZWJTaG9wSWQ6IHN0cmluZ106IEFwaS5XZWJTaG9wO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY3JhcGVTZXJ2aWNlIGltcGxlbWVudHMgU2NyYXBpbmcuSVNjcmFwZVNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBzY3JhcGVyID0gbmV3IEpzZG9tU2NyYXBlcigpO1xyXG4gICAgcHJpdmF0ZSB3ZWJTaG9wczogUHJvbWlzZTxXZWJTaG9wSGFzaD47XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBwcm9kdWN0U2VydmljZTogUHJvZHVjdFNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSB3ZWJTaG9wU2VydmljZTogV2ViU2hvcFNlcnZpY2UpIHtcclxuICAgICAgICBpZiAoIXByb2R1Y3RTZXJ2aWNlKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJwcm9kdWN0U2VydmljZSBpcyB1bmRlZmluZWRcIik7XHJcbiAgICAgICAgaWYgKCF3ZWJTaG9wU2VydmljZSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwid2ViU2hvcFNlcnZpY2UgaXMgdW5kZWZpbmVkXCIpO1xyXG5cclxuICAgICAgICB0aGlzLndlYlNob3BzID0gdGhpcy53ZWJTaG9wU2VydmljZVxyXG4gICAgICAgICAgICAuYWxsKClcclxuICAgICAgICAgICAgLnRoZW4oc2hvcHMgPT4gc2hvcHMudG9IYXNoKHMgPT4gcy5pZCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNjcmFwZVByb2R1Y3REYXRhKHByb2R1Y3RJZDogc3RyaW5nKTogUHJvbWlzZTxTY3JhcGluZy5Qcm9kdWN0U2NyYXBlUmVzdWx0PiB7XHJcbiAgICAgICAgaWYgKCFwcm9kdWN0SWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInByb2R1Y3RJZCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLndlYlNob3BzLnRoZW4oc2hvcHMgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9kdWN0U2VydmljZS5vbmUocHJvZHVjdElkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocHJvZHVjdCA9PiBQcm9taXNlLmFsbCh0aGlzLnNjcmFwZVByb2R1Y3QocHJvZHVjdCwgc2hvcHMpKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKHJlc3VsdHMgPT4gcmVzdWx0cy50b0hhc2goZSA9PiBlLndlYlNob3BJZCwgZSA9PiBlLnNjcmFwaW5nUmVzdWx0KSkpXHJcbiAgICAgICAgICAgICAgICAudGhlbihyID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBldmVudEJ1cy5lbWl0KEV2ZW50TmFtZXMuUHJvZHVjdFNjcmFwZWQsIHByb2R1Y3RJZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzY3JhcGVQcm9kdWN0KHByb2R1Y3Q6IEFwaS5Qcm9kdWN0LCBzaG9wczogV2ViU2hvcEhhc2gpOiBQcm9taXNlPHsgd2ViU2hvcElkOiBzdHJpbmc7IHNjcmFwaW5nUmVzdWx0OiBTY3JhcGluZy5XZWJTaG9wU2NyYXBpbmdSZXN1bHQ7IH0+W10ge1xyXG5cclxuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMocHJvZHVjdC5zY3JhcGluZ1VybHMpXHJcbiAgICAgICAgICAgIC5tYXAod2ViU2hvcElkID0+IHRoaXMuc2NyYXBlUHJvZHVjdEZyb21TaG9wQW5kU2F2ZShwcm9kdWN0LCB3ZWJTaG9wSWQsIHNob3BzKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocHJvZHVjdFNjcmFwZVJlc3VsdCA9PiAoe1xyXG4gICAgICAgICAgICAgICAgICAgIHdlYlNob3BJZDogd2ViU2hvcElkLFxyXG4gICAgICAgICAgICAgICAgICAgIHNjcmFwaW5nUmVzdWx0OiBwcm9kdWN0U2NyYXBlUmVzdWx0XHJcbiAgICAgICAgICAgICAgICB9KSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2NyYXBlUHJvZHVjdEZyb21TaG9wQW5kU2F2ZShwcm9kdWN0OiBBcGkuUHJvZHVjdCwgd2ViU2hvcElkOiBzdHJpbmcsIHNob3BzOiBXZWJTaG9wSGFzaCk6IFByb21pc2U8U2NyYXBpbmcuV2ViU2hvcFNjcmFwaW5nUmVzdWx0PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NyYXBlclxyXG4gICAgICAgICAgICAuc2NyYXBlKHByb2R1Y3Quc2NyYXBpbmdVcmxzW3dlYlNob3BJZF0sIHNob3BzW3dlYlNob3BJZF0uc2NyYXBpbmdTZXR0aW5ncylcclxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHRoaXMucHJvZHVjdFNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC51cGRhdGVTY3JhcGVkRGF0YShwcm9kdWN0LmlkLCB3ZWJTaG9wSWQsIHJlc3VsdClcclxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHJlc3VsdCkpO1xyXG4gICAgfVxyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/scraping/scrape-service.ts\n ** module id = 40\n ** module chunks = 0\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar jsdom = require(\"jsdom\");\r\nvar value_parser_1 = require(\"./value-parser\");\r\nvar JsdomScraper = (function () {\r\n    function JsdomScraper() {\r\n        this.valueParser = new value_parser_1.default();\r\n    }\r\n    JsdomScraper.prototype.scrape = function (url, values) {\r\n        var _this = this;\r\n        if (!url)\r\n            throw new Error(\"url is undefined\");\r\n        if (!values)\r\n            throw new Error(\"values is undefined.\");\r\n        if (!Object.keys(values).length)\r\n            throw new Error(\"No values to extract\");\r\n        var result = {\r\n            isSuccessful: false,\r\n            error: null,\r\n            values: {}\r\n        };\r\n        // \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\"\r\n        return new Promise(function (resolve) {\r\n            jsdom.env({\r\n                url: url,\r\n                userAgent: \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\",\r\n                features: {\r\n                    FetchExternalResources: false,\r\n                    ProcessExternalResources: false\r\n                },\r\n                done: function (err, window) {\r\n                    if (err && err.length) {\r\n                        result.isSuccessful = false;\r\n                        result.error = err;\r\n                        resolve(result);\r\n                        return;\r\n                    }\r\n                    else {\r\n                        Object.keys(values)\r\n                            .forEach(function (valueName) {\r\n                            var settings = values[valueName];\r\n                            result.values[valueName] = _this.scrapeValue(window.document, settings);\r\n                        });\r\n                        result.isSuccessful = Object.keys(result.values)\r\n                            .map(function (valueName) { return result.values[valueName]; })\r\n                            .every(function (v) { return v.isSuccessful; });\r\n                        resolve(result);\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    };\r\n    JsdomScraper.prototype.scrapeValue = function (document, valueScrapingSettings) {\r\n        if (!document)\r\n            throw new Error(\"document is undefined\");\r\n        if (!valueScrapingSettings)\r\n            throw new Error(\"valueScrapingSettings is undefined\");\r\n        var parsingContext = {\r\n            location: document.location\r\n        };\r\n        var result = this.emptyValueScrapingResult();\r\n        for (var _i = 0, valueScrapingSettings_1 = valueScrapingSettings; _i < valueScrapingSettings_1.length; _i++) {\r\n            var scrapingSetting = valueScrapingSettings_1[_i];\r\n            try {\r\n                var rawValue = this.extractRawValueFromDocument(document, scrapingSetting);\r\n                var parsedValue = this.valueParser[scrapingSetting.type](rawValue, parsingContext);\r\n                result.isSuccessful = true;\r\n                result.error = null;\r\n                result.settings = scrapingSetting;\r\n                result.value = parsedValue;\r\n                return result;\r\n            }\r\n            catch (error) {\r\n                result.isSuccessful = false;\r\n                result.error = error;\r\n                result.settings = scrapingSetting;\r\n                if (scrapingSetting.failOnError)\r\n                    return result;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    JsdomScraper.prototype.extractRawValueFromDocument = function (document, valueScrapingSetting) {\r\n        var extractMethod = valueScrapingSetting.extract || \"queryselector\";\r\n        switch (extractMethod) {\r\n            case \"queryselector\":\r\n                {\r\n                    var querySelectorSettings = valueScrapingSetting;\r\n                    if (!querySelectorSettings.elementSelector)\r\n                        throw new Error(\"elementSelector is missing\");\r\n                    var elements = document.querySelectorAll(querySelectorSettings.elementSelector);\r\n                    if (elements.length === 0)\r\n                        throw new Error(\"Element with selector \" + querySelectorSettings.elementSelector + \" is missing\");\r\n                    if (elements.length > 1)\r\n                        throw new Error(\"There are more than one element with selector \" + querySelectorSettings.elementSelector);\r\n                    if (querySelectorSettings.attribute)\r\n                        return elements[0].getAttribute(querySelectorSettings.attribute);\r\n                    else\r\n                        return elements[0].textContent;\r\n                }\r\n                ;\r\n            case \"regex\":\r\n                {\r\n                    var regexSettings = valueScrapingSetting;\r\n                    if (!regexSettings.regex)\r\n                        throw new Error(\"regex missing\");\r\n                    var text = document.querySelector(\"html\").innerHTML;\r\n                    var regex = new RegExp(regexSettings.regex, \"gmi\");\r\n                    var matches = regex.exec(text);\r\n                    if (!matches.length)\r\n                        throw new Error(\"No value matches\");\r\n                    return matches[1];\r\n                }\r\n                ;\r\n            default:\r\n                throw new Error(\"Unknown extract method\");\r\n        }\r\n    };\r\n    JsdomScraper.prototype.emptyValueScrapingResult = function () {\r\n        return {\r\n            value: null,\r\n            isSuccessful: true,\r\n            error: null,\r\n            settings: null\r\n        };\r\n    };\r\n    return JsdomScraper;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = JsdomScraper;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianNkb20tc2NyYXBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImpzZG9tLXNjcmFwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOENBQThDOztBQUU5QyxJQUFZLEtBQUssV0FBTSxPQUFPLENBQUMsQ0FBQTtBQUMvQiw2QkFBNEIsZ0JBQWdCLENBQUMsQ0FBQTtBQUU3QztJQUFBO1FBQ1ksZ0JBQVcsR0FBRyxJQUFJLHNCQUFlLEVBQUUsQ0FBQztJQXlJaEQsQ0FBQztJQXZJRyw2QkFBTSxHQUFOLFVBQU8sR0FBVyxFQUFFLE1BQTRCO1FBQWhELGlCQThDQztRQTdDRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUNMLE1BQU0sSUFBSSxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUN4QyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUNSLE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUM1QyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQzVCLE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUU1QyxJQUFNLE1BQU0sR0FBbUM7WUFDM0MsWUFBWSxFQUFFLEtBQUs7WUFDbkIsS0FBSyxFQUFFLElBQUk7WUFDWCxNQUFNLEVBQUUsRUFBRTtTQUNiLENBQUM7UUFDRixtSEFBbUg7UUFDbkgsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFDLFVBQUEsT0FBTztZQUN0QixLQUFLLENBQUMsR0FBRyxDQUFDO2dCQUNOLEdBQUcsRUFBRSxHQUFHO2dCQUNSLFNBQVMsRUFBRSxnSEFBZ0g7Z0JBQzNILFFBQVEsRUFBRTtvQkFDTixzQkFBc0IsRUFBRSxLQUFLO29CQUM3Qix3QkFBd0IsRUFBRSxLQUFLO2lCQUNsQztnQkFDRCxJQUFJLEVBQUUsVUFBQyxHQUFHLEVBQUUsTUFBTTtvQkFDZCxF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LENBQUM7d0JBQ3JCLE1BQU0sSUFBSSxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUM7b0JBRXJDLElBQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDO29CQUV0RCxJQUFNLEtBQUssR0FBRyxJQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO29CQUVyRCxJQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUNqQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7d0JBQ2hCLE1BQU0sSUFBSSxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQztvQkFFeEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdEIsQ0FBQztnQkFBQSxDQUFDO1lBQ047Z0JBQ0ksTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBQ2xELENBQUM7SUFDTCxDQUFDO0lBRU8sK0NBQXdCLEdBQWhDO1FBQ0ksTUFBTSxDQUFDO1lBQ0gsS0FBSyxFQUFFLElBQUk7WUFDWCxZQUFZLEVBQUUsSUFBSTtZQUNsQixLQUFLLEVBQUUsSUFBSTtZQUNYLFFBQVEsRUFBRSxJQUFJO1NBQ2pCLENBQUM7SUFDTixDQUFDO0lBQ0wsbUJBQUM7QUFBRCxDQUFDLEFBMUlELElBMElDO0FBMUlEOzhCQTBJQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XHJcblxyXG5pbXBvcnQgKiBhcyBqc2RvbSBmcm9tIFwianNkb21cIjtcclxuaW1wb3J0IFZhbHVlUGFyc2VySGFzaCBmcm9tIFwiLi92YWx1ZS1wYXJzZXJcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEpzZG9tU2NyYXBlciBpbXBsZW1lbnRzIFNjcmFwaW5nLklTY3JhcGVyIHtcclxuICAgIHByaXZhdGUgdmFsdWVQYXJzZXIgPSBuZXcgVmFsdWVQYXJzZXJIYXNoKCk7XHJcblxyXG4gICAgc2NyYXBlKHVybDogc3RyaW5nLCB2YWx1ZXM6IEFwaS5TY3JhcGluZ1NldHRpbmdzKTogUHJvbWlzZTxTY3JhcGluZy5XZWJTaG9wU2NyYXBpbmdSZXN1bHQ+IHtcclxuICAgICAgICBpZiAoIXVybClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidXJsIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoIXZhbHVlcylcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidmFsdWVzIGlzIHVuZGVmaW5lZC5cIik7XHJcbiAgICAgICAgaWYgKCFPYmplY3Qua2V5cyh2YWx1ZXMpLmxlbmd0aClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdmFsdWVzIHRvIGV4dHJhY3RcIik7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlc3VsdDogU2NyYXBpbmcuV2ViU2hvcFNjcmFwaW5nUmVzdWx0ID0ge1xyXG4gICAgICAgICAgICBpc1N1Y2Nlc3NmdWw6IGZhbHNlLFxyXG4gICAgICAgICAgICBlcnJvcjogbnVsbCxcclxuICAgICAgICAgICAgdmFsdWVzOiB7fVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8gXCJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXT1c2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzUwLjAuMjY2MS4xMDIgU2FmYXJpLzUzNy4zNlwiXHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICAgICAgICBqc2RvbS5lbnYoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgICAgICAgICB1c2VyQWdlbnQ6IFwiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS81MC4wLjI2NjEuMTAyIFNhZmFyaS81MzcuMzZcIixcclxuICAgICAgICAgICAgICAgIGZlYXR1cmVzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgRmV0Y2hFeHRlcm5hbFJlc291cmNlczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgUHJvY2Vzc0V4dGVybmFsUmVzb3VyY2VzOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGRvbmU6IChlcnIsIHdpbmRvdykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIgJiYgZXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuaXNTdWNjZXNzZnVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5lcnJvciA9IGVycjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyh2YWx1ZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaCh2YWx1ZU5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gdmFsdWVzW3ZhbHVlTmFtZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnZhbHVlc1t2YWx1ZU5hbWVdID0gdGhpcy5zY3JhcGVWYWx1ZSh3aW5kb3cuZG9jdW1lbnQsIHNldHRpbmdzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmlzU3VjY2Vzc2Z1bCA9IE9iamVjdC5rZXlzKHJlc3VsdC52YWx1ZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKHZhbHVlTmFtZSA9PiByZXN1bHQudmFsdWVzW3ZhbHVlTmFtZV0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZXZlcnkodiA9PiB2LmlzU3VjY2Vzc2Z1bCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNjcmFwZVZhbHVlKGRvY3VtZW50OiBEb2N1bWVudCwgdmFsdWVTY3JhcGluZ1NldHRpbmdzOiBBcGkuVmFsdWVTY3JhcGluZ1NldHRpbmdzW10pOiBTY3JhcGluZy5WYWx1ZVNjcmFwaW5nUmVzdWx0IHtcclxuICAgICAgICBpZiAoIWRvY3VtZW50KVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJkb2N1bWVudCBpcyB1bmRlZmluZWRcIik7XHJcbiAgICAgICAgaWYgKCF2YWx1ZVNjcmFwaW5nU2V0dGluZ3MpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInZhbHVlU2NyYXBpbmdTZXR0aW5ncyBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIGNvbnN0IHBhcnNpbmdDb250ZXh0OiBTY3JhcGluZy5QYXJzZXJDb250ZXh0ID0ge1xyXG4gICAgICAgICAgICBsb2NhdGlvbjogZG9jdW1lbnQubG9jYXRpb25cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmVtcHR5VmFsdWVTY3JhcGluZ1Jlc3VsdCgpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBzY3JhcGluZ1NldHRpbmcgb2YgdmFsdWVTY3JhcGluZ1NldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByYXdWYWx1ZSA9IHRoaXMuZXh0cmFjdFJhd1ZhbHVlRnJvbURvY3VtZW50KGRvY3VtZW50LCBzY3JhcGluZ1NldHRpbmcpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFyc2VkVmFsdWUgPSB0aGlzLnZhbHVlUGFyc2VyW3NjcmFwaW5nU2V0dGluZy50eXBlXShyYXdWYWx1ZSwgcGFyc2luZ0NvbnRleHQpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc3VsdC5pc1N1Y2Nlc3NmdWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LmVycm9yID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5zZXR0aW5ncyA9IHNjcmFwaW5nU2V0dGluZztcclxuICAgICAgICAgICAgICAgIHJlc3VsdC52YWx1ZSA9IHBhcnNlZFZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuaXNTdWNjZXNzZnVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuZXJyb3IgPSBlcnJvcjtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5zZXR0aW5ncyA9IHNjcmFwaW5nU2V0dGluZztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NyYXBpbmdTZXR0aW5nLmZhaWxPbkVycm9yKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBleHRyYWN0UmF3VmFsdWVGcm9tRG9jdW1lbnQoZG9jdW1lbnQ6IERvY3VtZW50LCB2YWx1ZVNjcmFwaW5nU2V0dGluZzogQXBpLlZhbHVlU2NyYXBpbmdTZXR0aW5ncyk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgZXh0cmFjdE1ldGhvZCA9IHZhbHVlU2NyYXBpbmdTZXR0aW5nLmV4dHJhY3QgfHwgXCJxdWVyeXNlbGVjdG9yXCI7XHJcblxyXG4gICAgICAgIHN3aXRjaCAoZXh0cmFjdE1ldGhvZCkge1xyXG4gICAgICAgICAgICBjYXNlIFwicXVlcnlzZWxlY3RvclwiOlxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXJ5U2VsZWN0b3JTZXR0aW5ncyA9IHZhbHVlU2NyYXBpbmdTZXR0aW5nIGFzIEFwaS5RdWVyeVNlbGVjdG9yRXh0cmFjdFNldHRpbmdzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXF1ZXJ5U2VsZWN0b3JTZXR0aW5ncy5lbGVtZW50U2VsZWN0b3IpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZWxlbWVudFNlbGVjdG9yIGlzIG1pc3NpbmdgKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHF1ZXJ5U2VsZWN0b3JTZXR0aW5ncy5lbGVtZW50U2VsZWN0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50cy5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRWxlbWVudCB3aXRoIHNlbGVjdG9yICR7cXVlcnlTZWxlY3RvclNldHRpbmdzLmVsZW1lbnRTZWxlY3Rvcn0gaXMgbWlzc2luZ2ApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50cy5sZW5ndGggPiAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIGFyZSBtb3JlIHRoYW4gb25lIGVsZW1lbnQgd2l0aCBzZWxlY3RvciAke3F1ZXJ5U2VsZWN0b3JTZXR0aW5ncy5lbGVtZW50U2VsZWN0b3J9YCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChxdWVyeVNlbGVjdG9yU2V0dGluZ3MuYXR0cmlidXRlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudHNbMF0uZ2V0QXR0cmlidXRlKHF1ZXJ5U2VsZWN0b3JTZXR0aW5ncy5hdHRyaWJ1dGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRzWzBdLnRleHRDb250ZW50O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY2FzZSBcInJlZ2V4XCI6XHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVnZXhTZXR0aW5ncyA9IHZhbHVlU2NyYXBpbmdTZXR0aW5nIGFzIEFwaS5SZWdleEV4dHJhY3RTZXR0aW5ncztcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlZ2V4U2V0dGluZ3MucmVnZXgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInJlZ2V4IG1pc3NpbmdcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaHRtbFwiKS5pbm5lckhUTUw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChyZWdleFNldHRpbmdzLnJlZ2V4LCBcImdtaVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHJlZ2V4LmV4ZWModGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVzLmxlbmd0aClcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdmFsdWUgbWF0Y2hlc1wiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXNbMV07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biBleHRyYWN0IG1ldGhvZFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbXB0eVZhbHVlU2NyYXBpbmdSZXN1bHQoKTogU2NyYXBpbmcuVmFsdWVTY3JhcGluZ1Jlc3VsdCB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdmFsdWU6IG51bGwsXHJcbiAgICAgICAgICAgIGlzU3VjY2Vzc2Z1bDogdHJ1ZSxcclxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgIHNldHRpbmdzOiBudWxsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSJdfQ==\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/scrapers/jsdom-scraper.ts\n ** module id = 41\n ** module chunks = 0\n **/","module.exports = require(\"jsdom\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"jsdom\"\n ** module id = 42\n ** module chunks = 0\n **/","\"use strict\";\r\n/// <reference path=\"../typings/index.d.ts\"/>\r\nvar path = require(\"path\");\r\nvar ValueParserHash = (function () {\r\n    function ValueParserHash() {\r\n        this.parsers = {};\r\n        this.parsers[\"string\"] = this.string;\r\n        this.parsers[\"number\"] = this.number;\r\n    }\r\n    ValueParserHash.prototype.string = function (input) {\r\n        return (input || \"\").trim();\r\n    };\r\n    ValueParserHash.prototype.number = function (input) {\r\n        if (!input)\r\n            throw new Error(\"Number is missing.\");\r\n        var src = input.replace(/[^0-9\\.]/g, \"\");\r\n        var number = parseFloat(src);\r\n        if (number && !isNaN(number))\r\n            return number;\r\n        throw new Error(\"Number format is not valid.\");\r\n    };\r\n    ValueParserHash.prototype.relativeUrl = function (input, context) {\r\n        var baseLocation = input[0] === \"/\" ? context.location.origin : context.location.href;\r\n        return path.posix.join(baseLocation, input).replace(\":/\", \"://\");\r\n    };\r\n    return ValueParserHash;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ValueParserHash;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsdWUtcGFyc2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidmFsdWUtcGFyc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw2Q0FBNkM7QUFDN0MsSUFBWSxJQUFJLFdBQU0sTUFBTSxDQUFDLENBQUE7QUFFN0I7SUFHSTtRQUZBLFlBQU8sR0FBRyxFQUFFLENBQUM7UUFHVCxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDckMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3pDLENBQUM7SUFFRCxnQ0FBTSxHQUFOLFVBQU8sS0FBYTtRQUNoQixNQUFNLENBQUMsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUVELGdDQUFNLEdBQU4sVUFBTyxLQUFhO1FBQ2hCLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQ1AsTUFBTSxJQUFJLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBRTFDLElBQU0sR0FBRyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRTNDLElBQU0sTUFBTSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUUvQixFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDekIsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUVsQixNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVELHFDQUFXLEdBQVgsVUFBWSxLQUFhLEVBQUUsT0FBK0I7UUFDdEQsSUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztRQUV4RixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckUsQ0FBQztJQUNMLHNCQUFDO0FBQUQsQ0FBQyxBQS9CRCxJQStCQztBQS9CRDtpQ0ErQkMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZhbHVlUGFyc2VySGFzaCB7XHJcbiAgICBwYXJzZXJzID0ge307XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5wYXJzZXJzW1wic3RyaW5nXCJdID0gdGhpcy5zdHJpbmc7XHJcbiAgICAgICAgdGhpcy5wYXJzZXJzW1wibnVtYmVyXCJdID0gdGhpcy5udW1iZXI7XHJcbiAgICB9XHJcblxyXG4gICAgc3RyaW5nKGlucHV0OiBzdHJpbmcpOiBhbnkge1xyXG4gICAgICAgIHJldHVybiAoaW5wdXQgfHwgXCJcIikudHJpbSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG51bWJlcihpbnB1dDogc3RyaW5nKTogYW55IHtcclxuICAgICAgICBpZiAoIWlucHV0KVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOdW1iZXIgaXMgbWlzc2luZy5cIik7XHJcblxyXG4gICAgICAgIGNvbnN0IHNyYyA9IGlucHV0LnJlcGxhY2UoL1teMC05XFwuXS9nLCBcIlwiKTtcclxuXHJcbiAgICAgICAgY29uc3QgbnVtYmVyID0gcGFyc2VGbG9hdChzcmMpO1xyXG5cclxuICAgICAgICBpZiAobnVtYmVyICYmICFpc05hTihudW1iZXIpKVxyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG5cclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOdW1iZXIgZm9ybWF0IGlzIG5vdCB2YWxpZC5cIik7XHJcbiAgICB9XHJcblxyXG4gICAgcmVsYXRpdmVVcmwoaW5wdXQ6IHN0cmluZywgY29udGV4dDogU2NyYXBpbmcuUGFyc2VyQ29udGV4dCkge1xyXG4gICAgICAgIGNvbnN0IGJhc2VMb2NhdGlvbiA9IGlucHV0WzBdID09PSBcIi9cIiA/IGNvbnRleHQubG9jYXRpb24ub3JpZ2luIDogY29udGV4dC5sb2NhdGlvbi5ocmVmOyAgICAgICAgXHJcblxyXG4gICAgICAgIHJldHVybiBwYXRoLnBvc2l4LmpvaW4oYmFzZUxvY2F0aW9uLCBpbnB1dCkucmVwbGFjZShcIjovXCIsIFwiOi8vXCIpO1xyXG4gICAgfVxyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/scrapers/value-parser.ts\n ** module id = 43\n ** module chunks = 0\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 44\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\"/>\r\n\"use strict\";\r\nvar async = require(\"async\");\r\nvar ScrapeQueueService = (function () {\r\n    function ScrapeQueueService(scrapeService, scrapingThreads, delayBetweenProductScraping) {\r\n        var _this = this;\r\n        this.scrapeService = scrapeService;\r\n        if (!scrapeService)\r\n            throw new Error(\"scrapeService is missing\");\r\n        this.queue = async.queue(function (productId, callback) {\r\n            console.log(\"Scraping data for product \" + productId);\r\n            _this.scrapeService.scrapeProductData(productId)\r\n                .then(function (res) {\r\n                Object.keys(res)\r\n                    .forEach(function (webShop) {\r\n                    var result = res[webShop];\r\n                    if (result.isSuccessful)\r\n                        console.log(\"Scraping product \" + productId + \" from shop \" + webShop + \" completed successfuly\");\r\n                    else {\r\n                        console.error(\"Scraping product \" + productId + \" from shop \" + webShop + \" failed\");\r\n                        console.error(result.error);\r\n                    }\r\n                });\r\n                setTimeout(callback, delayBetweenProductScraping);\r\n            })\r\n                .catch(function (err) { return callback(err); });\r\n        }, scrapingThreads);\r\n    }\r\n    /**\r\n     * Enqueues scraping data and saving results for a product.\r\n     * Method returns a promise which will be resolved when processing finishes.\r\n     */\r\n    ScrapeQueueService.prototype.enqueue = function (productId) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return new Promise(function (resolve, reject) {\r\n            _this.queue.push(productId, function (err) {\r\n                if (err)\r\n                    reject(err);\r\n                else\r\n                    resolve(productId);\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Enqueues scraping data and saving results for a product before other enqueued products.\r\n     * Method returns a promise which will be resolved when processing finishes.\r\n     */\r\n    ScrapeQueueService.prototype.enqueuePriore = function (productId) {\r\n        var _this = this;\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        return new Promise(function (resolve, reject) {\r\n            _this.queue.unshift(productId, function (err) {\r\n                if (err)\r\n                    reject(err);\r\n                else\r\n                    resolve(productId);\r\n            });\r\n        });\r\n    };\r\n    return ScrapeQueueService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ScrapeQueueService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyYXBlLXF1ZXVlLXNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzY3JhcGUtcXVldWUtc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnREFBZ0Q7O0FBRWhELElBQVksS0FBSyxXQUFNLE9BQU8sQ0FBQyxDQUFBO0FBSS9CO0lBR0ksNEJBQW9CLGFBQTRCLEVBQUUsZUFBdUIsRUFBRSwyQkFBbUM7UUFIbEgsaUJBaUVDO1FBOUR1QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QyxFQUFFLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQztZQUNmLE1BQU0sSUFBSSxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUVoRCxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsVUFBQyxTQUFpQixFQUFFLFFBQVE7WUFDakQsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQkFBNkIsU0FBVyxDQUFDLENBQUM7WUFFdEQsS0FBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUM7aUJBQzFDLElBQUksQ0FBQyxVQUFBLEdBQUc7Z0JBQ0wsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7cUJBQ1gsT0FBTyxDQUFDLFVBQUEsT0FBTztvQkFDWixJQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQzVCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUM7d0JBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQW9CLFNBQVMsbUJBQWMsT0FBTywyQkFBd0IsQ0FBQyxDQUFDO29CQUM1RixJQUFJLENBQUMsQ0FBQzt3QkFDRixPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFvQixTQUFTLG1CQUFjLE9BQU8sWUFBUyxDQUFDLENBQUM7d0JBQzNFLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNoQyxDQUFDO2dCQUNMLENBQUMsQ0FBQyxDQUFDO2dCQUVQLFVBQVUsQ0FBQyxRQUFRLEVBQUUsMkJBQTJCLENBQUMsQ0FBQztZQUN0RCxDQUFDLENBQUM7aUJBQ0QsS0FBSyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFiLENBQWEsQ0FBQyxDQUFDO1FBRXJDLENBQUMsRUFBRSxlQUFlLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsb0NBQU8sR0FBUCxVQUFRLFNBQWlCO1FBQXpCLGlCQVlDO1FBWEcsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDWCxNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFFOUMsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFDLFVBQUMsT0FBTyxFQUFFLE1BQU07WUFDL0IsS0FBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQUEsR0FBRztnQkFDMUIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO29CQUNKLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDaEIsSUFBSTtvQkFDQSxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDM0IsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRDs7O09BR0c7SUFDSCwwQ0FBYSxHQUFiLFVBQWMsU0FBaUI7UUFBL0IsaUJBWUM7UUFYRyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUU5QyxNQUFNLENBQUMsSUFBSSxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsTUFBTTtZQUMvQixLQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsVUFBQSxHQUFHO2dCQUM3QixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUM7b0JBQ0osTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNoQixJQUFJO29CQUNBLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMzQixDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNMLHlCQUFDO0FBQUQsQ0FBQyxBQWpFRCxJQWlFQztBQWpFRDtvQ0FpRUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcblxyXG5pbXBvcnQgKiBhcyBhc3luYyBmcm9tIFwiYXN5bmNcIjtcclxuXHJcbmltcG9ydCBTY3JhcGVTZXJ2aWNlIGZyb20gXCIuL3NjcmFwZS1zZXJ2aWNlXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY3JhcGVRdWV1ZVNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBxdWV1ZTogQXN5bmNRdWV1ZTxzdHJpbmc+O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc2NyYXBlU2VydmljZTogU2NyYXBlU2VydmljZSwgc2NyYXBpbmdUaHJlYWRzOiBudW1iZXIsIGRlbGF5QmV0d2VlblByb2R1Y3RTY3JhcGluZzogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKCFzY3JhcGVTZXJ2aWNlKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzY3JhcGVTZXJ2aWNlIGlzIG1pc3NpbmdcIik7XHJcblxyXG4gICAgICAgIHRoaXMucXVldWUgPSBhc3luYy5xdWV1ZSgocHJvZHVjdElkOiBzdHJpbmcsIGNhbGxiYWNrKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTY3JhcGluZyBkYXRhIGZvciBwcm9kdWN0ICR7cHJvZHVjdElkfWApO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zY3JhcGVTZXJ2aWNlLnNjcmFwZVByb2R1Y3REYXRhKHByb2R1Y3RJZClcclxuICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMocmVzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaCh3ZWJTaG9wID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlc1t3ZWJTaG9wXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaXNTdWNjZXNzZnVsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTY3JhcGluZyBwcm9kdWN0ICR7cHJvZHVjdElkfSBmcm9tIHNob3AgJHt3ZWJTaG9wfSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bHlgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFNjcmFwaW5nIHByb2R1Y3QgJHtwcm9kdWN0SWR9IGZyb20gc2hvcCAke3dlYlNob3B9IGZhaWxlZGApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IocmVzdWx0LmVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoY2FsbGJhY2ssIGRlbGF5QmV0d2VlblByb2R1Y3RTY3JhcGluZyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBjYWxsYmFjayhlcnIpKTtcclxuXHJcbiAgICAgICAgfSwgc2NyYXBpbmdUaHJlYWRzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEVucXVldWVzIHNjcmFwaW5nIGRhdGEgYW5kIHNhdmluZyByZXN1bHRzIGZvciBhIHByb2R1Y3QuXHJcbiAgICAgKiBNZXRob2QgcmV0dXJucyBhIHByb21pc2Ugd2hpY2ggd2lsbCBiZSByZXNvbHZlZCB3aGVuIHByb2Nlc3NpbmcgZmluaXNoZXMuICAgICBcclxuICAgICAqL1xyXG4gICAgZW5xdWV1ZShwcm9kdWN0SWQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICAgICAgaWYgKCFwcm9kdWN0SWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInByb2R1Y3RJZCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucXVldWUucHVzaChwcm9kdWN0SWQsIGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocHJvZHVjdElkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFbnF1ZXVlcyBzY3JhcGluZyBkYXRhIGFuZCBzYXZpbmcgcmVzdWx0cyBmb3IgYSBwcm9kdWN0IGJlZm9yZSBvdGhlciBlbnF1ZXVlZCBwcm9kdWN0cy5cclxuICAgICAqIE1ldGhvZCByZXR1cm5zIGEgcHJvbWlzZSB3aGljaCB3aWxsIGJlIHJlc29sdmVkIHdoZW4gcHJvY2Vzc2luZyBmaW5pc2hlcy4gICAgIFxyXG4gICAgICovXHJcbiAgICBlbnF1ZXVlUHJpb3JlKHByb2R1Y3RJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKCFwcm9kdWN0SWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInByb2R1Y3RJZCBpcyB1bmRlZmluZWRcIik7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucXVldWUudW5zaGlmdChwcm9kdWN0SWQsIGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocHJvZHVjdElkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iXX0=\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/scraping/scrape-queue-service.ts\n ** module id = 45\n ** module chunks = 0\n **/","module.exports = require(\"async\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"async\"\n ** module id = 46\n ** module chunks = 0\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\"use strict\";\r\nvar schedule = require(\"node-schedule\");\r\nvar uuid = require(\"node-uuid\");\r\nvar ScrapeSchedulerService = (function () {\r\n    function ScrapeSchedulerService(queue, productService, schedules) {\r\n        this.queue = queue;\r\n        this.productService = productService;\r\n        this.schedules = schedules;\r\n        if (!queue)\r\n            throw new Error(\"queue is undefined\");\r\n        if (!productService)\r\n            throw new Error(\"productService is undefined\");\r\n        if (!schedules && !schedules.length)\r\n            throw new Error(\"schedules is undefined or empty\");\r\n    }\r\n    ScrapeSchedulerService.prototype.run = function () {\r\n        var _this = this;\r\n        if (schedule.scheduledJobs && Object.keys(schedule.scheduledJobs).length)\r\n            return false;\r\n        this.schedules\r\n            .map(function (rule) { return schedule.scheduleJob(uuid.v1(), rule, function () {\r\n            console.log(new Date() + \" Running product scraping for scheduler rule \" + rule);\r\n            _this.productService\r\n                .all()\r\n                .then(function (products) {\r\n                products.forEach(function (p) { return _this.queue.enqueue(p.id); });\r\n            });\r\n        }); });\r\n        return true;\r\n    };\r\n    return ScrapeSchedulerService;\r\n}());\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = ScrapeSchedulerService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyYXBlLXNjaGVkdWxlci1zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic2NyYXBlLXNjaGVkdWxlci1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDs7QUFFakQsSUFBWSxRQUFRLFdBQU0sZUFBZSxDQUFDLENBQUE7QUFDMUMsSUFBWSxJQUFJLFdBQU0sV0FBVyxDQUFDLENBQUE7QUFLbEM7SUFDSSxnQ0FBb0IsS0FBeUIsRUFDekIsY0FBOEIsRUFDOUIsU0FBbUI7UUFGbkIsVUFBSyxHQUFMLEtBQUssQ0FBb0I7UUFDekIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLGNBQVMsR0FBVCxTQUFTLENBQVU7UUFDbkMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7WUFDUCxNQUFNLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDMUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUM7WUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1FBQ25ELEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQztZQUNoQyxNQUFNLElBQUksS0FBSyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7SUFDM0QsQ0FBQztJQUVELG9DQUFHLEdBQUg7UUFBQSxpQkFrQkM7UUFqQkcsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLGFBQWEsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDckUsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUVqQixJQUFJLENBQUMsU0FBUzthQUNULEdBQUcsQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUN2QyxJQUFJLEVBQ0o7WUFDSSxPQUFPLENBQUMsR0FBRyxDQUFJLElBQUksSUFBSSxFQUFFLHFEQUFnRCxJQUFNLENBQUMsQ0FBQztZQUVqRixLQUFJLENBQUMsY0FBYztpQkFDZCxHQUFHLEVBQUU7aUJBQ0wsSUFBSSxDQUFDLFVBQUEsUUFBUTtnQkFDVixRQUFRLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsS0FBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUF4QixDQUF3QixDQUFDLENBQUM7WUFDcEQsQ0FBQyxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUMsRUFWTyxDQVVQLENBQUMsQ0FBQztRQUVaLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUNMLDZCQUFDO0FBQUQsQ0FBQyxBQS9CRCxJQStCQztBQS9CRDt3Q0ErQkMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxyXG5cclxuaW1wb3J0ICogYXMgc2NoZWR1bGUgZnJvbSBcIm5vZGUtc2NoZWR1bGVcIjtcclxuaW1wb3J0ICogYXMgdXVpZCBmcm9tIFwibm9kZS11dWlkXCI7XHJcblxyXG5pbXBvcnQgU2NyYXBlUXVldWVTZXJ2aWNlIGZyb20gXCIuL3NjcmFwZS1xdWV1ZS1zZXJ2aWNlXCI7XHJcbmltcG9ydCBQcm9kdWN0U2VydmljZSBmcm9tIFwiLi4vcHJvZHVjdHMvcHJvZHVjdC1zZXJ2aWNlXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY3JhcGVTY2hlZHVsZXJTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcXVldWU6IFNjcmFwZVF1ZXVlU2VydmljZSxcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgcHJvZHVjdFNlcnZpY2U6IFByb2R1Y3RTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBzY2hlZHVsZXM6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgaWYgKCFxdWV1ZSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicXVldWUgaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgICAgIGlmICghcHJvZHVjdFNlcnZpY2UpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInByb2R1Y3RTZXJ2aWNlIGlzIHVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoIXNjaGVkdWxlcyAmJiAhc2NoZWR1bGVzLmxlbmd0aClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwic2NoZWR1bGVzIGlzIHVuZGVmaW5lZCBvciBlbXB0eVwiKTtcclxuICAgIH1cclxuXHJcbiAgICBydW4oKTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKHNjaGVkdWxlLnNjaGVkdWxlZEpvYnMgJiYgT2JqZWN0LmtleXMoc2NoZWR1bGUuc2NoZWR1bGVkSm9icykubGVuZ3RoKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIHRoaXMuc2NoZWR1bGVzXHJcbiAgICAgICAgICAgIC5tYXAocnVsZSA9PiBzY2hlZHVsZS5zY2hlZHVsZUpvYih1dWlkLnYxKCksXHJcbiAgICAgICAgICAgICAgICBydWxlLFxyXG4gICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke25ldyBEYXRlKCl9IFJ1bm5pbmcgcHJvZHVjdCBzY3JhcGluZyBmb3Igc2NoZWR1bGVyIHJ1bGUgJHtydWxlfWApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hbGwoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihwcm9kdWN0cyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0cy5mb3JFYWNoKHAgPT4gdGhpcy5xdWV1ZS5lbnF1ZXVlKHAuaWQpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59Il19\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/services/scraping/scrape-scheduler-service.ts\n ** module id = 47\n ** module chunks = 0\n **/","module.exports = require(\"node-schedule\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-schedule\"\n ** module id = 48\n ** module chunks = 0\n **/"],"sourceRoot":""}