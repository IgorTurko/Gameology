{"version":3,"sources":["webpack:///webpack/bootstrap 4bc4fe7c089acf0ad43a?0131","webpack:///./server/extensions.ts?6836","webpack:///./server/data-access/db.ts?fc04","webpack:///external \"mongodb\"?b417","webpack:///./server/config.ts?d70e","webpack:///external \"fs\"?2e09","webpack:///./server/services/web-shop/mongo-web-shop-storage.ts?d4d9","webpack:///./server/services/web-shop/web-shop-service.ts?8393","webpack:///./server/services/web-shop/web-shop-validator.ts?4110","webpack:///./server/validation/validation.ts?4863","webpack:///./server/services/products/mongo-product-storage.ts?2fde","webpack:///./server/services/products/product-service.ts?576f","webpack:///external \"moment\"?a88d","webpack:///external \"node-uuid\"?fdd4","webpack:///./server/services/event-bus.ts?93ac","webpack:///external \"events\"?c68f","webpack:///./server/services/products/product-validator.ts?6887","webpack:///./server-test/test-parsing/run-page-parsing.ts","webpack:///./server/services/scraping/scrape-service.ts","webpack:///./server/scrapers/jsdom-scraper.ts","webpack:///external \"jsdom\"","webpack:///./server/scrapers/value-parser.ts","webpack:///external \"path\""],"names":[],"mappings":"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","file":"run-page-parsing.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 4bc4fe7c089acf0ad43a\n **/","/// <reference path=\"typings/index.d.ts\" />\r\n\r\nif (!Array.prototype.toHash) {\r\n    Array.prototype.toHash = function toHash<T, K>(keySelector: (elem: T) => string, valueSelector?: (elem: T) => K): { [key: string]: K; } {\r\n        valueSelector = valueSelector || ((e: T) => ((e as any) as K));\r\n\r\n        return this.reduce((hash, elem) => {\r\n            const key = keySelector(elem);\r\n            const value = valueSelector(elem);\r\n\r\n            hash[key] = value;\r\n\r\n            return hash;\r\n        },\r\n        {}) as { [key: string]: K; };\r\n    };\r\n}\r\n\r\nif (!Object.entries) {\r\n    Object.entries = (obj: any) => Object.keys(obj)\r\n        .map(key => ([key, obj[key]]));\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/extensions.ts\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\nimport * as mongo from \"mongodb\";\r\nimport config from \"../config\";\r\n\r\nlet db: Promise<mongo.Db> = new Promise((resolve, reject) => {\r\n    mongo.MongoClient.connect(config.mongoUrl,\r\n    (err, db) => {\r\n        if (err) {\r\n            reject(err);\r\n        } else {\r\n            console.info(`Connected to Mongo server at ${config.mongoUrl}`);\r\n            resolve(db);\r\n        }\r\n    });\r\n});\r\n\r\nexport default class Database {\r\n    static Collections = {\r\n        sessions: \"sessions\",\r\n        webshops: \"webshops\",\r\n        products: \"products\",\r\n        users: \"users\"\r\n    };\r\n\r\n    collection(collection: string): Promise<mongo.Collection> {\r\n        if (!collection)\r\n            throw new Error(\"collection is undefined\");\r\n        if (!Database.Collections[collection])\r\n            throw new Error(`Collection ${collection} is unknown`);\r\n\r\n        return this.connect()\r\n            .then(db => db.collection(collection));\r\n    }\r\n\r\n    private connect(): Promise<mongo.Db> {\r\n        return db;\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/data-access/db.ts\n **/","module.exports = require(\"mongodb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongodb\"\n ** module id = 4\n ** module chunks = 0 1\n **/","/// <reference path=\"typings/index.d.ts\"/>\r\nimport * as fs from \"fs\";\r\n\r\n\r\nlet configContent = fs.readFileSync(\"./config.json\", \"utf8\");\r\nlet configuration = <Configuration>JSON.parse(configContent);\r\n\r\nexport default configuration;\n\n\n/** WEBPACK FOOTER **\n ** ./server/config.ts\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 6\n ** module chunks = 0 1\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport Database from \"../../data-access/db\";\r\n\r\nexport default class MongoWebShopStorage implements WebShops.IWebShopStorage {\r\n    constructor(private db: Database) {\r\n        if (!db)\r\n            throw new Error(\"db is undefined\");\r\n    }\r\n\r\n    all(): Promise<Api.WebShop[]> {\r\n        return this.db\r\n            .collection(Database.Collections.webshops)\r\n            .then(c => c.find({}, { _id: 0 }))\r\n            .then(c => c.toArray());\r\n    }\r\n\r\n    one(id: string): Promise<Api.WebShop> {\r\n        if (!id)\r\n            throw new Error(\"id is undefined\");\r\n\r\n        return this.db\r\n            .collection(Database.Collections.webshops)\r\n            .then(c => c.find({ id: id }, { _id: 0 }))\r\n            .then(c => c.limit(1).next());\r\n    }\r\n\r\n    save(webShop: Api.WebShop): Promise<Api.WebShop> {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n\r\n        return this.db\r\n            .collection(Database.Collections.webshops)\r\n            .then(c => c.updateOne(\r\n                {\r\n                    id: webShop.id\r\n                },\r\n                {\r\n                    $set: {\r\n                        id: webShop.id,\r\n                        title: webShop.title,\r\n                        delivery: webShop.delivery\r\n                    }\r\n                }\r\n            ))\r\n            .then(() => webShop);\r\n    }\r\n\r\n    put(webShop: Api.WebShop): Promise<Api.WebShop> {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n\r\n        return this.db\r\n            .collection(Database.Collections.webshops)\r\n            .then(c => c.updateOne(\r\n                {\r\n                    id: webShop.id\r\n                },\r\n                webShop,\r\n                {\r\n                    upsert: true\r\n                }\r\n            ))\r\n            .then(() => webShop);\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/web-shop/mongo-web-shop-storage.ts\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport WebShopValidator from \"./web-shop-validator\";\r\n\r\nexport default class WebShopService {\r\n\r\n    private validator = new WebShopValidator();\r\n\r\n    constructor(private storage: WebShops.IWebShopStorage) {\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n\r\n    all(): Promise<Api.WebShop[]> {\r\n        return this.storage.all();\r\n    }\r\n\r\n    one(webShopId: string): Promise<Api.WebShop> {\r\n        if (!webShopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        return this.storage.one(webShopId);\r\n    }\r\n\r\n    save(webShop: Api.WebShop): Promise<Api.WebShop | Api.ValidationResult> {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n\r\n        webShop = this.normalize(webShop);\r\n\r\n        return new Promise(resolve => {\r\n            const validationResult = this.validator.validate(webShop);\r\n\r\n            if (!validationResult.ok)\r\n                resolve(validationResult);\r\n            else\r\n                this.storage\r\n                    .save(webShop)\r\n                    .then(() => this.one(webShop.id))\r\n                    .then(entity => resolve(entity))\r\n                    .catch(err => {\r\n                        const errorResult: Api.ValidationResult = {\r\n                            ok: false,\r\n                            errors: {\r\n                                message: err\r\n                            }\r\n                        };\r\n\r\n                        resolve(errorResult);\r\n                    });\r\n        });\r\n    }\r\n\r\n    put(webShop: Api.WebShop): Promise<Api.WebShop | Api.ValidationResult> {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n\r\n        webShop = this.normalize(webShop);\r\n\r\n        return new Promise(resolve => {\r\n\r\n            const validationResult = this.validator.validate(webShop);\r\n\r\n            if (!validationResult.ok)\r\n                resolve(validationResult);\r\n            else\r\n                this.storage\r\n                    .put(webShop)\r\n                    .then(() => this.one(webShop.id))\r\n                    .then(entity => resolve(entity))\r\n                    .catch(err => {\r\n                        const errorResult: Api.ValidationResult = {\r\n                            ok: false,\r\n                            errors: {\r\n                                message: err\r\n                            }\r\n                        };\r\n                        resolve(errorResult);\r\n                    });\r\n\r\n        });\r\n    }\r\n\r\n    private normalize(webShop: Api.WebShop): Api.WebShop {\r\n\r\n        if (webShop.delivery && webShop.delivery.length) {\r\n            webShop.delivery = webShop.delivery\r\n                .map(d => ({\r\n                    deliveryMethod: d.deliveryMethod,\r\n                    price: parseFloat(`${d.price}`)\r\n                }));\r\n        }\r\n\r\n        return webShop;\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/web-shop/web-shop-service.ts\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport { Validator } from \"../../validation/validation\";\r\n\r\nexport default class WebShopValidator {\r\n\r\n    validate(webShop: Api.WebShop): Api.ValidationResult {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n\r\n        const validator = new Validator();\r\n\r\n        return validator\r\n            .property(\"title\")\r\n                .errorIf(() => !webShop.title, \"Title is required\")\r\n                .errorIf(() => webShop.title && webShop.title.length > 1024, \"Title too long\")\r\n            .end()\r\n            .property(\"delivery\")\r\n                .array(webShop.delivery,\r\n                (delivery, validator) => {\r\n                    validator\r\n                        .property(\"deliveryMethod\")\r\n                            .errorIf(() => !delivery.deliveryMethod, \"Delivery method is required\")\r\n                            .errorIf(() => delivery.deliveryMethod && delivery.deliveryMethod.length > 1024, \"Delivery method too long\")\r\n                        .end()\r\n                        .property(\"price\")\r\n                            .errorIf(() => isNaN(delivery.price) || !delivery.price || delivery.price < 0, \"Price is required and must be greater than zero\")\r\n                        .end();\r\n                })\r\n            .end()\r\n            .result();\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/web-shop/web-shop-validator.ts\n **/","/// <reference path=\"../typings/index.d.ts\"/>\r\n\r\ninterface ValidationResult {\r\n    ok: boolean;\r\n    errors: {\r\n        [path: string]: string[];\r\n    }\r\n}\r\n\r\nexport class Validator {\r\n    private context = \"\";\r\n    private parent: Validator;\r\n\r\n    private errors: { [path: string]: string[] } = {};\r\n\r\n    errorIf(isError: () => boolean, errorMessage: string): Validator {\r\n        if (!isError)\r\n            throw new Error(\"isError check is required\");\r\n\r\n        if (!isError())\r\n            return this;\r\n\r\n        const path = this.fullPath();\r\n        \r\n        let errors = this.errors[path];\r\n        if (!errors) {\r\n            errors = [];\r\n            this.errors[path] = errors;\r\n        }\r\n\r\n        errors.push(errorMessage);\r\n\r\n        return this;\r\n    }\r\n\r\n    property(propertyName: string): Validator {\r\n        const nested = new Validator();\r\n        let context = propertyName;\r\n\r\n        if (this.context)\r\n            context = `${this.context}.${propertyName}`;\r\n\r\n        nested.context = context;\r\n        nested.errors = this.errors;\r\n        nested.parent = this;\r\n\r\n        return nested;\r\n    }\r\n\r\n    indexer(index: number): Validator {\r\n        const nested = new Validator();\r\n        let context = `[${index}]`;\r\n\r\n        if (this.context)\r\n            context = `${this.context}${context}`;\r\n\r\n        nested.context = context;\r\n        nested.errors = this.errors;\r\n        nested.parent = this;\r\n\r\n        return nested;\r\n    }\r\n\r\n    array<TElement>(array: TElement[], validator: (element: TElement, acc: Validator) => void): Validator {\r\n        array = array || [];\r\n\r\n        array.forEach((element, index) => {\r\n            const indexerValidator = this.indexer(index);\r\n            validator(element, indexerValidator);\r\n        });\r\n        \r\n        return this;\r\n    }\r\n\r\n    end(): Validator {\r\n        if (!this.parent)\r\n            throw new Error(\"No parent\");\r\n\r\n        return this.parent;\r\n    }\r\n\r\n    result(): ValidationResult {\r\n        return {\r\n            ok: Object.keys(this.errors).length === 0,\r\n            errors: this.errors\r\n        };\r\n    }\r\n\r\n    private fullPath(path?: string): string {\r\n        if (!path && !this.context)\r\n            throw new Error(\"Use property() or indexer() to define value to validate\");\r\n\r\n        if (!path)\r\n            return this.context;\r\n\r\n        if (!this.context)\r\n            return path;\r\n\r\n        return `${this.context}.${path}`;\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/validation/validation.ts\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport Database from \"../../data-access/db\";\r\n\r\nexport default class MongoProductStorage implements Products.IProductStorage {\r\n    constructor(private db: Database) {\r\n        if (!db)\r\n            throw new Error(\"db is missing\");\r\n    }\r\n\r\n    all(): Promise<Api.Product[]> {\r\n        return this.db\r\n            .collection(Database.Collections.products)\r\n            .then(c => c.find({}, { _id: 0 }))\r\n            .then(c => c.toArray());\r\n    }\r\n\r\n    one(id: string): Promise<Api.Product> {\r\n        if (!id)\r\n            throw new Error(\"id is undefined\");\r\n\r\n        return this.db\r\n            .collection(Database.Collections.products)\r\n            .then(c => c.find({ id: id }, { _id: 0 }))\r\n            .then(c => c.limit(1))\r\n            .then(c => c.next());\r\n    }\r\n\r\n    save(product: Api.Product): Promise<Api.Product> {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n\r\n        return this.db\r\n            .collection(Database.Collections.products)\r\n            .then(c => c.updateOne({\r\n                id: product.id\r\n            },\r\n            {\r\n                $set: {\r\n                    id: product.id,\r\n                    title: product.title,\r\n                    scrapingUrls: product.scrapingUrls\r\n                }\r\n            },\r\n            {\r\n                upsert: true\r\n            }))\r\n            .then(() => product);\r\n    }\r\n\r\n    setScrapingData(productId: string, webShopId: string, values: Api.ScrapedValues, log: Api.ScrapeLog): Promise<Api.Product> {\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        if (!webShopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        if (!values)\r\n            throw new Error(\"values is undefined\");\r\n\r\n        return this.db\r\n            .collection(Database.Collections.products)\r\n            .then(c => c.updateOne(\r\n            {\r\n                id: productId\r\n            },\r\n            {\r\n                $set: {\r\n                    [`values.${webShopId}`]: values,\r\n                    [`log.${webShopId}`]: log\r\n                }\r\n            },\r\n            {\r\n                upsert: true\r\n            }))\r\n            .then(r => this.one(productId));\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/products/mongo-product-storage.ts\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport * as moment from \"moment\";\r\nimport * as uuid from \"node-uuid\";\r\n\r\nimport { eventBus, EventNames } from \"../event-bus\";\r\n\r\nimport ProductValidator from \"./product-validator\";\r\n\r\nexport default class ProductService {\r\n    private validator = new ProductValidator();\r\n\r\n    constructor(private storage: Products.IProductStorage) {\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n\r\n    all(): Promise<Api.Product[]> {\r\n        return this.storage.all();\r\n    }\r\n\r\n    save(product: Api.Product): Promise<Api.ValidationResult | Api.Product> {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n\r\n        if (!product.id)\r\n            product.id = uuid.v1();\r\n\r\n        return new Promise(resolve => {\r\n            const validationResult = this.validator.validate(product);\r\n            if (!validationResult.ok)\r\n                resolve(validationResult);\r\n            else {\r\n                this.storage\r\n                    .save(product)\r\n                    .then(() => this.one(product.id))\r\n                    .then(p => {\r\n                        eventBus.emit(EventNames.ProductUpdated, p.id);\r\n\r\n                        return p;\r\n                    })\r\n                    .then(entity => resolve(entity));\r\n            }\r\n        });\r\n    }\r\n\r\n    one(productId: string): Promise<Api.Product> {\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n\r\n        return this.storage.one(productId);\r\n    }\r\n\r\n    updateScrapedData(productId: string, webshopId: string, data: Scraping.WebShopScrapingResult): Promise<Api.Product> {\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        if (!webshopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        if (!data)\r\n            throw new Error(\"data is undefined\");\r\n        const now = moment.utc().toDate();\r\n\r\n        return this.one(productId)\r\n            .then(product => {\r\n                if (!product.values)\r\n                    product.values = {};\r\n\r\n                const values = product.values[webshopId] ||\r\n                {\r\n                    title: null,\r\n                    price: null,\r\n                    image: null\r\n                };\r\n                product.values[webshopId] = values;\r\n\r\n                if (!product.log)\r\n                    product.log = {};\r\n\r\n                const log = product.log[webshopId] ||\r\n                {\r\n                    url: null,\r\n                    scrapedAt: null,\r\n                    error: data.error,\r\n                    values: {}\r\n                };\r\n                product.log[webshopId] = log;\r\n\r\n                log.url = product.scrapingUrls[webshopId];\r\n                log.scrapedAt = now;\r\n                log.error = data.error;\r\n\r\n                Object.keys(data.values)\r\n                    .forEach(name => {\r\n                        const value = data.values[name];\r\n\r\n                        if (value.isSuccessful)\r\n                            values[name] = value.value;\r\n\r\n                        log.values[name] = {\r\n                            scrapedAt: now,\r\n                            error: value.error\r\n                        };\r\n                    });\r\n\r\n                return this.storage.setScrapingData(product.id, webshopId, values, log);\r\n            });\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/products/product-service.ts\n **/","module.exports = require(\"moment\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"moment\"\n ** module id = 13\n ** module chunks = 0 1\n **/","module.exports = require(\"node-uuid\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-uuid\"\n ** module id = 14\n ** module chunks = 0 1\n **/","/// <reference path=\"../typings/index.d.ts\"/>\r\n\r\nimport { EventEmitter } from \"events\";\r\n\r\nclass EventNames {\r\n    /**\r\n     * Published when product inserted or updated.\r\n     * Params is product id: string.\r\n     */\r\n    static ProductUpdated = \"product-updated\";\r\n    /**\r\n     * Published when product data is scraped.\r\n     * Param is product id: string.\r\n     */\r\n    static ProductScraped = \"product-scraped\";\r\n}\r\n\r\nconst eventBus = new EventEmitter();\r\n\r\nexport { eventBus, EventNames };\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/event-bus.ts\n **/","module.exports = require(\"events\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"events\"\n ** module id = 16\n ** module chunks = 0 1\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport { Validator } from \"../../validation/validation\";\r\n\r\nexport default class ProductValidator {\r\n\r\n    validate(product: Api.Product): Api.ValidationResult {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n\r\n        const validator = new Validator();\r\n\r\n        return validator\r\n            .property(\"id\")\r\n                .errorIf(() => !product.id, \"Product ID is required\")\r\n            .end()\r\n            .property(\"title\")\r\n                .errorIf(() => !product.title, \"Product title is required\")\r\n                .errorIf(() => product.title && product.title.length > 1024, \"Product title too long\")\r\n            .end()\r\n            .property(\"scrapingUrls\")\r\n                .errorIf(() => !product.scrapingUrls || Object.keys(product.scrapingUrls).length === 0, \"At least one scraping URL is required\")\r\n            .end()\r\n            .result();\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/products/product-validator.ts\n **/","/// <reference path=\"../../server/typings/index.d.ts\" />\r\n\r\nimport Database from \"../../server/data-access/db\";\r\n\r\nimport MongoProductStorage from \"../../server/services/products/mongo-product-storage\";\r\nimport ProductService from \"../../server/services/products/product-service\";\r\n\r\nimport MongoWebShopStorage from \"../../server/services/web-shop/mongo-web-shop-storage\";\r\nimport WebShopService from \"../../server/services/web-shop/web-shop-service\";\r\n\r\nimport JsdomScraper from \"../../server/scrapers/jsdom-scraper\";\r\n\r\nimport ScrapeService from \"../../server/services/scraping/scrape-service\";\r\n\r\nconst db = new Database();\r\n\r\nconst webShopService = new WebShopService(new MongoWebShopStorage(db));\r\nconst productService = new ProductService(new MongoProductStorage(db));\r\n\r\nconst scrapeService = new ScrapeService(productService, webShopService);\r\n\r\nfunction outputProductScrapeResult(scrapeResult: Scraping.ProductScrapeResult, product: Api.Product, shops: Api.WebShop[]) {\r\n    Object.keys(scrapeResult)\r\n        .forEach(shopId => {\r\n            const shop = shops.filter(s => s.id === shopId)[0];\r\n            const result = scrapeResult[shopId];\r\n\r\n            console.log(`Scrapping of ${product.title} successful for shop ${shop.title}`);\r\n\r\n            const out = {};\r\n            Object.keys(result.values)\r\n                .forEach(k => {\r\n                    const v = result.values[k];\r\n                    if (v.isSuccessful) {\r\n                        out[k] = v.value;\r\n                    } else {\r\n                        out[k] = {\r\n                            error: v.error\r\n                        };\r\n                    }\r\n                });\r\n\r\n            console.dir(out);\r\n        });\r\n\r\n}\r\n\r\nwebShopService.all()\r\n    .then(shops => {\r\n        return productService.all()\r\n            .then(products => {\r\n                const productScrapePromises = products.map(product => {\r\n                    return scrapeService.scrapeProductData(product.id)\r\n                        .then(productScrapeResultHash => outputProductScrapeResult(productScrapeResultHash, product, shops));\r\n                });\r\n\r\n                return Promise.all(productScrapePromises);\r\n            });\r\n    })\r\n    .then(() => {\r\n        console.info(\"Scraping completed successfully\");\r\n        process.exit();\r\n    })\r\n    .catch(err => {\r\n        console.error(\"Scraping failed\");\r\n        console.error(err);\r\n        process.exit();\r\n    });\n\n\n/** WEBPACK FOOTER **\n ** ./server-test/test-parsing/run-page-parsing.ts\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport ProductService from \"../products/product-service\";\r\nimport WebShopService from \"../web-shop/web-shop-service\";\r\n\r\nimport JsdomScraper from \"../../scrapers/jsdom-scraper\";\r\n\r\nimport { eventBus, EventNames } from \"../event-bus\";\r\n\r\ninterface WebShopHash {\r\n    [webShopId: string]: Api.WebShop;\r\n}\r\n\r\nexport default class ScrapeService implements Scraping.IScrapeService {\r\n    private scraper = new JsdomScraper();\r\n    private webShops: Promise<WebShopHash>;\r\n\r\n    constructor(private productService: ProductService,\r\n                private webShopService: WebShopService) {\r\n        if (!productService)\r\n            throw new Error(\"productService is undefined\");\r\n        if (!webShopService)\r\n            throw new Error(\"webShopService is undefined\");\r\n\r\n        this.webShops = this.webShopService\r\n            .all()\r\n            .then(shops => shops.toHash(s => s.id));\r\n    }\r\n\r\n    scrapeProductData(productId: string): Promise<Scraping.ProductScrapeResult> {\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n\r\n        return this.webShops.then(shops => {\r\n            return this.productService.one(productId)\r\n                .then(product => Promise.all(this.scrapeProduct(product, shops))\r\n                    .then(results => results.toHash(e => e.webShopId, e => e.scrapingResult)))\r\n                .then(r => {\r\n                    eventBus.emit(EventNames.ProductScraped, productId);\r\n\r\n                    return r;\r\n                });\r\n        });\r\n    }\r\n\r\n    private scrapeProduct(product: Api.Product, shops: WebShopHash): Promise<{ webShopId: string; scrapingResult: Scraping.WebShopScrapingResult; }>[] {\r\n\r\n        return Object.keys(product.scrapingUrls)\r\n            .map(webShopId => this.scrapeProductFromShopAndSave(product, webShopId, shops)\r\n                .then(productScrapeResult => ({\r\n                    webShopId: webShopId,\r\n                    scrapingResult: productScrapeResult\r\n                })));\r\n    }\r\n\r\n    private scrapeProductFromShopAndSave(product: Api.Product, webShopId: string, shops: WebShopHash): Promise<Scraping.WebShopScrapingResult> {\r\n        return this.scraper\r\n            .scrape(product.scrapingUrls[webShopId], shops[webShopId].scrapingSettings)\r\n            .then(result => this.productService\r\n                .updateScrapedData(product.id, webShopId, result)\r\n                .then(() => result));\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/scraping/scrape-service.ts\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\n\r\nimport * as jsdom from \"jsdom\";\r\nimport ValueParserHash from \"./value-parser\";\r\n\r\nexport default class JsdomScraper implements Scraping.IScraper {\r\n    private valueParser = new ValueParserHash();\r\n\r\n    scrape(url: string, values: Api.ScrapingSettings): Promise<Scraping.WebShopScrapingResult> {\r\n        if (!url)\r\n            throw new Error(\"url is undefined\");\r\n        if (!values)\r\n            throw new Error(\"values is undefined.\");\r\n        if (!Object.keys(values).length)\r\n            throw new Error(\"No values to extract\");\r\n\r\n        const result: Scraping.WebShopScrapingResult = {\r\n            isSuccessful: false,\r\n            error: null,\r\n            values: {}\r\n        };\r\n        // \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\"\r\n        return new Promise(resolve => {\r\n            jsdom.env({\r\n                url: url,\r\n                userAgent: \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\",\r\n                features: {\r\n                    FetchExternalResources: false,\r\n                    ProcessExternalResources: false\r\n                },\r\n                done: (err, window) => {\r\n                    if (err && err.length) {\r\n                        result.isSuccessful = false;\r\n                        result.error = err;\r\n\r\n                        resolve(result);\r\n\r\n                        return;\r\n                    } else {\r\n                        Object.keys(values)\r\n                            .forEach(valueName => {\r\n                                const settings = values[valueName];\r\n                                result.values[valueName] = this.scrapeValue(window.document, settings);\r\n                            });\r\n\r\n                        result.isSuccessful = Object.keys(result.values)\r\n                            .map(valueName => result.values[valueName])\r\n                            .every(v => v.isSuccessful);\r\n\r\n                        resolve(result);  \r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    private scrapeValue(document: Document, valueScrapingSettings: Api.ValueScrapingSettings[]): Scraping.ValueScrapingResult {\r\n        if (!document)\r\n            throw new Error(\"document is undefined\");\r\n        if (!valueScrapingSettings)\r\n            throw new Error(\"valueScrapingSettings is undefined\");\r\n\r\n        const parsingContext: Scraping.ParserContext = {\r\n            pageUrl: document.location.href\r\n        };\r\n\r\n        const result = this.emptyValueScrapingResult();\r\n\r\n        for (let scrapingSetting of valueScrapingSettings) {\r\n            try {\r\n                const rawValue = this.extractRawValueFromDocument(document, scrapingSetting);\r\n                const parsedValue = this.valueParser[scrapingSetting.type](rawValue, parsingContext);\r\n\r\n                result.isSuccessful = true;\r\n                result.error = null;\r\n                result.settings = scrapingSetting;\r\n                result.value = parsedValue;\r\n\r\n                return result;\r\n            } catch (error) {\r\n                result.isSuccessful = false;\r\n                result.error = error;\r\n                result.settings = scrapingSetting;\r\n\r\n                if (scrapingSetting.failOnError)\r\n                    return result;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private extractRawValueFromDocument(document: Document, valueScrapingSetting: Api.ValueScrapingSettings): string {\r\n        const extractMethod = valueScrapingSetting.extract || \"queryselector\";\r\n\r\n        switch (extractMethod) {\r\n            case \"queryselector\":\r\n            {\r\n                const querySelectorSettings = valueScrapingSetting as Api.QuerySelectorExtractSettings;\r\n\r\n                if (!querySelectorSettings.elementSelector)\r\n                    throw new Error(`elementSelector is missing`);\r\n\r\n                const elements = document.querySelectorAll(querySelectorSettings.elementSelector);\r\n                if (elements.length === 0)\r\n                    throw new Error(`Element with selector ${querySelectorSettings.elementSelector} is missing`);\r\n                if (elements.length > 1)\r\n                    throw new Error(`There are more than one element with selector ${querySelectorSettings.elementSelector}`);\r\n\r\n                if (querySelectorSettings.attribute)\r\n                    return elements[0].getAttribute(querySelectorSettings.attribute);\r\n                else\r\n                    return elements[0].textContent;\r\n            };\r\n            case \"regex\":\r\n            {\r\n                const regexSettings = valueScrapingSetting as Api.RegexExtractSettings;\r\n                if (!regexSettings.regex)\r\n                    throw new Error(\"regex missing\");\r\n\r\n                const text = document.querySelector(\"html\").innerHTML;\r\n\r\n                const regex = new RegExp(regexSettings.regex, \"gmi\");\r\n\r\n                const matches = regex.exec(text);\r\n                if (!matches.length)\r\n                    throw new Error(\"No value matches\");\r\n\r\n                return matches[1];\r\n            };\r\n            default:\r\n                throw new Error(\"Unknown extract method\");\r\n        }\r\n    }\r\n\r\n    private emptyValueScrapingResult(): Scraping.ValueScrapingResult {\r\n        return {\r\n            value: null,\r\n            isSuccessful: true,\r\n            error: null,\r\n            settings: null\r\n        };\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/scrapers/jsdom-scraper.ts\n **/","module.exports = require(\"jsdom\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"jsdom\"\n ** module id = 23\n ** module chunks = 1\n **/","/// <reference path=\"../typings/index.d.ts\"/>\r\nimport * as path from \"path\";\r\n\r\nexport default class ValueParserHash {\r\n    parsers = {};\r\n\r\n    constructor() {\r\n        this.parsers[\"string\"] = this.string;\r\n        this.parsers[\"number\"] = this.number;\r\n    }\r\n\r\n    string(input: string): any {\r\n        return (input || \"\").trim();\r\n    }\r\n\r\n    number(input: string): any {\r\n        if (!input)\r\n            throw new Error(\"Number is missing.\");\r\n\r\n        const src = input.replace(/[^0-9\\.]/g, \"\");\r\n\r\n        const number = parseFloat(src);\r\n\r\n        if (number && !isNaN(number))\r\n            return number;\r\n\r\n        throw new Error(\"Number format is not valid.\");\r\n    }\r\n\r\n    relativeUrl(input: string, context: Scraping.ParserContext) {\r\n        return path.posix.join(context.pageUrl, input).replace(\":/\", \"://\");\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/scrapers/value-parser.ts\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 25\n ** module chunks = 1\n **/"],"sourceRoot":""}