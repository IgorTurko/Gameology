{"version":3,"sources":["webpack:///webpack/bootstrap e33f480d615ee3dcfe5a?beb1","webpack:///./server-test/test-parsing/run-page-parsing.ts","webpack:///./server/data-access/db.ts?fc04","webpack:///external \"mongodb\"?b417","webpack:///./server/config.ts?d70e","webpack:///external \"fs\"?2e09","webpack:///./server/services/web-shop/mongo-web-shop-storage.ts?d4d9","webpack:///./server/services/web-shop/web-shop-service.ts?8393","webpack:///./server/services/web-shop/web-shop-validator.ts?4110","webpack:///external \"node-validator\"?9476","webpack:///./server/services/products/mongo-product-storage.ts?2fde","webpack:///./server/services/products/product-service.ts?576f","webpack:///./server/services/products/product-validator.ts?6887","webpack:///./server/scrapers/jsdom-scraper.ts","webpack:///external \"jsdom\"","webpack:///./server/scrapers/value-parser.ts","webpack:///external \"moment\"?a88d"],"names":[],"mappings":"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","file":"run-page-parsing.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap e33f480d615ee3dcfe5a\n **/","/// <reference path=\"../../server/typings/index.d.ts\" />\r\n\r\nimport Database from \"../../server/data-access/db\";\r\n\r\nimport MongoProductStorage from \"../../server/services/products/mongo-product-storage\";\r\nimport ProductService from \"../../server/services/products/product-service\";\r\n\r\nimport MongoWebShopStorage from \"../../server/services/web-shop/mongo-web-shop-storage\";\r\nimport WebShopService from \"../../server/services/web-shop/web-shop-service\";\r\n\r\nimport JsdomScraper from \"../../server/scrapers/jsdom-scraper\";\r\n\r\nconst db = new Database();\r\n\r\nconst webShopService = new WebShopService(new MongoWebShopStorage(db));\r\nconst productService = new ProductService(new MongoProductStorage(db), webShopService);\r\n\r\n\r\nconst jsdomScraper = new JsdomScraper();\r\n\r\nwebShopService.all()\r\n    .then(shops => {\r\n\r\n        return productService.all()\r\n            .then(products => {\r\n                products.forEach(productToScrape => {\r\n                    console.log(`Scraping data for product ${productToScrape.title}`);\r\n                    console.log();\r\n\r\n                    Object.keys(productToScrape.scrapingUrls)\r\n                        .forEach(shopId => {\r\n                            const shop = shops.filter(s => s.id === shopId)[0];\r\n                            const url = productToScrape.scrapingUrls[shopId];\r\n\r\n                            jsdomScraper.scrape(url, shop.scrapingSettings)\r\n                                .then(result => {\r\n                                    console\r\n                                        .log(`Scrapping of ${productToScrape.title} successful for shop ${shop.title}`);\r\n\r\n                                    const out = {};\r\n                                    Object.keys(result.values)\r\n                                        .forEach(k => {\r\n                                            const v = result.values[k];\r\n                                            if (v.isSuccessful) {\r\n                                                out[k] = v.value;\r\n                                            } else {\r\n                                                out[k] = { error: v.error };\r\n                                            }\r\n                                        });\r\n\r\n                                    console.dir(out);\r\n                                })\r\n                                .catch((result: Scraping.ScrapingResult) => {\r\n                                    console\r\n                                        .error(`Scrapping of ${productToScrape.title} failed for shop ${shop.title}`);\r\n                                    if (result.error) {\r\n                                        console.error(result.error);\r\n                                    } else {\r\n                                        const out = Object.keys(result.values)\r\n                                            .map(prop => ({ prop: prop, value: result.values[prop] }))\r\n                                            .reduce((hash, a) => {\r\n                                                if (a.value.isSuccessful)\r\n                                                    hash[a.prop] = a.value.value;\r\n                                                else\r\n                                                    hash[a.prop] = a.value.error;\r\n                                                return hash;\r\n                                            },\r\n                                            {});\r\n\r\n                                        console.dir(out);\r\n                                    }\r\n                                });\r\n                        });\r\n                });\r\n            });\r\n    });\n\n\n/** WEBPACK FOOTER **\n ** ./server-test/test-parsing/run-page-parsing.ts\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\nimport * as mongo from \"mongodb\";\r\nimport config from \"../config\";\r\n\r\nlet db: Promise<mongo.Db> = new Promise((resolve, reject) => {\r\n    mongo.MongoClient.connect(config.mongoUrl,\r\n    (err, db) => {\r\n        if (err) {\r\n            reject(err);\r\n        } else {\r\n            console.log(`Connected to Mongo server at ${config.mongoUrl}`);\r\n            resolve(db);\r\n        }\r\n    });\r\n});\r\n\r\nexport default class Database {\r\n    static Collections = {\r\n        sessions: \"sessions\",\r\n        webshops: \"webshops\",\r\n        products: \"products\"\r\n    };\r\n\r\n    collection(collection: string): Promise<mongo.Collection> {\r\n        if (!collection)\r\n            throw new Error(\"collection is undefined\");\r\n        if (!Database.Collections[collection])\r\n            throw new Error(`Collection ${collection} is unknown`);\r\n\r\n        return this.connect()\r\n            .then(db => db.collection(collection));\r\n    }\r\n\r\n    private connect(): Promise<mongo.Db> {\r\n        return db;\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/data-access/db.ts\n **/","module.exports = require(\"mongodb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongodb\"\n ** module id = 2\n ** module chunks = 0 1\n **/","/// <reference path=\"typings/index.d.ts\"/>\r\nimport * as fs from \"fs\";\r\n\r\n\r\nlet configContent = fs.readFileSync(\"./config.json\", \"utf8\");\r\nlet configuration = <Configuration>JSON.parse(configContent);\r\n\r\nexport default configuration;\n\n\n/** WEBPACK FOOTER **\n ** ./server/config.ts\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 4\n ** module chunks = 0 1\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport Database from \"../../data-access/db\";\r\n\r\nexport default class MongoWebShopStorage implements WebShops.IWebShopStorage {\r\n    constructor(private db: Database) {\r\n        if (!db)\r\n            throw new Error(\"db is undefined\");\r\n    }\r\n\r\n    all(): Promise<WebShops.WebShop[]> {\r\n        return this.db\r\n            .collection(Database.Collections.webshops)\r\n            .then(c => c.find())\r\n            .then(c => c.toArray());\r\n    }\r\n\r\n    one(id: string): Promise<WebShops.WebShop> {\r\n        if (!id)\r\n            throw new Error(\"id is undefined\");\r\n\r\n        return this.db\r\n            .collection(Database.Collections.webshops)\r\n            .then(c => c.find({ id: id }))\r\n            .then(r => r.limit(1))\r\n            .then(c => c.next());\r\n    }\r\n\r\n    save(webShop: WebShops.WebShop): Promise<WebShops.WebShop> {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n\r\n        return this.db\r\n            .collection(Database.Collections.webshops)\r\n            .then(c => c.updateOne({ id: webShop.id }, webShop, { upsert: true }))\r\n            .then(() => webShop);\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/web-shop/mongo-web-shop-storage.ts\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport WebShopValidator from \"./web-shop-validator\";\r\n\r\nexport default class WebShopService {\r\n\r\n    private validator = new WebShopValidator();\r\n\r\n    constructor(private storage: WebShops.IWebShopStorage) {\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n    }\r\n\r\n    all(): Promise<WebShops.WebShop[]> {\r\n        return this.storage.all();\r\n    }\r\n\r\n    one(webShopId: string): Promise<WebShops.WebShop> {\r\n        if (!webShopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n\r\n        return this.storage.one(webShopId);\r\n    }\r\n\r\n    save(webShop: WebShops.WebShop): Promise<Validator.ValidationResult> {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n\r\n        return new Promise((resolve, reject) => {\r\n            this.validator\r\n                .validate(webShop)\r\n                .then(validationResult => {\r\n                    if (!validationResult.isValid)\r\n                        reject(validationResult);\r\n                    else\r\n                        this.storage\r\n                            .save(webShop)\r\n                            .then(() => resolve(validationResult));\r\n                });\r\n        });\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/web-shop/web-shop-service.ts\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport * as validator from \"node-validator\";\r\n\r\nexport default class WebShopValidator {\r\n    private webShopValidator: validator.Validatable;\r\n    private deliveryMethodValidator: validator.Validatable;\r\n\r\n    constructor() {\r\n        this.deliveryMethodValidator = validator.isAnyObject()\r\n            .withRequired(\"deliveryMethod\", validator.isString())\r\n            .withRequired(\"price\", validator.isNumber({ min: 0 }));\r\n\r\n        \r\n        this.webShopValidator = validator.isAnyObject()\r\n            .withRequired(\"title\", validator.isString())\r\n            .withOptional(\"deliveryMethods\", validator.isArray(this.deliveryMethodValidator));\r\n    }\r\n\r\n    validate(webShop: WebShops.WebShop): Promise<Validator.ValidationResult> {\r\n        if (!webShop)\r\n            throw new Error(\"webShop is undefined\");\r\n\r\n        return new Promise(resolve => {\r\n            validator.run(this.webShopValidator,\r\n                webShop,\r\n                (errorCount, errors) => {\r\n                    resolve({\r\n                        isValid: errorCount === 0,\r\n                        errorCount: errorCount,\r\n                        errors: errors\r\n                    });\r\n                });\r\n        });\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/web-shop/web-shop-validator.ts\n **/","module.exports = require(\"node-validator\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-validator\"\n ** module id = 8\n ** module chunks = 0 1\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport Database from \"../../data-access/db\";\r\n\r\nexport default class MongoProductStorage implements Products.IProductStorage {\r\n    constructor(private db: Database) {\r\n        if (!db)\r\n            throw new Error(\"db is missing\");\r\n    }\r\n\r\n    all(): Promise<Products.Product[]> {\r\n        return this.db\r\n            .collection(Database.Collections.products)\r\n            .then(c => c.find())\r\n            .then(c => c.toArray());\r\n    }\r\n\r\n    one(id: string): Promise<Products.Product> {\r\n        if (!id)\r\n            throw new Error(\"id is undefined\");\r\n\r\n        return this.db\r\n            .collection(Database.Collections.products)\r\n            .then(c => c.find({ id: id }))\r\n            .then(c => c.limit(1))\r\n            .then(c => c.next());\r\n    }\r\n\r\n    save(product: Products.Product): Promise<Products.Product> {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n\r\n        return this.db\r\n            .collection(Database.Collections.products)\r\n            .then(c => c.updateOne({ id: product.id }, product, { upsert: true }))\r\n            .then(() => product);\r\n    }\r\n\r\n    setScrapingData(productId: string, webShopId: string, scrapingData: Products.ProductScrapedData): Promise<Products.ProductScrapedData> {\r\n        throw new Error();\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/products/mongo-product-storage.ts\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport ProductValidator from \"./product-validator\";\r\nimport WebShopService from \"../web-shop/web-shop-service\";\r\nimport * as moment from \"moment\";\r\n\r\nexport default class ProductService {\r\n    private validator = new ProductValidator();\r\n\r\n    constructor(private storage: Products.IProductStorage,\r\n                private webShopService: WebShopService) {\r\n        if (!storage)\r\n            throw new Error(\"storage is undefined\");\r\n        if (!webShopService)\r\n            throw new Error(\"webShopService is undefined\");\r\n    }\r\n\r\n    all(): Promise<Products.Product[]> {\r\n        return this.storage\r\n            .all();\r\n    }\r\n\r\n    save(product: Products.Product): Promise<Validator.ValidationResult> {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n\r\n        return new Promise((resolve, reject) => {\r\n            this.validator\r\n                .validate(product)\r\n                .then(validationResult => {\r\n                    if (!validationResult.isValid)\r\n                        reject(validationResult);\r\n                    else\r\n                        this.storage\r\n                            .save(product)\r\n                            .then(() => resolve(validationResult));\r\n                });\r\n        });\r\n    }\r\n\r\n    one(productId: string): Promise<Products.Product> {\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n\r\n        return this.storage.one(productId);\r\n    }\r\n\r\n    updateScrapedData(productId: string, webshopId: string, data: Products.ProductScrapedData): Promise<any> {\r\n        if (!productId)\r\n            throw new Error(\"productId is undefined\");\r\n        if (!webshopId)\r\n            throw new Error(\"webShopId is undefined\");\r\n        if (!data)\r\n            throw new Error(\"data is undefined\");\r\n\r\n        return Promise.all([this.one(productId), this.webShopService.one(webshopId)])\r\n            .then(([product, webshop]) => {\r\n                data.scrapedAt = moment().toDate();\r\n                data.url = product.scrapingUrls[webshopId];\r\n                \r\n            });\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/products/product-service.ts\n **/","/// <reference path=\"../../typings/index.d.ts\" />\r\n\r\nimport * as validator from \"node-validator\";\r\n\r\nexport default class ProductValidator {\r\n    private productValidator: validator.Validatable;\r\n\r\n    constructor() {\r\n        this.productValidator = validator.isAnyObject()\r\n            .withRequired(\"id\", validator.isString())\r\n            .withRequired(\"title\", validator.isString());\r\n\r\n    }\r\n\r\n    validate(product: Products.Product): Promise<Validator.ValidationResult> {\r\n        if (!product)\r\n            throw new Error(\"product is undefined\");\r\n\r\n        return new Promise(resolve => {\r\n            validator.run(this.productValidator,\r\n                product,\r\n                (errorCount, errors) => {\r\n                    resolve({\r\n                        isValid: errorCount === 0,\r\n                        errorCount: errorCount,\r\n                        errors: errors\r\n                    });\r\n                });\r\n        });\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/services/products/product-validator.ts\n **/","/// <reference path=\"../typings/index.d.ts\" />\r\nimport * as jsdom from \"jsdom\";\r\nimport ValueParserHash from \"./value-parser\";\r\n\r\nexport default class JsdomScraper implements Scraping.IScraper {\r\n    private valueParser = new ValueParserHash();\r\n\r\n    scrape(url: string, values: Scraping.ScrapingSettings): Promise<Scraping.ScrapingResult> {\r\n        if (!url)\r\n            throw new Error(\"url is undefined\");\r\n        if (!values)\r\n            throw new Error(\"values is undefined.\");\r\n        if (!Object.keys(values).length)\r\n            throw new Error(\"No values to extract\");\r\n\r\n\r\n        let result: Scraping.ScrapingResult = {\r\n            isSuccessful: false,\r\n            error: null,\r\n            values: {}\r\n        };\r\n       // \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\"\r\n        return new Promise((resolve, reject) => {\r\n            jsdom.env({\r\n                url: url,\r\n                userAgent: \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\",\r\n                features: {\r\n                    FetchExternalResources: false,\r\n                    ProcessExternalResources: false\r\n                },\r\n                done: (err, window) => {\r\n                    if (err && err.length) {\r\n                        result.isSuccessful = false;\r\n                        result.error = err;\r\n\r\n                        reject(result);\r\n\r\n                        return;\r\n                    }\r\n                    else {\r\n                        Object.keys(values)\r\n                            .forEach(valueName => {\r\n                                const settings = values[valueName];\r\n                                result.values[valueName] = this.scrapeValue(window.document, settings);\r\n                            });\r\n\r\n                        result.isSuccessful = Object.keys(result.values)\r\n                            .map(valueName => result.values[valueName])\r\n                            .every(v => v.isSuccessful);\r\n\r\n\r\n                        if (result.isSuccessful)\r\n                            resolve(result);\r\n                        else\r\n                            reject(result);\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    private scrapeValue(document: Document, valueScrapingSettings: Scraping.ValueScrapingSettings[]): Scraping.ValueScrapingResult {\r\n        if (!document)\r\n            throw new Error(\"document is undefined\");\r\n        if (!valueScrapingSettings)\r\n            throw new Error(\"valueScrapingSettings is undefined\");\r\n\r\n        const result = this.emptyValueScrapingResult();\r\n\r\n        for (let scrapingSetting of valueScrapingSettings) {\r\n            try {\r\n                const rawValue = this.extractRawValueFromDocument(document, scrapingSetting);\r\n                const parsedValue = this.valueParser[scrapingSetting.type](rawValue);\r\n\r\n                result.isSuccessful = true;\r\n                result.error = null;\r\n                result.settings = scrapingSetting;\r\n                result.value = parsedValue;\r\n\r\n                return result;\r\n            }\r\n            catch (error) {\r\n                result.isSuccessful = false;\r\n                result.error = error;\r\n                result.settings = scrapingSetting;\r\n\r\n                if (scrapingSetting.failOnError === true)\r\n                    return result;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private extractRawValueFromDocument(document: Document, valueScrapingSetting: Scraping.ValueScrapingSettings): string {\r\n        const extractMethod = valueScrapingSetting.extract || \"queryselector\";\r\n\r\n        switch (extractMethod) {\r\n            case \"queryselector\": {\r\n                const querySelectorSettings = valueScrapingSetting as Scraping.QuerySelectorExtractSettings;\r\n\r\n                if (!querySelectorSettings.elementSelector)\r\n                    throw new Error(`elementSelector is missing`);\r\n\r\n                let elements = document.querySelectorAll(querySelectorSettings.elementSelector);\r\n                if (elements.length === 0)\r\n                    throw new Error(`Element with selector ${querySelectorSettings.elementSelector} is missing`);\r\n                if (elements.length > 1)\r\n                    throw new Error(`There are more than one element with selector ${querySelectorSettings.elementSelector}`);\r\n\r\n                if (querySelectorSettings.attribute)\r\n                    return elements[0].getAttribute(querySelectorSettings.attribute);\r\n                else\r\n                    return elements[0].textContent;\r\n            };\r\n            case \"regex\": {\r\n                const regexSettings = valueScrapingSetting as Scraping.RegexExtractSettings;\r\n                if (!regexSettings.regex)\r\n                    throw new Error(\"regex missing\");\r\n\r\n                const text = document.querySelector(\"html\").innerHTML;\r\n\r\n                const regex = new RegExp(regexSettings.regex, \"gmi\");\r\n\r\n                const matches = regex.exec(text);\r\n                if (!matches.length)\r\n                    throw new Error(\"No value matches\");\r\n\r\n                return matches[1];\r\n            };\r\n            default: \r\n                throw new Error(\"Unknown extract method\");\r\n        }\r\n    }\r\n\r\n    private emptyValueScrapingResult(): Scraping.ValueScrapingResult {\r\n        return {\r\n            value: null,\r\n            isSuccessful: true,\r\n            error: null,\r\n            settings: null\r\n        };\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/scrapers/jsdom-scraper.ts\n **/","module.exports = require(\"jsdom\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"jsdom\"\n ** module id = 15\n ** module chunks = 1\n **/","/// <reference path=\"../typings/index.d.ts\"/>\r\n\r\nexport default class ValueParserHash {\r\n    parsers = {};\r\n\r\n    constructor() {\r\n        this.parsers[\"string\"] = this.string;\r\n        this.parsers[\"number\"] = this.number;\r\n    }\r\n\r\n    string(input: string): any {\r\n        return (input || \"\").trim();\r\n    }\r\n\r\n    number(input: string): any {\r\n        if (!input)\r\n            throw new Error(\"Number is missing.\");\r\n\r\n        const src = input.replace(/[^0-9\\.]/g, \"\");\r\n\r\n        const number = parseFloat(src);\r\n\r\n        if (number && !isNaN(number))\r\n            return number;\r\n\r\n        throw new Error(\"Number format is not valid.\");\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/scrapers/value-parser.ts\n **/","module.exports = require(\"moment\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"moment\"\n ** module id = 17\n ** module chunks = 0 1\n **/"],"sourceRoot":""}